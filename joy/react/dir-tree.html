<!DOCTYPE html><html><head><style id="theme-color">:root {
              --ant-primary-color: rgb(250, 84, 28);
              --ant-primary-color-disabled: #ffd8bf;
              --ant-primary-color-hover: #ff7a45;
              --ant-primary-color-active: #ad2102;
              --ant-primary-color-outline: rgba(250, 84, 28, 0.2);
              --ant-primary-color-deprecated-bg: #ffd8bf;
              --ant-primary-color-deprecated-border: #ff9c6e;
              --ant-primary-1: #fff2e8;
              --ant-primary-2: #ffd8bf;
              --ant-primary-3: #ffbb96;
              --ant-primary-4: #ff9c6e;
              --ant-primary-5: #ff7a45;
              --ant-primary-6: #fa541c;
              --ant-primary-7: #d4380d;
              --ant-primary-8: #ad2102;
              --ant-primary-9: #871400;
              --ant-primary-10: #610b00;
              --ant-primary-color-deprecated-l-35: rgb(254, 216, 203);
              --ant-primary-color-deprecated-l-20: rgb(252, 159, 128);
              --ant-primary-color-deprecated-t-20: rgb(251, 118, 73);
              --ant-primary-color-deprecated-t-50: rgb(253, 170, 142);
              --ant-primary-color-deprecated-f-12: rgba(250, 84, 28, 0.12);
              --ant-primary-color-active-deprecated-f-30: rgba(255, 242, 232, 0.3);
              --ant-primary-color-active-deprecated-d-02: rgb(255, 236, 222);
            }</style><link rel="stylesheet" href="/static/antd.variable.css"/><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>目录结构</title><meta name="joy-head-count" content="3"/><link rel="icon" href="data:image/ico;base64,aWNv"/><link rel="preload" href="/_joy/static/css/5839b0d50b0b717131ce.css" as="style"/><link rel="stylesheet" href="/_joy/static/css/5839b0d50b0b717131ce.css" data-n-g=""/><noscript data-n-css="true"></noscript><link rel="preload" href="/_joy/static/chunks/main-afae04c633ecb7831b2d.js" as="script"/><link rel="preload" href="/_joy/static/chunks/webpack-373fdeea3ec48be3183e.js" as="script"/><link rel="preload" href="/_joy/static/chunks/framework-c68016514741a3bee8af.js" as="script"/><link rel="preload" href="/_joy/static/chunks/commons-661a67bd51344448fa8d.js" as="script"/><link rel="preload" href="/_joy/static/chunks/pages/_app-7b903e89152bab22741a.js" as="script"/></head><body data-theme="light" data-is-mobile="false"><script src="https://cdn.staticfile.org/darkreader/4.9.44/darkreader.min.js"></script><script>
                if (typeof window !== "undefined") {
                  const theme = window.localStorage.getItem("theme") || 'light';
                  const oBody = document.getElementsByTagName("body")[0];
                  oBody.setAttribute("data-theme", theme);

                  if (theme === "dark") {
                    const defaultTheme = {
                      brightness: 100,
                      contrast: 90,
                      sepia: 10,
                    };

                    const defaultFixes = {
                      invert: [],
                      css: "",
                      ignoreInlineStyle: [".react-switch-handle"],
                      ignoreImageAnalysis: [],
                      disableStyleSheetsProxy: true,
                    };
                    if (window.MutationObserver) DarkReader.enable(defaultTheme, defaultFixes);
                  } else {
                    if (window.MutationObserver) DarkReader.disable();
                  }
                }
              </script><div id="__joy"><section class="ant-layout"><header class="layout_header__1OM0M"><nav id="nav" class="layout_nav__K3mbB"><div id="nav-inner" class="layout_nav__inner__2uMRU"><a id="logo" class="layout_logo__FKYzP" href="/">Symph Joy</a><button id="collapseBtn" type="button" class="ant-btn ant-btn-text ant-btn-lg layout_menu__collapseBtn__FF_4T"><span role="img" aria-label="menu-unfold" class="anticon anticon-menu-unfold"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu-unfold" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM142.4 642.1L298.7 519a8.84 8.84 0 000-13.9L142.4 381.9c-5.8-4.6-14.4-.5-14.4 6.9v246.3a8.9 8.9 0 0014.4 7z"></path></svg></span></button><ul class="ant-menu-overflow ant-menu ant-menu-root ant-menu-horizontal ant-menu-light layout_menu__2a0TM layout_menu__collapsed__cIvBb" role="menu" tabindex="0" data-menu-list="true"><li class="ant-menu-overflow-item ant-menu-item ant-menu-item-only-child" style="opacity:1;order:0" role="menuitem" tabindex="-1"><span class="ant-menu-title-content"><div class="ant-select ant-select-auto-complete ant-select-single ant-select-allow-clear ant-select-customize-input ant-select-show-search"><div class="ant-select-selector"><span class="ant-select-selection-search"><span class="ant-input-affix-wrapper ant-select-selection-search-input layout_search__3NGXd"><span class="ant-input-prefix"><span role="img" aria-label="search" class="anticon anticon-search"><svg viewBox="64 64 896 896" focusable="false" data-icon="search" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0011.6 0l43.6-43.5a8.2 8.2 0 000-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"></path></svg></span></span><input type="search" autoComplete="off" placeholder="搜索" class="ant-input" role="combobox" aria-haspopup="listbox" aria-owns="undefined_list" aria-autocomplete="list" aria-controls="undefined_list" aria-activedescendant="undefined_list_0" value=""/></span></span><span class="ant-select-selection-placeholder"></span></div></div></span></li><li class="ant-menu-overflow-item ant-menu-submenu ant-menu-submenu-horizontal" style="opacity:1;order:1" role="none"><div role="menuitem" class="ant-menu-submenu-title" tabindex="-1" aria-expanded="false" aria-haspopup="true"><span class="ant-menu-title-content">项目</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-overflow-item ant-menu-item ant-menu-item-only-child" style="opacity:1;order:2" role="menuitem" tabindex="-1"><span class="ant-menu-title-content"><a href="/plugin/index">插件</a></span></li><li class="ant-menu-overflow-item ant-menu-item ant-menu-item-only-child" style="opacity:1;order:3" role="menuitem" tabindex="-1"><span class="ant-menu-title-content"><a href="/v1/readme">v1</a></span></li><li class="ant-menu-overflow-item ant-menu-item ant-menu-item-only-child" style="opacity:1;order:4" role="menuitem" tabindex="-1"><span class="ant-menu-title-content"><a target="_blank" href="https://github.com/lnlfps/symph-joy">Github</a></span></li><li class="ant-menu-overflow-item ant-menu-item ant-menu-item-only-child" style="opacity:1;order:5" role="menuitem" tabindex="-1"><span class="ant-menu-title-content"><a id="change-theme" class="layout_theme__switch__133kS"><span><span role="img" class="anticon"><svg viewBox="0 0 1024 1024" fill="currentColor" width="1em" height="1em"><path d="M512 832a64 64 0 0 1 64 64v64a64 64 0 1 1-128 0v-64a64 64 0 0 1 64-64z m0-640a64 64 0 0 1-64-64V64a64 64 0 1 1 128 0v64a64 64 0 0 1-64 64z m448 256a64 64 0 1 1 0 128h-64a64 64 0 1 1 0-128h64zM192 512a64 64 0 0 1-64 64H64a64 64 0 1 1 0-128h64a64 64 0 0 1 64 64z m636.768 226.272l45.248 45.248a64 64 0 1 1-90.496 90.496l-45.248-45.248a64 64 0 1 1 90.496-90.496zM195.232 285.728L149.984 240.48a64 64 0 1 1 90.496-90.496l45.248 45.248a64 64 0 1 1-90.496 90.496z m633.536 0a64 64 0 1 1-90.496-90.496l45.248-45.248a64 64 0 1 1 90.496 90.496l-45.248 45.248zM195.232 738.272a64 64 0 1 1 90.496 90.496l-45.248 45.248a64 64 0 1 1-90.496-90.496l45.248-45.248zM512 256a256 256 0 1 0 0 512 256 256 0 0 0 0-512z m0 416a160 160 0 1 1 0.032-320.032A160 160 0 0 1 512 672z" p-id="2605"></path></svg></span><span role="img" class="anticon"><svg viewBox="0 0 1024 1024" fill="currentColor" width="1em" height="1em"><path d="M514.56 938.666667h-40.106667a426.666667 426.666667 0 0 1 0-853.333334 42.666667 42.666667 0 0 1 42.666667 21.76A42.666667 42.666667 0 0 1 512 153.173333a256 256 0 0 0 358.4 358.4 42.666667 42.666667 0 0 1 46.08-2.986666 42.666667 42.666667 0 0 1 21.76 42.666666A426.666667 426.666667 0 0 1 514.56 938.666667zM397.226667 189.44a341.333333 341.333333 0 1 0 437.333333 437.333333A341.333333 341.333333 0 0 1 381.013333 356.266667a341.333333 341.333333 0 0 1 16.213334-166.826667z" p-id="3227"></path></svg></span></span></a></span></li><li class="ant-menu-overflow-item ant-menu-overflow-item-rest ant-menu-submenu ant-menu-submenu-horizontal" style="opacity:0;height:0;overflow-y:hidden;order:9007199254740991;pointer-events:none;position:absolute" aria-hidden="true" role="none"><div role="menuitem" class="ant-menu-submenu-title" tabindex="-1" aria-expanded="false" aria-haspopup="true"><span role="img" aria-label="ellipsis" class="anticon anticon-ellipsis"><svg viewBox="64 64 896 896" focusable="false" data-icon="ellipsis" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M176 511a56 56 0 10112 0 56 56 0 10-112 0zm280 0a56 56 0 10112 0 56 56 0 10-112 0zm280 0a56 56 0 10112 0 56 56 0 10-112 0z"></path></svg></span><i class="ant-menu-submenu-arrow"></i></div></li></ul><div style="display:none" aria-hidden="true"></div></div></nav></header><main class="ant-layout-content"><div class="docs_layoutContent__1N8MU"><div class="docs_docMenus__2pe7u"><div class=""><div class="docs_titleContainer__3i08V"> <span role="img" aria-label="bars" style="margin-right:4px" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0z"></path></svg></span> <!-- -->@symph/joy</div><ul class="ant-menu ant-menu-root ant-menu-inline ant-menu-light" role="menu" tabindex="0" data-menu-list="true"><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="none"><div role="menuitem" style="padding-left:24px" class="ant-menu-submenu-title" tabindex="-1" aria-expanded="true" aria-haspopup="true"><span class="ant-menu-title-content">介绍</span><i class="ant-menu-submenu-arrow"></i></div><ul class="ant-menu ant-menu-sub ant-menu-inline" data-menu-list="true"><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content">@symph/joy</span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content">快速开始</span></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="none"><div role="menuitem" style="padding-left:24px" class="ant-menu-submenu-title" tabindex="-1" aria-expanded="true" aria-haspopup="true"><span class="ant-menu-title-content">前端开发</span><i class="ant-menu-submenu-arrow"></i></div><ul class="ant-menu ant-menu-sub ant-menu-inline" data-menu-list="true"><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content">React 开发</span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-selected ant-menu-item-only-child"><span class="ant-menu-title-content">目录结构</span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content">React 约定路由</span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content">使用 CSS 样式</span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content">使用图片</span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content">Head 组件</span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content">自定义 App</span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content">自定义 Document</span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content">导出 React</span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content">动态按需加载</span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content">快速刷新 Fast Refresh</span></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="none"><div role="menuitem" style="padding-left:24px" class="ant-menu-submenu-title" tabindex="-1" aria-expanded="true" aria-haspopup="true"><span class="ant-menu-title-content">后端开发</span><i class="ant-menu-submenu-arrow"></i></div><ul class="ant-menu ant-menu-sub ant-menu-inline" data-menu-list="true"><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content">Node.js 服务开发</span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content">静态文件服务</span></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="none"><div role="menuitem" style="padding-left:24px" class="ant-menu-submenu-title" tabindex="-1" aria-expanded="true" aria-haspopup="true"><span class="ant-menu-title-content">Joy 进阶</span><i class="ant-menu-submenu-arrow"></i></div><ul class="ant-menu ant-menu-sub ant-menu-inline" data-menu-list="true"><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content">使用 TypeScript</span></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="none"><div role="menuitem" style="padding-left:24px" class="ant-menu-submenu-title" tabindex="-1" aria-expanded="true" aria-haspopup="true"><span class="ant-menu-title-content">应用容器</span><i class="ant-menu-submenu-arrow"></i></div><ul class="ant-menu ant-menu-sub ant-menu-inline" data-menu-list="true"><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content">应用容器</span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content">组件</span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content">配置类</span></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="none"><div role="menuitem" style="padding-left:24px" class="ant-menu-submenu-title" tabindex="-1" aria-expanded="true" aria-haspopup="true"><span class="ant-menu-title-content">配置管理</span><i class="ant-menu-submenu-arrow"></i></div><ul class="ant-menu ant-menu-sub ant-menu-inline" data-menu-list="true"><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content">配置管理</span></li><li role="menuitem" tabindex="-1" style="padding-left:48px" class="ant-menu-item ant-menu-item-only-child"><span class="ant-menu-title-content">Joy 应用配置</span></li></ul></li></ul><div style="display:none" aria-hidden="true"></div></div></div><div class="docs_menuIcon__3YKAQ"><span role="img" aria-label="menu-unfold" class="anticon anticon-menu-unfold"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu-unfold" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM142.4 642.1L298.7 519a8.84 8.84 0 000-13.9L142.4 381.9c-5.8-4.6-14.4-.5-14.4 6.9v246.3a8.9 8.9 0 0014.4 7z"></path></svg></span></div><div class="docs_right__1ZHMG"><div class="docs_center__23l0Z"><div class="ant-spin-nested-loading"><div class="ant-spin-container"><div class="docs_docContent__jPjeX">
                <h1 id="%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84">
                  目录结构
                </h1>
                <h2 id="%E7%BA%A6%E5%AE%9A%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84">
                  约定目录结构
                </h2><p>Joy 支持 React 和 Node 以及两者的混合应用，下面列举各种应用类型常用的约定目录结构。</p>

                <h3 id="react-%E5%BA%94%E7%94%A8">
                  React 应用
                </h3><pre><code class="hljs language-text">myapp
    src             // 源代码目录
        pages       // React文件约定路由目录
        models      // ReactModel目录
        components  // React组件目录
        server      // 可选，server端目录
    config          // 配置目录
        config.ts   // 配置文件
    public          // 静态文件目录
        logo.png    // 静态图片文件
    package.json
</code></pre>

                <h3 id="%E5%89%8D%E5%90%8E%E7%AB%AF%E6%B7%B7%E5%90%88%E5%BA%94%E7%94%A8">
                  前后端混合应用
                </h3><pre><code class="hljs language-text">myapp
    src                 // 源代码目录
        common:         // 前后端共享的代码，如类接口定义，通用处理方法等。
        server          // 服务端代码
            controllers
            services
        client          // 可选，客户端目录
            pages       // 约定React路由目录
            models      // ReactModel目录
            components  // React组件目录
    config              // 配置目录
        config.ts       // 配置文件
    public              // 静态文件目录
        logo.png        // 静态图片文件
    package.json
</code></pre>

                <h2 id="%E7%9B%AE%E5%BD%95%E8%AF%B4%E6%98%8E">
                  目录说明
                </h2>
                <h3 id="src-%E7%9B%AE%E5%BD%95">
                  src 目录
                </h3><p>源代码目录。</p>

                <h3 id="server-%E7%9B%AE%E5%BD%95">
                  server 目录
                </h3><p>服务端相关代码，如果不需要服务端提供后端服务，可以没有该目录。</p>

                <h3 id="client-%E7%9B%AE%E5%BD%95">
                  client 目录
                </h3><p>React 客户端应用相关的代码，该目录可选：</p>
<ul>
<li><code>client</code>这级目录可以省略，直接在<code>src</code>下创建 React 的源代码文件，例如<code>src/pages/index.tsx</code>。</li>
<li>如果应用只提供 Api 服务，不需要前端 React 界面，可以没有该目录。</li>
</ul>

                <h4 id="clientpages-%E6%88%96%E8%80%85-pages-%E7%9B%AE%E5%BD%95">
                  client/pages 或者 pages 目录
                </h4><p>React 约定文件路由目录，具体使用方法，请查看 <a href="/joy/basic/joy-fs-router">路由</a> 章节。</p>

                <h3 id="config-%E7%9B%AE%E5%BD%95">
                  config 目录
                </h3><p>存放应用配置文件， 请转到 <a href="/joy/config/config-manage">配置管理</a> 查看如何配置应用。</p>

                <h3 id="env">
                  .env
                </h3><p><a href="https://github.com/motdotla/dotenv">dotenv</a> 环境变量配置文件。
例如：</p>
<pre><code class="hljs language-text">port=8888
host=localhost
</code></pre>

                <h3 id="public-%E7%9B%AE%E5%BD%95">
                  public 目录
                </h3><p>存放静态资源文件，可直接通过 http 直接访问，例如文件 <code>/myapp/public/logo.png</code> 可通过 <code>http://localhost:3000/logo.png</code>访问。</p>

                <h3 id="joy-%E7%9B%AE%E5%BD%95">
                  .joy 目录
                </h3><p><code>.joy</code> 目录是在运行时自动生成的目录，是 Joy 应用必须的，可以随时删除，在下次运行时重新生成该目录。
日常开发时，我们不用去关注和修改里面的文件。
里面主要包含的文件有：</p>
<ul>
<li>用于代码扫描分析的临时文件，以及分析后的产出物。</li>
<li>webpack 构建的缓存、日志物。</li>
<li>Joy 应用运行加载的源文件，这些文件是编译打包后的源文件。</li>
</ul>

                <h3 id="out-%E7%9B%AE%E5%BD%95">
                  out 目录
                </h3><p>运行<code>joy export</code> 命令的默认输出目录，存放 React 导出后的静态文件，部署该目录到静态文件服务器即可，例如 Nginx 。</p>
</div></div></div></div><div class="docs_titleTree__2wlEA"><div><div class=""><div class="ant-anchor-wrapper" style="max-height:100vh"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#%E7%BA%A6%E5%AE%9A%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84" title="约定目录结构">约定目录结构</a><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#react-%E5%BA%94%E7%94%A8" title="React 应用">React 应用</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#%E5%89%8D%E5%90%8E%E7%AB%AF%E6%B7%B7%E5%90%88%E5%BA%94%E7%94%A8" title="前后端混合应用">前后端混合应用</a></div></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#%E7%9B%AE%E5%BD%95%E8%AF%B4%E6%98%8E" title="目录说明">目录说明</a><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#src-%E7%9B%AE%E5%BD%95" title="src 目录">src 目录</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#server-%E7%9B%AE%E5%BD%95" title="server 目录">server 目录</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#client-%E7%9B%AE%E5%BD%95" title="client 目录">client 目录</a><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#clientpages-%E6%88%96%E8%80%85-pages-%E7%9B%AE%E5%BD%95" title="client/pages 或者 pages 目录">client/pages 或者 pages 目录</a></div></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#config-%E7%9B%AE%E5%BD%95" title="config 目录">config 目录</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#env" title=".env">.env</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#public-%E7%9B%AE%E5%BD%95" title="public 目录">public 目录</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#joy-%E7%9B%AE%E5%BD%95" title=".joy 目录">.joy 目录</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#out-%E7%9B%AE%E5%BD%95" title="out 目录">out 目录</a></div></div></div></div></div></div></div></div></div></main></section></div><script id="__JOY_DATA__" type="application/json">{"initState":[{"pathname":"INIT@/joy/react/dir-tree","ssgData":[{"type":"__INIT_MODEL","state":{"noop":{},"reactAppInitManager":{},"layoutModel":{"collapsed":true,"isMobile":false},"docsModel":{"loadingCurrentDoc":false,"docMenus":[],"titleTrees":[],"result":[],"openKeys":[],"snippets":{},"defaultOpenKeys":[]}}}]},{"pathname":"/","ssgData":[{"type":"reactAppInitManager/__SET_STATE","state":{"/":{"pathname":"/","index":false,"initStatic":2}}}]},{"pathname":"/joy","ssgData":[{"type":"docsModel/__SET_STATE","state":{"docMenus":[{"title":"介绍","path":"/joy/01-start","file":"docs/joy/01-start","children":[{"title":"@symph/joy","path":"/joy/start/introduce","file":"docs\\joy\\01-start\\01-introduce.md","hasMenu":false,"mdContent":"# @symph/joy\r\n\r\n@symph/joy 是 symph 架构体系中的应用层架构，集成了大量最佳实践的方案和研发工具，零配置可用，即使刚接触 React 或 Node 服务研发，也可以轻松快速的创建可靠的 JS/TS 应用。\r\n\r\n```mermaid\r\ngraph BT\r\n  Config(\"@symph/config\")\r\n  Core(\"@symph/core\")\r\n  React(\"@symph/react\")\r\n  Joy(\"@symph/joy\")\r\n  Server(\"@symph/server\")\r\n  Webpack(\"Webpack\")\r\n  Config --\u003e React\r\n  Core --\u003e React\r\n  React --\u003e Joy\r\n  Config --\u003e Server\r\n  Core --\u003e Server\r\n  Server --\u003e Joy\r\n  Webpack --\u003e Joy\r\n```\r\n\r\n`@symph/core` IoC 核心，提供组件容器、注入器、全局 Hook 管理的能力。\r\n\r\n[`@symph/config`](/config/start/introduce) 应用配置管理，提供应用级的配置读取、验证、注入等。\r\n\r\n[`@symph/react`](/react/start/introduce) React 的 MVC 框架，可轻松开发大型复杂 React 单页面应用，提供 React MVC 基础组件，统一数据管理，单向数据绑定和路由等基础功能。\r\n\r\n[`@symph/server`](/react/start/introduce) 基于依赖注入和装饰器，类似 Spring MVC 的 Web 后端研发框架。\r\n\r\n[`@symph/joy`](/joy/start/introduce) 整合 @symph/server 和 @symph/react，server 提供业务服务，react 负责展示和交互，是集成开发调试、编译打包、服务运行等的全栈式工具。\r\n\r\n## 特征\r\n\r\n- 零配置可用，集成最佳实践配置，快速启动开发，提供研发全流程工具链。\r\n- 支持多端多类型应用开发：React、Electron、Server、Proxy Server 等。\r\n- 现代化面向对象和 IoC 设计原则，更能适应企业级迭代开发。\r\n- 默认支持和推荐使用 TypeScript，提供静态类型检查和高级语法特性。\r\n- Joy React 应用原生支持：全局状态管理、约定路由、懒加载、热更新、服务端渲染、预渲染、静态部署等。\r\n- Joy Node 应用原生支持：全局配置管理、MVC 组件、Middleware、Pipe、Guards、Fastify 集成等。\r\n- 子模块独立维护和使用，即可选择性单独使用 IoC 库，Config 配置管理、React 应用、Node 应用。\r\n- 插件化开发，便于定制功能和扩展能力。\r\n\r\n## 联系我们\r\n\r\n有任何疑问请联系我们！\r\n\r\nGithub Issue: https://github.com/symph-joy/symph-joy/issues  \r\n邮件：lnlfps@gmail.com  \r\nQQ 群：929743297\r\n","htmlContent":"\n                \u003ch1 id=\"symph%2Fjoy\"\u003e\n                  @symph/joy\n                \u003c/h1\u003e\u003cp\u003e@symph/joy 是 symph 架构体系中的应用层架构，集成了大量最佳实践的方案和研发工具，零配置可用，即使刚接触 React 或 Node 服务研发，也可以轻松快速的创建可靠的 JS/TS 应用。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-mermaid\"\u003egraph BT\n  Config(\u0026quot;@symph/config\u0026quot;)\n  Core(\u0026quot;@symph/core\u0026quot;)\n  React(\u0026quot;@symph/react\u0026quot;)\n  Joy(\u0026quot;@symph/joy\u0026quot;)\n  Server(\u0026quot;@symph/server\u0026quot;)\n  Webpack(\u0026quot;Webpack\u0026quot;)\n  Config --\u0026gt; React\n  Core --\u0026gt; React\n  React --\u0026gt; Joy\n  Config --\u0026gt; Server\n  Core --\u0026gt; Server\n  Server --\u0026gt; Joy\n  Webpack --\u0026gt; Joy\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003e@symph/core\u003c/code\u003e IoC 核心，提供组件容器、注入器、全局 Hook 管理的能力。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"/config/start/introduce\"\u003e\u003ccode\u003e@symph/config\u003c/code\u003e\u003c/a\u003e 应用配置管理，提供应用级的配置读取、验证、注入等。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"/react/start/introduce\"\u003e\u003ccode\u003e@symph/react\u003c/code\u003e\u003c/a\u003e React 的 MVC 框架，可轻松开发大型复杂 React 单页面应用，提供 React MVC 基础组件，统一数据管理，单向数据绑定和路由等基础功能。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"/react/start/introduce\"\u003e\u003ccode\u003e@symph/server\u003c/code\u003e\u003c/a\u003e 基于依赖注入和装饰器，类似 Spring MVC 的 Web 后端研发框架。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"/joy/start/introduce\"\u003e\u003ccode\u003e@symph/joy\u003c/code\u003e\u003c/a\u003e 整合 @symph/server 和 @symph/react，server 提供业务服务，react 负责展示和交互，是集成开发调试、编译打包、服务运行等的全栈式工具。\u003c/p\u003e\n\n                \u003ch2 id=\"%E7%89%B9%E5%BE%81\"\u003e\n                  特征\n                \u003c/h2\u003e\u003cul\u003e\n\u003cli\u003e零配置可用，集成最佳实践配置，快速启动开发，提供研发全流程工具链。\u003c/li\u003e\n\u003cli\u003e支持多端多类型应用开发：React、Electron、Server、Proxy Server 等。\u003c/li\u003e\n\u003cli\u003e现代化面向对象和 IoC 设计原则，更能适应企业级迭代开发。\u003c/li\u003e\n\u003cli\u003e默认支持和推荐使用 TypeScript，提供静态类型检查和高级语法特性。\u003c/li\u003e\n\u003cli\u003eJoy React 应用原生支持：全局状态管理、约定路由、懒加载、热更新、服务端渲染、预渲染、静态部署等。\u003c/li\u003e\n\u003cli\u003eJoy Node 应用原生支持：全局配置管理、MVC 组件、Middleware、Pipe、Guards、Fastify 集成等。\u003c/li\u003e\n\u003cli\u003e子模块独立维护和使用，即可选择性单独使用 IoC 库，Config 配置管理、React 应用、Node 应用。\u003c/li\u003e\n\u003cli\u003e插件化开发，便于定制功能和扩展能力。\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch2 id=\"%E8%81%94%E7%B3%BB%E6%88%91%E4%BB%AC\"\u003e\n                  联系我们\n                \u003c/h2\u003e\u003cp\u003e有任何疑问请联系我们！\u003c/p\u003e\n\u003cp\u003eGithub Issue: \u003ca href=\"https://github.com/symph-joy/symph-joy/issues\"\u003ehttps://github.com/symph-joy/symph-joy/issues\u003c/a\u003e\u003cbr\u003e邮件：\u003ca href=\"mailto:\u0026#x6c;\u0026#x6e;\u0026#108;\u0026#102;\u0026#x70;\u0026#x73;\u0026#64;\u0026#103;\u0026#x6d;\u0026#97;\u0026#105;\u0026#x6c;\u0026#x2e;\u0026#99;\u0026#x6f;\u0026#x6d;\"\u003e\u0026#x6c;\u0026#x6e;\u0026#108;\u0026#102;\u0026#x70;\u0026#x73;\u0026#64;\u0026#103;\u0026#x6d;\u0026#97;\u0026#105;\u0026#x6c;\u0026#x2e;\u0026#99;\u0026#x6f;\u0026#x6d;\u003c/a\u003e\u003cbr\u003eQQ 群：929743297\u003c/p\u003e\n","anchor":[{"type":"heading","raw":"## 特征\n\n","depth":2,"text":"特征","tokens":[{"type":"text","raw":"特征","text":"特征"}],"id":"#%E7%89%B9%E5%BE%81"},{"type":"heading","raw":"## 联系我们\n\n","depth":2,"text":"联系我们","tokens":[{"type":"text","raw":"联系我们","text":"联系我们"}],"id":"#%E8%81%94%E7%B3%BB%E6%88%91%E4%BB%AC"}]},{"title":"快速开始","path":"/joy/start/quick-started","file":"docs\\joy\\01-start\\02-quick-started.md","hasMenu":false,"mdContent":"# 快速开始\r\n\r\nJoy 支持 React、Node.js 或者前后端混合应用开发，这里以一个简单的包含前后端的`Hello World`应用为例，介绍如何快速开始开发。\r\n\r\n## 环境准备\r\n\r\n- node 必须 12.22.0 或以上版本，推荐使用 nvm 来管理 node 版本。\r\n\r\n- 推荐使用 yarn 管理依赖，国内使用 [阿里 npm 源](https://npmmirror.com/) registry: https://registry.npm.taobao.org\r\n\r\n```shell\r\n# 安装 yarn\r\n$ npm i yarn -g\r\n# 手动设置`registry`地址为国内源\r\n$ yarn config set registry https://registry.npm.taobao.org\r\n# 查看源\r\n$ yarn config get registry\r\n\r\n# 或者使用 tyarn\r\n$ npm i yarn tyarn -g\r\n# 后面文档里的 yarn 换成 tyarn\r\n$ tyarn -v\r\n```\r\n\r\n## 创建目录\r\n\r\n创建应用根目录\r\n\r\n```shell\r\n$ mkdir myapp \u0026\u0026 cd myapp\r\n```\r\n\r\n- 创建 package.json 文件， 申明应用名和依赖：\r\n\r\n```json\r\n{\r\n  \"name\": \"myapp\",\r\n  \"version\": \"v1.0.0\",\r\n  \"scripts\": {\r\n    \"dev\": \"joy dev\",\r\n    \"build\": \"joy build\",\r\n    \"start\": \"joy start\"\r\n  },\r\n  \"dependencies\": {\r\n    \"react\": \"^17.0.1\",\r\n    \"react-dom\": \"^17.0.1\",\r\n    \"@symph/joy\": \"^2.0.0\"\r\n  },\r\n  \"devDependencies\": {\r\n    \"@types/react\": \"^17.0.1\",\r\n    \"@types/react-dom\": \"^17.0.1\"\r\n  }\r\n}\r\n```\r\n\r\n## 安装依赖\r\n\r\n```shell\r\n$ yarn install\r\n```\r\n\r\n## 第一个页面\r\n\r\n### React 客户端\r\n\r\n#### 创建 Model\r\n\r\n创建文件 `src/client/model/hello.model.ts`, ReactModel 管理应用状态数据和封装业务方法。\r\n\r\n```ts\r\n// src/client/model/hello.model.ts\r\nimport { ReactModel, BaseReactModel } from \"@symph/react\";\r\nimport { Inject } from \"@symph/core\";\r\nimport { ReactFetchService } from \"@symph/joy\";\r\n\r\n@ReactModel()\r\nexport class HelloModel extends BaseReactModel\u003c{\r\n  message: string;\r\n}\u003e {\r\n  constructor(@Inject(\"joyFetchService\") private joyFetchService: ReactFetchService) {\r\n    super();\r\n  }\r\n\r\n  getInitState() {\r\n    return { message: \"Hello World!\" }; // Init model state\r\n  }\r\n\r\n  async fetchMessage() {\r\n    const resp = await this.joyFetchService.fetchApi(\"/hello\");\r\n    const message = await resp.text();\r\n    this.setState({ message }); // Update model state\r\n  }\r\n}\r\n```\r\n\r\n#### 创建页面\r\n\r\n- 创建第一个页面`src/client/pages/index.tsx`，页面 ReactController 负责展示 Model 中的状态，响应用户交互，触发业务流程。\r\n\r\n```tsx\r\n// src/client/pages/index.tsx\r\nimport React, { ReactNode } from \"react\";\r\nimport { BaseReactController, ReactController } from \"@symph/react\";\r\nimport { Inject } from \"@symph/core\";\r\nimport { HelloModel } from \"../model/hello.model\";\r\n\r\n@ReactController()\r\nexport default class IndexController extends BaseReactController {\r\n  @Inject()\r\n  helloModel: HelloModel;\r\n\r\n  renderView(): ReactNode {\r\n    const { message } = this.helloModel.state;\r\n    return (\r\n      \u003cdiv\u003e\r\n        \u003cdiv id=\"message\"\u003e{message}\u003c/div\u003e\r\n        \u003cbutton id=\"btnUpdateMessage\" onClick={() =\u003e this.helloModel.fetchMessage()}\u003e\r\n          Update Message\r\n        \u003c/button\u003e\r\n      \u003c/div\u003e\r\n    );\r\n  }\r\n}\r\n```\r\n\r\n### Server 服务端\r\n\r\n#### 创建 Api Controller\r\n\r\n创建文件 `server/controller/hello.controller.ts`, Server Controller 对外提供 HTTP 接口服务。\r\n\r\n```ts\r\n// server/controller/hello.controller.ts\r\nimport { Controller, Get } from \"@symph/server\";\r\n\r\n@Controller()\r\nexport class HelloController {\r\n  @Get(\"/hello\")\r\n  hello(): string {\r\n    return \"Hello Joy!\";\r\n  }\r\n}\r\n```\r\n\r\n服务启动后，可通过 `http://localhost:3000/api/hello` 访问该接口。\r\n\r\n## 启动开发服务器\r\n\r\n```shell\r\n$ yarn dev\r\n```\r\n\r\n当命令行输出`ready - started server on http://localhost:3000`时，开发服务器启动成功，打开浏览器输入地址 `http://localhost:3000`，即可看到我们的第一个页面`Hello Joy!`。\r\n\r\n\u003e 热更新：此时可尝试修改页面内容，当保存后，浏览器界面将自动更新为新内容。\r\n\r\n## 部署发布\r\n\r\n### 构建\r\n\r\n```shell\r\n$ yarn run build\r\n```\r\n\r\n执行 `joy build` 命令将在 `.joy` 文件夹中构建出用于生产环境的应用程序。\r\n\r\n### 运行应用\r\n\r\n```shell\r\n$ yarn run start\r\n```\r\n\r\n构建完成后执行 `joy start`命令，将启动一个 Node.js 服务程序，该服务对外提供 HTTP API 接口服务，以及渲染 React 页面。\r\n\r\n### 导出静态HTML\r\n\r\n将React应用导出为静态HTML，可使其独立运行和部署。\r\n\r\n例如当我们开发一个单纯的React应用，业务接口由服务端团队提供，也不需要服务端渲染时，可以考虑将React应用导出，然后部署到Nginx静态资源服务器上。\r\n\r\n如果想将 `@symph/joy` 应用程序导出为静态 HTML，请参照 导出文档 中的说明进行操作。\r\n","htmlContent":"\n                \u003ch1 id=\"%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B\"\u003e\n                  快速开始\n                \u003c/h1\u003e\u003cp\u003eJoy 支持 React、Node.js 或者前后端混合应用开发，这里以一个简单的包含前后端的\u003ccode\u003eHello World\u003c/code\u003e应用为例，介绍如何快速开始开发。\u003c/p\u003e\n\n                \u003ch2 id=\"%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87\"\u003e\n                  环境准备\n                \u003c/h2\u003e\u003cul\u003e\n\u003cli\u003e\u003cp\u003enode 必须 12.22.0 或以上版本，推荐使用 nvm 来管理 node 版本。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e推荐使用 yarn 管理依赖，国内使用 \u003ca href=\"https://npmmirror.com/\"\u003e阿里 npm 源\u003c/a\u003e registry: \u003ca href=\"https://registry.npm.taobao.org\"\u003ehttps://registry.npm.taobao.org\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-shell\"\u003e\u003cspan class=\"hljs-meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e安装 yarn\u003c/span\u003e\n\u003cspan class=\"hljs-meta prompt_\"\u003e$ \u003c/span\u003e\u003cspan class=\"language-bash\"\u003enpm i yarn -g\u003c/span\u003e\n\u003cspan class=\"hljs-meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e手动设置`registry`地址为国内源\u003c/span\u003e\n\u003cspan class=\"hljs-meta prompt_\"\u003e$ \u003c/span\u003e\u003cspan class=\"language-bash\"\u003eyarn config \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e registry https://registry.npm.taobao.org\u003c/span\u003e\n\u003cspan class=\"hljs-meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e查看源\u003c/span\u003e\n\u003cspan class=\"hljs-meta prompt_\"\u003e$ \u003c/span\u003e\u003cspan class=\"language-bash\"\u003eyarn config get registry\u003c/span\u003e\n\u003cspan class=\"hljs-meta prompt_\"\u003e\n# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e或者使用 tyarn\u003c/span\u003e\n\u003cspan class=\"hljs-meta prompt_\"\u003e$ \u003c/span\u003e\u003cspan class=\"language-bash\"\u003enpm i yarn tyarn -g\u003c/span\u003e\n\u003cspan class=\"hljs-meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e后面文档里的 yarn 换成 tyarn\u003c/span\u003e\n\u003cspan class=\"hljs-meta prompt_\"\u003e$ \u003c/span\u003e\u003cspan class=\"language-bash\"\u003etyarn -v\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch2 id=\"%E5%88%9B%E5%BB%BA%E7%9B%AE%E5%BD%95\"\u003e\n                  创建目录\n                \u003c/h2\u003e\u003cp\u003e创建应用根目录\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-shell\"\u003e\u003cspan class=\"hljs-meta prompt_\"\u003e$ \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003emkdir\u003c/span\u003e myapp \u0026amp;\u0026amp; \u003cspan class=\"hljs-built_in\"\u003ecd\u003c/span\u003e myapp\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e创建 package.json 文件， 申明应用名和依赖：\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-json\"\u003e\u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;name\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;myapp\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;version\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;v1.0.0\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;scripts\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\u0026quot;dev\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;joy dev\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\u0026quot;build\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;joy build\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\u0026quot;start\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;joy start\u0026quot;\u003c/span\u003e\n  \u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;dependencies\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\u0026quot;react\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;^17.0.1\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\u0026quot;react-dom\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;^17.0.1\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\u0026quot;@symph/joy\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;^2.0.0\u0026quot;\u003c/span\u003e\n  \u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;devDependencies\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\u0026quot;@types/react\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;^17.0.1\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\u0026quot;@types/react-dom\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;^17.0.1\u0026quot;\u003c/span\u003e\n  \u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch2 id=\"%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96\"\u003e\n                  安装依赖\n                \u003c/h2\u003e\u003cpre\u003e\u003ccode class=\"hljs language-shell\"\u003e\u003cspan class=\"hljs-meta prompt_\"\u003e$ \u003c/span\u003e\u003cspan class=\"language-bash\"\u003eyarn install\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch2 id=\"%E7%AC%AC%E4%B8%80%E4%B8%AA%E9%A1%B5%E9%9D%A2\"\u003e\n                  第一个页面\n                \u003c/h2\u003e\n                \u003ch3 id=\"react-%E5%AE%A2%E6%88%B7%E7%AB%AF\"\u003e\n                  React 客户端\n                \u003c/h3\u003e\n                \u003ch4 id=\"%E5%88%9B%E5%BB%BA-model\"\u003e\n                  创建 Model\n                \u003c/h4\u003e\u003cp\u003e创建文件 \u003ccode\u003esrc/client/model/hello.model.ts\u003c/code\u003e, ReactModel 管理应用状态数据和封装业务方法。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-comment\"\u003e// src/client/model/hello.model.ts\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eReactModel\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eBaseReactModel\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eInject\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/core\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eReactFetchService\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-meta\"\u003e@ReactModel\u003c/span\u003e()\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eHelloModel\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title class_ inherited__\"\u003eBaseReactModel\u003c/span\u003e\u0026lt;{\n  \u003cspan class=\"hljs-attr\"\u003emessage\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e;\n}\u0026gt; {\n  \u003cspan class=\"hljs-title function_\"\u003econstructor\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-meta\"\u003e@Inject\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;joyFetchService\u0026quot;\u003c/span\u003e) \u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e joyFetchService: ReactFetchService\u003c/span\u003e) {\n    \u003cspan class=\"hljs-variable language_\"\u003esuper\u003c/span\u003e();\n  }\n\n  \u003cspan class=\"hljs-title function_\"\u003egetInitState\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e { \u003cspan class=\"hljs-attr\"\u003emessage\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;Hello World!\u0026quot;\u003c/span\u003e }; \u003cspan class=\"hljs-comment\"\u003e// Init model state\u003c/span\u003e\n  }\n\n  \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efetchMessage\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e resp = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ejoyFetchService\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003efetchApi\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;/hello\u0026quot;\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e message = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e resp.\u003cspan class=\"hljs-title function_\"\u003etext\u003c/span\u003e();\n    \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003esetState\u003c/span\u003e({ message }); \u003cspan class=\"hljs-comment\"\u003e// Update model state\u003c/span\u003e\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch4 id=\"%E5%88%9B%E5%BB%BA%E9%A1%B5%E9%9D%A2\"\u003e\n                  创建页面\n                \u003c/h4\u003e\u003cul\u003e\n\u003cli\u003e创建第一个页面\u003ccode\u003esrc/client/pages/index.tsx\u003c/code\u003e，页面 ReactController 负责展示 Model 中的状态，响应用户交互，触发业务流程。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-tsx\"\u003e\u003cspan class=\"hljs-comment\"\u003e// src/client/pages/index.tsx\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eReact\u003c/span\u003e, { \u003cspan class=\"hljs-title class_\"\u003eReactNode\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eBaseReactController\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eReactController\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eInject\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/core\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eHelloModel\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;../model/hello.model\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-meta\"\u003e@ReactController\u003c/span\u003e()\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eIndexController\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title class_ inherited__\"\u003eBaseReactController\u003c/span\u003e {\n  \u003cspan class=\"hljs-meta\"\u003e@Inject\u003c/span\u003e()\n  \u003cspan class=\"hljs-attr\"\u003ehelloModel\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eHelloModel\u003c/span\u003e;\n\n  \u003cspan class=\"hljs-title function_\"\u003erenderView\u003c/span\u003e(): \u003cspan class=\"hljs-title class_\"\u003eReactNode\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { message } = \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ehelloModel\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003estate\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n      \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;message\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e{message}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;btnUpdateMessage\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eonClick\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{()\u003c/span\u003e =\u0026gt;\u003c/span\u003e this.helloModel.fetchMessage()}\u0026gt;\n          Update Message\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n    );\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch3 id=\"server-%E6%9C%8D%E5%8A%A1%E7%AB%AF\"\u003e\n                  Server 服务端\n                \u003c/h3\u003e\n                \u003ch4 id=\"%E5%88%9B%E5%BB%BA-api-controller\"\u003e\n                  创建 Api Controller\n                \u003c/h4\u003e\u003cp\u003e创建文件 \u003ccode\u003eserver/controller/hello.controller.ts\u003c/code\u003e, Server Controller 对外提供 HTTP 接口服务。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-comment\"\u003e// server/controller/hello.controller.ts\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eController\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eGet\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/server\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-meta\"\u003e@Controller\u003c/span\u003e()\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eHelloController\u003c/span\u003e {\n  \u003cspan class=\"hljs-meta\"\u003e@Get\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;/hello\u0026quot;\u003c/span\u003e)\n  \u003cspan class=\"hljs-title function_\"\u003ehello\u003c/span\u003e(): \u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;Hello Joy!\u0026quot;\u003c/span\u003e;\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e服务启动后，可通过 \u003ccode\u003ehttp://localhost:3000/api/hello\u003c/code\u003e 访问该接口。\u003c/p\u003e\n\n                \u003ch2 id=\"%E5%90%AF%E5%8A%A8%E5%BC%80%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8\"\u003e\n                  启动开发服务器\n                \u003c/h2\u003e\u003cpre\u003e\u003ccode class=\"hljs language-shell\"\u003e\u003cspan class=\"hljs-meta prompt_\"\u003e$ \u003c/span\u003e\u003cspan class=\"language-bash\"\u003eyarn dev\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e当命令行输出\u003ccode\u003eready - started server on http://localhost:3000\u003c/code\u003e时，开发服务器启动成功，打开浏览器输入地址 \u003ccode\u003ehttp://localhost:3000\u003c/code\u003e，即可看到我们的第一个页面\u003ccode\u003eHello Joy!\u003c/code\u003e。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e热更新：此时可尝试修改页面内容，当保存后，浏览器界面将自动更新为新内容。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n                \u003ch2 id=\"%E9%83%A8%E7%BD%B2%E5%8F%91%E5%B8%83\"\u003e\n                  部署发布\n                \u003c/h2\u003e\n                \u003ch3 id=\"%E6%9E%84%E5%BB%BA\"\u003e\n                  构建\n                \u003c/h3\u003e\u003cpre\u003e\u003ccode class=\"hljs language-shell\"\u003e\u003cspan class=\"hljs-meta prompt_\"\u003e$ \u003c/span\u003e\u003cspan class=\"language-bash\"\u003eyarn run build\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e执行 \u003ccode\u003ejoy build\u003c/code\u003e 命令将在 \u003ccode\u003e.joy\u003c/code\u003e 文件夹中构建出用于生产环境的应用程序。\u003c/p\u003e\n\n                \u003ch3 id=\"%E8%BF%90%E8%A1%8C%E5%BA%94%E7%94%A8\"\u003e\n                  运行应用\n                \u003c/h3\u003e\u003cpre\u003e\u003ccode class=\"hljs language-shell\"\u003e\u003cspan class=\"hljs-meta prompt_\"\u003e$ \u003c/span\u003e\u003cspan class=\"language-bash\"\u003eyarn run start\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e构建完成后执行 \u003ccode\u003ejoy start\u003c/code\u003e命令，将启动一个 Node.js 服务程序，该服务对外提供 HTTP API 接口服务，以及渲染 React 页面。\u003c/p\u003e\n\n                \u003ch3 id=\"%E5%AF%BC%E5%87%BA%E9%9D%99%E6%80%81html\"\u003e\n                  导出静态HTML\n                \u003c/h3\u003e\u003cp\u003e将React应用导出为静态HTML，可使其独立运行和部署。\u003c/p\u003e\n\u003cp\u003e例如当我们开发一个单纯的React应用，业务接口由服务端团队提供，也不需要服务端渲染时，可以考虑将React应用导出，然后部署到Nginx静态资源服务器上。\u003c/p\u003e\n\u003cp\u003e如果想将 \u003ccode\u003e@symph/joy\u003c/code\u003e 应用程序导出为静态 HTML，请参照 导出文档 中的说明进行操作。\u003c/p\u003e\n","anchor":[{"type":"heading","raw":"## 环境准备\n\n","depth":2,"text":"环境准备","tokens":[{"type":"text","raw":"环境准备","text":"环境准备"}],"id":"#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"},{"type":"heading","raw":"## 创建目录\n\n","depth":2,"text":"创建目录","tokens":[{"type":"text","raw":"创建目录","text":"创建目录"}],"id":"#%E5%88%9B%E5%BB%BA%E7%9B%AE%E5%BD%95"},{"type":"heading","raw":"## 安装依赖\n\n","depth":2,"text":"安装依赖","tokens":[{"type":"text","raw":"安装依赖","text":"安装依赖"}],"id":"#%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96"},{"type":"heading","raw":"## 第一个页面\n\n","depth":2,"text":"第一个页面","tokens":[{"type":"text","raw":"第一个页面","text":"第一个页面"}],"id":"#%E7%AC%AC%E4%B8%80%E4%B8%AA%E9%A1%B5%E9%9D%A2","children":[{"type":"heading","raw":"### React 客户端\n\n","depth":3,"text":"React 客户端","tokens":[{"type":"text","raw":"React 客户端","text":"React 客户端"}],"id":"#react-%E5%AE%A2%E6%88%B7%E7%AB%AF","children":[{"type":"heading","raw":"#### 创建 Model\n\n","depth":4,"text":"创建 Model","tokens":[{"type":"text","raw":"创建 Model","text":"创建 Model"}],"id":"#%E5%88%9B%E5%BB%BA-model"},{"type":"heading","raw":"#### 创建页面\n\n","depth":4,"text":"创建页面","tokens":[{"type":"text","raw":"创建页面","text":"创建页面"}],"id":"#%E5%88%9B%E5%BB%BA%E9%A1%B5%E9%9D%A2"}]},{"type":"heading","raw":"### Server 服务端\n\n","depth":3,"text":"Server 服务端","tokens":[{"type":"text","raw":"Server 服务端","text":"Server 服务端"}],"id":"#server-%E6%9C%8D%E5%8A%A1%E7%AB%AF","children":[{"type":"heading","raw":"#### 创建 Api Controller\n\n","depth":4,"text":"创建 Api Controller","tokens":[{"type":"text","raw":"创建 Api Controller","text":"创建 Api Controller"}],"id":"#%E5%88%9B%E5%BB%BA-api-controller"}]}]},{"type":"heading","raw":"## 启动开发服务器\n\n","depth":2,"text":"启动开发服务器","tokens":[{"type":"text","raw":"启动开发服务器","text":"启动开发服务器"}],"id":"#%E5%90%AF%E5%8A%A8%E5%BC%80%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8"},{"type":"heading","raw":"## 部署发布\n\n","depth":2,"text":"部署发布","tokens":[{"type":"text","raw":"部署发布","text":"部署发布"}],"id":"#%E9%83%A8%E7%BD%B2%E5%8F%91%E5%B8%83","children":[{"type":"heading","raw":"### 构建\n\n","depth":3,"text":"构建","tokens":[{"type":"text","raw":"构建","text":"构建"}],"id":"#%E6%9E%84%E5%BB%BA"},{"type":"heading","raw":"### 运行应用\n\n","depth":3,"text":"运行应用","tokens":[{"type":"text","raw":"运行应用","text":"运行应用"}],"id":"#%E8%BF%90%E8%A1%8C%E5%BA%94%E7%94%A8"},{"type":"heading","raw":"### 导出静态HTML\n\n","depth":3,"text":"导出静态HTML","tokens":[{"type":"text","raw":"导出静态HTML","text":"导出静态HTML"}],"id":"#%E5%AF%BC%E5%87%BA%E9%9D%99%E6%80%81html"}]}]}]},{"title":"前端开发","path":"/joy/02-react","file":"docs/joy/02-react","children":[{"title":"React 开发","path":"/joy/react/react-dev","file":"docs\\joy\\02-react\\01-react-dev.md","hasMenu":false,"mdContent":"# React 开发\r\n\r\n\r\n\u003e **重要提示**： `@symph/joy` 无缝集成 `@symph/react`库，在`@symph/react`的基础上提供了工程化相关的扩展功能。\r\n\u003e\r\n\u003e - 如需查看 React 应用基础开发文档，请跳转到 \"[@symph/react 文档](/react/start/introduce)\"。\r\n\u003e - 查看 `@symph/joy` 提供的扩展功能，请继续查看后续章节。\r\n\r\n`@symph/joy` 在 `@symph/react` 基础之上，为 React 应用开发提供了部分额外能力：\r\n\r\n- 自动扫描和注册 `@symph/react` React MVC 组件\r\n- [React 约定路由](/joy/react/joy-fs-router)\r\n- 配置管理\r\n- 服务端渲染\r\n- 按需加载\r\n- 导入第三方模块\r\n- 热更新(Fast Refresh)\r\n- 静态导出\r\n- 编译打包\r\n","htmlContent":"\n                \u003ch1 id=\"react-%E5%BC%80%E5%8F%91\"\u003e\n                  React 开发\n                \u003c/h1\u003e\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e重要提示\u003c/strong\u003e： \u003ccode\u003e@symph/joy\u003c/code\u003e 无缝集成 \u003ccode\u003e@symph/react\u003c/code\u003e库，在\u003ccode\u003e@symph/react\u003c/code\u003e的基础上提供了工程化相关的扩展功能。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e如需查看 React 应用基础开发文档，请跳转到 \u0026quot;\u003ca href=\"/react/start/introduce\"\u003e@symph/react 文档\u003c/a\u003e\u0026quot;。\u003c/li\u003e\n\u003cli\u003e查看 \u003ccode\u003e@symph/joy\u003c/code\u003e 提供的扩展功能，请继续查看后续章节。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003ccode\u003e@symph/joy\u003c/code\u003e 在 \u003ccode\u003e@symph/react\u003c/code\u003e 基础之上，为 React 应用开发提供了部分额外能力：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e自动扫描和注册 \u003ccode\u003e@symph/react\u003c/code\u003e React MVC 组件\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"/joy/react/joy-fs-router\"\u003eReact 约定路由\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e配置管理\u003c/li\u003e\n\u003cli\u003e服务端渲染\u003c/li\u003e\n\u003cli\u003e按需加载\u003c/li\u003e\n\u003cli\u003e导入第三方模块\u003c/li\u003e\n\u003cli\u003e热更新(Fast Refresh)\u003c/li\u003e\n\u003cli\u003e静态导出\u003c/li\u003e\n\u003cli\u003e编译打包\u003c/li\u003e\n\u003c/ul\u003e\n","anchor":[]},{"title":"目录结构","path":"/joy/react/dir-tree","file":"docs\\joy\\02-react\\02-dir-tree.md","hasMenu":false,"mdContent":"# 目录结构\r\n\r\n## 约定目录结构\r\n\r\nJoy 支持 React 和 Node 以及两者的混合应用，下面列举各种应用类型常用的约定目录结构。\r\n\r\n### React 应用\r\n\r\n```text\r\nmyapp\r\n    src             // 源代码目录\r\n        pages       // React文件约定路由目录\r\n        models      // ReactModel目录\r\n        components  // React组件目录\r\n        server      // 可选，server端目录\r\n    config          // 配置目录\r\n        config.ts   // 配置文件\r\n    public          // 静态文件目录\r\n        logo.png    // 静态图片文件\r\n    package.json\r\n```\r\n\r\n### 前后端混合应用\r\n\r\n```text\r\nmyapp\r\n    src                 // 源代码目录\r\n        common:         // 前后端共享的代码，如类接口定义，通用处理方法等。\r\n        server          // 服务端代码\r\n            controllers\r\n            services\r\n        client          // 可选，客户端目录\r\n            pages       // 约定React路由目录\r\n            models      // ReactModel目录\r\n            components  // React组件目录\r\n    config              // 配置目录\r\n        config.ts       // 配置文件\r\n    public              // 静态文件目录\r\n        logo.png        // 静态图片文件\r\n    package.json\r\n```\r\n\r\n## 目录说明\r\n\r\n### src 目录\r\n\r\n源代码目录。\r\n\r\n### server 目录\r\n\r\n服务端相关代码，如果不需要服务端提供后端服务，可以没有该目录。\r\n\r\n### client 目录\r\n\r\nReact 客户端应用相关的代码，该目录可选：\r\n\r\n- `client`这级目录可以省略，直接在`src`下创建 React 的源代码文件，例如`src/pages/index.tsx`。\r\n- 如果应用只提供 Api 服务，不需要前端 React 界面，可以没有该目录。\r\n\r\n#### client/pages 或者 pages 目录\r\n\r\nReact 约定文件路由目录，具体使用方法，请查看 [路由](/joy/basic/joy-fs-router) 章节。\r\n\r\n### config 目录\r\n\r\n存放应用配置文件， 请转到 [配置管理](/joy/config/config-manage) 查看如何配置应用。\r\n\r\n### .env\r\n\r\n[dotenv](https://github.com/motdotla/dotenv) 环境变量配置文件。\r\n例如：\r\n\r\n```text\r\nport=8888\r\nhost=localhost\r\n```\r\n\r\n### public 目录\r\n\r\n存放静态资源文件，可直接通过 http 直接访问，例如文件 `/myapp/public/logo.png` 可通过 `http://localhost:3000/logo.png`访问。\r\n\r\n### .joy 目录\r\n\r\n`.joy` 目录是在运行时自动生成的目录，是 Joy 应用必须的，可以随时删除，在下次运行时重新生成该目录。\r\n日常开发时，我们不用去关注和修改里面的文件。\r\n里面主要包含的文件有：\r\n\r\n- 用于代码扫描分析的临时文件，以及分析后的产出物。\r\n- webpack 构建的缓存、日志物。\r\n- Joy 应用运行加载的源文件，这些文件是编译打包后的源文件。\r\n\r\n### out 目录\r\n\r\n运行`joy export` 命令的默认输出目录，存放 React 导出后的静态文件，部署该目录到静态文件服务器即可，例如 Nginx 。\r\n","htmlContent":"\n                \u003ch1 id=\"%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84\"\u003e\n                  目录结构\n                \u003c/h1\u003e\n                \u003ch2 id=\"%E7%BA%A6%E5%AE%9A%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84\"\u003e\n                  约定目录结构\n                \u003c/h2\u003e\u003cp\u003eJoy 支持 React 和 Node 以及两者的混合应用，下面列举各种应用类型常用的约定目录结构。\u003c/p\u003e\n\n                \u003ch3 id=\"react-%E5%BA%94%E7%94%A8\"\u003e\n                  React 应用\n                \u003c/h3\u003e\u003cpre\u003e\u003ccode class=\"hljs language-text\"\u003emyapp\n    src             // 源代码目录\n        pages       // React文件约定路由目录\n        models      // ReactModel目录\n        components  // React组件目录\n        server      // 可选，server端目录\n    config          // 配置目录\n        config.ts   // 配置文件\n    public          // 静态文件目录\n        logo.png    // 静态图片文件\n    package.json\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch3 id=\"%E5%89%8D%E5%90%8E%E7%AB%AF%E6%B7%B7%E5%90%88%E5%BA%94%E7%94%A8\"\u003e\n                  前后端混合应用\n                \u003c/h3\u003e\u003cpre\u003e\u003ccode class=\"hljs language-text\"\u003emyapp\n    src                 // 源代码目录\n        common:         // 前后端共享的代码，如类接口定义，通用处理方法等。\n        server          // 服务端代码\n            controllers\n            services\n        client          // 可选，客户端目录\n            pages       // 约定React路由目录\n            models      // ReactModel目录\n            components  // React组件目录\n    config              // 配置目录\n        config.ts       // 配置文件\n    public              // 静态文件目录\n        logo.png        // 静态图片文件\n    package.json\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch2 id=\"%E7%9B%AE%E5%BD%95%E8%AF%B4%E6%98%8E\"\u003e\n                  目录说明\n                \u003c/h2\u003e\n                \u003ch3 id=\"src-%E7%9B%AE%E5%BD%95\"\u003e\n                  src 目录\n                \u003c/h3\u003e\u003cp\u003e源代码目录。\u003c/p\u003e\n\n                \u003ch3 id=\"server-%E7%9B%AE%E5%BD%95\"\u003e\n                  server 目录\n                \u003c/h3\u003e\u003cp\u003e服务端相关代码，如果不需要服务端提供后端服务，可以没有该目录。\u003c/p\u003e\n\n                \u003ch3 id=\"client-%E7%9B%AE%E5%BD%95\"\u003e\n                  client 目录\n                \u003c/h3\u003e\u003cp\u003eReact 客户端应用相关的代码，该目录可选：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eclient\u003c/code\u003e这级目录可以省略，直接在\u003ccode\u003esrc\u003c/code\u003e下创建 React 的源代码文件，例如\u003ccode\u003esrc/pages/index.tsx\u003c/code\u003e。\u003c/li\u003e\n\u003cli\u003e如果应用只提供 Api 服务，不需要前端 React 界面，可以没有该目录。\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch4 id=\"clientpages-%E6%88%96%E8%80%85-pages-%E7%9B%AE%E5%BD%95\"\u003e\n                  client/pages 或者 pages 目录\n                \u003c/h4\u003e\u003cp\u003eReact 约定文件路由目录，具体使用方法，请查看 \u003ca href=\"/joy/basic/joy-fs-router\"\u003e路由\u003c/a\u003e 章节。\u003c/p\u003e\n\n                \u003ch3 id=\"config-%E7%9B%AE%E5%BD%95\"\u003e\n                  config 目录\n                \u003c/h3\u003e\u003cp\u003e存放应用配置文件， 请转到 \u003ca href=\"/joy/config/config-manage\"\u003e配置管理\u003c/a\u003e 查看如何配置应用。\u003c/p\u003e\n\n                \u003ch3 id=\"env\"\u003e\n                  .env\n                \u003c/h3\u003e\u003cp\u003e\u003ca href=\"https://github.com/motdotla/dotenv\"\u003edotenv\u003c/a\u003e 环境变量配置文件。\n例如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-text\"\u003eport=8888\nhost=localhost\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch3 id=\"public-%E7%9B%AE%E5%BD%95\"\u003e\n                  public 目录\n                \u003c/h3\u003e\u003cp\u003e存放静态资源文件，可直接通过 http 直接访问，例如文件 \u003ccode\u003e/myapp/public/logo.png\u003c/code\u003e 可通过 \u003ccode\u003ehttp://localhost:3000/logo.png\u003c/code\u003e访问。\u003c/p\u003e\n\n                \u003ch3 id=\"joy-%E7%9B%AE%E5%BD%95\"\u003e\n                  .joy 目录\n                \u003c/h3\u003e\u003cp\u003e\u003ccode\u003e.joy\u003c/code\u003e 目录是在运行时自动生成的目录，是 Joy 应用必须的，可以随时删除，在下次运行时重新生成该目录。\n日常开发时，我们不用去关注和修改里面的文件。\n里面主要包含的文件有：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e用于代码扫描分析的临时文件，以及分析后的产出物。\u003c/li\u003e\n\u003cli\u003ewebpack 构建的缓存、日志物。\u003c/li\u003e\n\u003cli\u003eJoy 应用运行加载的源文件，这些文件是编译打包后的源文件。\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch3 id=\"out-%E7%9B%AE%E5%BD%95\"\u003e\n                  out 目录\n                \u003c/h3\u003e\u003cp\u003e运行\u003ccode\u003ejoy export\u003c/code\u003e 命令的默认输出目录，存放 React 导出后的静态文件，部署该目录到静态文件服务器即可，例如 Nginx 。\u003c/p\u003e\n","anchor":[{"type":"heading","raw":"## 约定目录结构\n\n","depth":2,"text":"约定目录结构","tokens":[{"type":"text","raw":"约定目录结构","text":"约定目录结构"}],"id":"#%E7%BA%A6%E5%AE%9A%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84","children":[{"type":"heading","raw":"### React 应用\n\n","depth":3,"text":"React 应用","tokens":[{"type":"text","raw":"React 应用","text":"React 应用"}],"id":"#react-%E5%BA%94%E7%94%A8"},{"type":"heading","raw":"### 前后端混合应用\n\n","depth":3,"text":"前后端混合应用","tokens":[{"type":"text","raw":"前后端混合应用","text":"前后端混合应用"}],"id":"#%E5%89%8D%E5%90%8E%E7%AB%AF%E6%B7%B7%E5%90%88%E5%BA%94%E7%94%A8"}]},{"type":"heading","raw":"## 目录说明\n\n","depth":2,"text":"目录说明","tokens":[{"type":"text","raw":"目录说明","text":"目录说明"}],"id":"#%E7%9B%AE%E5%BD%95%E8%AF%B4%E6%98%8E","children":[{"type":"heading","raw":"### src 目录\n\n","depth":3,"text":"src 目录","tokens":[{"type":"text","raw":"src 目录","text":"src 目录"}],"id":"#src-%E7%9B%AE%E5%BD%95"},{"type":"heading","raw":"### server 目录\n\n","depth":3,"text":"server 目录","tokens":[{"type":"text","raw":"server 目录","text":"server 目录"}],"id":"#server-%E7%9B%AE%E5%BD%95"},{"type":"heading","raw":"### client 目录\n\n","depth":3,"text":"client 目录","tokens":[{"type":"text","raw":"client 目录","text":"client 目录"}],"id":"#client-%E7%9B%AE%E5%BD%95","children":[{"type":"heading","raw":"#### client/pages 或者 pages 目录\n\n","depth":4,"text":"client/pages 或者 pages 目录","tokens":[{"type":"text","raw":"client/pages 或者 pages 目录","text":"client/pages 或者 pages 目录"}],"id":"#clientpages-%E6%88%96%E8%80%85-pages-%E7%9B%AE%E5%BD%95"}]},{"type":"heading","raw":"### config 目录\n\n","depth":3,"text":"config 目录","tokens":[{"type":"text","raw":"config 目录","text":"config 目录"}],"id":"#config-%E7%9B%AE%E5%BD%95"},{"type":"heading","raw":"### .env\n\n","depth":3,"text":".env","tokens":[{"type":"text","raw":".env","text":".env"}],"id":"#env"},{"type":"heading","raw":"### public 目录\n\n","depth":3,"text":"public 目录","tokens":[{"type":"text","raw":"public 目录","text":"public 目录"}],"id":"#public-%E7%9B%AE%E5%BD%95"},{"type":"heading","raw":"### .joy 目录\n\n","depth":3,"text":".joy 目录","tokens":[{"type":"text","raw":".joy 目录","text":".joy 目录"}],"id":"#joy-%E7%9B%AE%E5%BD%95"},{"type":"heading","raw":"### out 目录\n\n","depth":3,"text":"out 目录","tokens":[{"type":"text","raw":"out 目录","text":"out 目录"}],"id":"#out-%E7%9B%AE%E5%BD%95"}]}]},{"title":"React 约定路由","path":"/joy/react/joy-fs-router","file":"docs\\joy\\02-react\\04-joy-fs-router.md","hasMenu":false,"mdContent":"# React 约定路由\r\n\r\n\u003e 这篇文章只介绍如何使用约定路由，如需查看 `@symph/react` 路由的详细文档， 点击跳转到 [`@symph/react` React 路由](/react/basic/react-router)。\r\n\r\n约定式路由也称为文件路由，在约定目录下的文件，通过文件名称和子路径名，推测出路由信息，并自动注册为路由。\r\n\r\nJoy 约定存放在`src/client/pages`或者`src/pages`目录中的 ReactController 组件，将会自动注册为路由组件。注意：只有`src/client/pages` 不存在，才会使用`src/pages`目录。\r\n例如：\r\n\r\n```text\r\nsrc\r\n└── client\r\n    └── pages  # 约定路由根目录\r\n        ├── index.tsx  # 首页\r\n        └── about.tsx  # 关于页面\r\n    ```\r\n\r\n等效于以下路由配置：\r\n\r\n```js\r\n[\r\n  {\r\n    path: \"/\",\r\n    index: true,\r\n    componentName: \"index\",\r\n    componentModule: require(\"src/client/pages/index\"),\r\n  },\r\n  {\r\n    path: \"/about\",\r\n    componentName: \"about\",\r\n    componentModule: require(\"src/client/pages/about\"),\r\n  },\r\n];\r\n```\r\n\r\n需要注意的是，满足以下任意规则的文件不会被注册为路由：\r\n\r\n- 以 . 或 \\_ 开头的文件或目录\r\n- 以 test.ts、spec.ts、e2e.ts 结尾的测试文件（适用于 .js、.jsx 和 .tsx 文件）\r\n- components 和 component 目录\r\n- utils 和 util 目录\r\n\r\n如果在约定路由目录下，组件已被装饰器`@ReactRoute()`明确声明为路由组件，那么也不会再被当做文件路由组件。\r\n\r\n## 动态路由\r\n\r\n约定 `[]` 包裹的文件或文件夹为动态路由，例如：\r\n\r\n- src/client/pages/users/[id].tsx 会成为 `/users/:id`\r\n- src/client/pages/users/[id]/settings.tsx 会成为 `/users/:id/settings`\r\n\r\n## 缺省路由\r\n\r\n约定目录中的`index.tsx`(适用于.jsx 文件)命名的文件为目录下的缺省路由， 例如：\r\n\r\n- src/client/pages/index.tsx 会成为 `{path: \"/\", index: true}`。\r\n- src/client/pages/users/index.tsx 会成为 `{path: \"/user\", index: true}`。\r\n- src/client/pages/users/[id]/index.tsx 会成为 `{path: \"/users/:id\", index: true}`。\r\n\r\n## 嵌套路由\r\n\r\n约定目录下有 `_layout.tsx` 时会生成嵌套路由，目录下的其它路由将作为其子路由，`_layout.tsx` 作为父级路由，需要通过 `Outlet` 渲染子路由组件。\r\n\r\n例如以下目录结构：\r\n\r\n```text\r\n└── pages\r\n    └── users\r\n        ├── _layout.tsx\r\n        ├── index.tsx\r\n        └── list.tsx\r\n```\r\n\r\n会生成路由：\r\n\r\n```js\r\n[\r\n  {\r\n    path: \"/users\",\r\n    componentName: \"_layout\",\r\n    children: [\r\n      {\r\n        path: \"\",\r\n        index: true,\r\n        componentName: \"index\",\r\n      },\r\n      {\r\n        path: \"/list\",\r\n        componentName: \"list\",\r\n      },\r\n    ],\r\n  },\r\n];\r\n```\r\n\r\n## 全局 Layout\r\n\r\n约定 `src/client/pages/_layout.tsx` 为全局路由。\r\n\r\n我们可能需要针对不同的页面采用不同的布局，例如登录页面 `/login` 采用简单布局, 我们可以通过`location.pathname`来做区分，例如：\r\n\r\n```tsx\r\n// src/client/pages/_layout.tsx\r\n\r\nimport React from \"react\";\r\nimport { BaseReactController, ReactController } from \"@symph/react\";\r\nimport { Outlet } from \"@symph/react/router-dom\";\r\n\r\n@ReactController()\r\nexport default class MainLayout extends BaseReactController {\r\n  renderView(): React.ReactNode {\r\n    if (this.props.locaiton.pathname === \"/login\") {\r\n      return (\r\n        \u003cSimpleLayout\u003e\r\n          \u003cOutlet /\u003e\r\n        \u003c/SimpleLayout\u003e\r\n      );\r\n    }\r\n\r\n    return (\r\n      \u003c\u003e\r\n        \u003cHeader /\u003e\r\n        \u003cOutlet /\u003e\r\n        \u003cFooter /\u003e\r\n      \u003c/\u003e\r\n    );\r\n  }\r\n}\r\n```\r\n\r\n## 错误页面\r\n\r\n当在服务端或者浏览器运行时，出现未捕获的异常，导致应用无法正常继续运行，将显示错误页面，展示错误代码和错误提示信息。\r\n\r\n如果项目中没有自定义错误页面，会默认使用 `import { ErrorComponent } from \"@symph/joy/react\"`组件，我们也可以继承该默认错误组件，自定义错误界面。\r\n\r\n约定 `src/client/pages/_error.tsx` 为自定义错误页面，注意：错误组件是简单展示组件，只能使用`props`渲染界面。\r\n\r\n```tsx\r\nimport React from \"react\";\r\nimport { ErrorComponent } from \"@symph/joy/react\";\r\n\r\nexport default class MyError extends ErrorComponent {\r\n  renderView({ statusCode, title }: { statusCode: string; title: string }) {\r\n    return (\r\n      \u003c\u003e\r\n        \u003ch1\u003eMy Custom Error Page\u003c/h1\u003e\r\n        \u003cp\u003e\r\n          {statusCode}|{title}\r\n        \u003c/p\u003e\r\n      \u003c/\u003e\r\n    );\r\n  }\r\n}\r\n```\r\n\r\n## 404 页面\r\n\r\n`/404` 路由为特殊路由，渲染时如果未在注册的所有路由中匹配到页面，Joy 将渲染 404 组件。\r\n\r\n如果项目中没有自定义 404 页面，会使用默认的 `import { ErrorComponent } from \"@symph/joy/react\"` 组件。\r\n\r\n约定`src/client/pages/404.tsx` 为 `/404` 页面。\r\n\r\n```tsx\r\nimport React from \"react\";\r\nimport { BaseReactController, ReactController, ReactRoute } from \"@symph/react\";\r\n\r\n@ReactRoute({ path: \"/404\" })\r\n@ReactController()\r\nexport default class My404Page extends BaseReactController {\r\n  renderView() {\r\n    return \u003cdiv id={\"title\"}\u003eCustom 404\u003c/div\u003e;\r\n  }\r\n}\r\n```\r\n","htmlContent":"\n                \u003ch1 id=\"react-%E7%BA%A6%E5%AE%9A%E8%B7%AF%E7%94%B1\"\u003e\n                  React 约定路由\n                \u003c/h1\u003e\u003cblockquote\u003e\n\u003cp\u003e这篇文章只介绍如何使用约定路由，如需查看 \u003ccode\u003e@symph/react\u003c/code\u003e 路由的详细文档， 点击跳转到 \u003ca href=\"/react/basic/react-router\"\u003e\u003ccode\u003e@symph/react\u003c/code\u003e React 路由\u003c/a\u003e。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e约定式路由也称为文件路由，在约定目录下的文件，通过文件名称和子路径名，推测出路由信息，并自动注册为路由。\u003c/p\u003e\n\u003cp\u003eJoy 约定存放在\u003ccode\u003esrc/client/pages\u003c/code\u003e或者\u003ccode\u003esrc/pages\u003c/code\u003e目录中的 ReactController 组件，将会自动注册为路由组件。注意：只有\u003ccode\u003esrc/client/pages\u003c/code\u003e 不存在，才会使用\u003ccode\u003esrc/pages\u003c/code\u003e目录。\n例如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-text\"\u003esrc\n└── client\n    └── pages  # 约定路由根目录\n        ├── index.tsx  # 首页\n        └── about.tsx  # 关于页面\n    ```\n\n等效于以下路由配置：\n\n```js\n[\n  {\n    path: \u0026quot;/\u0026quot;,\n    index: true,\n    componentName: \u0026quot;index\u0026quot;,\n    componentModule: require(\u0026quot;src/client/pages/index\u0026quot;),\n  },\n  {\n    path: \u0026quot;/about\u0026quot;,\n    componentName: \u0026quot;about\u0026quot;,\n    componentModule: require(\u0026quot;src/client/pages/about\u0026quot;),\n  },\n];\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e需要注意的是，满足以下任意规则的文件不会被注册为路由：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e以 . 或 _ 开头的文件或目录\u003c/li\u003e\n\u003cli\u003e以 test.ts、spec.ts、e2e.ts 结尾的测试文件（适用于 .js、.jsx 和 .tsx 文件）\u003c/li\u003e\n\u003cli\u003ecomponents 和 component 目录\u003c/li\u003e\n\u003cli\u003eutils 和 util 目录\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e如果在约定路由目录下，组件已被装饰器\u003ccode\u003e@ReactRoute()\u003c/code\u003e明确声明为路由组件，那么也不会再被当做文件路由组件。\u003c/p\u003e\n\n                \u003ch2 id=\"%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1\"\u003e\n                  动态路由\n                \u003c/h2\u003e\u003cp\u003e约定 \u003ccode\u003e[]\u003c/code\u003e 包裹的文件或文件夹为动态路由，例如：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003esrc/client/pages/users/[id].tsx 会成为 \u003ccode\u003e/users/:id\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003esrc/client/pages/users/[id]/settings.tsx 会成为 \u003ccode\u003e/users/:id/settings\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch2 id=\"%E7%BC%BA%E7%9C%81%E8%B7%AF%E7%94%B1\"\u003e\n                  缺省路由\n                \u003c/h2\u003e\u003cp\u003e约定目录中的\u003ccode\u003eindex.tsx\u003c/code\u003e(适用于.jsx 文件)命名的文件为目录下的缺省路由， 例如：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003esrc/client/pages/index.tsx 会成为 \u003ccode\u003e{path: \u0026quot;/\u0026quot;, index: true}\u003c/code\u003e。\u003c/li\u003e\n\u003cli\u003esrc/client/pages/users/index.tsx 会成为 \u003ccode\u003e{path: \u0026quot;/user\u0026quot;, index: true}\u003c/code\u003e。\u003c/li\u003e\n\u003cli\u003esrc/client/pages/users/[id]/index.tsx 会成为 \u003ccode\u003e{path: \u0026quot;/users/:id\u0026quot;, index: true}\u003c/code\u003e。\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch2 id=\"%E5%B5%8C%E5%A5%97%E8%B7%AF%E7%94%B1\"\u003e\n                  嵌套路由\n                \u003c/h2\u003e\u003cp\u003e约定目录下有 \u003ccode\u003e_layout.tsx\u003c/code\u003e 时会生成嵌套路由，目录下的其它路由将作为其子路由，\u003ccode\u003e_layout.tsx\u003c/code\u003e 作为父级路由，需要通过 \u003ccode\u003eOutlet\u003c/code\u003e 渲染子路由组件。\u003c/p\u003e\n\u003cp\u003e例如以下目录结构：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-text\"\u003e└── pages\n    └── users\n        ├── _layout.tsx\n        ├── index.tsx\n        └── list.tsx\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e会生成路由：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e[\n  {\n    \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;/users\u0026quot;\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003ecomponentName\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;_layout\u0026quot;\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003echildren\u003c/span\u003e: [\n      {\n        \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003eindex\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003ecomponentName\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;index\u0026quot;\u003c/span\u003e,\n      },\n      {\n        \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;/list\u0026quot;\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003ecomponentName\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;list\u0026quot;\u003c/span\u003e,\n      },\n    ],\n  },\n];\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch2 id=\"%E5%85%A8%E5%B1%80-layout\"\u003e\n                  全局 Layout\n                \u003c/h2\u003e\u003cp\u003e约定 \u003ccode\u003esrc/client/pages/_layout.tsx\u003c/code\u003e 为全局路由。\u003c/p\u003e\n\u003cp\u003e我们可能需要针对不同的页面采用不同的布局，例如登录页面 \u003ccode\u003e/login\u003c/code\u003e 采用简单布局, 我们可以通过\u003ccode\u003elocation.pathname\u003c/code\u003e来做区分，例如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-tsx\"\u003e\u003cspan class=\"hljs-comment\"\u003e// src/client/pages/_layout.tsx\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eReact\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eBaseReactController\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eReactController\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eOutlet\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/react/router-dom\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-meta\"\u003e@ReactController\u003c/span\u003e()\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eMainLayout\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title class_ inherited__\"\u003eBaseReactController\u003c/span\u003e {\n  \u003cspan class=\"hljs-title function_\"\u003erenderView\u003c/span\u003e(): \u003cspan class=\"hljs-title class_\"\u003eReact\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eReactNode\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eprops\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003elocaiton\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003epathname\u003c/span\u003e === \u003cspan class=\"hljs-string\"\u003e\u0026quot;/login\u0026quot;\u003c/span\u003e) {\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n        \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eSimpleLayout\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eOutlet\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eSimpleLayout\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n      );\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n      \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eHeader\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eOutlet\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eFooter\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u0026gt;\u003c/span\u003e\u003c/span\u003e\n    );\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch2 id=\"%E9%94%99%E8%AF%AF%E9%A1%B5%E9%9D%A2\"\u003e\n                  错误页面\n                \u003c/h2\u003e\u003cp\u003e当在服务端或者浏览器运行时，出现未捕获的异常，导致应用无法正常继续运行，将显示错误页面，展示错误代码和错误提示信息。\u003c/p\u003e\n\u003cp\u003e如果项目中没有自定义错误页面，会默认使用 \u003ccode\u003eimport { ErrorComponent } from \u0026quot;@symph/joy/react\u0026quot;\u003c/code\u003e组件，我们也可以继承该默认错误组件，自定义错误界面。\u003c/p\u003e\n\u003cp\u003e约定 \u003ccode\u003esrc/client/pages/_error.tsx\u003c/code\u003e 为自定义错误页面，注意：错误组件是简单展示组件，只能使用\u003ccode\u003eprops\u003c/code\u003e渲染界面。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-tsx\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eReact\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eErrorComponent\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/react\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eMyError\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title class_ inherited__\"\u003eErrorComponent\u003c/span\u003e {\n  \u003cspan class=\"hljs-title function_\"\u003erenderView\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e{ statusCode, title }: { statusCode: \u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e; title: \u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e }\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n      \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh1\u003c/span\u003e\u0026gt;\u003c/span\u003eMy Custom Error Page\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh1\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          {statusCode}|{title}\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u0026gt;\u003c/span\u003e\u003c/span\u003e\n    );\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch2 id=\"404-%E9%A1%B5%E9%9D%A2\"\u003e\n                  404 页面\n                \u003c/h2\u003e\u003cp\u003e\u003ccode\u003e/404\u003c/code\u003e 路由为特殊路由，渲染时如果未在注册的所有路由中匹配到页面，Joy 将渲染 404 组件。\u003c/p\u003e\n\u003cp\u003e如果项目中没有自定义 404 页面，会使用默认的 \u003ccode\u003eimport { ErrorComponent } from \u0026quot;@symph/joy/react\u0026quot;\u003c/code\u003e 组件。\u003c/p\u003e\n\u003cp\u003e约定\u003ccode\u003esrc/client/pages/404.tsx\u003c/code\u003e 为 \u003ccode\u003e/404\u003c/code\u003e 页面。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-tsx\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eReact\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eBaseReactController\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eReactController\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eReactRoute\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/react\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-meta\"\u003e@ReactRoute\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;/404\u0026quot;\u003c/span\u003e })\n\u003cspan class=\"hljs-meta\"\u003e@ReactController\u003c/span\u003e()\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eMy404Page\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title class_ inherited__\"\u003eBaseReactController\u003c/span\u003e {\n  \u003cspan class=\"hljs-title function_\"\u003erenderView\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{\u003c/span\u003e\u0026quot;\u003cspan class=\"hljs-attr\"\u003etitle\u003c/span\u003e\u0026quot;}\u0026gt;\u003c/span\u003eCustom 404\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e;\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n","anchor":[{"type":"heading","raw":"## 动态路由\n\n","depth":2,"text":"动态路由","tokens":[{"type":"text","raw":"动态路由","text":"动态路由"}],"id":"#%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1"},{"type":"heading","raw":"## 缺省路由\n\n","depth":2,"text":"缺省路由","tokens":[{"type":"text","raw":"缺省路由","text":"缺省路由"}],"id":"#%E7%BC%BA%E7%9C%81%E8%B7%AF%E7%94%B1"},{"type":"heading","raw":"## 嵌套路由\n\n","depth":2,"text":"嵌套路由","tokens":[{"type":"text","raw":"嵌套路由","text":"嵌套路由"}],"id":"#%E5%B5%8C%E5%A5%97%E8%B7%AF%E7%94%B1"},{"type":"heading","raw":"## 全局 Layout\n\n","depth":2,"text":"全局 Layout","tokens":[{"type":"text","raw":"全局 Layout","text":"全局 Layout"}],"id":"#%E5%85%A8%E5%B1%80-layout"},{"type":"heading","raw":"## 错误页面\n\n","depth":2,"text":"错误页面","tokens":[{"type":"text","raw":"错误页面","text":"错误页面"}],"id":"#%E9%94%99%E8%AF%AF%E9%A1%B5%E9%9D%A2"},{"type":"heading","raw":"## 404 页面\n\n","depth":2,"text":"404 页面","tokens":[{"type":"text","raw":"404 页面","text":"404 页面"}],"id":"#404-%E9%A1%B5%E9%9D%A2"}]},{"title":"使用 CSS 样式","path":"/joy/react/style-css","file":"docs\\joy\\02-react\\05-style-css.md","hasMenu":false,"mdContent":"# 使用 CSS 样式\r\n\r\n## 应用全局样式\r\n\r\nJoy 中约定在 `src/global.css`（或`global.less` `global.sass` ）中定义全局样式，应用启动时会自动加载该样式。\r\n\r\n比如我们给应用统一设置全局样式，或者覆盖组件样式，新建文件 `src/global.css`:\r\n\r\n```css\r\nbody {\r\n  font-family: BlinkMacSystemFont, PingFang SC, Microsoft YaHei, sans-serif;\r\n  font-size: 14px;\r\n  padding: 20px 20px 60px;\r\n}\r\n\r\n.addButton {\r\n  width: 60px;\r\n}\r\n```\r\n\r\n## CSS 模块导入\r\n\r\nJoy 会对导入的 CSS 文件自动识别是否使用 CSS Modules 导入.\r\n\r\n### CSS Modules 导入\r\n\r\n[CSS Modules](https://github.com/css-modules/css-modules) 会将 css 文件内的 class 名称生成唯一的标识，从而避免不同 css 模块类相同 class 名称的冲突。 通常使用 CSS Modules 来定义组件样式，而不用担心和组件间以及全局样式的冲突。\r\n\r\n```js\r\n// CSS Modules\r\nimport styles from \"./foo.css\";\r\n\r\nexport function Button() {\r\n  return \u003cbutton className={styles.btnAdd}\u003eAdd\u003c/button\u003e;\r\n}\r\n```\r\n\r\n在 CSS Modules 中，也可以通过`:global { }`包裹方式，临时插入全局类样式，被包裹中的代码中定义的 CSS 类名，将不会被 CSS Modules 处理，直接输出到页面。\r\n例如我们自定义 header 中的菜单组件样式：\r\n\r\n```less\r\n// main-layout.less\r\n.appHeader {\r\n  height: 64px;\r\n\r\n  :global {\r\n    .ant-menu {\r\n      // ant-menu 是 antd \u003cMenu /\u003e 组件中的常量类名。\r\n      border: 0;\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n### 全局样式导入\r\n\r\n非 CSS Modules 方式导入，css 文件内定义的类样式为全局样式，将会控制页面中所有满足条件的 DOM 元素。\r\n\r\n```js\r\n// 非 CSS Modules\r\nimport \"./foo.css\";\r\n\r\nexport function Button() {\r\n  return \u003cbutton className=\"btnAdd\"\u003eNew\u003c/button\u003e;\r\n}\r\n\r\n// 非 CSS Modules, bar.css内定义的样式为全局样式，将会控制页面中所有满足条件的DOM元素。\r\nimport \"./bar.css\";\r\n```\r\n\r\n## 使用 LESS\r\n\r\nJoy 原生支持 Less，使用 `.less` 后缀名定义 Less 文件。在使用 Less 之前，需要先安装 [less](https://github.com/less/less.js):\r\n\r\n```bash\r\nnpm install less\r\n```\r\n\r\n### 自定义 LESS 配置\r\n\r\n在 `joy.config.js` 的 `lessOptions` 字段中定义 Less 的自定义配置, 具体可配置项参考 [less-loader](https://webpack.js.org/loaders/less-loader/) 的配置。\r\n\r\n```js\r\nconst path = require(\"path\");\r\n\r\nmodule.exports = {\r\n  lessOptions: {\r\n    strictMath: true,\r\n  },\r\n};\r\n```\r\n\r\n## 使用 Sass\r\n\r\nJoy 原生支持 Sass，使用 `.scss` 或 `.sass` 后缀名定义 Sass 文件，在使用 Sass 之前，需要先安装 [sass](https://github.com/sass/sass) :\r\n\r\n```bash\r\nnpm install sass\r\n```\r\n\r\n\u003e Sass 支持 2 种语法格式定义来样式，`.scss`文件使用[SCSS 语法](https://sass-lang.com/documentation/syntax#scss) ，`.sass`文件使用 [Indented Syntax (\"Sass\")](https://sass-lang.com/documentation/syntax#the-indented-syntax) 语法。\r\n\u003e 如果你不确定使用哪种语法，可首先采用`.scss`，它是 CSS 的扩展，可使用 CSS 的全部语法，不需要学习新的 Indented Syntax 缩进语法。\r\n\r\n### 自定义 Sass 配置\r\n\r\n在 `joy.config.js` 的 `sassOptions` 字段中定义 Sass 的自定义配置, 具体可配置项参考 [sass-loader](https://webpack.js.org/loaders/sass-loader/) 的配置。\r\n\r\n```js\r\nconst path = require(\"path\");\r\n\r\nmodule.exports = {\r\n  sassOptions: {\r\n    additionalData: \"$env: \" + process.env.NODE_ENV + \";\",\r\n    indentWidth: 4,\r\n    includePaths: [\"/absolute/path/a\", \"/absolute/path/b\"],\r\n  },\r\n};\r\n```\r\n\r\n### Sass 变量\r\n\r\nJoy 支持 Sass 变量从 CSS Module 文件中导出。比如导出`primaryColor`变量：\r\n\r\n```scss\r\n/* index-scss-variables.scss */\r\n$primary-color: #ff0000;\r\n\r\n:export {\r\n  primaryColor: $primary-color;\r\n}\r\n```\r\n\r\n```tsx\r\n// index-scss-variables.js\r\nimport variables from \"../index-scss-variables.scss\";\r\n\r\nexport default function MyApp({ Component, pageProps }) {\r\n  return \u003cdiv style={{ color: variables.primaryColor }}\u003eHello\u003c/div\u003e;\r\n}\r\n```\r\n\r\n## todo\r\n\r\n- 自定义 PostCss https://nextjs.org/docs/advanced-features/customizing-postcss-config\r\n","htmlContent":"\n                \u003ch1 id=\"%E4%BD%BF%E7%94%A8-css-%E6%A0%B7%E5%BC%8F\"\u003e\n                  使用 CSS 样式\n                \u003c/h1\u003e\n                \u003ch2 id=\"%E5%BA%94%E7%94%A8%E5%85%A8%E5%B1%80%E6%A0%B7%E5%BC%8F\"\u003e\n                  应用全局样式\n                \u003c/h2\u003e\u003cp\u003eJoy 中约定在 \u003ccode\u003esrc/global.css\u003c/code\u003e（或\u003ccode\u003eglobal.less\u003c/code\u003e \u003ccode\u003eglobal.sass\u003c/code\u003e ）中定义全局样式，应用启动时会自动加载该样式。\u003c/p\u003e\n\u003cp\u003e比如我们给应用统一设置全局样式，或者覆盖组件样式，新建文件 \u003ccode\u003esrc/global.css\u003c/code\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-css\"\u003e\u003cspan class=\"hljs-selector-tag\"\u003ebody\u003c/span\u003e {\n  \u003cspan class=\"hljs-attribute\"\u003efont-family\u003c/span\u003e: BlinkMacSystemFont, PingFang SC, Microsoft YaHei, sans-serif;\n  \u003cspan class=\"hljs-attribute\"\u003efont-size\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e14px\u003c/span\u003e;\n  \u003cspan class=\"hljs-attribute\"\u003epadding\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e20px\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e20px\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e60px\u003c/span\u003e;\n}\n\n\u003cspan class=\"hljs-selector-class\"\u003e.addButton\u003c/span\u003e {\n  \u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e60px\u003c/span\u003e;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch2 id=\"css-%E6%A8%A1%E5%9D%97%E5%AF%BC%E5%85%A5\"\u003e\n                  CSS 模块导入\n                \u003c/h2\u003e\u003cp\u003eJoy 会对导入的 CSS 文件自动识别是否使用 CSS Modules 导入.\u003c/p\u003e\n\n                \u003ch3 id=\"css-modules-%E5%AF%BC%E5%85%A5\"\u003e\n                  CSS Modules 导入\n                \u003c/h3\u003e\u003cp\u003e\u003ca href=\"https://github.com/css-modules/css-modules\"\u003eCSS Modules\u003c/a\u003e 会将 css 文件内的 class 名称生成唯一的标识，从而避免不同 css 模块类相同 class 名称的冲突。 通常使用 CSS Modules 来定义组件样式，而不用担心和组件间以及全局样式的冲突。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// CSS Modules\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e styles \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;./foo.css\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eButton\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclassName\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{styles.btnAdd}\u003c/span\u003e\u0026gt;\u003c/span\u003eAdd\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e在 CSS Modules 中，也可以通过\u003ccode\u003e:global { }\u003c/code\u003e包裹方式，临时插入全局类样式，被包裹中的代码中定义的 CSS 类名，将不会被 CSS Modules 处理，直接输出到页面。\n例如我们自定义 header 中的菜单组件样式：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-less\"\u003e\u003cspan class=\"hljs-comment\"\u003e// main-layout.less\u003c/span\u003e\n\u003cspan class=\"hljs-selector-class\"\u003e.appHeader\u003c/span\u003e {\n  \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e64px\u003c/span\u003e;\n\n  :\u003cspan class=\"hljs-selector-tag\"\u003eglobal\u003c/span\u003e {\n    \u003cspan class=\"hljs-selector-class\"\u003e.ant-menu\u003c/span\u003e {\n      \u003cspan class=\"hljs-comment\"\u003e// ant-menu 是 antd \u0026lt;Menu /\u0026gt; 组件中的常量类名。\u003c/span\u003e\n      \u003cspan class=\"hljs-attribute\"\u003eborder\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n    }\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch3 id=\"%E5%85%A8%E5%B1%80%E6%A0%B7%E5%BC%8F%E5%AF%BC%E5%85%A5\"\u003e\n                  全局样式导入\n                \u003c/h3\u003e\u003cp\u003e非 CSS Modules 方式导入，css 文件内定义的类样式为全局样式，将会控制页面中所有满足条件的 DOM 元素。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 非 CSS Modules\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;./foo.css\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eButton\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclassName\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;btnAdd\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003eNew\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e;\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// 非 CSS Modules, bar.css内定义的样式为全局样式，将会控制页面中所有满足条件的DOM元素。\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;./bar.css\u0026quot;\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch2 id=\"%E4%BD%BF%E7%94%A8-less\"\u003e\n                  使用 LESS\n                \u003c/h2\u003e\u003cp\u003eJoy 原生支持 Less，使用 \u003ccode\u003e.less\u003c/code\u003e 后缀名定义 Less 文件。在使用 Less 之前，需要先安装 \u003ca href=\"https://github.com/less/less.js\"\u003eless\u003c/a\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003enpm install less\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch3 id=\"%E8%87%AA%E5%AE%9A%E4%B9%89-less-%E9%85%8D%E7%BD%AE\"\u003e\n                  自定义 LESS 配置\n                \u003c/h3\u003e\u003cp\u003e在 \u003ccode\u003ejoy.config.js\u003c/code\u003e 的 \u003ccode\u003elessOptions\u003c/code\u003e 字段中定义 Less 的自定义配置, 具体可配置项参考 \u003ca href=\"https://webpack.js.org/loaders/less-loader/\"\u003eless-loader\u003c/a\u003e 的配置。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e path = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;path\u0026quot;\u003c/span\u003e);\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = {\n  \u003cspan class=\"hljs-attr\"\u003elessOptions\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003estrictMath\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n  },\n};\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch2 id=\"%E4%BD%BF%E7%94%A8-sass\"\u003e\n                  使用 Sass\n                \u003c/h2\u003e\u003cp\u003eJoy 原生支持 Sass，使用 \u003ccode\u003e.scss\u003c/code\u003e 或 \u003ccode\u003e.sass\u003c/code\u003e 后缀名定义 Sass 文件，在使用 Sass 之前，需要先安装 \u003ca href=\"https://github.com/sass/sass\"\u003esass\u003c/a\u003e :\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003enpm install sass\n\u003c/code\u003e\u003c/pre\u003e\n\u003cblockquote\u003e\n\u003cp\u003eSass 支持 2 种语法格式定义来样式，\u003ccode\u003e.scss\u003c/code\u003e文件使用\u003ca href=\"https://sass-lang.com/documentation/syntax#scss\"\u003eSCSS 语法\u003c/a\u003e ，\u003ccode\u003e.sass\u003c/code\u003e文件使用 \u003ca href=\"https://sass-lang.com/documentation/syntax#the-indented-syntax\"\u003eIndented Syntax (\u0026quot;Sass\u0026quot;)\u003c/a\u003e 语法。\n如果你不确定使用哪种语法，可首先采用\u003ccode\u003e.scss\u003c/code\u003e，它是 CSS 的扩展，可使用 CSS 的全部语法，不需要学习新的 Indented Syntax 缩进语法。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n                \u003ch3 id=\"%E8%87%AA%E5%AE%9A%E4%B9%89-sass-%E9%85%8D%E7%BD%AE\"\u003e\n                  自定义 Sass 配置\n                \u003c/h3\u003e\u003cp\u003e在 \u003ccode\u003ejoy.config.js\u003c/code\u003e 的 \u003ccode\u003esassOptions\u003c/code\u003e 字段中定义 Sass 的自定义配置, 具体可配置项参考 \u003ca href=\"https://webpack.js.org/loaders/sass-loader/\"\u003esass-loader\u003c/a\u003e 的配置。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e path = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;path\u0026quot;\u003c/span\u003e);\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = {\n  \u003cspan class=\"hljs-attr\"\u003esassOptions\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003eadditionalData\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;$env: \u0026quot;\u003c/span\u003e + process.\u003cspan class=\"hljs-property\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eNODE_ENV\u003c/span\u003e + \u003cspan class=\"hljs-string\"\u003e\u0026quot;;\u0026quot;\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003eindentWidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003eincludePaths\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e\u0026quot;/absolute/path/a\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;/absolute/path/b\u0026quot;\u003c/span\u003e],\n  },\n};\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch3 id=\"sass-%E5%8F%98%E9%87%8F\"\u003e\n                  Sass 变量\n                \u003c/h3\u003e\u003cp\u003eJoy 支持 Sass 变量从 CSS Module 文件中导出。比如导出\u003ccode\u003eprimaryColor\u003c/code\u003e变量：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-scss\"\u003e\u003cspan class=\"hljs-comment\"\u003e/* index-scss-variables.scss */\u003c/span\u003e\n\u003cspan class=\"hljs-variable\"\u003e$primary-color\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e#ff0000\u003c/span\u003e;\n\n:export {\n  primaryColor: \u003cspan class=\"hljs-variable\"\u003e$primary-color\u003c/span\u003e;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-tsx\"\u003e\u003cspan class=\"hljs-comment\"\u003e// index-scss-variables.js\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e variables \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;../index-scss-variables.scss\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eMyApp\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e{ Component, pageProps }\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003estyle\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{{\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ecolor:\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003evariables.primaryColor\u003c/span\u003e }}\u0026gt;\u003c/span\u003eHello\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch2 id=\"todo\"\u003e\n                  todo\n                \u003c/h2\u003e\u003cul\u003e\n\u003cli\u003e自定义 PostCss \u003ca href=\"https://nextjs.org/docs/advanced-features/customizing-postcss-config\"\u003ehttps://nextjs.org/docs/advanced-features/customizing-postcss-config\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","anchor":[{"type":"heading","raw":"## 应用全局样式\n\n","depth":2,"text":"应用全局样式","tokens":[{"type":"text","raw":"应用全局样式","text":"应用全局样式"}],"id":"#%E5%BA%94%E7%94%A8%E5%85%A8%E5%B1%80%E6%A0%B7%E5%BC%8F"},{"type":"heading","raw":"## CSS 模块导入\n\n","depth":2,"text":"CSS 模块导入","tokens":[{"type":"text","raw":"CSS 模块导入","text":"CSS 模块导入"}],"id":"#css-%E6%A8%A1%E5%9D%97%E5%AF%BC%E5%85%A5","children":[{"type":"heading","raw":"### CSS Modules 导入\n\n","depth":3,"text":"CSS Modules 导入","tokens":[{"type":"text","raw":"CSS Modules 导入","text":"CSS Modules 导入"}],"id":"#css-modules-%E5%AF%BC%E5%85%A5"},{"type":"heading","raw":"### 全局样式导入\n\n","depth":3,"text":"全局样式导入","tokens":[{"type":"text","raw":"全局样式导入","text":"全局样式导入"}],"id":"#%E5%85%A8%E5%B1%80%E6%A0%B7%E5%BC%8F%E5%AF%BC%E5%85%A5"}]},{"type":"heading","raw":"## 使用 LESS\n\n","depth":2,"text":"使用 LESS","tokens":[{"type":"text","raw":"使用 LESS","text":"使用 LESS"}],"id":"#%E4%BD%BF%E7%94%A8-less","children":[{"type":"heading","raw":"### 自定义 LESS 配置\n\n","depth":3,"text":"自定义 LESS 配置","tokens":[{"type":"text","raw":"自定义 LESS 配置","text":"自定义 LESS 配置"}],"id":"#%E8%87%AA%E5%AE%9A%E4%B9%89-less-%E9%85%8D%E7%BD%AE"}]},{"type":"heading","raw":"## 使用 Sass\n\n","depth":2,"text":"使用 Sass","tokens":[{"type":"text","raw":"使用 Sass","text":"使用 Sass"}],"id":"#%E4%BD%BF%E7%94%A8-sass","children":[{"type":"heading","raw":"### 自定义 Sass 配置\n\n","depth":3,"text":"自定义 Sass 配置","tokens":[{"type":"text","raw":"自定义 Sass 配置","text":"自定义 Sass 配置"}],"id":"#%E8%87%AA%E5%AE%9A%E4%B9%89-sass-%E9%85%8D%E7%BD%AE"},{"type":"heading","raw":"### Sass 变量\n\n","depth":3,"text":"Sass 变量","tokens":[{"type":"text","raw":"Sass 变量","text":"Sass 变量"}],"id":"#sass-%E5%8F%98%E9%87%8F"}]},{"type":"heading","raw":"## todo\n\n","depth":2,"text":"todo","tokens":[{"type":"text","raw":"todo","text":"todo"}],"id":"#todo"}]},{"title":"使用图片","path":"/joy/react/use-image","file":"docs\\joy\\02-react\\06-use-image.md","hasMenu":false,"mdContent":"# 使用图片\r\n\r\n## 静态导入\r\n\r\nJoy 应用中可以直接静态导入图片模块， 支持的图片格式有: `png|jpg|jpeg|gif|webp|avif|ico|bmp|svg`。\r\n\r\n下面例子中，我们导入图片，并设置给 `img` 标签来展示图片:\r\n\r\n```tsx\r\nimport imgMe from \"./me.png\";\r\n// or const imgMe = require(\"./me.png\")\r\n\r\nfunction Avator() {\r\n  return \u003cimg src={imgMe.src} width={imgMe.width} height={imgMe.heigh} /\u003e;\r\n}\r\n```\r\n\r\n导入的变量类型为`StaticImageData`，包含加载地址和大小等信息：\r\n\r\n```ts\r\ninterface StaticImageData {\r\n  src: string;\r\n  width: number;\r\n  height: number;\r\n  blurDataURL?: string;\r\n}\r\n```\r\n\r\n- **src** Type: string, 图片加载在线地址，类似： `/_joy/static/media/xxxx.png`。\r\n- **width** Type: number, 图片的宽度，单位像素。\r\n- **height** Type: number, 图片的高度，单位像素。\r\n- **blurDataURL** Type: string, 图片预览图，默认为 `8 * 8`像素的缩略图，生产模式打包时值为 Base64 的 DataUrl， 开发模式时值为缩略的在线生成地址。\r\n\r\n## CSS 中使用图片\r\n\r\n```css\r\n.logo {\r\n  background: url(\"./logo.png\");\r\n}\r\n``` \r\n\r\n## 引用静态文件图片\r\n\r\nJoy 提供内建静态文件服务，将图片放入项目的`public`目录下，即可通过URL路径访问该图片。\r\n\r\n例如： 我们将图片放入 `public/logo.png` 路径下，在`img`标签里引用该图片。\r\n\r\n```tsx\r\n  return \u003cimg src=\"/logo.png\" /\u003e;\r\n```\r\n\r\n\r\n## Image 组件和图片优化\r\n\r\nJoy `Image` 组件是 HTML `\u003cimg\u003e` 标签的扩展， 它集成了一系列的性能优化操作，为应用提供更好的用户体验。\r\n\r\n一些内建的优化操作有：\r\n\r\n- 提升加载性能： 在不同的设备上，自动加载适应屏幕尺寸的图片，并使用优化的图片格式，例如 `webp`。\r\n- 防止累积布局偏移：固定图片布局，防止图片在加载过程中导致界面布局跳动。\r\n- 加快页面加载：图片仅在它可见是才加载，在加载之前，也可展示模糊的缩略图。\r\n- 灵活提供图片资源：服务端实时的提供各种尺寸和格式的图片，即使图片存储在远程的服务器上。\r\n\r\n### 使用本地图片\r\n\r\n使用本地图片，首先使用相对地址导入图片，然后赋值给 `Image` 组件的`src`属性。 本地图片在导入时，Joy 会检查其高宽，自动设置 `width` 和 `height` 属性， 防止图片加载过程中布局跳动。\r\n\r\n```tsx\r\nimport Image from \"@symph/joy/react\";\r\nimport logoImg from \"./logo.png\";\r\n\r\nfunction Home() {\r\n  return (\r\n    \u003c\u003e\r\n      \u003ch1\u003eHomePage\u003c/h1\u003e\r\n      \u003cImage\r\n        src={logoImg}\r\n        alt=\"logo\"\r\n        // width={100} 未设置时，默认采用图片的宽度。\r\n        // height={100} 未设置时，默认采用图片的高度。\r\n        // blurDataURL=\"data:...\" 未设置时，默认使用原\r\n        //\r\n        // 始图片 8 * 8 的模糊缩略图。\r\n        // placeholder=\"blur\" // 默认使用模糊缩略图，或者设置为 empty 空白\r\n      /\u003e\r\n      \u003cp\u003eWelcome to my homepage!\u003c/p\u003e\r\n    \u003c/\u003e\r\n  );\r\n}\r\n```\r\n\r\n### 使用远程图片\r\n\r\n使用远程图片和本地图片类似，只是 `src` 属性设置为远程图片的相对或绝对字符串 URL 地址。 因为在编译时 Joy 不能访问远程图片，所以不能得到图片的高宽，我们需要明确的手动指定图片的 `width` 和 `height` 属性。\r\n\r\n```tsx\r\nimport Image from \"@symph/joy/react\";\r\nimport logoImg from \"./logo.png\";\r\n\r\nfunction Home() {\r\n  return (\r\n    \u003c\u003e\r\n      \u003ch1\u003eHomePage\u003c/h1\u003e\r\n      \u003cImage\r\n        src=\"/logo.png\" // 图片的 URL 相对路径。\r\n        alt=\"logo\"\r\n        width={100}\r\n        height={100}\r\n      /\u003e\r\n      \u003cp\u003eWelcome to my homepage!\u003c/p\u003e`\r\n    \u003c/\u003e\r\n  );\r\n}\r\n```\r\n\r\n如果是外部域名，例如：`https://example1.com/logo.png` ，我们应该添加`domians`配置来设置安全域白名单，保护我们的应用程序不被恶意的用户破坏，不在这些域名内的图片，将拒绝提供图片优化服务。\r\n在 `joy.config.js`中设置 `domains`来指定安全域，例如：\r\n\r\n```js\r\nmodule.exports = {\r\n  images: {\r\n    domains: [\"example1.com\", \"example2.com\"],\r\n  },\r\n};\r\n```\r\n\r\n### 图片尺寸\r\n\r\n图片影响用户体验的最常见的场景是改不布局，如图片在加载过程中推动其它元素。这对用户来说是非常糟糕的体验，以至于产生了一个核心指标 [累积布局偏移 CLS](https://web.dev/cls/) 来量化用户经历意外布局偏移的频率。\r\n避免因图片加载导致布局偏移的方法是始终设置图片的大小，这让浏览器在加载之前为图片预留足够的空间。\r\n\r\n`Image` 组件是为了保证良好的性能结果而设计的，所以它会采用以下 3 中方式来确定图片大小，防止布局变化：\r\n\r\n1. 自动识别大小， 当采用静态导入的时候。\r\n2. 明确指定大小， 使用 `width` 和 `height` 属性明确设置图片大小。\r\n3. 隐式声明， 设置属性 `layout=\"fill\"`，使图片缩放适配其父元素大小。\r\n\r\n另外图片文件大小也是影响页面加载性能的重要因素之一，加载图片时，`Image` 组价计算出图片展示尺寸后，会从 `[16, 32, 48, 64, 96, 128, 256, 384, ...]`等尺寸规格中选取比当前展示尺寸大一号的图片版本，例如图片展示宽度为 `80px`，会加载`96px`规格的图片副本。\r\n并且副本图片会优先采用`webp`或者`avif`等压缩率和压缩质量较高的图片格式，进一步减小图片的文件大小。\r\n\r\n### 加载优先级\r\n\r\n我们应该为任何的 [最大内容绘制 LCP](https://web.dev/lcp) 的图片元素设置 `priority` 属性，从而让 Joy 优先加载图片（通过预加载标签和优先级属性实现 ），减少最大内容绘制耗时。\r\n\r\n通常最大内容绘制元素是页面可视区域内的大尺寸图片或者文本块，当使用 `joy dev` 开发模式运行应用时，如果一个最大内容绘制元素的`Image` 组件未设置 `priority`属性，将会在 console 里收到一条提示信息。\r\n\r\n### 内置图片优化服务\r\n\r\nJoy 内置图片优化服务，该服务可以优化 web 上的任何图像，然后从 Joy 的内置 web 服务器对外提供这些优化后图像。\r\n\r\n从以下几个优化面：\r\n\r\n- 根据界面布局大小，使用缩小版的图片。\r\n- 转换为压缩质量更高的图片格式，例如 `webp`。\r\n- 提供低质量的图片，提升加载速度。\r\n- 设置图片资源缓存，有效利用浏览器缓存。\r\n\r\n该服务对外提供 API GET 接口： `/_joy/image`， 接口参数：\r\n\r\n- `url`: `string` 必须，图片的下载地址，可以是本地相对或绝对路径，或者远程绝对路径。\r\n- `w`: `number` 必须，图片的宽度，等比缩放图片使宽度等于该值。\r\n- `q`: `number` 非必须，图片的压缩质量百分比，取 0 到 100 的整数，默认 75。\r\n- `mimeType`：隐藏参数，无需设置，通过请求 header 的`accept`自动获取，例如浏览器支持 `accept: image/webp`,将优先返回 `webp`格式，否则返回原图片格式。\r\n\r\n例如我们希望获取宽度 32px，压缩质量 75%、格式为`webp`的图片，完整的请求 URL 路径为：`http://localhost:3000/_joy/image/?url=%2Fexample.png\u0026w=32\u0026q=75`\r\n\r\n\u003e 该服务内部默认使用 [`squoosh`](https://www.npmjs.com/package/@squoosh/lib) 库来加工图片，因为它安装起来很快，而且适合于开发环境。\r\n\u003e 在生成环境中，建议替换为[`sharp`](https://www.npmjs.com/package/sharp)工具，在项目目录中运行 `yarn add sharp` 来安装 [`sharp`](https://www.npmjs.com/package/sharp)，安装成功后重启应用，会自动切换为 [`sharp`](https://www.npmjs.com/package/sharp)。\r\n\u003e `sharp` 比 `squoosh` 能更快更高效的处理图片，由于 `sharp` 在安装时会下载其底层依赖`libvips`包，受网络环境的影响较大，安装很缓慢且容易失败，所以在开发环境使用安装更轻便的`squoosh`。\r\n\r\n### 图片加载器\r\n\r\n通过设置图片的 `loader` 属性指定加载器，图片加载器是一个方法，用于生成图片 URL 地址或者多尺寸的图片地址集合，地址集合将用于生成 `\u003cimg /\u003e`标签的`srcset`属性，从而为用户提供满足他们展示设备的大小图片。\r\n\r\nJoy 应用的默认加载器 ` default` 使用内置的图片优化服务 API。\r\n如果我们想直接从 CDN 或其它图像服务器上获取图片，可以用几行 JavaScript 实现一个新的加载器，使用一个 Joy 内置的加载器。\r\n\r\n下面示例展示如何使用 Imgix 服务商提供的图片服务，首先配置图片模块，设置全局的默认加载器为内置的 `imgix`，也可以不用全局配置，在`Image`组件内设置每个组件自己的加载器。\r\n\r\n```ts\r\n// joy.confing.js\r\nmodule.exports = {\r\n  images: {\r\n    loader: \"imgix\",\r\n    path: \"https://static.imgix.net\",\r\n  },\r\n};\r\n```\r\n\r\n在`Image`组件内定义图片路径和大小等信息：\r\n\r\n```tsx\r\n\u003cImage src=\"/daisy.png\" width={300} qulity={75} /\u003e\r\n```\r\n\r\n上面的例子中，最终图片加载地址类似于：`https://static.imgix.net/daisy.png?auto=format\u0026fit=max\u0026w=300\u0026q=75`\r\n\r\n### 图片样式\r\n\r\n`Image` 组件和标准的 `\u003cimg \u003e`标签在样式设置上没有太大不同，下面是一些需要注意的指导建议：\r\n\r\n- 使用 `className` 来查询图片和定义样式，不应该依赖 DOM 结构， `Image` 组件是一个复合组件，里面使用 `\u003cspan\u003e`标签包裹`\u003cimg\u003e`标签，在某些情况下，我们并不能使用 DOM 结构精确的定位到图片。\r\n- 使用正确的布局模式，`Image` 组件提供了几种不同的布局模式来定义它在页面上的大小。\r\n- 当 `layout=\"fill\"` 时，其父元素的样式必须包含 `position: relative`。\r\n- 的 `layout=\"responsive\"` 时，其父元素样式必须包含 `display: block`。\r\n\r\n### Image 组件属性\r\n\r\n#### src\r\n\r\n属性名称：`src`，类型：`string|StaticImport`，默认值：`-`，必须：`true`\r\n\r\n必须是下列之一：\r\n\r\n- 静态导入`import`的图片对象。\r\n- 字符串，可以是一个绝对的外部 URL，也可以是一个内部路径，这取决于配置的`loader`。\r\n\r\n使用外部 URL，我们应该设置安全域（在应用配置里添加`images.domains`配置）.\r\n\r\n#### width\r\n\r\n属性名称：`width`，类型：`number`，默认值：`undefined`，必须：`false`\r\n\r\n图片的宽度，输入整数的像素值。\r\n必须设置该属性，除非是静态导入的图片或者`layout=\"fill\"`时。\r\n\r\n#### height\r\n\r\n属性名称：`height`，类型：`number`，默认值：`undefined`，必须：`false`\r\n\r\n图片的宽度，输入整数的像素值。\r\n必须设置该属性，除非是静态导入的图片或者`layout=\"fill\"`的时。\r\n\r\n#### loader\r\n\r\n属性名称：`loader`，类型：`(resolverProps:ImageLoaderProps) =\u003e string`，默认值：`undefined`，必须：`false`\r\n\r\n`loader` 是一个自定义方法，使用图片的属性来生成完整 URL 地址，接受以下参数：\r\n\r\n- `src`: `string` 图片的相对或绝对路径。\r\n- `width`: `number` 期望加载图片的宽度。\r\n- `quality`: `number` 期望加载图片的压缩质量。\r\n- `config`: `ImageConfig` 图片模块的配置。\r\n\r\n下面是一个自定义的加载器示例：\r\n\r\n```tsx\r\nimport Image from \"@symph/joy/react\";\r\n\r\nconst myLoader = ({ src, width, quality }) =\u003e {\r\n  return `https://example.com/${src}?w=${width}\u0026q=${quality || 75}`;\r\n};\r\n\r\nconst MyImage = (props) =\u003e {\r\n  return \u003cImage loader={myLoader} src=\"me.png\" alt=\"Picture of the author\" width={500} height={500} /\u003e;\r\n};\r\n```\r\n\r\nJoy 内建了一些云服务提供商的图片加载器，我们可以在应用配置点 `images.loader` 上, 设置默认图片加载器。\r\n\r\n#### layout\r\n\r\n属性名称：`layout`，类型： `\"intrinsic\"|\"fixed\"|\"responsive\"|\"fill\"`，默认值：`\"intrinsic\"`，必须：`false`\r\n\r\n通过 `layout`属性设置布局模式，用于定义图片布局将随窗口变化时如何变化，Joy 内置了以下 4 种布局模式：\r\n\r\n- `intrinsic`\r\n  默认布局，当父容器的宽度小于图片组件的宽度时，缩小图片尺寸以适应父容器的宽度，当父容器的宽度大于图片组件的宽度时，会展示图片组件的固定宽度。\r\n  受影响的属性：\r\n\r\n  - `srcSet`： 基于当前图片组件的尺寸，从 `imageSizes` 中选取和组件尺寸相同或大一号的尺寸，生成 `srcSet` 中 `1x`，`2x`的图片。\r\n  - `sizes`: 该属性值无效。\r\n\r\n- `fixed` 图片组件的尺寸不会随着父容器的大小改变而改变，这个标准的`img`标签的表现一样。\r\n  受影响的属性：\r\n\r\n  - `srcSet`： 基于当前图片组件的尺寸，从 `imageSizes` 中选取和组件尺寸相同或大一号的尺寸，生成 `srcSet` 中 `1x`，`2x`的图片。\r\n  - `sizes`: 该属性值无效。\r\n\r\n- `responsive` 图片组件将缩放适应父元素的宽度，父元素需要样式需包含 `display: block`。\r\n  在不同的窗口尺寸下，组件将加载对应尺寸的图片。例如：在`1080px`宽度的窗口上加载 `1080px` 版本的图片，在`1920px`宽度的窗口上加载 `1920px`版本的图片。\r\n  受影响的属性：\r\n\r\n  - `srcSet`： 将 `imageSizes` 和 `deviceSizes` 定义的所有尺寸生成 `srcSet` 列表，以便可以响应式的加载对应尺寸的图片。\r\n  - `sizes`: 默认为 `100vw`。\r\n\r\n- `fill` 图片组件宽度和高度将拉伸到父元素的尺寸，父元素需要是相对布局的，样式需包含 `position: relative `。\r\n  配合 `objectFit` 属性定义拉伸缩放模式，例如：`fill` 拉伸填充， `contain` 包含等。\r\n  受影响的属性：\r\n\r\n  - `srcSet`： 将 `imageSizes` 和 `deviceSizes` 定义的所有尺寸生成 `srcSet` 列表，以便可以响应式的加载对应尺寸的图片。\r\n  - `sizes`: 默认为 `100vw`。\r\n\r\n#### sizes\r\n\r\n属性名称：`sizes`，类型： `string`，默认值：`undefined`，必须：`false`\r\n\r\n指定不同页面布局的图像大小了， 例如：`sizes=\"(max-width: 360px) 340px, 128px\"`，表示当视区宽度不大于 360 像素时候，图片的宽度限制为 340 像素，其他情况下，使用 128 像素。\r\n\r\n当 `layout=\"responsive\"` 或者 `layout=\"fill\"` 时，默认值时 `100vw` 即占满整个窗口，我们可以设置更小的值，使图片小于窗口的宽度。\r\n\r\n当 `layout=\"intrinsic\"` 或者 `layout=\"fixed\"` 时，`sizes`属性是无效的，因为它依赖的是父容器边界大小。\r\n\r\n[了解更多](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/img#attr-sizes)\r\n\r\n#### objectFit\r\n\r\n属性名称：`objectFit`，类型： `string`，默认值：`undefined`，必须：`false`\r\n\r\n当 `layout=\"fill\"`时，定义图片如何填充父元素， 如：\r\n\r\n- `fill` 图片拉伸填充整个父容器。\r\n- `container`图片等比放大后填满父容器的整个宽度或高度。\r\n- `cover` 图片等比放大覆盖整个父容器。\r\n- `none` 图片缩放，在父容器中心按原尺寸展示图片。\r\n\r\n该属性将直接传递给 `img` 的 [`object-fit`](https://developer.mozilla.org/en-US/docs/Web/CSS/object-fit) 属性。\r\n\r\n#### objectPosition\r\n\r\n属性名称：`objectPosition`，类型： `string`，默认值：`undefined`，必须：`false`\r\n\r\n当 `layout=\"fill\"`时，定义图片在父元素的布局位置，例如： `\"right top\"`\r\n\r\n该属性将直接传递给 `img` 的 [`object-position`](https://developer.mozilla.org/en-US/docs/Web/CSS/object-position) 属性。\r\n\r\n#### quality\r\n\r\n属性名称：`quality`，类型： `number`，默认值：`75`，必须：`false`\r\n\r\n`quality`属性设置加载什么质量的图片，质量是相对于原图片的压缩质量，取 `1` 到 `100` 的整数，默认值 `75`。\r\n数值越高质量越好，同时图片的文件大小也会越大。\r\n\r\n#### priority\r\n\r\n属性名称：`priority`，类型： `bool`，默认值：`false`，必须：`false`\r\n\r\n如果为 `true` 图片将尽量优先加载，图片延迟加载将自动关闭。\r\n\r\n我们应该为任何的 [最大内容绘制 LCP](https://web.dev/lcp) 的图片元素设置 `priority` 属性。\r\n\r\n#### loading\r\n\r\n属性名称：`loading`，类型： `string`，默认值：`lazy`，必须：`false`\r\n\r\n设置图片的加载时机。\r\n\r\n- `lazy` 延迟加载图片，当图片滚动到可视区域时才开始加载图片。\r\n- `eager` 立即加载图片。\r\n\r\n\u003e 请尽量保持默认的 `lazy` 模式，立即加载 `eager` 模式，在大多数情况下会影响网页的加载性能。如需尽快加载图片，推荐使用 `priority` 属性。\r\n\r\n#### lazyBoundary\r\n\r\n属性名称：`lazyBoundary`，类型： `string`，默认值：`\"200px\"`，必须：`false`\r\n\r\n当图片延迟加载时，检查图片到可视区域的距离阈值，当小于这个阈值时，即视为图片即将展示，需立即开始加载图片，触发加载过程。\r\n\r\n如果图片时嵌入在一个内部可滚动的父容器中，需要通过`lazyRoot`属性指定父容器，使用父容器的滚动位置来计算可视区域，而不是直接使用 document 的滚动位置。\r\n\r\n#### lazyRoot\r\n\r\n属性名称：`lazyRoot`，类型： `ref`，默认值：`null`，必须：`false`\r\n\r\n设置一个 [React Ref](https://reactjs.org/docs/refs-and-the-dom.html) ，指向滚动的父容器。默认值 `null`，表示 document。\r\n\r\n```tsx\r\nimport React from \"react\";\r\nimport Image from \"@symph/joy/react\";\r\n\r\nconst lazyRoot = React.useRef(null);\r\n\r\nconst Example = () =\u003e (\r\n  \u003cdiv ref={lazyRoot} style={{ overflowX: \"scroll\", width: \"500px\" }}\u003e\r\n    \u003cImage lazyRoot={lazyRoot} src=\"/one.jpg\" width=\"500\" height=\"500\" /\u003e\r\n    \u003cImage lazyRoot={lazyRoot} src=\"/two.jpg\" width=\"500\" height=\"500\" /\u003e\r\n  \u003c/div\u003e\r\n);\r\n```\r\n\r\nRef 必须指向一个 DOM 元素，而不是 React Component 复合组件。如果父元素是 React Component 中，可以使用 [forwarding-refs](https://reactjs.org/docs/forwarding-refs.html) 方法，将引用指向其内部 DOM 元素。例如：\r\n\r\n```tsx\r\nimport React from \"react\";\r\nimport Image from \"@symph/joy/react\";\r\n\r\nconst Container = React.forwardRef((props, ref) =\u003e {\r\n  return (\r\n    \u003cdiv ref={ref} style={{ overflowX: \"scroll\", width: \"500px\" }}\u003e\r\n      {props.children}\r\n    \u003c/div\u003e\r\n  );\r\n});\r\n\r\nconst Example = () =\u003e {\r\n  const lazyRoot = React.useRef(null);\r\n\r\n  return (\r\n    \u003cContainer ref={lazyRoot}\u003e\r\n      \u003cImage lazyRoot={lazyRoot} src=\"/one.jpg\" width=\"500\" height=\"500\" /\u003e\r\n      \u003cImage lazyRoot={lazyRoot} src=\"/two.jpg\" width=\"500\" height=\"500\" /\u003e\r\n    \u003c/Container\u003e\r\n  );\r\n};\r\n```\r\n\r\n#### placeholder\r\n\r\n属性名称：`placeholder`，类型： `\"blur\"|\"empty\"`，默认值：`\"empty\"`，必须：`false`\r\n\r\n`placeholder`属性设置图片加载中的占位图，提供 `blur`和`emtpy`两个选项，默认值：`emtpy`。\r\n\r\n当 `placeholder=\"blur\"` 时，使用`blurDataURL`图片来显示占位图。 如果 `src` 设置的是静态`import`的图片对象，如：导入的`.jpg`、`.png`、`.webp`等，`blurDataURL`属性将自动从导入对象中取值。\r\n如是是动态加载的远程图片，需要手动提供 `blurDataURL` 属性。\r\n\r\n当 `placeholder=\"blemtpyur\"`时，图片在加载过程中，将保留空白的区域，无任何的展位图。\r\n\r\n#### blurDataURL\r\n\r\n属性名称：`placeholder`，类型： `string`，默认值：`undefined`，必须：`false`\r\n\r\n当 `placeholder=\"blur\"`时，使用 `blurDataURL` 的内容来展示占位图，值必须是 Base64 编码的 DataUrl 字符串。\r\n占位图会被放大和模糊，所以建议使用非常小的图像(10px 或更小)，Joy 静态导入的图片，默认是 8px 的缩略图。\r\n\r\n#### unoptimized\r\n\r\n属性名称：`unoptimized`，类型： `bool`，默认值：`false`，必须：`false`\r\n\r\n为 `true` 时，关闭图片优化，将使用图片的源文件，不会使用经过大小、质量和格式优化后的图片。\r\n\r\n#### onLoadingComplete\r\n\r\n属性名称：`onLoadingComplete`，类型： `function`，默认值：`undefiend`，必须：`false`\r\n\r\n图片加载完成后的回调函数，接受 1 个对象参数，对象参数有以下属性：\r\n\r\n- [`naturalWidth` ](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/naturalWidth)\r\n- [`naturalHeight`](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/naturalHeight)\r\n\r\n#### others\r\n\r\n赋值给`\u003cImage \u003e`组件的其它属性，将直接传递给内部的 `img` 标签。有以下几点需注意：\r\n\r\n- `style`属性，请使用 `className` 方式替换，不能直接给图片组件内联样式。\r\n- `srcSet`属性，请配置`images.deviceSize`项，设置可支持的设备窗口大小列表，组件会自动计算出合适的`srcSet`集合。\r\n- `ref`属性，请使用`onLoadingComplete`替换，如需获取图片的信息，可在该回调函数中获取。\r\n- `decoding` 属性需一直保持为 `\"async\"`。\r\n\r\n### 图片模块配置\r\n\r\n`Image` 组件和图片优化服务可以在应用配置的`images`节点中自定义配置。\r\n下面是应用的默认配置示例：\r\n\r\n```ts\r\nmodule.exports = {\r\n  deviceSizes: [640, 750, 828, 1080, 1200, 1920, 2048, 3840],\r\n  imageSizes: [16, 32, 48, 64, 96, 128, 256, 384],\r\n  path: \"/_joy/image\",\r\n  loader: \"default\",\r\n  domains: [],\r\n  disableStaticImages: false,\r\n  minimumCacheTTL: 60,\r\n  formats: [\"image/webp\"],\r\n  dangerouslyAllowSVG: false,\r\n  contentSecurityPolicy: `script-src 'none'; frame-src 'none'; sandbox;`,\r\n  unoptimized: false,\r\n};\r\n```\r\n\r\n#### domains\r\n\r\n配置名称：`domains`，类型： `stirng[]`，默认值：`[]`，必须：`false`\r\n\r\n当使用其它域名的远程图片时，为了保护我们的应用程序不被恶意的用户破坏，`domains`配置远程图片所在域名的白名单，不在这些域名内的图片，`Image` 组件和图片优化将拒绝服务。\r\n\r\n#### loader\r\n\r\n配置名称：`loader`，类型： `string`，默认值：`\"default\"`，必须：`false`\r\n\r\n如果我们想不使用 Joy 内建的图片服务， 而想使用其它云服务商提供的图片存储和优化服务，可以配置 `loader` 参数来切换图片加载方式。\r\n一般结合 `path` 参数使用， `path`参数设置图片的 URL 地址前缀，而后在`Image`的 src 属性上，只需设置图片的相对路径。\r\n\r\n```tsx\r\nmodule.exports = {\r\n  images: {\r\n    loader: \"imgix\",\r\n    path: \"https://static.imgix.net\",\r\n  },\r\n};\r\n```\r\n\r\nJoy 提供了以下内置加载器：\r\n\r\n- `default` : 使用内置图片优化服务的加载器。\r\n- `imgix`: 使用 [Imgix](https://imgix.com/) 服务商提供的图片服务。\r\n- `cloudinary`: 使用 [Cloudinary](https://cloudinary.com/) 服务商提供的图片服务。\r\n- `akamai`: 使用 [Akamai](https://www.akamai.com/) 服务商提供的图片服务。\r\n- `custom`: 使用自定义的云服务，设置该选项后，每个`Image` 组件必须设置自定义的`loader`属性。\r\n\r\n#### path\r\n\r\n配置名称：`path`，类型： `string`，默认值：`\"/_joy/image\"`，必须：`false`\r\n\r\n在默认 `loader=\"default\"` 时， path 的默认值是 `\"/_joy/image\"`， 即使用 Joy 内置的图片优化服务。\r\n\r\n如果使用其它图片服务，可以设置`path`配置图片的统一 URL 地址前缀，而后在`Image`的 src 属性上只需设置图片的相对路径，运行时将两者合并生成完整的图片地址。\r\n\r\n#### deviceSizes\r\n\r\n配置名称：`deviceSizes`，类型： `number[]`，默认值：`[640, 750, 828, 1080, 1200, 1920, 2048, 3840]`，必须：`false`\r\n\r\n当我们明确知道用户设备的宽度有哪些时，我们可以设置一个列表将这些宽度分段，在分段区间的内，加载对应尺寸的图片，从而让用户在各种尺寸的屏幕上，都可以获得较好的体验。\r\n这些设备宽度仅会在`Image` 组件 `layout=\"responsive\"` 或 `layout=\"fill\"` 时使用得到。\r\n\r\n#### imageSizes\r\n\r\n配置名称：`imageSizes`，类型： `number[]`，默认值：`[16, 32, 48, 64, 96, 128, 256, 384]`，必须：`false`\r\n\r\n我们可以设置图片的宽度列表，这些宽度与`deviceSizes` 数组连接在一起，用于生成图像 srcsets 的完整大小数组。\r\n\r\n之所以有两个单独的宽度列表，是因为 `imageSizes` 只用于设置了`sizes`属性的图片，即图片的宽度小于全尺寸的屏幕宽度。因此，`imageSizes` 中的大小应该都小于`deviceSizes`中的最小大小。\r\n\r\n#### formats\r\n\r\n配置名称：`formats`，类型： `string[]`，默认值：`[\"image/webp\"]`，必须：`false`\r\n\r\n如果请求的`Accept`头能匹配配置列表中的多个格式，则使用数组中的第一个匹配项作为返回格式。因此，数组的顺序很重要。如果没有匹配的格式，将返回原始图像的格式。\r\n\r\n例如我们想优先使用`image/avif`，如果浏览器不支持 avif，则再检查是否支持 'image/webp' 格式，如果还不支持，则返回图片原格式，可以这样编写配置：\r\n\r\n```ts\r\nmodule.exports = {\r\n  images: {\r\n    formats: [\"image/avif\", \"image/webp\"],\r\n  },\r\n};\r\n```\r\n\r\n\u003e AVIF 编码通常要多花 20%的时间，但它比 WebP 多压缩了 20%的空间。这意味着第一次请求图片时，它通常会缓慢点，而缓存后，后续请求会变快。\r\n\r\n#### minimumCacheTTL\r\n\r\n配置名称：`minimumCacheTTL`，类型： `number`，默认值：`60`，必须：`false`\r\n\r\n设置图片的在优化服务内的最小缓存时长，单位秒。\r\n大多数情况下，建议使用使用 [静态导入](#静态导入) 的方式加载图片，这将自动为图片生成一个唯一的 hash 值，并设置`Cache-Control`为`immutable`，使图片长期有效。\r\n\r\n#### disableStaticImages\r\n\r\n配置名称：`disableStaticImages`，类型： `bool`，默认值：`false`，必须：`false`\r\n\r\n默认情况下，我们可以直接静态导入图片，如 `import logo from \"./logo.png\"`，然后设置给图片组件的 `src`属性。\r\n\r\n但有时候，如果静态导入和其它插件冲突，或者想自定义 webpack 插件以实现不同的导入方式，我们可以设置为`false`关闭默认的图片导入插件。\r\n\r\n#### dangerouslyAllowSVG\r\n\r\n配置名称：`dangerouslyAllowSVG`，类型： `bool`，默认值：`false`，必须：`false`\r\n\r\n默认 Joy 的内置图片优化服务不会对 SVG 格式的图片进行优化。\r\n首先，SVG 是一种矢量格式，这意味着它可以无损地调整大小。其次，SVG 有许多与 HTML/CSS 相同的特性，如果没有适当的内容安全策略(CSP)头，这些特性可能会导致漏洞。\r\n\r\n如果想内置的图片优化服务提供 SVG 图片格式，可以启用该功能，并设置适当的内容安全策略。\r\n\r\n```ts\r\nmodule.exports = {\r\n  images: {\r\n    dangerouslyAllowSVG: true,\r\n    contentSecurityPolicy: \"default-src 'self'; script-src 'none'; sandbox;\",\r\n  },\r\n};\r\n```\r\n","htmlContent":"\n                \u003ch1 id=\"%E4%BD%BF%E7%94%A8%E5%9B%BE%E7%89%87\"\u003e\n                  使用图片\n                \u003c/h1\u003e\n                \u003ch2 id=\"%E9%9D%99%E6%80%81%E5%AF%BC%E5%85%A5\"\u003e\n                  静态导入\n                \u003c/h2\u003e\u003cp\u003eJoy 应用中可以直接静态导入图片模块， 支持的图片格式有: \u003ccode\u003epng|jpg|jpeg|gif|webp|avif|ico|bmp|svg\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e下面例子中，我们导入图片，并设置给 \u003ccode\u003eimg\u003c/code\u003e 标签来展示图片:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-tsx\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e imgMe \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;./me.png\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-comment\"\u003e// or const imgMe = require(\u0026quot;./me.png\u0026quot;)\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eAvator\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eimg\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{imgMe.src}\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ewidth\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{imgMe.width}\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eheight\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{imgMe.heigh}\u003c/span\u003e /\u0026gt;\u003c/span\u003e\u003c/span\u003e;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e导入的变量类型为\u003ccode\u003eStaticImageData\u003c/code\u003e，包含加载地址和大小等信息：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eStaticImageData\u003c/span\u003e {\n  \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e;\n  \u003cspan class=\"hljs-attr\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003enumber\u003c/span\u003e;\n  \u003cspan class=\"hljs-attr\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003enumber\u003c/span\u003e;\n  blurDataURL?: \u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003esrc\u003c/strong\u003e Type: string, 图片加载在线地址，类似： \u003ccode\u003e/_joy/static/media/xxxx.png\u003c/code\u003e。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003ewidth\u003c/strong\u003e Type: number, 图片的宽度，单位像素。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eheight\u003c/strong\u003e Type: number, 图片的高度，单位像素。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eblurDataURL\u003c/strong\u003e Type: string, 图片预览图，默认为 \u003ccode\u003e8 * 8\u003c/code\u003e像素的缩略图，生产模式打包时值为 Base64 的 DataUrl， 开发模式时值为缩略的在线生成地址。\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch2 id=\"css-%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%9B%BE%E7%89%87\"\u003e\n                  CSS 中使用图片\n                \u003c/h2\u003e\u003cpre\u003e\u003ccode class=\"hljs language-css\"\u003e\u003cspan class=\"hljs-selector-class\"\u003e.logo\u003c/span\u003e {\n  \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003eurl\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;./logo.png\u0026quot;\u003c/span\u003e);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch2 id=\"%E5%BC%95%E7%94%A8%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E5%9B%BE%E7%89%87\"\u003e\n                  引用静态文件图片\n                \u003c/h2\u003e\u003cp\u003eJoy 提供内建静态文件服务，将图片放入项目的\u003ccode\u003epublic\u003c/code\u003e目录下，即可通过URL路径访问该图片。\u003c/p\u003e\n\u003cp\u003e例如： 我们将图片放入 \u003ccode\u003epublic/logo.png\u003c/code\u003e 路径下，在\u003ccode\u003eimg\u003c/code\u003e标签里引用该图片。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-tsx\"\u003e  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eimg\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;/logo.png\u0026quot;\u003c/span\u003e /\u0026gt;\u003c/span\u003e\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch2 id=\"image-%E7%BB%84%E4%BB%B6%E5%92%8C%E5%9B%BE%E7%89%87%E4%BC%98%E5%8C%96\"\u003e\n                  Image 组件和图片优化\n                \u003c/h2\u003e\u003cp\u003eJoy \u003ccode\u003eImage\u003c/code\u003e 组件是 HTML \u003ccode\u003e\u0026lt;img\u0026gt;\u003c/code\u003e 标签的扩展， 它集成了一系列的性能优化操作，为应用提供更好的用户体验。\u003c/p\u003e\n\u003cp\u003e一些内建的优化操作有：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e提升加载性能： 在不同的设备上，自动加载适应屏幕尺寸的图片，并使用优化的图片格式，例如 \u003ccode\u003ewebp\u003c/code\u003e。\u003c/li\u003e\n\u003cli\u003e防止累积布局偏移：固定图片布局，防止图片在加载过程中导致界面布局跳动。\u003c/li\u003e\n\u003cli\u003e加快页面加载：图片仅在它可见是才加载，在加载之前，也可展示模糊的缩略图。\u003c/li\u003e\n\u003cli\u003e灵活提供图片资源：服务端实时的提供各种尺寸和格式的图片，即使图片存储在远程的服务器上。\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch3 id=\"%E4%BD%BF%E7%94%A8%E6%9C%AC%E5%9C%B0%E5%9B%BE%E7%89%87\"\u003e\n                  使用本地图片\n                \u003c/h3\u003e\u003cp\u003e使用本地图片，首先使用相对地址导入图片，然后赋值给 \u003ccode\u003eImage\u003c/code\u003e 组件的\u003ccode\u003esrc\u003c/code\u003e属性。 本地图片在导入时，Joy 会检查其高宽，自动设置 \u003ccode\u003ewidth\u003c/code\u003e 和 \u003ccode\u003eheight\u003c/code\u003e 属性， 防止图片加载过程中布局跳动。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-tsx\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eImage\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e logoImg \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;./logo.png\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eHome\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n    \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh1\u003c/span\u003e\u0026gt;\u003c/span\u003eHomePage\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh1\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eImage\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{logoImg}\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003ealt\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;logo\u0026quot;\u003c/span\u003e\n        // \u003cspan class=\"hljs-attr\"\u003ewidth\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{100}\u003c/span\u003e 未设置时，默认采用图片的宽度。\n        // \u003cspan class=\"hljs-attr\"\u003eheight\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{100}\u003c/span\u003e 未设置时，默认采用图片的高度。\n        // \u003cspan class=\"hljs-attr\"\u003eblurDataURL\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;data:...\u0026quot;\u003c/span\u003e 未设置时，默认使用原\n        //\n        // 始图片 \u003cspan class=\"hljs-attr\"\u003e8\u003c/span\u003e * \u003cspan class=\"hljs-attr\"\u003e8\u003c/span\u003e 的模糊缩略图。\n        // \u003cspan class=\"hljs-attr\"\u003eplaceholder\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;blur\u0026quot;\u003c/span\u003e // 默认使用模糊缩略图，或者设置为 \u003cspan class=\"hljs-attr\"\u003eempty\u003c/span\u003e 空白\n      /\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003eWelcome to my homepage!\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u0026gt;\u003c/span\u003e\u003c/span\u003e\n  );\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch3 id=\"%E4%BD%BF%E7%94%A8%E8%BF%9C%E7%A8%8B%E5%9B%BE%E7%89%87\"\u003e\n                  使用远程图片\n                \u003c/h3\u003e\u003cp\u003e使用远程图片和本地图片类似，只是 \u003ccode\u003esrc\u003c/code\u003e 属性设置为远程图片的相对或绝对字符串 URL 地址。 因为在编译时 Joy 不能访问远程图片，所以不能得到图片的高宽，我们需要明确的手动指定图片的 \u003ccode\u003ewidth\u003c/code\u003e 和 \u003ccode\u003eheight\u003c/code\u003e 属性。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-tsx\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eImage\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e logoImg \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;./logo.png\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eHome\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n    \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh1\u003c/span\u003e\u0026gt;\u003c/span\u003eHomePage\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh1\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eImage\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;/logo.png\u0026quot;\u003c/span\u003e // 图片的 \u003cspan class=\"hljs-attr\"\u003eURL\u003c/span\u003e 相对路径。\n        \u003cspan class=\"hljs-attr\"\u003ealt\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;logo\u0026quot;\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003ewidth\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{100}\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003eheight\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{100}\u003c/span\u003e\n      /\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003eWelcome to my homepage!\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e`\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u0026gt;\u003c/span\u003e\u003c/span\u003e\n  );\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e如果是外部域名，例如：\u003ccode\u003ehttps://example1.com/logo.png\u003c/code\u003e ，我们应该添加\u003ccode\u003edomians\u003c/code\u003e配置来设置安全域白名单，保护我们的应用程序不被恶意的用户破坏，不在这些域名内的图片，将拒绝提供图片优化服务。\n在 \u003ccode\u003ejoy.config.js\u003c/code\u003e中设置 \u003ccode\u003edomains\u003c/code\u003e来指定安全域，例如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = {\n  \u003cspan class=\"hljs-attr\"\u003eimages\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003edomains\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e\u0026quot;example1.com\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;example2.com\u0026quot;\u003c/span\u003e],\n  },\n};\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch3 id=\"%E5%9B%BE%E7%89%87%E5%B0%BA%E5%AF%B8\"\u003e\n                  图片尺寸\n                \u003c/h3\u003e\u003cp\u003e图片影响用户体验的最常见的场景是改不布局，如图片在加载过程中推动其它元素。这对用户来说是非常糟糕的体验，以至于产生了一个核心指标 \u003ca href=\"https://web.dev/cls/\"\u003e累积布局偏移 CLS\u003c/a\u003e 来量化用户经历意外布局偏移的频率。\n避免因图片加载导致布局偏移的方法是始终设置图片的大小，这让浏览器在加载之前为图片预留足够的空间。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eImage\u003c/code\u003e 组件是为了保证良好的性能结果而设计的，所以它会采用以下 3 中方式来确定图片大小，防止布局变化：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e自动识别大小， 当采用静态导入的时候。\u003c/li\u003e\n\u003cli\u003e明确指定大小， 使用 \u003ccode\u003ewidth\u003c/code\u003e 和 \u003ccode\u003eheight\u003c/code\u003e 属性明确设置图片大小。\u003c/li\u003e\n\u003cli\u003e隐式声明， 设置属性 \u003ccode\u003elayout=\u0026quot;fill\u0026quot;\u003c/code\u003e，使图片缩放适配其父元素大小。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e另外图片文件大小也是影响页面加载性能的重要因素之一，加载图片时，\u003ccode\u003eImage\u003c/code\u003e 组价计算出图片展示尺寸后，会从 \u003ccode\u003e[16, 32, 48, 64, 96, 128, 256, 384, ...]\u003c/code\u003e等尺寸规格中选取比当前展示尺寸大一号的图片版本，例如图片展示宽度为 \u003ccode\u003e80px\u003c/code\u003e，会加载\u003ccode\u003e96px\u003c/code\u003e规格的图片副本。\n并且副本图片会优先采用\u003ccode\u003ewebp\u003c/code\u003e或者\u003ccode\u003eavif\u003c/code\u003e等压缩率和压缩质量较高的图片格式，进一步减小图片的文件大小。\u003c/p\u003e\n\n                \u003ch3 id=\"%E5%8A%A0%E8%BD%BD%E4%BC%98%E5%85%88%E7%BA%A7\"\u003e\n                  加载优先级\n                \u003c/h3\u003e\u003cp\u003e我们应该为任何的 \u003ca href=\"https://web.dev/lcp\"\u003e最大内容绘制 LCP\u003c/a\u003e 的图片元素设置 \u003ccode\u003epriority\u003c/code\u003e 属性，从而让 Joy 优先加载图片（通过预加载标签和优先级属性实现 ），减少最大内容绘制耗时。\u003c/p\u003e\n\u003cp\u003e通常最大内容绘制元素是页面可视区域内的大尺寸图片或者文本块，当使用 \u003ccode\u003ejoy dev\u003c/code\u003e 开发模式运行应用时，如果一个最大内容绘制元素的\u003ccode\u003eImage\u003c/code\u003e 组件未设置 \u003ccode\u003epriority\u003c/code\u003e属性，将会在 console 里收到一条提示信息。\u003c/p\u003e\n\n                \u003ch3 id=\"%E5%86%85%E7%BD%AE%E5%9B%BE%E7%89%87%E4%BC%98%E5%8C%96%E6%9C%8D%E5%8A%A1\"\u003e\n                  内置图片优化服务\n                \u003c/h3\u003e\u003cp\u003eJoy 内置图片优化服务，该服务可以优化 web 上的任何图像，然后从 Joy 的内置 web 服务器对外提供这些优化后图像。\u003c/p\u003e\n\u003cp\u003e从以下几个优化面：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e根据界面布局大小，使用缩小版的图片。\u003c/li\u003e\n\u003cli\u003e转换为压缩质量更高的图片格式，例如 \u003ccode\u003ewebp\u003c/code\u003e。\u003c/li\u003e\n\u003cli\u003e提供低质量的图片，提升加载速度。\u003c/li\u003e\n\u003cli\u003e设置图片资源缓存，有效利用浏览器缓存。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e该服务对外提供 API GET 接口： \u003ccode\u003e/_joy/image\u003c/code\u003e， 接口参数：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eurl\u003c/code\u003e: \u003ccode\u003estring\u003c/code\u003e 必须，图片的下载地址，可以是本地相对或绝对路径，或者远程绝对路径。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ew\u003c/code\u003e: \u003ccode\u003enumber\u003c/code\u003e 必须，图片的宽度，等比缩放图片使宽度等于该值。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eq\u003c/code\u003e: \u003ccode\u003enumber\u003c/code\u003e 非必须，图片的压缩质量百分比，取 0 到 100 的整数，默认 75。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003emimeType\u003c/code\u003e：隐藏参数，无需设置，通过请求 header 的\u003ccode\u003eaccept\u003c/code\u003e自动获取，例如浏览器支持 \u003ccode\u003eaccept: image/webp\u003c/code\u003e,将优先返回 \u003ccode\u003ewebp\u003c/code\u003e格式，否则返回原图片格式。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e例如我们希望获取宽度 32px，压缩质量 75%、格式为\u003ccode\u003ewebp\u003c/code\u003e的图片，完整的请求 URL 路径为：\u003ccode\u003ehttp://localhost:3000/_joy/image/?url=%2Fexample.png\u0026amp;w=32\u0026amp;q=75\u003c/code\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e该服务内部默认使用 \u003ca href=\"https://www.npmjs.com/package/@squoosh/lib\"\u003e\u003ccode\u003esquoosh\u003c/code\u003e\u003c/a\u003e 库来加工图片，因为它安装起来很快，而且适合于开发环境。\n在生成环境中，建议替换为\u003ca href=\"https://www.npmjs.com/package/sharp\"\u003e\u003ccode\u003esharp\u003c/code\u003e\u003c/a\u003e工具，在项目目录中运行 \u003ccode\u003eyarn add sharp\u003c/code\u003e 来安装 \u003ca href=\"https://www.npmjs.com/package/sharp\"\u003e\u003ccode\u003esharp\u003c/code\u003e\u003c/a\u003e，安装成功后重启应用，会自动切换为 \u003ca href=\"https://www.npmjs.com/package/sharp\"\u003e\u003ccode\u003esharp\u003c/code\u003e\u003c/a\u003e。\n\u003ccode\u003esharp\u003c/code\u003e 比 \u003ccode\u003esquoosh\u003c/code\u003e 能更快更高效的处理图片，由于 \u003ccode\u003esharp\u003c/code\u003e 在安装时会下载其底层依赖\u003ccode\u003elibvips\u003c/code\u003e包，受网络环境的影响较大，安装很缓慢且容易失败，所以在开发环境使用安装更轻便的\u003ccode\u003esquoosh\u003c/code\u003e。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n                \u003ch3 id=\"%E5%9B%BE%E7%89%87%E5%8A%A0%E8%BD%BD%E5%99%A8\"\u003e\n                  图片加载器\n                \u003c/h3\u003e\u003cp\u003e通过设置图片的 \u003ccode\u003eloader\u003c/code\u003e 属性指定加载器，图片加载器是一个方法，用于生成图片 URL 地址或者多尺寸的图片地址集合，地址集合将用于生成 \u003ccode\u003e\u0026lt;img /\u0026gt;\u003c/code\u003e标签的\u003ccode\u003esrcset\u003c/code\u003e属性，从而为用户提供满足他们展示设备的大小图片。\u003c/p\u003e\n\u003cp\u003eJoy 应用的默认加载器 \u003ccode\u003e default\u003c/code\u003e 使用内置的图片优化服务 API。\n如果我们想直接从 CDN 或其它图像服务器上获取图片，可以用几行 JavaScript 实现一个新的加载器，使用一个 Joy 内置的加载器。\u003c/p\u003e\n\u003cp\u003e下面示例展示如何使用 Imgix 服务商提供的图片服务，首先配置图片模块，设置全局的默认加载器为内置的 \u003ccode\u003eimgix\u003c/code\u003e，也可以不用全局配置，在\u003ccode\u003eImage\u003c/code\u003e组件内设置每个组件自己的加载器。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-comment\"\u003e// joy.confing.js\u003c/span\u003e\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = {\n  \u003cspan class=\"hljs-attr\"\u003eimages\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003eloader\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;imgix\u0026quot;\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;https://static.imgix.net\u0026quot;\u003c/span\u003e,\n  },\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e在\u003ccode\u003eImage\u003c/code\u003e组件内定义图片路径和大小等信息：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-tsx\"\u003e\u0026lt;\u003cspan class=\"hljs-title class_\"\u003eImage\u003c/span\u003e src=\u003cspan class=\"hljs-string\"\u003e\u0026quot;/daisy.png\u0026quot;\u003c/span\u003e width={\u003cspan class=\"hljs-number\"\u003e300\u003c/span\u003e} qulity={\u003cspan class=\"hljs-number\"\u003e75\u003c/span\u003e} /\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e上面的例子中，最终图片加载地址类似于：\u003ccode\u003ehttps://static.imgix.net/daisy.png?auto=format\u0026amp;fit=max\u0026amp;w=300\u0026amp;q=75\u003c/code\u003e\u003c/p\u003e\n\n                \u003ch3 id=\"%E5%9B%BE%E7%89%87%E6%A0%B7%E5%BC%8F\"\u003e\n                  图片样式\n                \u003c/h3\u003e\u003cp\u003e\u003ccode\u003eImage\u003c/code\u003e 组件和标准的 \u003ccode\u003e\u0026lt;img \u0026gt;\u003c/code\u003e标签在样式设置上没有太大不同，下面是一些需要注意的指导建议：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e使用 \u003ccode\u003eclassName\u003c/code\u003e 来查询图片和定义样式，不应该依赖 DOM 结构， \u003ccode\u003eImage\u003c/code\u003e 组件是一个复合组件，里面使用 \u003ccode\u003e\u0026lt;span\u0026gt;\u003c/code\u003e标签包裹\u003ccode\u003e\u0026lt;img\u0026gt;\u003c/code\u003e标签，在某些情况下，我们并不能使用 DOM 结构精确的定位到图片。\u003c/li\u003e\n\u003cli\u003e使用正确的布局模式，\u003ccode\u003eImage\u003c/code\u003e 组件提供了几种不同的布局模式来定义它在页面上的大小。\u003c/li\u003e\n\u003cli\u003e当 \u003ccode\u003elayout=\u0026quot;fill\u0026quot;\u003c/code\u003e 时，其父元素的样式必须包含 \u003ccode\u003eposition: relative\u003c/code\u003e。\u003c/li\u003e\n\u003cli\u003e的 \u003ccode\u003elayout=\u0026quot;responsive\u0026quot;\u003c/code\u003e 时，其父元素样式必须包含 \u003ccode\u003edisplay: block\u003c/code\u003e。\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch3 id=\"image-%E7%BB%84%E4%BB%B6%E5%B1%9E%E6%80%A7\"\u003e\n                  Image 组件属性\n                \u003c/h3\u003e\n                \u003ch4 id=\"src\"\u003e\n                  src\n                \u003c/h4\u003e\u003cp\u003e属性名称：\u003ccode\u003esrc\u003c/code\u003e，类型：\u003ccode\u003estring|StaticImport\u003c/code\u003e，默认值：\u003ccode\u003e-\u003c/code\u003e，必须：\u003ccode\u003etrue\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e必须是下列之一：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e静态导入\u003ccode\u003eimport\u003c/code\u003e的图片对象。\u003c/li\u003e\n\u003cli\u003e字符串，可以是一个绝对的外部 URL，也可以是一个内部路径，这取决于配置的\u003ccode\u003eloader\u003c/code\u003e。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e使用外部 URL，我们应该设置安全域（在应用配置里添加\u003ccode\u003eimages.domains\u003c/code\u003e配置）.\u003c/p\u003e\n\n                \u003ch4 id=\"width\"\u003e\n                  width\n                \u003c/h4\u003e\u003cp\u003e属性名称：\u003ccode\u003ewidth\u003c/code\u003e，类型：\u003ccode\u003enumber\u003c/code\u003e，默认值：\u003ccode\u003eundefined\u003c/code\u003e，必须：\u003ccode\u003efalse\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e图片的宽度，输入整数的像素值。\n必须设置该属性，除非是静态导入的图片或者\u003ccode\u003elayout=\u0026quot;fill\u0026quot;\u003c/code\u003e时。\u003c/p\u003e\n\n                \u003ch4 id=\"height\"\u003e\n                  height\n                \u003c/h4\u003e\u003cp\u003e属性名称：\u003ccode\u003eheight\u003c/code\u003e，类型：\u003ccode\u003enumber\u003c/code\u003e，默认值：\u003ccode\u003eundefined\u003c/code\u003e，必须：\u003ccode\u003efalse\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e图片的宽度，输入整数的像素值。\n必须设置该属性，除非是静态导入的图片或者\u003ccode\u003elayout=\u0026quot;fill\u0026quot;\u003c/code\u003e的时。\u003c/p\u003e\n\n                \u003ch4 id=\"loader\"\u003e\n                  loader\n                \u003c/h4\u003e\u003cp\u003e属性名称：\u003ccode\u003eloader\u003c/code\u003e，类型：\u003ccode\u003e(resolverProps:ImageLoaderProps) =\u0026gt; string\u003c/code\u003e，默认值：\u003ccode\u003eundefined\u003c/code\u003e，必须：\u003ccode\u003efalse\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eloader\u003c/code\u003e 是一个自定义方法，使用图片的属性来生成完整 URL 地址，接受以下参数：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003esrc\u003c/code\u003e: \u003ccode\u003estring\u003c/code\u003e 图片的相对或绝对路径。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ewidth\u003c/code\u003e: \u003ccode\u003enumber\u003c/code\u003e 期望加载图片的宽度。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003equality\u003c/code\u003e: \u003ccode\u003enumber\u003c/code\u003e 期望加载图片的压缩质量。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003econfig\u003c/code\u003e: \u003ccode\u003eImageConfig\u003c/code\u003e 图片模块的配置。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e下面是一个自定义的加载器示例：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-tsx\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eImage\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/react\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003emyLoader\u003c/span\u003e = (\u003cspan class=\"hljs-params\"\u003e{ src, width, quality }\u003c/span\u003e) =\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e`https://example.com/\u003cspan class=\"hljs-subst\"\u003e${src}\u003c/span\u003e?w=\u003cspan class=\"hljs-subst\"\u003e${width}\u003c/span\u003e\u0026amp;q=\u003cspan class=\"hljs-subst\"\u003e${quality || \u003cspan class=\"hljs-number\"\u003e75\u003c/span\u003e}\u003c/span\u003e`\u003c/span\u003e;\n};\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eMyImage\u003c/span\u003e = (\u003cspan class=\"hljs-params\"\u003eprops\u003c/span\u003e) =\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eImage\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eloader\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{myLoader}\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;me.png\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ealt\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;Picture of the author\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ewidth\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{500}\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eheight\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{500}\u003c/span\u003e /\u0026gt;\u003c/span\u003e\u003c/span\u003e;\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eJoy 内建了一些云服务提供商的图片加载器，我们可以在应用配置点 \u003ccode\u003eimages.loader\u003c/code\u003e 上, 设置默认图片加载器。\u003c/p\u003e\n\n                \u003ch4 id=\"layout\"\u003e\n                  layout\n                \u003c/h4\u003e\u003cp\u003e属性名称：\u003ccode\u003elayout\u003c/code\u003e，类型： \u003ccode\u003e\u0026quot;intrinsic\u0026quot;|\u0026quot;fixed\u0026quot;|\u0026quot;responsive\u0026quot;|\u0026quot;fill\u0026quot;\u003c/code\u003e，默认值：\u003ccode\u003e\u0026quot;intrinsic\u0026quot;\u003c/code\u003e，必须：\u003ccode\u003efalse\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e通过 \u003ccode\u003elayout\u003c/code\u003e属性设置布局模式，用于定义图片布局将随窗口变化时如何变化，Joy 内置了以下 4 种布局模式：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003e\u003ccode\u003eintrinsic\u003c/code\u003e\n默认布局，当父容器的宽度小于图片组件的宽度时，缩小图片尺寸以适应父容器的宽度，当父容器的宽度大于图片组件的宽度时，会展示图片组件的固定宽度。\n受影响的属性：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003esrcSet\u003c/code\u003e： 基于当前图片组件的尺寸，从 \u003ccode\u003eimageSizes\u003c/code\u003e 中选取和组件尺寸相同或大一号的尺寸，生成 \u003ccode\u003esrcSet\u003c/code\u003e 中 \u003ccode\u003e1x\u003c/code\u003e，\u003ccode\u003e2x\u003c/code\u003e的图片。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003esizes\u003c/code\u003e: 该属性值无效。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ccode\u003efixed\u003c/code\u003e 图片组件的尺寸不会随着父容器的大小改变而改变，这个标准的\u003ccode\u003eimg\u003c/code\u003e标签的表现一样。\n受影响的属性：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003esrcSet\u003c/code\u003e： 基于当前图片组件的尺寸，从 \u003ccode\u003eimageSizes\u003c/code\u003e 中选取和组件尺寸相同或大一号的尺寸，生成 \u003ccode\u003esrcSet\u003c/code\u003e 中 \u003ccode\u003e1x\u003c/code\u003e，\u003ccode\u003e2x\u003c/code\u003e的图片。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003esizes\u003c/code\u003e: 该属性值无效。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ccode\u003eresponsive\u003c/code\u003e 图片组件将缩放适应父元素的宽度，父元素需要样式需包含 \u003ccode\u003edisplay: block\u003c/code\u003e。\n在不同的窗口尺寸下，组件将加载对应尺寸的图片。例如：在\u003ccode\u003e1080px\u003c/code\u003e宽度的窗口上加载 \u003ccode\u003e1080px\u003c/code\u003e 版本的图片，在\u003ccode\u003e1920px\u003c/code\u003e宽度的窗口上加载 \u003ccode\u003e1920px\u003c/code\u003e版本的图片。\n受影响的属性：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003esrcSet\u003c/code\u003e： 将 \u003ccode\u003eimageSizes\u003c/code\u003e 和 \u003ccode\u003edeviceSizes\u003c/code\u003e 定义的所有尺寸生成 \u003ccode\u003esrcSet\u003c/code\u003e 列表，以便可以响应式的加载对应尺寸的图片。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003esizes\u003c/code\u003e: 默认为 \u003ccode\u003e100vw\u003c/code\u003e。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ccode\u003efill\u003c/code\u003e 图片组件宽度和高度将拉伸到父元素的尺寸，父元素需要是相对布局的，样式需包含 \u003ccode\u003eposition: relative \u003c/code\u003e。\n配合 \u003ccode\u003eobjectFit\u003c/code\u003e 属性定义拉伸缩放模式，例如：\u003ccode\u003efill\u003c/code\u003e 拉伸填充， \u003ccode\u003econtain\u003c/code\u003e 包含等。\n受影响的属性：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003esrcSet\u003c/code\u003e： 将 \u003ccode\u003eimageSizes\u003c/code\u003e 和 \u003ccode\u003edeviceSizes\u003c/code\u003e 定义的所有尺寸生成 \u003ccode\u003esrcSet\u003c/code\u003e 列表，以便可以响应式的加载对应尺寸的图片。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003esizes\u003c/code\u003e: 默认为 \u003ccode\u003e100vw\u003c/code\u003e。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch4 id=\"sizes\"\u003e\n                  sizes\n                \u003c/h4\u003e\u003cp\u003e属性名称：\u003ccode\u003esizes\u003c/code\u003e，类型： \u003ccode\u003estring\u003c/code\u003e，默认值：\u003ccode\u003eundefined\u003c/code\u003e，必须：\u003ccode\u003efalse\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e指定不同页面布局的图像大小了， 例如：\u003ccode\u003esizes=\u0026quot;(max-width: 360px) 340px, 128px\u0026quot;\u003c/code\u003e，表示当视区宽度不大于 360 像素时候，图片的宽度限制为 340 像素，其他情况下，使用 128 像素。\u003c/p\u003e\n\u003cp\u003e当 \u003ccode\u003elayout=\u0026quot;responsive\u0026quot;\u003c/code\u003e 或者 \u003ccode\u003elayout=\u0026quot;fill\u0026quot;\u003c/code\u003e 时，默认值时 \u003ccode\u003e100vw\u003c/code\u003e 即占满整个窗口，我们可以设置更小的值，使图片小于窗口的宽度。\u003c/p\u003e\n\u003cp\u003e当 \u003ccode\u003elayout=\u0026quot;intrinsic\u0026quot;\u003c/code\u003e 或者 \u003ccode\u003elayout=\u0026quot;fixed\u0026quot;\u003c/code\u003e 时，\u003ccode\u003esizes\u003c/code\u003e属性是无效的，因为它依赖的是父容器边界大小。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/Element/img#attr-sizes\"\u003e了解更多\u003c/a\u003e\u003c/p\u003e\n\n                \u003ch4 id=\"objectfit\"\u003e\n                  objectFit\n                \u003c/h4\u003e\u003cp\u003e属性名称：\u003ccode\u003eobjectFit\u003c/code\u003e，类型： \u003ccode\u003estring\u003c/code\u003e，默认值：\u003ccode\u003eundefined\u003c/code\u003e，必须：\u003ccode\u003efalse\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e当 \u003ccode\u003elayout=\u0026quot;fill\u0026quot;\u003c/code\u003e时，定义图片如何填充父元素， 如：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003efill\u003c/code\u003e 图片拉伸填充整个父容器。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003econtainer\u003c/code\u003e图片等比放大后填满父容器的整个宽度或高度。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ecover\u003c/code\u003e 图片等比放大覆盖整个父容器。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003enone\u003c/code\u003e 图片缩放，在父容器中心按原尺寸展示图片。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e该属性将直接传递给 \u003ccode\u003eimg\u003c/code\u003e 的 \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/object-fit\"\u003e\u003ccode\u003eobject-fit\u003c/code\u003e\u003c/a\u003e 属性。\u003c/p\u003e\n\n                \u003ch4 id=\"objectposition\"\u003e\n                  objectPosition\n                \u003c/h4\u003e\u003cp\u003e属性名称：\u003ccode\u003eobjectPosition\u003c/code\u003e，类型： \u003ccode\u003estring\u003c/code\u003e，默认值：\u003ccode\u003eundefined\u003c/code\u003e，必须：\u003ccode\u003efalse\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e当 \u003ccode\u003elayout=\u0026quot;fill\u0026quot;\u003c/code\u003e时，定义图片在父元素的布局位置，例如： \u003ccode\u003e\u0026quot;right top\u0026quot;\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e该属性将直接传递给 \u003ccode\u003eimg\u003c/code\u003e 的 \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/object-position\"\u003e\u003ccode\u003eobject-position\u003c/code\u003e\u003c/a\u003e 属性。\u003c/p\u003e\n\n                \u003ch4 id=\"quality\"\u003e\n                  quality\n                \u003c/h4\u003e\u003cp\u003e属性名称：\u003ccode\u003equality\u003c/code\u003e，类型： \u003ccode\u003enumber\u003c/code\u003e，默认值：\u003ccode\u003e75\u003c/code\u003e，必须：\u003ccode\u003efalse\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003equality\u003c/code\u003e属性设置加载什么质量的图片，质量是相对于原图片的压缩质量，取 \u003ccode\u003e1\u003c/code\u003e 到 \u003ccode\u003e100\u003c/code\u003e 的整数，默认值 \u003ccode\u003e75\u003c/code\u003e。\n数值越高质量越好，同时图片的文件大小也会越大。\u003c/p\u003e\n\n                \u003ch4 id=\"priority\"\u003e\n                  priority\n                \u003c/h4\u003e\u003cp\u003e属性名称：\u003ccode\u003epriority\u003c/code\u003e，类型： \u003ccode\u003ebool\u003c/code\u003e，默认值：\u003ccode\u003efalse\u003c/code\u003e，必须：\u003ccode\u003efalse\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e如果为 \u003ccode\u003etrue\u003c/code\u003e 图片将尽量优先加载，图片延迟加载将自动关闭。\u003c/p\u003e\n\u003cp\u003e我们应该为任何的 \u003ca href=\"https://web.dev/lcp\"\u003e最大内容绘制 LCP\u003c/a\u003e 的图片元素设置 \u003ccode\u003epriority\u003c/code\u003e 属性。\u003c/p\u003e\n\n                \u003ch4 id=\"loading\"\u003e\n                  loading\n                \u003c/h4\u003e\u003cp\u003e属性名称：\u003ccode\u003eloading\u003c/code\u003e，类型： \u003ccode\u003estring\u003c/code\u003e，默认值：\u003ccode\u003elazy\u003c/code\u003e，必须：\u003ccode\u003efalse\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e设置图片的加载时机。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003elazy\u003c/code\u003e 延迟加载图片，当图片滚动到可视区域时才开始加载图片。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eeager\u003c/code\u003e 立即加载图片。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e请尽量保持默认的 \u003ccode\u003elazy\u003c/code\u003e 模式，立即加载 \u003ccode\u003eeager\u003c/code\u003e 模式，在大多数情况下会影响网页的加载性能。如需尽快加载图片，推荐使用 \u003ccode\u003epriority\u003c/code\u003e 属性。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n                \u003ch4 id=\"lazyboundary\"\u003e\n                  lazyBoundary\n                \u003c/h4\u003e\u003cp\u003e属性名称：\u003ccode\u003elazyBoundary\u003c/code\u003e，类型： \u003ccode\u003estring\u003c/code\u003e，默认值：\u003ccode\u003e\u0026quot;200px\u0026quot;\u003c/code\u003e，必须：\u003ccode\u003efalse\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e当图片延迟加载时，检查图片到可视区域的距离阈值，当小于这个阈值时，即视为图片即将展示，需立即开始加载图片，触发加载过程。\u003c/p\u003e\n\u003cp\u003e如果图片时嵌入在一个内部可滚动的父容器中，需要通过\u003ccode\u003elazyRoot\u003c/code\u003e属性指定父容器，使用父容器的滚动位置来计算可视区域，而不是直接使用 document 的滚动位置。\u003c/p\u003e\n\n                \u003ch4 id=\"lazyroot\"\u003e\n                  lazyRoot\n                \u003c/h4\u003e\u003cp\u003e属性名称：\u003ccode\u003elazyRoot\u003c/code\u003e，类型： \u003ccode\u003eref\u003c/code\u003e，默认值：\u003ccode\u003enull\u003c/code\u003e，必须：\u003ccode\u003efalse\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e设置一个 \u003ca href=\"https://reactjs.org/docs/refs-and-the-dom.html\"\u003eReact Ref\u003c/a\u003e ，指向滚动的父容器。默认值 \u003ccode\u003enull\u003c/code\u003e，表示 document。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-tsx\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eReact\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eImage\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/react\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e lazyRoot = \u003cspan class=\"hljs-title class_\"\u003eReact\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003euseRef\u003c/span\u003e(\u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eExample\u003c/span\u003e = (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) =\u0026gt; (\n  \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{lazyRoot}\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003estyle\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{{\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eoverflowX:\u003c/span\u003e \u0026quot;\u003cspan class=\"hljs-attr\"\u003escroll\u003c/span\u003e\u0026quot;, \u003cspan class=\"hljs-attr\"\u003ewidth:\u003c/span\u003e \u0026quot;\u003cspan class=\"hljs-attr\"\u003e500px\u003c/span\u003e\u0026quot; }}\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eImage\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003elazyRoot\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{lazyRoot}\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;/one.jpg\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ewidth\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;500\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eheight\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;500\u0026quot;\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eImage\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003elazyRoot\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{lazyRoot}\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;/two.jpg\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ewidth\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;500\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eheight\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;500\u0026quot;\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eRef 必须指向一个 DOM 元素，而不是 React Component 复合组件。如果父元素是 React Component 中，可以使用 \u003ca href=\"https://reactjs.org/docs/forwarding-refs.html\"\u003eforwarding-refs\u003c/a\u003e 方法，将引用指向其内部 DOM 元素。例如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-tsx\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eReact\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eImage\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/react\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eContainer\u003c/span\u003e = \u003cspan class=\"hljs-title class_\"\u003eReact\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eforwardRef\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eprops, ref\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n    \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{ref}\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003estyle\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{{\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eoverflowX:\u003c/span\u003e \u0026quot;\u003cspan class=\"hljs-attr\"\u003escroll\u003c/span\u003e\u0026quot;, \u003cspan class=\"hljs-attr\"\u003ewidth:\u003c/span\u003e \u0026quot;\u003cspan class=\"hljs-attr\"\u003e500px\u003c/span\u003e\u0026quot; }}\u0026gt;\u003c/span\u003e\n      {props.children}\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n  );\n});\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eExample\u003c/span\u003e = (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) =\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e lazyRoot = \u003cspan class=\"hljs-title class_\"\u003eReact\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003euseRef\u003c/span\u003e(\u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e);\n\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n    \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eContainer\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{lazyRoot}\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eImage\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003elazyRoot\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{lazyRoot}\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;/one.jpg\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ewidth\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;500\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eheight\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;500\u0026quot;\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eImage\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003elazyRoot\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{lazyRoot}\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;/two.jpg\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ewidth\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;500\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eheight\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;500\u0026quot;\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eContainer\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n  );\n};\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch4 id=\"placeholder\"\u003e\n                  placeholder\n                \u003c/h4\u003e\u003cp\u003e属性名称：\u003ccode\u003eplaceholder\u003c/code\u003e，类型： \u003ccode\u003e\u0026quot;blur\u0026quot;|\u0026quot;empty\u0026quot;\u003c/code\u003e，默认值：\u003ccode\u003e\u0026quot;empty\u0026quot;\u003c/code\u003e，必须：\u003ccode\u003efalse\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eplaceholder\u003c/code\u003e属性设置图片加载中的占位图，提供 \u003ccode\u003eblur\u003c/code\u003e和\u003ccode\u003eemtpy\u003c/code\u003e两个选项，默认值：\u003ccode\u003eemtpy\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e当 \u003ccode\u003eplaceholder=\u0026quot;blur\u0026quot;\u003c/code\u003e 时，使用\u003ccode\u003eblurDataURL\u003c/code\u003e图片来显示占位图。 如果 \u003ccode\u003esrc\u003c/code\u003e 设置的是静态\u003ccode\u003eimport\u003c/code\u003e的图片对象，如：导入的\u003ccode\u003e.jpg\u003c/code\u003e、\u003ccode\u003e.png\u003c/code\u003e、\u003ccode\u003e.webp\u003c/code\u003e等，\u003ccode\u003eblurDataURL\u003c/code\u003e属性将自动从导入对象中取值。\n如是是动态加载的远程图片，需要手动提供 \u003ccode\u003eblurDataURL\u003c/code\u003e 属性。\u003c/p\u003e\n\u003cp\u003e当 \u003ccode\u003eplaceholder=\u0026quot;blemtpyur\u0026quot;\u003c/code\u003e时，图片在加载过程中，将保留空白的区域，无任何的展位图。\u003c/p\u003e\n\n                \u003ch4 id=\"blurdataurl\"\u003e\n                  blurDataURL\n                \u003c/h4\u003e\u003cp\u003e属性名称：\u003ccode\u003eplaceholder\u003c/code\u003e，类型： \u003ccode\u003estring\u003c/code\u003e，默认值：\u003ccode\u003eundefined\u003c/code\u003e，必须：\u003ccode\u003efalse\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e当 \u003ccode\u003eplaceholder=\u0026quot;blur\u0026quot;\u003c/code\u003e时，使用 \u003ccode\u003eblurDataURL\u003c/code\u003e 的内容来展示占位图，值必须是 Base64 编码的 DataUrl 字符串。\n占位图会被放大和模糊，所以建议使用非常小的图像(10px 或更小)，Joy 静态导入的图片，默认是 8px 的缩略图。\u003c/p\u003e\n\n                \u003ch4 id=\"unoptimized\"\u003e\n                  unoptimized\n                \u003c/h4\u003e\u003cp\u003e属性名称：\u003ccode\u003eunoptimized\u003c/code\u003e，类型： \u003ccode\u003ebool\u003c/code\u003e，默认值：\u003ccode\u003efalse\u003c/code\u003e，必须：\u003ccode\u003efalse\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e为 \u003ccode\u003etrue\u003c/code\u003e 时，关闭图片优化，将使用图片的源文件，不会使用经过大小、质量和格式优化后的图片。\u003c/p\u003e\n\n                \u003ch4 id=\"onloadingcomplete\"\u003e\n                  onLoadingComplete\n                \u003c/h4\u003e\u003cp\u003e属性名称：\u003ccode\u003eonLoadingComplete\u003c/code\u003e，类型： \u003ccode\u003efunction\u003c/code\u003e，默认值：\u003ccode\u003eundefiend\u003c/code\u003e，必须：\u003ccode\u003efalse\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e图片加载完成后的回调函数，接受 1 个对象参数，对象参数有以下属性：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/naturalWidth\"\u003e\u003ccode\u003enaturalWidth\u003c/code\u003e \u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/naturalHeight\"\u003e\u003ccode\u003enaturalHeight\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch4 id=\"others\"\u003e\n                  others\n                \u003c/h4\u003e\u003cp\u003e赋值给\u003ccode\u003e\u0026lt;Image \u0026gt;\u003c/code\u003e组件的其它属性，将直接传递给内部的 \u003ccode\u003eimg\u003c/code\u003e 标签。有以下几点需注意：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003estyle\u003c/code\u003e属性，请使用 \u003ccode\u003eclassName\u003c/code\u003e 方式替换，不能直接给图片组件内联样式。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003esrcSet\u003c/code\u003e属性，请配置\u003ccode\u003eimages.deviceSize\u003c/code\u003e项，设置可支持的设备窗口大小列表，组件会自动计算出合适的\u003ccode\u003esrcSet\u003c/code\u003e集合。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eref\u003c/code\u003e属性，请使用\u003ccode\u003eonLoadingComplete\u003c/code\u003e替换，如需获取图片的信息，可在该回调函数中获取。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003edecoding\u003c/code\u003e 属性需一直保持为 \u003ccode\u003e\u0026quot;async\u0026quot;\u003c/code\u003e。\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch3 id=\"%E5%9B%BE%E7%89%87%E6%A8%A1%E5%9D%97%E9%85%8D%E7%BD%AE\"\u003e\n                  图片模块配置\n                \u003c/h3\u003e\u003cp\u003e\u003ccode\u003eImage\u003c/code\u003e 组件和图片优化服务可以在应用配置的\u003ccode\u003eimages\u003c/code\u003e节点中自定义配置。\n下面是应用的默认配置示例：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = {\n  \u003cspan class=\"hljs-attr\"\u003edeviceSizes\u003c/span\u003e: [\u003cspan class=\"hljs-number\"\u003e640\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e750\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e828\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1080\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1200\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1920\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2048\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3840\u003c/span\u003e],\n  \u003cspan class=\"hljs-attr\"\u003eimageSizes\u003c/span\u003e: [\u003cspan class=\"hljs-number\"\u003e16\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e32\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e48\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e64\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e96\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e128\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e256\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e384\u003c/span\u003e],\n  \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;/_joy/image\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003eloader\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;default\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003edomains\u003c/span\u003e: [],\n  \u003cspan class=\"hljs-attr\"\u003edisableStaticImages\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003eminimumCacheTTL\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e60\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003eformats\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e\u0026quot;image/webp\u0026quot;\u003c/span\u003e],\n  \u003cspan class=\"hljs-attr\"\u003edangerouslyAllowSVG\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003econtentSecurityPolicy\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e`script-src \u0026#x27;none\u0026#x27;; frame-src \u0026#x27;none\u0026#x27;; sandbox;`\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003eunoptimized\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n};\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch4 id=\"domains\"\u003e\n                  domains\n                \u003c/h4\u003e\u003cp\u003e配置名称：\u003ccode\u003edomains\u003c/code\u003e，类型： \u003ccode\u003estirng[]\u003c/code\u003e，默认值：\u003ccode\u003e[]\u003c/code\u003e，必须：\u003ccode\u003efalse\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e当使用其它域名的远程图片时，为了保护我们的应用程序不被恶意的用户破坏，\u003ccode\u003edomains\u003c/code\u003e配置远程图片所在域名的白名单，不在这些域名内的图片，\u003ccode\u003eImage\u003c/code\u003e 组件和图片优化将拒绝服务。\u003c/p\u003e\n\n                \u003ch4 id=\"loader\"\u003e\n                  loader\n                \u003c/h4\u003e\u003cp\u003e配置名称：\u003ccode\u003eloader\u003c/code\u003e，类型： \u003ccode\u003estring\u003c/code\u003e，默认值：\u003ccode\u003e\u0026quot;default\u0026quot;\u003c/code\u003e，必须：\u003ccode\u003efalse\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e如果我们想不使用 Joy 内建的图片服务， 而想使用其它云服务商提供的图片存储和优化服务，可以配置 \u003ccode\u003eloader\u003c/code\u003e 参数来切换图片加载方式。\n一般结合 \u003ccode\u003epath\u003c/code\u003e 参数使用， \u003ccode\u003epath\u003c/code\u003e参数设置图片的 URL 地址前缀，而后在\u003ccode\u003eImage\u003c/code\u003e的 src 属性上，只需设置图片的相对路径。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-tsx\"\u003e\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = {\n  \u003cspan class=\"hljs-attr\"\u003eimages\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003eloader\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;imgix\u0026quot;\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;https://static.imgix.net\u0026quot;\u003c/span\u003e,\n  },\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eJoy 提供了以下内置加载器：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003edefault\u003c/code\u003e : 使用内置图片优化服务的加载器。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eimgix\u003c/code\u003e: 使用 \u003ca href=\"https://imgix.com/\"\u003eImgix\u003c/a\u003e 服务商提供的图片服务。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ecloudinary\u003c/code\u003e: 使用 \u003ca href=\"https://cloudinary.com/\"\u003eCloudinary\u003c/a\u003e 服务商提供的图片服务。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eakamai\u003c/code\u003e: 使用 \u003ca href=\"https://www.akamai.com/\"\u003eAkamai\u003c/a\u003e 服务商提供的图片服务。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ecustom\u003c/code\u003e: 使用自定义的云服务，设置该选项后，每个\u003ccode\u003eImage\u003c/code\u003e 组件必须设置自定义的\u003ccode\u003eloader\u003c/code\u003e属性。\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch4 id=\"path\"\u003e\n                  path\n                \u003c/h4\u003e\u003cp\u003e配置名称：\u003ccode\u003epath\u003c/code\u003e，类型： \u003ccode\u003estring\u003c/code\u003e，默认值：\u003ccode\u003e\u0026quot;/_joy/image\u0026quot;\u003c/code\u003e，必须：\u003ccode\u003efalse\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e在默认 \u003ccode\u003eloader=\u0026quot;default\u0026quot;\u003c/code\u003e 时， path 的默认值是 \u003ccode\u003e\u0026quot;/_joy/image\u0026quot;\u003c/code\u003e， 即使用 Joy 内置的图片优化服务。\u003c/p\u003e\n\u003cp\u003e如果使用其它图片服务，可以设置\u003ccode\u003epath\u003c/code\u003e配置图片的统一 URL 地址前缀，而后在\u003ccode\u003eImage\u003c/code\u003e的 src 属性上只需设置图片的相对路径，运行时将两者合并生成完整的图片地址。\u003c/p\u003e\n\n                \u003ch4 id=\"devicesizes\"\u003e\n                  deviceSizes\n                \u003c/h4\u003e\u003cp\u003e配置名称：\u003ccode\u003edeviceSizes\u003c/code\u003e，类型： \u003ccode\u003enumber[]\u003c/code\u003e，默认值：\u003ccode\u003e[640, 750, 828, 1080, 1200, 1920, 2048, 3840]\u003c/code\u003e，必须：\u003ccode\u003efalse\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e当我们明确知道用户设备的宽度有哪些时，我们可以设置一个列表将这些宽度分段，在分段区间的内，加载对应尺寸的图片，从而让用户在各种尺寸的屏幕上，都可以获得较好的体验。\n这些设备宽度仅会在\u003ccode\u003eImage\u003c/code\u003e 组件 \u003ccode\u003elayout=\u0026quot;responsive\u0026quot;\u003c/code\u003e 或 \u003ccode\u003elayout=\u0026quot;fill\u0026quot;\u003c/code\u003e 时使用得到。\u003c/p\u003e\n\n                \u003ch4 id=\"imagesizes\"\u003e\n                  imageSizes\n                \u003c/h4\u003e\u003cp\u003e配置名称：\u003ccode\u003eimageSizes\u003c/code\u003e，类型： \u003ccode\u003enumber[]\u003c/code\u003e，默认值：\u003ccode\u003e[16, 32, 48, 64, 96, 128, 256, 384]\u003c/code\u003e，必须：\u003ccode\u003efalse\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e我们可以设置图片的宽度列表，这些宽度与\u003ccode\u003edeviceSizes\u003c/code\u003e 数组连接在一起，用于生成图像 srcsets 的完整大小数组。\u003c/p\u003e\n\u003cp\u003e之所以有两个单独的宽度列表，是因为 \u003ccode\u003eimageSizes\u003c/code\u003e 只用于设置了\u003ccode\u003esizes\u003c/code\u003e属性的图片，即图片的宽度小于全尺寸的屏幕宽度。因此，\u003ccode\u003eimageSizes\u003c/code\u003e 中的大小应该都小于\u003ccode\u003edeviceSizes\u003c/code\u003e中的最小大小。\u003c/p\u003e\n\n                \u003ch4 id=\"formats\"\u003e\n                  formats\n                \u003c/h4\u003e\u003cp\u003e配置名称：\u003ccode\u003eformats\u003c/code\u003e，类型： \u003ccode\u003estring[]\u003c/code\u003e，默认值：\u003ccode\u003e[\u0026quot;image/webp\u0026quot;]\u003c/code\u003e，必须：\u003ccode\u003efalse\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e如果请求的\u003ccode\u003eAccept\u003c/code\u003e头能匹配配置列表中的多个格式，则使用数组中的第一个匹配项作为返回格式。因此，数组的顺序很重要。如果没有匹配的格式，将返回原始图像的格式。\u003c/p\u003e\n\u003cp\u003e例如我们想优先使用\u003ccode\u003eimage/avif\u003c/code\u003e，如果浏览器不支持 avif，则再检查是否支持 \u0026#39;image/webp\u0026#39; 格式，如果还不支持，则返回图片原格式，可以这样编写配置：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = {\n  \u003cspan class=\"hljs-attr\"\u003eimages\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003eformats\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e\u0026quot;image/avif\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;image/webp\u0026quot;\u003c/span\u003e],\n  },\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cblockquote\u003e\n\u003cp\u003eAVIF 编码通常要多花 20%的时间，但它比 WebP 多压缩了 20%的空间。这意味着第一次请求图片时，它通常会缓慢点，而缓存后，后续请求会变快。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n                \u003ch4 id=\"minimumcachettl\"\u003e\n                  minimumCacheTTL\n                \u003c/h4\u003e\u003cp\u003e配置名称：\u003ccode\u003eminimumCacheTTL\u003c/code\u003e，类型： \u003ccode\u003enumber\u003c/code\u003e，默认值：\u003ccode\u003e60\u003c/code\u003e，必须：\u003ccode\u003efalse\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e设置图片的在优化服务内的最小缓存时长，单位秒。\n大多数情况下，建议使用使用 \u003ca href=\"#%E9%9D%99%E6%80%81%E5%AF%BC%E5%85%A5\"\u003e静态导入\u003c/a\u003e 的方式加载图片，这将自动为图片生成一个唯一的 hash 值，并设置\u003ccode\u003eCache-Control\u003c/code\u003e为\u003ccode\u003eimmutable\u003c/code\u003e，使图片长期有效。\u003c/p\u003e\n\n                \u003ch4 id=\"disablestaticimages\"\u003e\n                  disableStaticImages\n                \u003c/h4\u003e\u003cp\u003e配置名称：\u003ccode\u003edisableStaticImages\u003c/code\u003e，类型： \u003ccode\u003ebool\u003c/code\u003e，默认值：\u003ccode\u003efalse\u003c/code\u003e，必须：\u003ccode\u003efalse\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e默认情况下，我们可以直接静态导入图片，如 \u003ccode\u003eimport logo from \u0026quot;./logo.png\u0026quot;\u003c/code\u003e，然后设置给图片组件的 \u003ccode\u003esrc\u003c/code\u003e属性。\u003c/p\u003e\n\u003cp\u003e但有时候，如果静态导入和其它插件冲突，或者想自定义 webpack 插件以实现不同的导入方式，我们可以设置为\u003ccode\u003efalse\u003c/code\u003e关闭默认的图片导入插件。\u003c/p\u003e\n\n                \u003ch4 id=\"dangerouslyallowsvg\"\u003e\n                  dangerouslyAllowSVG\n                \u003c/h4\u003e\u003cp\u003e配置名称：\u003ccode\u003edangerouslyAllowSVG\u003c/code\u003e，类型： \u003ccode\u003ebool\u003c/code\u003e，默认值：\u003ccode\u003efalse\u003c/code\u003e，必须：\u003ccode\u003efalse\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e默认 Joy 的内置图片优化服务不会对 SVG 格式的图片进行优化。\n首先，SVG 是一种矢量格式，这意味着它可以无损地调整大小。其次，SVG 有许多与 HTML/CSS 相同的特性，如果没有适当的内容安全策略(CSP)头，这些特性可能会导致漏洞。\u003c/p\u003e\n\u003cp\u003e如果想内置的图片优化服务提供 SVG 图片格式，可以启用该功能，并设置适当的内容安全策略。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = {\n  \u003cspan class=\"hljs-attr\"\u003eimages\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003edangerouslyAllowSVG\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003econtentSecurityPolicy\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;default-src \u0026#x27;self\u0026#x27;; script-src \u0026#x27;none\u0026#x27;; sandbox;\u0026quot;\u003c/span\u003e,\n  },\n};\n\u003c/code\u003e\u003c/pre\u003e\n","anchor":[{"type":"heading","raw":"## 静态导入\n\n","depth":2,"text":"静态导入","tokens":[{"type":"text","raw":"静态导入","text":"静态导入"}],"id":"#%E9%9D%99%E6%80%81%E5%AF%BC%E5%85%A5"},{"type":"heading","raw":"## CSS 中使用图片\n\n","depth":2,"text":"CSS 中使用图片","tokens":[{"type":"text","raw":"CSS 中使用图片","text":"CSS 中使用图片"}],"id":"#css-%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%9B%BE%E7%89%87"},{"type":"heading","raw":"## 引用静态文件图片\n\n","depth":2,"text":"引用静态文件图片","tokens":[{"type":"text","raw":"引用静态文件图片","text":"引用静态文件图片"}],"id":"#%E5%BC%95%E7%94%A8%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E5%9B%BE%E7%89%87"},{"type":"heading","raw":"## Image 组件和图片优化\n\n","depth":2,"text":"Image 组件和图片优化","tokens":[{"type":"text","raw":"Image 组件和图片优化","text":"Image 组件和图片优化"}],"id":"#image-%E7%BB%84%E4%BB%B6%E5%92%8C%E5%9B%BE%E7%89%87%E4%BC%98%E5%8C%96","children":[{"type":"heading","raw":"### 使用本地图片\n\n","depth":3,"text":"使用本地图片","tokens":[{"type":"text","raw":"使用本地图片","text":"使用本地图片"}],"id":"#%E4%BD%BF%E7%94%A8%E6%9C%AC%E5%9C%B0%E5%9B%BE%E7%89%87"},{"type":"heading","raw":"### 使用远程图片\n\n","depth":3,"text":"使用远程图片","tokens":[{"type":"text","raw":"使用远程图片","text":"使用远程图片"}],"id":"#%E4%BD%BF%E7%94%A8%E8%BF%9C%E7%A8%8B%E5%9B%BE%E7%89%87"},{"type":"heading","raw":"### 图片尺寸\n\n","depth":3,"text":"图片尺寸","tokens":[{"type":"text","raw":"图片尺寸","text":"图片尺寸"}],"id":"#%E5%9B%BE%E7%89%87%E5%B0%BA%E5%AF%B8"},{"type":"heading","raw":"### 加载优先级\n\n","depth":3,"text":"加载优先级","tokens":[{"type":"text","raw":"加载优先级","text":"加载优先级"}],"id":"#%E5%8A%A0%E8%BD%BD%E4%BC%98%E5%85%88%E7%BA%A7"},{"type":"heading","raw":"### 内置图片优化服务\n\n","depth":3,"text":"内置图片优化服务","tokens":[{"type":"text","raw":"内置图片优化服务","text":"内置图片优化服务"}],"id":"#%E5%86%85%E7%BD%AE%E5%9B%BE%E7%89%87%E4%BC%98%E5%8C%96%E6%9C%8D%E5%8A%A1"},{"type":"heading","raw":"### 图片加载器\n\n","depth":3,"text":"图片加载器","tokens":[{"type":"text","raw":"图片加载器","text":"图片加载器"}],"id":"#%E5%9B%BE%E7%89%87%E5%8A%A0%E8%BD%BD%E5%99%A8"},{"type":"heading","raw":"### 图片样式\n\n","depth":3,"text":"图片样式","tokens":[{"type":"text","raw":"图片样式","text":"图片样式"}],"id":"#%E5%9B%BE%E7%89%87%E6%A0%B7%E5%BC%8F"},{"type":"heading","raw":"### Image 组件属性\n\n","depth":3,"text":"Image 组件属性","tokens":[{"type":"text","raw":"Image 组件属性","text":"Image 组件属性"}],"id":"#image-%E7%BB%84%E4%BB%B6%E5%B1%9E%E6%80%A7","children":[{"type":"heading","raw":"#### src\n\n","depth":4,"text":"src","tokens":[{"type":"text","raw":"src","text":"src"}],"id":"#src"},{"type":"heading","raw":"#### width\n\n","depth":4,"text":"width","tokens":[{"type":"text","raw":"width","text":"width"}],"id":"#width"},{"type":"heading","raw":"#### height\n\n","depth":4,"text":"height","tokens":[{"type":"text","raw":"height","text":"height"}],"id":"#height"},{"type":"heading","raw":"#### loader\n\n","depth":4,"text":"loader","tokens":[{"type":"text","raw":"loader","text":"loader"}],"id":"#loader"},{"type":"heading","raw":"#### layout\n\n","depth":4,"text":"layout","tokens":[{"type":"text","raw":"layout","text":"layout"}],"id":"#layout"},{"type":"heading","raw":"#### sizes\n\n","depth":4,"text":"sizes","tokens":[{"type":"text","raw":"sizes","text":"sizes"}],"id":"#sizes"},{"type":"heading","raw":"#### objectFit\n\n","depth":4,"text":"objectFit","tokens":[{"type":"text","raw":"objectFit","text":"objectFit"}],"id":"#objectfit"},{"type":"heading","raw":"#### objectPosition\n\n","depth":4,"text":"objectPosition","tokens":[{"type":"text","raw":"objectPosition","text":"objectPosition"}],"id":"#objectposition"},{"type":"heading","raw":"#### quality\n\n","depth":4,"text":"quality","tokens":[{"type":"text","raw":"quality","text":"quality"}],"id":"#quality"},{"type":"heading","raw":"#### priority\n\n","depth":4,"text":"priority","tokens":[{"type":"text","raw":"priority","text":"priority"}],"id":"#priority"},{"type":"heading","raw":"#### loading\n\n","depth":4,"text":"loading","tokens":[{"type":"text","raw":"loading","text":"loading"}],"id":"#loading"},{"type":"heading","raw":"#### lazyBoundary\n\n","depth":4,"text":"lazyBoundary","tokens":[{"type":"text","raw":"lazyBoundary","text":"lazyBoundary"}],"id":"#lazyboundary"},{"type":"heading","raw":"#### lazyRoot\n\n","depth":4,"text":"lazyRoot","tokens":[{"type":"text","raw":"lazyRoot","text":"lazyRoot"}],"id":"#lazyroot"},{"type":"heading","raw":"#### placeholder\n\n","depth":4,"text":"placeholder","tokens":[{"type":"text","raw":"placeholder","text":"placeholder"}],"id":"#placeholder"},{"type":"heading","raw":"#### blurDataURL\n\n","depth":4,"text":"blurDataURL","tokens":[{"type":"text","raw":"blurDataURL","text":"blurDataURL"}],"id":"#blurdataurl"},{"type":"heading","raw":"#### unoptimized\n\n","depth":4,"text":"unoptimized","tokens":[{"type":"text","raw":"unoptimized","text":"unoptimized"}],"id":"#unoptimized"},{"type":"heading","raw":"#### onLoadingComplete\n\n","depth":4,"text":"onLoadingComplete","tokens":[{"type":"text","raw":"onLoadingComplete","text":"onLoadingComplete"}],"id":"#onloadingcomplete"},{"type":"heading","raw":"#### others\n\n","depth":4,"text":"others","tokens":[{"type":"text","raw":"others","text":"others"}],"id":"#others"}]},{"type":"heading","raw":"### 图片模块配置\n\n","depth":3,"text":"图片模块配置","tokens":[{"type":"text","raw":"图片模块配置","text":"图片模块配置"}],"id":"#%E5%9B%BE%E7%89%87%E6%A8%A1%E5%9D%97%E9%85%8D%E7%BD%AE","children":[{"type":"heading","raw":"#### domains\n\n","depth":4,"text":"domains","tokens":[{"type":"text","raw":"domains","text":"domains"}],"id":"#domains"},{"type":"heading","raw":"#### loader\n\n","depth":4,"text":"loader","tokens":[{"type":"text","raw":"loader","text":"loader"}],"id":"#loader"},{"type":"heading","raw":"#### path\n\n","depth":4,"text":"path","tokens":[{"type":"text","raw":"path","text":"path"}],"id":"#path"},{"type":"heading","raw":"#### deviceSizes\n\n","depth":4,"text":"deviceSizes","tokens":[{"type":"text","raw":"deviceSizes","text":"deviceSizes"}],"id":"#devicesizes"},{"type":"heading","raw":"#### imageSizes\n\n","depth":4,"text":"imageSizes","tokens":[{"type":"text","raw":"imageSizes","text":"imageSizes"}],"id":"#imagesizes"},{"type":"heading","raw":"#### formats\n\n","depth":4,"text":"formats","tokens":[{"type":"text","raw":"formats","text":"formats"}],"id":"#formats"},{"type":"heading","raw":"#### minimumCacheTTL\n\n","depth":4,"text":"minimumCacheTTL","tokens":[{"type":"text","raw":"minimumCacheTTL","text":"minimumCacheTTL"}],"id":"#minimumcachettl"},{"type":"heading","raw":"#### disableStaticImages\n\n","depth":4,"text":"disableStaticImages","tokens":[{"type":"text","raw":"disableStaticImages","text":"disableStaticImages"}],"id":"#disablestaticimages"},{"type":"heading","raw":"#### dangerouslyAllowSVG\n\n","depth":4,"text":"dangerouslyAllowSVG","tokens":[{"type":"text","raw":"dangerouslyAllowSVG","text":"dangerouslyAllowSVG"}],"id":"#dangerouslyallowsvg"}]}]}]},{"title":"Head 组件","path":"/joy/react/head","file":"docs\\joy\\02-react\\10-head.md","hasMenu":false,"mdContent":"# Head 组件\r\n\r\n内建`Head` React 组件用于向页面的 `head`标签内追加元素，当 React 渲染时遇到 `\u003cHead\u003e`组件，将内部声明的标签追加到`document.head`内。\r\n\r\n\u003e `Head`标签可以在React组件树的任何位置，也可以多次出现，后渲染的内容，将会覆盖之前渲染的相同标签。\r\n\u003e \r\n\u003e 组件卸载时，将卸载组件注册的在`head`中的内容，所以需保证每个页面组件中包含了其所需的所有`head`内容，也请不要在一个页面推测其它页面的需要，声明其它页面的`head`。\r\n\r\n下面我们在页面中定义 `tile` 和 `meta` 信息：\r\n\r\n```tsx\r\nimport React from \"react\";\r\nimport { Head } from \"@symph/joy/react\";\r\nimport { ReactController, BaseReactController } from \"@symph/react\";\r\n\r\n@ReactController()\r\nexport class Index extends BaseReactController {\r\n  renderView() {\r\n    return (\r\n      \u003cdiv\u003e\r\n        \u003cHead\u003e\r\n          \u003ctitle\u003eMy page title\u003c/title\u003e\r\n          \u003cmeta name=\"viewport\" content=\"initial-scale=1.0, width=device-width\" /\u003e\r\n        \u003c/Head\u003e\r\n        \u003cp\u003eHello world!\u003c/p\u003e\r\n      \u003c/div\u003e\r\n    );\r\n  }\r\n}\r\n```\r\n\r\n我们可以使用`key`属性来避免重复渲染标签，确保标签只被渲染一次，例如：\r\n\r\n```tsx\r\nimport React from \"react\";\r\nimport { Head } from \"@symph/joy/react\";\r\nimport { ReactController, BaseReactController } from \"@symph/react\";\r\n\r\n@ReactController()\r\nexport class Index extends BaseReactController {\r\n  renderView() {\r\n    return (\r\n      \u003cdiv\u003e\r\n        \u003cHead\u003e\r\n          \u003ctitle\u003eMy page title\u003c/title\u003e\r\n          \u003cmeta property=\"og:title\" content=\"My page title\" key=\"title\" /\u003e\r\n        \u003c/Head\u003e\r\n        \u003cHead\u003e\r\n          \u003cmeta property=\"og:title\" content=\"My new title\" key=\"title\" /\u003e\r\n        \u003c/Head\u003e\r\n        \u003cp\u003eHello world!\u003c/p\u003e\r\n      \u003c/div\u003e\r\n    );\r\n  }\r\n}\r\n```\r\n\r\n在上例中，只有第二个 `\u003cmeta property=\"og:title\" /\u003e` 会被渲染。 带有不同 `key` 属性的 `meta` 标签将会被分别分开处理。\r\n\r\n`title`、`meta`或者其它类型的标签（如： `script`）需作为`Head`组件的直接子元素，或者被最多一级的`\u003cReact.Fragment\u003e`所包围，否则将无法正常收集其中定义的标签。\r\n\r\n\r\n\r\n\r\n","htmlContent":"\n                \u003ch1 id=\"head-%E7%BB%84%E4%BB%B6\"\u003e\n                  Head 组件\n                \u003c/h1\u003e\u003cp\u003e内建\u003ccode\u003eHead\u003c/code\u003e React 组件用于向页面的 \u003ccode\u003ehead\u003c/code\u003e标签内追加元素，当 React 渲染时遇到 \u003ccode\u003e\u0026lt;Head\u0026gt;\u003c/code\u003e组件，将内部声明的标签追加到\u003ccode\u003edocument.head\u003c/code\u003e内。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ccode\u003eHead\u003c/code\u003e标签可以在React组件树的任何位置，也可以多次出现，后渲染的内容，将会覆盖之前渲染的相同标签。\u003c/p\u003e\n\u003cp\u003e组件卸载时，将卸载组件注册的在\u003ccode\u003ehead\u003c/code\u003e中的内容，所以需保证每个页面组件中包含了其所需的所有\u003ccode\u003ehead\u003c/code\u003e内容，也请不要在一个页面推测其它页面的需要，声明其它页面的\u003ccode\u003ehead\u003c/code\u003e。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e下面我们在页面中定义 \u003ccode\u003etile\u003c/code\u003e 和 \u003ccode\u003emeta\u003c/code\u003e 信息：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-tsx\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eReact\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eHead\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eReactController\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eBaseReactController\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/react\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-meta\"\u003e@ReactController\u003c/span\u003e()\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eIndex\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title class_ inherited__\"\u003eBaseReactController\u003c/span\u003e {\n  \u003cspan class=\"hljs-title function_\"\u003erenderView\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n      \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eHead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u0026gt;\u003c/span\u003eMy page title\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003emeta\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;viewport\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003econtent\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;initial-scale=1.0, width=device-width\u0026quot;\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eHead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003eHello world!\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n    );\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e我们可以使用\u003ccode\u003ekey\u003c/code\u003e属性来避免重复渲染标签，确保标签只被渲染一次，例如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-tsx\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eReact\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eHead\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eReactController\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eBaseReactController\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/react\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-meta\"\u003e@ReactController\u003c/span\u003e()\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eIndex\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title class_ inherited__\"\u003eBaseReactController\u003c/span\u003e {\n  \u003cspan class=\"hljs-title function_\"\u003erenderView\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n      \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eHead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u0026gt;\u003c/span\u003eMy page title\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003emeta\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eproperty\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;og:title\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003econtent\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;My page title\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ekey\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;title\u0026quot;\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eHead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eHead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003emeta\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eproperty\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;og:title\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003econtent\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;My new title\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ekey\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;title\u0026quot;\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eHead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003eHello world!\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n    );\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e在上例中，只有第二个 \u003ccode\u003e\u0026lt;meta property=\u0026quot;og:title\u0026quot; /\u0026gt;\u003c/code\u003e 会被渲染。 带有不同 \u003ccode\u003ekey\u003c/code\u003e 属性的 \u003ccode\u003emeta\u003c/code\u003e 标签将会被分别分开处理。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003etitle\u003c/code\u003e、\u003ccode\u003emeta\u003c/code\u003e或者其它类型的标签（如： \u003ccode\u003escript\u003c/code\u003e）需作为\u003ccode\u003eHead\u003c/code\u003e组件的直接子元素，或者被最多一级的\u003ccode\u003e\u0026lt;React.Fragment\u0026gt;\u003c/code\u003e所包围，否则将无法正常收集其中定义的标签。\u003c/p\u003e\n","anchor":[]},{"title":"自定义 App","path":"/joy/react/custom-app","file":"docs\\joy\\02-react\\20-custom-app.md","hasMenu":false,"mdContent":"# 自定义 App\r\n\r\nJoy 使用`App`来包装和初始化整个界面，我们可以自定它来控制页面的初始化，例如：\r\n\r\n- 添加所有页面共有的布局。\r\n- 捕获渲染错误，使用`componentDidCatch`。\r\n- 修改路由或者路由的渲染方式。\r\n- 添加全局样式。\r\n\r\n## _app.tsx 文件\r\n\r\n下面我们开始覆盖默认的`App`， 首选创建文件`./src/pages/_app.tsx`，修改其内容：\r\n\r\n```tsx\r\nimport React from \"react\";\r\nimport { IReactApplication, ReactRouterService, RouteSwitch } from \"@symph/react\";\r\nimport { ReactAppProps } from \"@symph/joy\";\r\n\r\nexport default class App extends React.Component\u003cReactAppProps, any\u003e {\r\n  protected reactRouterService: ReactRouterService;\r\n  constructor(props: ReactAppProps, context?: any) {\r\n    super(props, context);\r\n    const appContext = props.appContext;\r\n    this.reactRouterService = appContext.getSync\u003cReactRouterService\u003e(\"reactRouterService\");\r\n  }\r\n  render() {\r\n    const routes = this.reactRouterService.getRoutes() || [];\r\n    return \u003cRouteSwitch routes={routes} extraProps={{}} /\u003e;\r\n  }\r\n}\r\n```\r\n\r\n`App` 的`props`中包含了`IReactApplication`实例，我们可以通过它获取到整个 React 应用的业务组件，例如上面例子中的`reactRouterService`路由组件。\r\n`render()`中使用的`RouteSwitch`组件来渲染应用中注册的路由，包括文件约定路由。\r\n\r\n## 注意事项：\r\n\r\n- 如果你的应用正在开发模式下运行中，首次添加`./src/pages/_app.js`文件，需要重新启动开发服务器。\r\n- `App`在服务端和浏览器上都会被渲染，所以需要注意渲染环境差异，例如在服务端渲染时，不能使用浏览器特有的API。\r\n","htmlContent":"\n                \u003ch1 id=\"%E8%87%AA%E5%AE%9A%E4%B9%89-app\"\u003e\n                  自定义 App\n                \u003c/h1\u003e\u003cp\u003eJoy 使用\u003ccode\u003eApp\u003c/code\u003e来包装和初始化整个界面，我们可以自定它来控制页面的初始化，例如：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e添加所有页面共有的布局。\u003c/li\u003e\n\u003cli\u003e捕获渲染错误，使用\u003ccode\u003ecomponentDidCatch\u003c/code\u003e。\u003c/li\u003e\n\u003cli\u003e修改路由或者路由的渲染方式。\u003c/li\u003e\n\u003cli\u003e添加全局样式。\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch2 id=\"_apptsx-%E6%96%87%E4%BB%B6\"\u003e\n                  _app.tsx 文件\n                \u003c/h2\u003e\u003cp\u003e下面我们开始覆盖默认的\u003ccode\u003eApp\u003c/code\u003e， 首选创建文件\u003ccode\u003e./src/pages/_app.tsx\u003c/code\u003e，修改其内容：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-tsx\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eReact\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eIReactApplication\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eReactRouterService\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eRouteSwitch\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eReactAppProps\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eApp\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title class_ inherited__\"\u003eReact.Component\u003c/span\u003e\u0026lt;\u003cspan class=\"hljs-title class_\"\u003eReactAppProps\u003c/span\u003e, \u003cspan class=\"hljs-built_in\"\u003eany\u003c/span\u003e\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eprotected\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ereactRouterService\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eReactRouterService\u003c/span\u003e;\n  \u003cspan class=\"hljs-title function_\"\u003econstructor\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eprops: ReactAppProps, context?: \u003cspan class=\"hljs-built_in\"\u003eany\u003c/span\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-variable language_\"\u003esuper\u003c/span\u003e(props, context);\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e appContext = props.\u003cspan class=\"hljs-property\"\u003eappContext\u003c/span\u003e;\n    \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ereactRouterService\u003c/span\u003e = appContext.\u003cspan class=\"hljs-property\"\u003egetSync\u003c/span\u003e\u0026lt;\u003cspan class=\"hljs-title class_\"\u003eReactRouterService\u003c/span\u003e\u0026gt;(\u003cspan class=\"hljs-string\"\u003e\u0026quot;reactRouterService\u0026quot;\u003c/span\u003e);\n  }\n  \u003cspan class=\"hljs-title function_\"\u003erender\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e routes = \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ereactRouterService\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003egetRoutes\u003c/span\u003e() || [];\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eRouteSwitch\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eroutes\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{routes}\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eextraProps\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{{}}\u003c/span\u003e /\u0026gt;\u003c/span\u003e\u003c/span\u003e;\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eApp\u003c/code\u003e 的\u003ccode\u003eprops\u003c/code\u003e中包含了\u003ccode\u003eIReactApplication\u003c/code\u003e实例，我们可以通过它获取到整个 React 应用的业务组件，例如上面例子中的\u003ccode\u003ereactRouterService\u003c/code\u003e路由组件。\n\u003ccode\u003erender()\u003c/code\u003e中使用的\u003ccode\u003eRouteSwitch\u003c/code\u003e组件来渲染应用中注册的路由，包括文件约定路由。\u003c/p\u003e\n\n                \u003ch2 id=\"%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%EF%BC%9A\"\u003e\n                  注意事项：\n                \u003c/h2\u003e\u003cul\u003e\n\u003cli\u003e如果你的应用正在开发模式下运行中，首次添加\u003ccode\u003e./src/pages/_app.js\u003c/code\u003e文件，需要重新启动开发服务器。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eApp\u003c/code\u003e在服务端和浏览器上都会被渲染，所以需要注意渲染环境差异，例如在服务端渲染时，不能使用浏览器特有的API。\u003c/li\u003e\n\u003c/ul\u003e\n","anchor":[{"type":"heading","raw":"## _app.tsx 文件\n\n","depth":2,"text":"_app.tsx 文件","tokens":[{"type":"text","raw":"_app.tsx 文件","text":"_app.tsx 文件"}],"id":"#_apptsx-%E6%96%87%E4%BB%B6"},{"type":"heading","raw":"## 注意事项：\n\n","depth":2,"text":"注意事项：","tokens":[{"type":"text","raw":"注意事项：","text":"注意事项："}],"id":"#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%EF%BC%9A"}]},{"title":"自定义 Document","path":"/joy/react/custom-document","file":"docs\\joy\\02-react\\21-custom-document.md","hasMenu":false,"mdContent":"# 自定义 Document\r\n\r\n`Document` React 组件用于生成页面的`\u003chtml\u003e`和`\u003cbody\u003e`标签， Joy 会根据应用内的组件和样式，自动生成必须的 js 和 css 标签，保证页面 html 能够正常被加载。\r\n我们可以通过自定义`Document`在`\u003chtml\u003e`加入自定义的扩展`\u003chead\u003e`、`\u003clink\u003e`或者`\u003csciprt\u003e`。\r\n\r\n## _document.tsx\r\n\r\n覆盖默认的`Document`，创建文件`./src/pages/_document.tsx`并修改`Document`如下：\r\n\r\n```tsx\r\nimport React from \"react\";\r\nimport Document, { Html, Head, Main, JoyScript, DocumentContext } from \"@symph/joy/document\";\r\n\r\nexport default class MyDocument extends Document\u003cany\u003e {\r\n  static async getInitialProps(ctx: DocumentContext) {\r\n    const initialProps = await Document.getInitialProps(ctx);\r\n    return { ...initialProps };\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      \u003cHtml\u003e\r\n        \u003cHead\u003e\u003c/Head\u003e\r\n        \u003cbody\u003e\r\n          \u003cMain /\u003e\r\n          \u003cJoyScript /\u003e\r\n        \u003c/body\u003e\r\n      \u003c/Html\u003e\r\n    );\r\n  }\r\n}\r\n```\r\n\r\n\u003e 上面示例中的`MyDocument`，等效于 Joy 默认的`Document`，未加入自定义的内容，如果不需要`getInitialProps`或者`render`方法，可以删除掉。\r\n\r\n`Html`、`Head`、`Main`和`JoyScript`是页面必须的，在自定义的`Document`类中，不要删除它们和更改顺序。\r\n但它们支持一些自定义的属性，例如：\r\n\r\n```tsx\r\n\u003cHtml lang=\"en\"\u003e\r\n```\r\n\r\n这里的`\u003cHead /\u003e`不同于`@symph/joy/react`中的`Head`组件，这里的`\u003cHead /\u003e`用于定义在所有页面中共有的`\u003chead\u003e`元素，而其它的，例如`\u003ctitle\u003e`标签，建议在页面组件中使用`@symph/joy/react`中的`Head`组件来定义。\r\n\r\n`getInitialProps`方法返回`Document`组件的初始 props，参数`ctx: DocumentContext`具有以下属性：\r\n\r\n- `pathname`：`string`，当前渲染的页面路径。\r\n- `query`： `object`， url 中的请求参数被解析后的对象。\r\n- `req`：[`IncomingMessage`](https://nodejs.org/api/http.html#http_class_http_incomingmessage), 触发当前渲染的请求对象。\r\n- `res`：[`ServerResponse`](https://nodejs.org/api/http.html#http_class_http_serverresponse), 触发当前渲染的请求的响应对象。\r\n- `err` ：Error, 在渲染阶段出现的异常。\r\n- `renderPage`: `functin` 将`App`渲染为 html 字符串，返回值`{html, head}`在服务端渲染时。\r\n\r\n## 注意事项\r\n\r\n- `Document`只在服务端被渲染，事件处理并不会触发执行，例如`onClick`事件。同理 React 的部分生命周期也不会执行，例如`onComponentDidMount`。\r\n- 在`\u003cMain/\u003e`之外的 React 组件并不会被浏览器初始化，所以不要在这里添加任何业务逻辑。如果需要给整个应用添加统一的组件，可以在根布局组件中添加，或者`App`中添加。\r\n","htmlContent":"\n                \u003ch1 id=\"%E8%87%AA%E5%AE%9A%E4%B9%89-document\"\u003e\n                  自定义 Document\n                \u003c/h1\u003e\u003cp\u003e\u003ccode\u003eDocument\u003c/code\u003e React 组件用于生成页面的\u003ccode\u003e\u0026lt;html\u0026gt;\u003c/code\u003e和\u003ccode\u003e\u0026lt;body\u0026gt;\u003c/code\u003e标签， Joy 会根据应用内的组件和样式，自动生成必须的 js 和 css 标签，保证页面 html 能够正常被加载。\n我们可以通过自定义\u003ccode\u003eDocument\u003c/code\u003e在\u003ccode\u003e\u0026lt;html\u0026gt;\u003c/code\u003e加入自定义的扩展\u003ccode\u003e\u0026lt;head\u0026gt;\u003c/code\u003e、\u003ccode\u003e\u0026lt;link\u0026gt;\u003c/code\u003e或者\u003ccode\u003e\u0026lt;sciprt\u0026gt;\u003c/code\u003e。\u003c/p\u003e\n\n                \u003ch2 id=\"_documenttsx\"\u003e\n                  _document.tsx\n                \u003c/h2\u003e\u003cp\u003e覆盖默认的\u003ccode\u003eDocument\u003c/code\u003e，创建文件\u003ccode\u003e./src/pages/_document.tsx\u003c/code\u003e并修改\u003ccode\u003eDocument\u003c/code\u003e如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-tsx\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eReact\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDocument\u003c/span\u003e, { \u003cspan class=\"hljs-title class_\"\u003eHtml\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eHead\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eMain\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eJoyScript\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eDocumentContext\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/document\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eMyDocument\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title class_ inherited__\"\u003eDocument\u003c/span\u003e\u0026lt;\u003cspan class=\"hljs-built_in\"\u003eany\u003c/span\u003e\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003egetInitialProps\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ectx: DocumentContext\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e initialProps = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDocument\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003egetInitialProps\u003c/span\u003e(ctx);\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e { ...initialProps };\n  }\n\n  \u003cspan class=\"hljs-title function_\"\u003erender\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n      \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eHtml\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eHead\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eHead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eMain\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eJoyScript\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eHtml\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n    );\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cblockquote\u003e\n\u003cp\u003e上面示例中的\u003ccode\u003eMyDocument\u003c/code\u003e，等效于 Joy 默认的\u003ccode\u003eDocument\u003c/code\u003e，未加入自定义的内容，如果不需要\u003ccode\u003egetInitialProps\u003c/code\u003e或者\u003ccode\u003erender\u003c/code\u003e方法，可以删除掉。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003ccode\u003eHtml\u003c/code\u003e、\u003ccode\u003eHead\u003c/code\u003e、\u003ccode\u003eMain\u003c/code\u003e和\u003ccode\u003eJoyScript\u003c/code\u003e是页面必须的，在自定义的\u003ccode\u003eDocument\u003c/code\u003e类中，不要删除它们和更改顺序。\n但它们支持一些自定义的属性，例如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-tsx\"\u003e\u0026lt;\u003cspan class=\"hljs-title class_\"\u003eHtml\u003c/span\u003e lang=\u003cspan class=\"hljs-string\"\u003e\u0026quot;en\u0026quot;\u003c/span\u003e\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e这里的\u003ccode\u003e\u0026lt;Head /\u0026gt;\u003c/code\u003e不同于\u003ccode\u003e@symph/joy/react\u003c/code\u003e中的\u003ccode\u003eHead\u003c/code\u003e组件，这里的\u003ccode\u003e\u0026lt;Head /\u0026gt;\u003c/code\u003e用于定义在所有页面中共有的\u003ccode\u003e\u0026lt;head\u0026gt;\u003c/code\u003e元素，而其它的，例如\u003ccode\u003e\u0026lt;title\u0026gt;\u003c/code\u003e标签，建议在页面组件中使用\u003ccode\u003e@symph/joy/react\u003c/code\u003e中的\u003ccode\u003eHead\u003c/code\u003e组件来定义。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003egetInitialProps\u003c/code\u003e方法返回\u003ccode\u003eDocument\u003c/code\u003e组件的初始 props，参数\u003ccode\u003ectx: DocumentContext\u003c/code\u003e具有以下属性：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003epathname\u003c/code\u003e：\u003ccode\u003estring\u003c/code\u003e，当前渲染的页面路径。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003equery\u003c/code\u003e： \u003ccode\u003eobject\u003c/code\u003e， url 中的请求参数被解析后的对象。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ereq\u003c/code\u003e：\u003ca href=\"https://nodejs.org/api/http.html#http_class_http_incomingmessage\"\u003e\u003ccode\u003eIncomingMessage\u003c/code\u003e\u003c/a\u003e, 触发当前渲染的请求对象。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eres\u003c/code\u003e：\u003ca href=\"https://nodejs.org/api/http.html#http_class_http_serverresponse\"\u003e\u003ccode\u003eServerResponse\u003c/code\u003e\u003c/a\u003e, 触发当前渲染的请求的响应对象。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eerr\u003c/code\u003e ：Error, 在渲染阶段出现的异常。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003erenderPage\u003c/code\u003e: \u003ccode\u003efunctin\u003c/code\u003e 将\u003ccode\u003eApp\u003c/code\u003e渲染为 html 字符串，返回值\u003ccode\u003e{html, head}\u003c/code\u003e在服务端渲染时。\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch2 id=\"%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9\"\u003e\n                  注意事项\n                \u003c/h2\u003e\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eDocument\u003c/code\u003e只在服务端被渲染，事件处理并不会触发执行，例如\u003ccode\u003eonClick\u003c/code\u003e事件。同理 React 的部分生命周期也不会执行，例如\u003ccode\u003eonComponentDidMount\u003c/code\u003e。\u003c/li\u003e\n\u003cli\u003e在\u003ccode\u003e\u0026lt;Main/\u0026gt;\u003c/code\u003e之外的 React 组件并不会被浏览器初始化，所以不要在这里添加任何业务逻辑。如果需要给整个应用添加统一的组件，可以在根布局组件中添加，或者\u003ccode\u003eApp\u003c/code\u003e中添加。\u003c/li\u003e\n\u003c/ul\u003e\n","anchor":[{"type":"heading","raw":"## _document.tsx\n\n","depth":2,"text":"_document.tsx","tokens":[{"type":"text","raw":"_document.tsx","text":"_document.tsx"}],"id":"#_documenttsx"},{"type":"heading","raw":"## 注意事项\n\n","depth":2,"text":"注意事项","tokens":[{"type":"text","raw":"注意事项","text":"注意事项"}],"id":"#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"}]},{"title":"导出 React","path":"/joy/react/export","file":"docs\\joy\\02-react\\22-export.md","hasMenu":false,"mdContent":"# 导出 React\r\n\r\n运行命令：\r\n```shell\r\n$ joy build \u0026\u0026 joy export \r\n```\r\n\r\n构建产物默认生成到 ./out 下，目录结构类似于：\r\n\r\n```shell\r\n./out\r\n  index.html\r\n  404.html\r\n  _joy/ # 包含js、css、json等\r\n```\r\n\r\n## 本地验证\r\n\r\n使用`http-server`启动本地静态文件服务器\r\n\r\n```shell\r\n# 安装 http-server\r\n$ npm i -g http-server\r\n\r\n# 启动服务器\r\n$ http-server ./out\r\n```\r\n\r\n在浏览器上打开地址：[http://127.0.0.1:8080](http://127.0.0.1:8080), 正常情况下应该是和`yarn dev`开发运行时是一致的。\r\n\r\n## 部署\r\n\r\n本地验证完成后，将`out`目录部署到服务器上即可。\r\n\r\n","htmlContent":"\n                \u003ch1 id=\"%E5%AF%BC%E5%87%BA-react\"\u003e\n                  导出 React\n                \u003c/h1\u003e\u003cp\u003e运行命令：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-shell\"\u003e\u003cspan class=\"hljs-meta prompt_\"\u003e$ \u003c/span\u003e\u003cspan class=\"language-bash\"\u003ejoy build \u0026amp;\u0026amp; joy \u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e\u003c/span\u003e \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e构建产物默认生成到 ./out 下，目录结构类似于：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-shell\"\u003e./out\n  index.html\n  404.html\n  _joy/ # 包含js、css、json等\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch2 id=\"%E6%9C%AC%E5%9C%B0%E9%AA%8C%E8%AF%81\"\u003e\n                  本地验证\n                \u003c/h2\u003e\u003cp\u003e使用\u003ccode\u003ehttp-server\u003c/code\u003e启动本地静态文件服务器\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-shell\"\u003e\u003cspan class=\"hljs-meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e安装 http-server\u003c/span\u003e\n\u003cspan class=\"hljs-meta prompt_\"\u003e$ \u003c/span\u003e\u003cspan class=\"language-bash\"\u003enpm i -g http-server\u003c/span\u003e\n\u003cspan class=\"hljs-meta prompt_\"\u003e\n# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e启动服务器\u003c/span\u003e\n\u003cspan class=\"hljs-meta prompt_\"\u003e$ \u003c/span\u003e\u003cspan class=\"language-bash\"\u003ehttp-server ./out\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e在浏览器上打开地址：\u003ca href=\"http://127.0.0.1:8080\"\u003ehttp://127.0.0.1:8080\u003c/a\u003e, 正常情况下应该是和\u003ccode\u003eyarn dev\u003c/code\u003e开发运行时是一致的。\u003c/p\u003e\n\n                \u003ch2 id=\"%E9%83%A8%E7%BD%B2\"\u003e\n                  部署\n                \u003c/h2\u003e\u003cp\u003e本地验证完成后，将\u003ccode\u003eout\u003c/code\u003e目录部署到服务器上即可。\u003c/p\u003e\n","anchor":[{"type":"heading","raw":"## 本地验证\n\n","depth":2,"text":"本地验证","tokens":[{"type":"text","raw":"本地验证","text":"本地验证"}],"id":"#%E6%9C%AC%E5%9C%B0%E9%AA%8C%E8%AF%81"},{"type":"heading","raw":"## 部署\n\n","depth":2,"text":"部署","tokens":[{"type":"text","raw":"部署","text":"部署"}],"id":"#%E9%83%A8%E7%BD%B2"}]},{"title":"动态按需加载","path":"/joy/react/dynamic-load","file":"docs\\joy\\02-react\\30-dynamic-load.md","hasMenu":false,"mdContent":"# 动态按需加载\r\n\r\n## 动态加载模块 import()\r\n\r\nJoy 支持 ES2020 `import()` 语法，使用它在运行时动态的加载 JavaScript 模块。\r\n\r\n我们可以使用动态加载，将我们的应用代码分割为多个代码段，在应用运行时再逐步加载需要的代码段，这可以让浏览器加快应用的启动。\r\n\r\n下面例子中，我们使用`fuse.js`来模糊搜索，只在用户输入搜索关键字后，才动态加载`fuse.js`库，然后使用它来搜索。\r\n\r\n```tsx\r\nimport { useState } from \"react\";\r\n\r\nconst names = [\"Tim\", \"Joe\", \"Bel\", \"Max\", \"Lee\"];\r\n\r\nexport default function Page() {\r\n  const [results, setResults] = useState();\r\n\r\n  return (\r\n    \u003cdiv\u003e\r\n      \u003cinput\r\n        type=\"text\"\r\n        placeholder=\"Search\"\r\n        onChange={async (e) =\u003e {\r\n          const { value } = e.currentTarget;\r\n          // Dynamically load fuse.js\r\n          const Fuse = (await import(\"fuse.js\")).default;\r\n          const fuse = new Fuse(names);\r\n\r\n          setResults(fuse.search(value));\r\n        }}\r\n      /\u003e\r\n      \u003cpre\u003eResults: {JSON.stringify(results, null, 2)}\u003c/pre\u003e\r\n    \u003c/div\u003e\r\n  );\r\n}\r\n```\r\n\r\n## 动态加载 React 组件\r\n\r\n使用 `@symph/joy/dynamic` 来动态加载 React 组件，它首先创建一个容器组件，在 React 组件树中使用容器组件替代目标，只当容器组件被渲染时，容器组件才会动态加载目标组件，加载完成后展示目标组件。\r\n\r\n容器组件提供加载动画、加载失败重试和错误展示的能力，它也支持服务端渲染，即服务端渲染时，动态加载的组件也能想其它组件一样同步渲染。\r\n\r\n下面的例子中展示了如何动态加载和使用 `../components/hello` 组件。\r\n\r\n```tsx\r\nimport dynamic from \"@symph/joy/dynamic\";\r\n\r\nconst DynamicComponent = dynamic(() =\u003e import(\"../components/hello\"));\r\n\r\nfunction Home() {\r\n  return (\r\n    \u003cdiv\u003e\r\n      \u003cp\u003eHOME PAGE\u003c/p\u003e\r\n      \u003cDynamicComponent /\u003e\r\n    \u003c/div\u003e\r\n  );\r\n}\r\n\r\nexport default Home;\r\n```\r\n\r\n\u003e 在 `import('path/to/component')` 中， `path/to/component` 指定需动态加载组件的代码路径，该路径只能是明确的路径字符串，不能是变量或者字符串模板。\r\n\u003e 此外，`import()`必须在`dynamic()`中调用，以便在服务端渲染时，能够在 Webpack 的输出 bundles 中查找包含该动态加载模块的 bundle，并在浏览器渲染之前预加载它们。\r\n\u003e `dynamic()` 不能在 React 渲染中使用，因为它需要在模块的顶层进行标记，才能进行预加载，类似于`React.lazy`。\r\n\r\n如果按需动态加载的 React 组件在 JS 文件中不是 default 方式导出，而是命名的导出，我们可以在 `import()` 的结果`Promise`中取导出的命名值。\r\n例如动态加载的组件导出名称为`Hello` 时:\r\n\r\n```ts\r\nexport function Hello() {\r\n  return \u003cp\u003eHello!\u003c/p\u003e;\r\n}\r\n```\r\n\r\n引用模块和使用导出的组件：\r\n\r\n```ts\r\nconst DynamicComponent = dynamic(() =\u003e import(\"../components/hello\").then((md) =\u003e md.Hello));\r\n```\r\n\r\n### 加载动画和状态\r\n\r\n`dynamic()` 方法支持 `loading` 可选选项，用于渲染加载中的动画，或者加载失败的状态。\r\n例如：\r\n\r\n```tsx\r\nimport dynamic from \"@symph/joy/dynamic\";\r\nimport { DynamicLoadingComponentProps } from \"@symph/joy/react\";\r\n\r\nfunction LoadingComp({ error, isLoading, pastDelay }: DynamicLoadingComponentProps) {\r\n  if (error) return `error`;\r\n  if (pastDelay \u0026\u0026 isLoading) return \"...\";\r\n}\r\n\r\nconst DynamicComponentWithCustomLoading = dynamic(() =\u003e import(\"../components/hello\"), { loading: LoadingComp });\r\n\r\nfunction Home() {\r\n  return (\r\n    \u003cdiv\u003e\r\n      \u003cp\u003eHOME PAGE\u003c/p\u003e\r\n      \u003cDynamicComponentWithCustomLoading /\u003e\r\n    \u003c/div\u003e\r\n  );\r\n}\r\n\r\nexport default Home;\r\n```\r\n\r\n### 动态加载关闭 SSR\r\n\r\n有时候我们想为动态加载的组件关闭服务端渲染，只在浏览器上运行该组件。 我们可以设置 `ssr` 属性为 false：\r\n\r\n```tsx\r\nimport dynamic from \"@symph/joy/dynamic\";\r\n\r\nconst DynamicComponentWithNoSSR = dynamic(() =\u003e import(\"../components/hello\"), { ssr: false });\r\n\r\nfunction Home() {\r\n  return (\r\n    \u003cdiv\u003e\r\n      \u003cp\u003eHOME PAGE\u003c/p\u003e\r\n      \u003cDynamicComponentWithNoSSR /\u003e\r\n    \u003c/div\u003e\r\n  );\r\n}\r\n\r\nexport default Home;\r\n```\r\n\r\n### 动态加载使用 suspense\r\n\r\n类似 React 18 的 `React.lazy` 和 `\u003cSuspense\u003e`, 使用 `suspense` 参数来延迟懒加载组件。注意这暂时只能在服务端或者客户端的 `fallback`模式下有效。\r\n\r\n```tsx\r\nimport dynamic from \"@symph/joy/dynamic\";\r\n\r\nconst DynamicLazyComponent = dynamic(() =\u003e import(\"../components/hello\"), { suspense: true });\r\n\r\nfunction Home() {\r\n  return (\r\n    \u003cdiv\u003e\r\n      \u003cp\u003eHOME PAGE\u003c/p\u003e\r\n      \u003cSuspense fallback={`loading`}\u003e\r\n        \u003cDynamicLazyComponent /\u003e\r\n      \u003c/Suspense\u003e\r\n    \u003c/div\u003e\r\n  );\r\n}\r\n\r\nexport default Home;\r\n```\r\n\r\n## 动态加载 Joy 路由组件\r\n\r\n动态加载路由组件，指只有渲染该路由页面时，才会加载该路由组件相关联的代码模块。\r\n我们可以直接使用 `@ReactDynamicLoad(options )` 装饰器将 `@ReactRoute` 路由组件模块声明为动态加载模块。\r\n动态加载的路由组件也支持服务端渲染，和 `@symph/joy/dynamic` 的参数列表类似，我们也可以为动态路由组件设置加载参数，例如：\r\n\r\n```tsx\r\nimport React, { ReactNode } from \"react\";\r\nimport { BaseReactController, ReactController, ReactRoute } from \"@symph/react\";\r\nimport { ReactDynamicLoad } from \"@symph/joy/react\";\r\n\r\n@ReactDynamicLoad({ delay: 200, timeout: 1000 })\r\n@ReactRoute({ path: \"/about\" })\r\n@ReactController()\r\nexport class AboutPage extends BaseReactController {\r\n  renderView(): ReactNode {\r\n    return \u003cdiv\u003eAboutPage\u003c/div\u003e;\r\n  }\r\n}\r\n```\r\n\r\n`@ReactDynamicLoad` 支持可选的参数有：\r\n\r\n- loading: `string` 加载动画组件的组件名称。\r\n- delay: `number`, 默认值 `200`，表示如果在 200 毫秒内加载完成，就不用展示加载动画。这可以减少短时间内的界面切换给用户带来的困扰，让页面看起来加载的更快。\r\n- timeout: `number` 设置加载的超时时间。\r\n\r\n### 路由加载动画\r\n\r\n和`@symph/joy/dynamic`不一样的是，`loading` 参数只能设置加载动画组件的组件字符串名称，而不是具体的加载组件。\r\n因为要保证加载路由组件之前 Loading 组件已经存在，才能在加载时展现加载动画，同时还得要确保 Loading 模块和路由模块之间没有静态的依赖关系，webpack 才不会将两者打包到一起。\r\n所以需使用字符串的组件名来指向当前运行时已经存在的组件名称。\r\n\r\n我们可以在上层路由或者根路由文件模块导出 Loading 组件，来确保在动态路由模块加载之前，应用上下文中已经注册了 Loading 组件。\r\n例如在根布局路由中：\r\n\r\n```tsx\r\n// src/client/pages/_layout.tsx\r\n\r\n/**\r\n * 根路由组件\r\n */\r\nimport React, { ReactNode } from \"react\";\r\nimport { BaseReactController, ReactController, ReactRouteContainer } from \"@symph/react\";\r\nimport { Outlet } from \"react-router-dom\";\r\nimport { LoadableLoadingComponentProps } from \"@symph/joy/react\";\r\n\r\n@ReactRouteContainer({ path: \"/\" })\r\n@ReactController()\r\nexport class Rootlayout extends BaseReactController {\r\n  renderView(): ReactNode {\r\n    return (\r\n      \u003c\u003e\r\n        \u003cHead\u003eHello\u003c/Head\u003e\r\n        \u003cOutlet /\u003e\r\n      \u003c/\u003e\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * 自定义的加载动画组件\r\n */\r\n@ReactController()\r\nexport class DynamicLoading extends BaseReactController\u003cLoadableLoadingComponentProps\u003e {\r\n  renderView(): ReactNode {\r\n    return (\r\n      \u003c\u003e\r\n        \u003cdiv id=\"loadingMsg\"\u003eCustom loading...\u003c/div\u003e\r\n      \u003c/\u003e\r\n    );\r\n  }\r\n}\r\n```\r\n\r\n然后在申明动态加载路由组件时，设置加载中动画组件。\r\n\r\n```tsx\r\nimport React, { ReactNode } from \"react\";\r\nimport { BaseReactController, ReactController, ReactRoute } from \"@symph/react\";\r\nimport { ReactDynamicLoad } from \"@symph/joy/react\";\r\n\r\n@ReactDynamicLoad({ loading: \"dynamicLoading\" }) \r\n@ReactRoute({ path: \"/about\" })\r\n@ReactController()\r\nexport class DynamicAboutPage extends BaseReactController {\r\n  renderView(): ReactNode {\r\n    return \u003cdiv\u003eThis is dynamic load about page.\u003c/div\u003e;\r\n  }\r\n}\r\n```\r\n","htmlContent":"\n                \u003ch1 id=\"%E5%8A%A8%E6%80%81%E6%8C%89%E9%9C%80%E5%8A%A0%E8%BD%BD\"\u003e\n                  动态按需加载\n                \u003c/h1\u003e\n                \u003ch2 id=\"%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD%E6%A8%A1%E5%9D%97-import()\"\u003e\n                  动态加载模块 import()\n                \u003c/h2\u003e\u003cp\u003eJoy 支持 ES2020 \u003ccode\u003eimport()\u003c/code\u003e 语法，使用它在运行时动态的加载 JavaScript 模块。\u003c/p\u003e\n\u003cp\u003e我们可以使用动态加载，将我们的应用代码分割为多个代码段，在应用运行时再逐步加载需要的代码段，这可以让浏览器加快应用的启动。\u003c/p\u003e\n\u003cp\u003e下面例子中，我们使用\u003ccode\u003efuse.js\u003c/code\u003e来模糊搜索，只在用户输入搜索关键字后，才动态加载\u003ccode\u003efuse.js\u003c/code\u003e库，然后使用它来搜索。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-tsx\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { useState } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e names = [\u003cspan class=\"hljs-string\"\u003e\u0026quot;Tim\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;Joe\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;Bel\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;Max\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;Lee\u0026quot;\u003c/span\u003e];\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003ePage\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e [results, setResults] = \u003cspan class=\"hljs-title function_\"\u003euseState\u003c/span\u003e();\n\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n    \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003einput\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;text\u0026quot;\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003eplaceholder\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;Search\u0026quot;\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003eonChange\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{async\u003c/span\u003e (\u003cspan class=\"hljs-attr\"\u003ee\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n          const { value } = e.currentTarget;\n          // Dynamically load fuse.js\n          const Fuse = (await import(\u0026quot;fuse.js\u0026quot;)).default;\n          const fuse = new Fuse(names);\n\n          setResults(fuse.search(value));\n        }}\n      /\u0026gt;\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003epre\u003c/span\u003e\u0026gt;\u003c/span\u003eResults: {JSON.stringify(results, null, 2)}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003epre\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n  );\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch2 id=\"%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD-react-%E7%BB%84%E4%BB%B6\"\u003e\n                  动态加载 React 组件\n                \u003c/h2\u003e\u003cp\u003e使用 \u003ccode\u003e@symph/joy/dynamic\u003c/code\u003e 来动态加载 React 组件，它首先创建一个容器组件，在 React 组件树中使用容器组件替代目标，只当容器组件被渲染时，容器组件才会动态加载目标组件，加载完成后展示目标组件。\u003c/p\u003e\n\u003cp\u003e容器组件提供加载动画、加载失败重试和错误展示的能力，它也支持服务端渲染，即服务端渲染时，动态加载的组件也能想其它组件一样同步渲染。\u003c/p\u003e\n\u003cp\u003e下面的例子中展示了如何动态加载和使用 \u003ccode\u003e../components/hello\u003c/code\u003e 组件。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-tsx\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e dynamic \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/dynamic\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDynamicComponent\u003c/span\u003e = \u003cspan class=\"hljs-title function_\"\u003edynamic\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eimport\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;../components/hello\u0026quot;\u003c/span\u003e));\n\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eHome\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n    \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003eHOME PAGE\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eDynamicComponent\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n  );\n}\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eHome\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cblockquote\u003e\n\u003cp\u003e在 \u003ccode\u003eimport(\u0026#39;path/to/component\u0026#39;)\u003c/code\u003e 中， \u003ccode\u003epath/to/component\u003c/code\u003e 指定需动态加载组件的代码路径，该路径只能是明确的路径字符串，不能是变量或者字符串模板。\n此外，\u003ccode\u003eimport()\u003c/code\u003e必须在\u003ccode\u003edynamic()\u003c/code\u003e中调用，以便在服务端渲染时，能够在 Webpack 的输出 bundles 中查找包含该动态加载模块的 bundle，并在浏览器渲染之前预加载它们。\n\u003ccode\u003edynamic()\u003c/code\u003e 不能在 React 渲染中使用，因为它需要在模块的顶层进行标记，才能进行预加载，类似于\u003ccode\u003eReact.lazy\u003c/code\u003e。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e如果按需动态加载的 React 组件在 JS 文件中不是 default 方式导出，而是命名的导出，我们可以在 \u003ccode\u003eimport()\u003c/code\u003e 的结果\u003ccode\u003ePromise\u003c/code\u003e中取导出的命名值。\n例如动态加载的组件导出名称为\u003ccode\u003eHello\u003c/code\u003e 时:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eHello\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003eHello!\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e引用模块和使用导出的组件：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDynamicComponent\u003c/span\u003e = \u003cspan class=\"hljs-title function_\"\u003edynamic\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eimport\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;../components/hello\u0026quot;\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ethen\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003emd\u003c/span\u003e) =\u0026gt;\u003c/span\u003e md.\u003cspan class=\"hljs-property\"\u003eHello\u003c/span\u003e));\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch3 id=\"%E5%8A%A0%E8%BD%BD%E5%8A%A8%E7%94%BB%E5%92%8C%E7%8A%B6%E6%80%81\"\u003e\n                  加载动画和状态\n                \u003c/h3\u003e\u003cp\u003e\u003ccode\u003edynamic()\u003c/code\u003e 方法支持 \u003ccode\u003eloading\u003c/code\u003e 可选选项，用于渲染加载中的动画，或者加载失败的状态。\n例如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-tsx\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e dynamic \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/dynamic\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eDynamicLoadingComponentProps\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/react\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eLoadingComp\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e{ error, isLoading, pastDelay }: DynamicLoadingComponentProps\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (error) \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e`error`\u003c/span\u003e;\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (pastDelay \u0026amp;\u0026amp; isLoading) \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;...\u0026quot;\u003c/span\u003e;\n}\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDynamicComponentWithCustomLoading\u003c/span\u003e = \u003cspan class=\"hljs-title function_\"\u003edynamic\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eimport\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;../components/hello\u0026quot;\u003c/span\u003e), { \u003cspan class=\"hljs-attr\"\u003eloading\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eLoadingComp\u003c/span\u003e });\n\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eHome\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n    \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003eHOME PAGE\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eDynamicComponentWithCustomLoading\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n  );\n}\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eHome\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch3 id=\"%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD%E5%85%B3%E9%97%AD-ssr\"\u003e\n                  动态加载关闭 SSR\n                \u003c/h3\u003e\u003cp\u003e有时候我们想为动态加载的组件关闭服务端渲染，只在浏览器上运行该组件。 我们可以设置 \u003ccode\u003essr\u003c/code\u003e 属性为 false：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-tsx\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e dynamic \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/dynamic\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDynamicComponentWithNoSSR\u003c/span\u003e = \u003cspan class=\"hljs-title function_\"\u003edynamic\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eimport\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;../components/hello\u0026quot;\u003c/span\u003e), { \u003cspan class=\"hljs-attr\"\u003essr\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e });\n\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eHome\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n    \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003eHOME PAGE\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eDynamicComponentWithNoSSR\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n  );\n}\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eHome\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch3 id=\"%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD%E4%BD%BF%E7%94%A8-suspense\"\u003e\n                  动态加载使用 suspense\n                \u003c/h3\u003e\u003cp\u003e类似 React 18 的 \u003ccode\u003eReact.lazy\u003c/code\u003e 和 \u003ccode\u003e\u0026lt;Suspense\u0026gt;\u003c/code\u003e, 使用 \u003ccode\u003esuspense\u003c/code\u003e 参数来延迟懒加载组件。注意这暂时只能在服务端或者客户端的 \u003ccode\u003efallback\u003c/code\u003e模式下有效。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-tsx\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e dynamic \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/dynamic\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDynamicLazyComponent\u003c/span\u003e = \u003cspan class=\"hljs-title function_\"\u003edynamic\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eimport\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;../components/hello\u0026quot;\u003c/span\u003e), { \u003cspan class=\"hljs-attr\"\u003esuspense\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e });\n\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eHome\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n    \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003eHOME PAGE\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eSuspense\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003efallback\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{\u003c/span\u003e`\u003cspan class=\"hljs-attr\"\u003eloading\u003c/span\u003e`}\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eDynamicLazyComponent\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eSuspense\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n  );\n}\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eHome\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch2 id=\"%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD-joy-%E8%B7%AF%E7%94%B1%E7%BB%84%E4%BB%B6\"\u003e\n                  动态加载 Joy 路由组件\n                \u003c/h2\u003e\u003cp\u003e动态加载路由组件，指只有渲染该路由页面时，才会加载该路由组件相关联的代码模块。\n我们可以直接使用 \u003ccode\u003e@ReactDynamicLoad(options )\u003c/code\u003e 装饰器将 \u003ccode\u003e@ReactRoute\u003c/code\u003e 路由组件模块声明为动态加载模块。\n动态加载的路由组件也支持服务端渲染，和 \u003ccode\u003e@symph/joy/dynamic\u003c/code\u003e 的参数列表类似，我们也可以为动态路由组件设置加载参数，例如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-tsx\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eReact\u003c/span\u003e, { \u003cspan class=\"hljs-title class_\"\u003eReactNode\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eBaseReactController\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eReactController\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eReactRoute\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eReactDynamicLoad\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/react\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-meta\"\u003e@ReactDynamicLoad\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003edelay\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003etimeout\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e })\n\u003cspan class=\"hljs-meta\"\u003e@ReactRoute\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;/about\u0026quot;\u003c/span\u003e })\n\u003cspan class=\"hljs-meta\"\u003e@ReactController\u003c/span\u003e()\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eAboutPage\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title class_ inherited__\"\u003eBaseReactController\u003c/span\u003e {\n  \u003cspan class=\"hljs-title function_\"\u003erenderView\u003c/span\u003e(): \u003cspan class=\"hljs-title class_\"\u003eReactNode\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003eAboutPage\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e;\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003e@ReactDynamicLoad\u003c/code\u003e 支持可选的参数有：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eloading: \u003ccode\u003estring\u003c/code\u003e 加载动画组件的组件名称。\u003c/li\u003e\n\u003cli\u003edelay: \u003ccode\u003enumber\u003c/code\u003e, 默认值 \u003ccode\u003e200\u003c/code\u003e，表示如果在 200 毫秒内加载完成，就不用展示加载动画。这可以减少短时间内的界面切换给用户带来的困扰，让页面看起来加载的更快。\u003c/li\u003e\n\u003cli\u003etimeout: \u003ccode\u003enumber\u003c/code\u003e 设置加载的超时时间。\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch3 id=\"%E8%B7%AF%E7%94%B1%E5%8A%A0%E8%BD%BD%E5%8A%A8%E7%94%BB\"\u003e\n                  路由加载动画\n                \u003c/h3\u003e\u003cp\u003e和\u003ccode\u003e@symph/joy/dynamic\u003c/code\u003e不一样的是，\u003ccode\u003eloading\u003c/code\u003e 参数只能设置加载动画组件的组件字符串名称，而不是具体的加载组件。\n因为要保证加载路由组件之前 Loading 组件已经存在，才能在加载时展现加载动画，同时还得要确保 Loading 模块和路由模块之间没有静态的依赖关系，webpack 才不会将两者打包到一起。\n所以需使用字符串的组件名来指向当前运行时已经存在的组件名称。\u003c/p\u003e\n\u003cp\u003e我们可以在上层路由或者根路由文件模块导出 Loading 组件，来确保在动态路由模块加载之前，应用上下文中已经注册了 Loading 组件。\n例如在根布局路由中：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-tsx\"\u003e\u003cspan class=\"hljs-comment\"\u003e// src/client/pages/_layout.tsx\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e/**\n * 根路由组件\n */\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eReact\u003c/span\u003e, { \u003cspan class=\"hljs-title class_\"\u003eReactNode\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eBaseReactController\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eReactController\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eReactRouteContainer\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eOutlet\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react-router-dom\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eLoadableLoadingComponentProps\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/react\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-meta\"\u003e@ReactRouteContainer\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;/\u0026quot;\u003c/span\u003e })\n\u003cspan class=\"hljs-meta\"\u003e@ReactController\u003c/span\u003e()\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eRootlayout\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title class_ inherited__\"\u003eBaseReactController\u003c/span\u003e {\n  \u003cspan class=\"hljs-title function_\"\u003erenderView\u003c/span\u003e(): \u003cspan class=\"hljs-title class_\"\u003eReactNode\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n      \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eHead\u003c/span\u003e\u0026gt;\u003c/span\u003eHello\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eHead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eOutlet\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u0026gt;\u003c/span\u003e\u003c/span\u003e\n    );\n  }\n}\n\n\u003cspan class=\"hljs-comment\"\u003e/**\n * 自定义的加载动画组件\n */\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e@ReactController\u003c/span\u003e()\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDynamicLoading\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title class_ inherited__\"\u003eBaseReactController\u003c/span\u003e\u0026lt;\u003cspan class=\"hljs-title class_\"\u003eLoadableLoadingComponentProps\u003c/span\u003e\u0026gt; {\n  \u003cspan class=\"hljs-title function_\"\u003erenderView\u003c/span\u003e(): \u003cspan class=\"hljs-title class_\"\u003eReactNode\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n      \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;loadingMsg\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003eCustom loading...\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u0026gt;\u003c/span\u003e\u003c/span\u003e\n    );\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e然后在申明动态加载路由组件时，设置加载中动画组件。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-tsx\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eReact\u003c/span\u003e, { \u003cspan class=\"hljs-title class_\"\u003eReactNode\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eBaseReactController\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eReactController\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eReactRoute\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eReactDynamicLoad\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/react\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-meta\"\u003e@ReactDynamicLoad\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003eloading\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;dynamicLoading\u0026quot;\u003c/span\u003e }) \n\u003cspan class=\"hljs-meta\"\u003e@ReactRoute\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;/about\u0026quot;\u003c/span\u003e })\n\u003cspan class=\"hljs-meta\"\u003e@ReactController\u003c/span\u003e()\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDynamicAboutPage\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title class_ inherited__\"\u003eBaseReactController\u003c/span\u003e {\n  \u003cspan class=\"hljs-title function_\"\u003erenderView\u003c/span\u003e(): \u003cspan class=\"hljs-title class_\"\u003eReactNode\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003eThis is dynamic load about page.\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e;\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n","anchor":[{"type":"heading","raw":"## 动态加载模块 import()\n\n","depth":2,"text":"动态加载模块 import()","tokens":[{"type":"text","raw":"动态加载模块 import()","text":"动态加载模块 import()"}],"id":"#%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD%E6%A8%A1%E5%9D%97-import()"},{"type":"heading","raw":"## 动态加载 React 组件\n\n","depth":2,"text":"动态加载 React 组件","tokens":[{"type":"text","raw":"动态加载 React 组件","text":"动态加载 React 组件"}],"id":"#%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD-react-%E7%BB%84%E4%BB%B6","children":[{"type":"heading","raw":"### 加载动画和状态\n\n","depth":3,"text":"加载动画和状态","tokens":[{"type":"text","raw":"加载动画和状态","text":"加载动画和状态"}],"id":"#%E5%8A%A0%E8%BD%BD%E5%8A%A8%E7%94%BB%E5%92%8C%E7%8A%B6%E6%80%81"},{"type":"heading","raw":"### 动态加载关闭 SSR\n\n","depth":3,"text":"动态加载关闭 SSR","tokens":[{"type":"text","raw":"动态加载关闭 SSR","text":"动态加载关闭 SSR"}],"id":"#%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD%E5%85%B3%E9%97%AD-ssr"},{"type":"heading","raw":"### 动态加载使用 suspense\n\n","depth":3,"text":"动态加载使用 suspense","tokens":[{"type":"text","raw":"动态加载使用 suspense","text":"动态加载使用 suspense"}],"id":"#%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD%E4%BD%BF%E7%94%A8-suspense"}]},{"type":"heading","raw":"## 动态加载 Joy 路由组件\n\n","depth":2,"text":"动态加载 Joy 路由组件","tokens":[{"type":"text","raw":"动态加载 Joy 路由组件","text":"动态加载 Joy 路由组件"}],"id":"#%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD-joy-%E8%B7%AF%E7%94%B1%E7%BB%84%E4%BB%B6","children":[{"type":"heading","raw":"### 路由加载动画\n\n","depth":3,"text":"路由加载动画","tokens":[{"type":"text","raw":"路由加载动画","text":"路由加载动画"}],"id":"#%E8%B7%AF%E7%94%B1%E5%8A%A0%E8%BD%BD%E5%8A%A8%E7%94%BB"}]}]},{"title":"快速刷新 Fast Refresh","path":"/joy/react/fast-refresh","file":"docs\\joy\\02-react\\31-fast-refresh.md","hasMenu":false,"mdContent":"# 快速刷新 Fast Refresh\r\n\r\n快速刷新（Fast Refresh）是 React 官方提供的热更新解决方案，让我们可以在对 React 组件进行修改时提供即时反馈。\r\n\r\n例如在开发时，我们修改了组件的布局或样式后，浏览器界面自动更新为新的布局或样式，假设之前在界面的表单里已经填入了数据，那这些数据应该依然存在。\r\n\r\nJoy 应用默认开启了快速刷新，大部分情况下，在 1 秒左右能看到更新后的结果。\r\n\r\n\u003e 本文描述的组件状态，指的是 React 组件内部状态 `state`。\r\n\u003e\r\n\u003e 而我们的业务数据状态通常应该存放在 `ReactModel` 中，得益于 [@symph/react](/react/start/introduce) 统一数据源的设计，在 Fast Refresh 过程中不受影响，因为 React 能够使用全局状态在任何时候重新渲染组件。\r\n\r\n## 如何工作的\r\n\r\n- 如果编辑了一个只导出 React 组件的文件，Fast Refresh 将只热更新该文件的代码，并重新渲染组件。您可以编辑该文件中的任何内容，包括样式、呈现逻辑、事件处理程序或效果。\r\n- 如果编辑了一个非 React 组件导出的文件，Fast Refresh 会重新运行该文件，以及导入它的其他文件。因此，如果 `Button.js` 和 `Modal.js` 都导入了 `theme.js`，编辑 `theme.js` 将更新这两个组件。\r\n- 最后，如果编辑了一个由非 React 树导入的文件，Fast Refresh 将降级到完全重新加载。例如有一个文件，它渲染了一个 React 组件，但也导出了一个常量，而一个非 React 模块导入了它。\r\n  在这种情况下，想让快速刷新重新生效，可考虑将常量迁移到一个单独的文件，并将其导入到两个文件中。其它很多情况通常也可以用类似的方法解决。\r\n\r\n## 错误恢复\r\n\r\n### 语法错误\r\n\r\n如果在开发过程中出现语法错误，在编译中会看到错误提示，可以修复它并再次保存文件，这个错误会自动消失。因此我们不需要重新加载应用，也不会丢失组件状态。\r\n\r\n### 运行时错误\r\n\r\n如果组件内部出现运行时错误，界面将出现错误提示浮层覆盖界面，修复错误后，这个浮层会自动消失，无需重新加载整个应用。\r\n\r\n如果错误不是发生在组件渲染期间，错误修复后，组件的状态将会保留。但如果错误发现在组件渲染期间，React 将会使用更新后的代码重新加载应用。\r\n\r\n如果应用程序中有 [错误边界](https://reactjs.org/docs/error-boundaries.html) (这对于生产中是处理错误的一个推荐方式)，出现错误后将在下次修改时尝试重新渲染边界内的组件。\r\n这意味着错误边界可以防止错误上抛到应用根组件，重置整个应用状态。但是，要记住错误边界不应该太细，它们应该是为生产中特意设计和使用的。\r\n\r\n## 保留状态局限性\r\n\r\n在安全的情况下，Fast Refresh 试图在编辑组件后热更新组件时保留 React 组件的状态，但在以下是一些不安全的情况下，React 组件将重新挂载，状态不会被保留:\r\n\r\n- React 类声明的组件，其内部状态不会被保留。只有使用函数组件和 Hooks 时，才会保留状态。\r\n- 除了 React 组件之外，正在编辑的文件可能还有其他导出。\r\n- 当导出的组件是一个高阶组件（HOC 如： WrappedComponent），且高阶组件返回的是一个类时。\r\n- 匿名箭头函数，如 `export default () =\u003e \u003cdiv /\u003e;`，也将导致状态重置。此时可考虑使用命名函数代替：`export default funciton MyComponent () { return \u003cdiv /\u003e;}` 。\r\n\r\n## 使用技巧\r\n\r\n- 尽量将业务数据状态放在 ReactModel 中，它不受 Fast Refresh 的影响，能够更好的恢复业务场景。\r\n- 默认情况下，函数式组件能够更好的支持 Fast Refresh，在更新的过程中保留组件状态。\r\n- 有时，您可能希望强制重置状态，并重新安装组件。例如，如果你要调整一个只发生在挂载上的动画，这就很方便了。为此，我们可以通过在编辑的文件的任何位置添加 `// @refresh reset`注释， 指示 Fast Refresh 在每次编辑时重新挂载在该文件中定义的组件。\r\n- 通过 Fast Refresh，我们可以在编辑的文件中添加 `console.log` 或者 `debug`来调试应用，不用重新加载应用来使打印日志生效。\r\n\r\n## Fast Refresh 和 Hooks\r\n\r\n在尽可能的情况下， Fast Refresh 尝试在两次编辑之间保存组件的状态。特别是，只要不更改它们的参数或 Hook 调用的顺序，`useState`和`useRef`就会保留它们以前的值。\r\n\r\n带有依赖项的钩子（如`useEffect`、`useMemo`和`usecallback`）将始终在快速刷新期间更新。当快速刷新发生时，它们的依赖项列表将被忽略。\r\n例如，当编辑`useMemo(() =\u003e x * 2， [x])`为`useMemo (() =\u003e x * 10， [x])`时，即使`x`(依赖项)没有改变，它也会重新运行。\r\n\r\n有时，这可能会导致意想不到的结果。例如，即使一个带有空依赖数组的 `useEffect` 仍然会在快速刷新期间重新运行一次。\r\n\r\n然而，即使没有快速刷新，编写能够适应偶尔重新运行 useEffect 的代码也是一个很好的实践。\r\n它将使你更容易在以后引入新的依赖，并且它也是 React `Strict Mode`强制约束的，强烈建议启用它。\r\n","htmlContent":"\n                \u003ch1 id=\"%E5%BF%AB%E9%80%9F%E5%88%B7%E6%96%B0-fast-refresh\"\u003e\n                  快速刷新 Fast Refresh\n                \u003c/h1\u003e\u003cp\u003e快速刷新（Fast Refresh）是 React 官方提供的热更新解决方案，让我们可以在对 React 组件进行修改时提供即时反馈。\u003c/p\u003e\n\u003cp\u003e例如在开发时，我们修改了组件的布局或样式后，浏览器界面自动更新为新的布局或样式，假设之前在界面的表单里已经填入了数据，那这些数据应该依然存在。\u003c/p\u003e\n\u003cp\u003eJoy 应用默认开启了快速刷新，大部分情况下，在 1 秒左右能看到更新后的结果。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e本文描述的组件状态，指的是 React 组件内部状态 \u003ccode\u003estate\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e而我们的业务数据状态通常应该存放在 \u003ccode\u003eReactModel\u003c/code\u003e 中，得益于 \u003ca href=\"/react/start/introduce\"\u003e@symph/react\u003c/a\u003e 统一数据源的设计，在 Fast Refresh 过程中不受影响，因为 React 能够使用全局状态在任何时候重新渲染组件。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n                \u003ch2 id=\"%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84\"\u003e\n                  如何工作的\n                \u003c/h2\u003e\u003cul\u003e\n\u003cli\u003e如果编辑了一个只导出 React 组件的文件，Fast Refresh 将只热更新该文件的代码，并重新渲染组件。您可以编辑该文件中的任何内容，包括样式、呈现逻辑、事件处理程序或效果。\u003c/li\u003e\n\u003cli\u003e如果编辑了一个非 React 组件导出的文件，Fast Refresh 会重新运行该文件，以及导入它的其他文件。因此，如果 \u003ccode\u003eButton.js\u003c/code\u003e 和 \u003ccode\u003eModal.js\u003c/code\u003e 都导入了 \u003ccode\u003etheme.js\u003c/code\u003e，编辑 \u003ccode\u003etheme.js\u003c/code\u003e 将更新这两个组件。\u003c/li\u003e\n\u003cli\u003e最后，如果编辑了一个由非 React 树导入的文件，Fast Refresh 将降级到完全重新加载。例如有一个文件，它渲染了一个 React 组件，但也导出了一个常量，而一个非 React 模块导入了它。\n在这种情况下，想让快速刷新重新生效，可考虑将常量迁移到一个单独的文件，并将其导入到两个文件中。其它很多情况通常也可以用类似的方法解决。\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch2 id=\"%E9%94%99%E8%AF%AF%E6%81%A2%E5%A4%8D\"\u003e\n                  错误恢复\n                \u003c/h2\u003e\n                \u003ch3 id=\"%E8%AF%AD%E6%B3%95%E9%94%99%E8%AF%AF\"\u003e\n                  语法错误\n                \u003c/h3\u003e\u003cp\u003e如果在开发过程中出现语法错误，在编译中会看到错误提示，可以修复它并再次保存文件，这个错误会自动消失。因此我们不需要重新加载应用，也不会丢失组件状态。\u003c/p\u003e\n\n                \u003ch3 id=\"%E8%BF%90%E8%A1%8C%E6%97%B6%E9%94%99%E8%AF%AF\"\u003e\n                  运行时错误\n                \u003c/h3\u003e\u003cp\u003e如果组件内部出现运行时错误，界面将出现错误提示浮层覆盖界面，修复错误后，这个浮层会自动消失，无需重新加载整个应用。\u003c/p\u003e\n\u003cp\u003e如果错误不是发生在组件渲染期间，错误修复后，组件的状态将会保留。但如果错误发现在组件渲染期间，React 将会使用更新后的代码重新加载应用。\u003c/p\u003e\n\u003cp\u003e如果应用程序中有 \u003ca href=\"https://reactjs.org/docs/error-boundaries.html\"\u003e错误边界\u003c/a\u003e (这对于生产中是处理错误的一个推荐方式)，出现错误后将在下次修改时尝试重新渲染边界内的组件。\n这意味着错误边界可以防止错误上抛到应用根组件，重置整个应用状态。但是，要记住错误边界不应该太细，它们应该是为生产中特意设计和使用的。\u003c/p\u003e\n\n                \u003ch2 id=\"%E4%BF%9D%E7%95%99%E7%8A%B6%E6%80%81%E5%B1%80%E9%99%90%E6%80%A7\"\u003e\n                  保留状态局限性\n                \u003c/h2\u003e\u003cp\u003e在安全的情况下，Fast Refresh 试图在编辑组件后热更新组件时保留 React 组件的状态，但在以下是一些不安全的情况下，React 组件将重新挂载，状态不会被保留:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eReact 类声明的组件，其内部状态不会被保留。只有使用函数组件和 Hooks 时，才会保留状态。\u003c/li\u003e\n\u003cli\u003e除了 React 组件之外，正在编辑的文件可能还有其他导出。\u003c/li\u003e\n\u003cli\u003e当导出的组件是一个高阶组件（HOC 如： WrappedComponent），且高阶组件返回的是一个类时。\u003c/li\u003e\n\u003cli\u003e匿名箭头函数，如 \u003ccode\u003eexport default () =\u0026gt; \u0026lt;div /\u0026gt;;\u003c/code\u003e，也将导致状态重置。此时可考虑使用命名函数代替：\u003ccode\u003eexport default funciton MyComponent () { return \u0026lt;div /\u0026gt;;}\u003c/code\u003e 。\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch2 id=\"%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7\"\u003e\n                  使用技巧\n                \u003c/h2\u003e\u003cul\u003e\n\u003cli\u003e尽量将业务数据状态放在 ReactModel 中，它不受 Fast Refresh 的影响，能够更好的恢复业务场景。\u003c/li\u003e\n\u003cli\u003e默认情况下，函数式组件能够更好的支持 Fast Refresh，在更新的过程中保留组件状态。\u003c/li\u003e\n\u003cli\u003e有时，您可能希望强制重置状态，并重新安装组件。例如，如果你要调整一个只发生在挂载上的动画，这就很方便了。为此，我们可以通过在编辑的文件的任何位置添加 \u003ccode\u003e// @refresh reset\u003c/code\u003e注释， 指示 Fast Refresh 在每次编辑时重新挂载在该文件中定义的组件。\u003c/li\u003e\n\u003cli\u003e通过 Fast Refresh，我们可以在编辑的文件中添加 \u003ccode\u003econsole.log\u003c/code\u003e 或者 \u003ccode\u003edebug\u003c/code\u003e来调试应用，不用重新加载应用来使打印日志生效。\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch2 id=\"fast-refresh-%E5%92%8C-hooks\"\u003e\n                  Fast Refresh 和 Hooks\n                \u003c/h2\u003e\u003cp\u003e在尽可能的情况下， Fast Refresh 尝试在两次编辑之间保存组件的状态。特别是，只要不更改它们的参数或 Hook 调用的顺序，\u003ccode\u003euseState\u003c/code\u003e和\u003ccode\u003euseRef\u003c/code\u003e就会保留它们以前的值。\u003c/p\u003e\n\u003cp\u003e带有依赖项的钩子（如\u003ccode\u003euseEffect\u003c/code\u003e、\u003ccode\u003euseMemo\u003c/code\u003e和\u003ccode\u003eusecallback\u003c/code\u003e）将始终在快速刷新期间更新。当快速刷新发生时，它们的依赖项列表将被忽略。\n例如，当编辑\u003ccode\u003euseMemo(() =\u0026gt; x * 2， [x])\u003c/code\u003e为\u003ccode\u003euseMemo (() =\u0026gt; x * 10， [x])\u003c/code\u003e时，即使\u003ccode\u003ex\u003c/code\u003e(依赖项)没有改变，它也会重新运行。\u003c/p\u003e\n\u003cp\u003e有时，这可能会导致意想不到的结果。例如，即使一个带有空依赖数组的 \u003ccode\u003euseEffect\u003c/code\u003e 仍然会在快速刷新期间重新运行一次。\u003c/p\u003e\n\u003cp\u003e然而，即使没有快速刷新，编写能够适应偶尔重新运行 useEffect 的代码也是一个很好的实践。\n它将使你更容易在以后引入新的依赖，并且它也是 React \u003ccode\u003eStrict Mode\u003c/code\u003e强制约束的，强烈建议启用它。\u003c/p\u003e\n","anchor":[{"type":"heading","raw":"## 如何工作的\n\n","depth":2,"text":"如何工作的","tokens":[{"type":"text","raw":"如何工作的","text":"如何工作的"}],"id":"#%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84"},{"type":"heading","raw":"## 错误恢复\n\n","depth":2,"text":"错误恢复","tokens":[{"type":"text","raw":"错误恢复","text":"错误恢复"}],"id":"#%E9%94%99%E8%AF%AF%E6%81%A2%E5%A4%8D","children":[{"type":"heading","raw":"### 语法错误\n\n","depth":3,"text":"语法错误","tokens":[{"type":"text","raw":"语法错误","text":"语法错误"}],"id":"#%E8%AF%AD%E6%B3%95%E9%94%99%E8%AF%AF"},{"type":"heading","raw":"### 运行时错误\n\n","depth":3,"text":"运行时错误","tokens":[{"type":"text","raw":"运行时错误","text":"运行时错误"}],"id":"#%E8%BF%90%E8%A1%8C%E6%97%B6%E9%94%99%E8%AF%AF"}]},{"type":"heading","raw":"## 保留状态局限性\n\n","depth":2,"text":"保留状态局限性","tokens":[{"type":"text","raw":"保留状态局限性","text":"保留状态局限性"}],"id":"#%E4%BF%9D%E7%95%99%E7%8A%B6%E6%80%81%E5%B1%80%E9%99%90%E6%80%A7"},{"type":"heading","raw":"## 使用技巧\n\n","depth":2,"text":"使用技巧","tokens":[{"type":"text","raw":"使用技巧","text":"使用技巧"}],"id":"#%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7"},{"type":"heading","raw":"## Fast Refresh 和 Hooks\n\n","depth":2,"text":"Fast Refresh 和 Hooks","tokens":[{"type":"text","raw":"Fast Refresh 和 Hooks","text":"Fast Refresh 和 Hooks"}],"id":"#fast-refresh-%E5%92%8C-hooks"}]}]},{"title":"后端开发","path":"/joy/03-server","file":"docs/joy/03-server","children":[{"title":"Node.js 服务开发","path":"/joy/server/server-dev","file":"docs\\joy\\03-server\\01-server-dev.md","hasMenu":false,"mdContent":"# Node.js 服务开发\r\n\r\n`@symph/joy` 无缝集成 [`@symph/server`](/react/start/introduce) 库，让我们可以零配置开始 React 开发。\r\n\r\n\u003e 请跳转到 \"[@symph/server 文档](/server/start/introduce)\"，查看详细的 Node.js 服务应用开发文档。\r\n\r\nJoy 可以自动扫描和注册项目中的`@symph/server` Components 组件，同时也为 React 开发提供了额外的扩展功能:\r\n\r\n- 自动扫描和注册组件\r\n- 配置管理\r\n- 热更新和热重启\r\n","htmlContent":"\n                \u003ch1 id=\"nodejs-%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91\"\u003e\n                  Node.js 服务开发\n                \u003c/h1\u003e\u003cp\u003e\u003ccode\u003e@symph/joy\u003c/code\u003e 无缝集成 \u003ca href=\"/react/start/introduce\"\u003e\u003ccode\u003e@symph/server\u003c/code\u003e\u003c/a\u003e 库，让我们可以零配置开始 React 开发。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e请跳转到 \u0026quot;\u003ca href=\"/server/start/introduce\"\u003e@symph/server 文档\u003c/a\u003e\u0026quot;，查看详细的 Node.js 服务应用开发文档。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eJoy 可以自动扫描和注册项目中的\u003ccode\u003e@symph/server\u003c/code\u003e Components 组件，同时也为 React 开发提供了额外的扩展功能:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e自动扫描和注册组件\u003c/li\u003e\n\u003cli\u003e配置管理\u003c/li\u003e\n\u003cli\u003e热更新和热重启\u003c/li\u003e\n\u003c/ul\u003e\n","anchor":[]},{"title":"静态文件服务","path":"/joy/server/static-file-serving","file":"docs\\joy\\03-server\\02-static-file-serving.md","hasMenu":false,"mdContent":"# 静态文件服务\r\n\r\n## public 目录\r\n\r\nJoy 提供静态文件服务，在`public`目录下存放的文件，可通过 `/` URL 前缀的`http`请求访问，例如：\r\n\r\n- `myapp/public/favicon.ico` 可通过 URL 地址 `http://localhost:3000/favicon.ico` 访问。\r\n- `myapp/public/img/image-1.png` 可通过 URL 地址 `http://localhost:3000/img/image-1.png` 访问。\r\n\r\n`public` 目录中的静态文件，仅在编译阶段处理，在 Joy 应用初始化时加载，不能在运行时动态添加和修改文件。\r\n建议使用第三方存储服务存放文件，例如阿里云和 AWS S3，可少了应用服务器的 CPU 和网络负载，也能动态的维护资源文件。\r\n\r\n\u003e 注意： 静态文件的 URL 路径，需避免和 React 应用的页面路径或者 API 路径冲突，如果重复，将优先返回静态文件。\r\n\r\n### React 使用静态文件\r\n\r\n在 React 应用中，可使用其 URL 加载资源。导出 react 应用时，整个`public`目录也将一起导出。\r\n\r\n例如 `public/me.png`，在 React 中访问：\r\n\r\n```tsx\r\nfunction Avator() {\r\n  return \u003cimg src={\"/me.png\"} /\u003e;\r\n}\r\n```\r\n","htmlContent":"\n                \u003ch1 id=\"%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1\"\u003e\n                  静态文件服务\n                \u003c/h1\u003e\n                \u003ch2 id=\"public-%E7%9B%AE%E5%BD%95\"\u003e\n                  public 目录\n                \u003c/h2\u003e\u003cp\u003eJoy 提供静态文件服务，在\u003ccode\u003epublic\u003c/code\u003e目录下存放的文件，可通过 \u003ccode\u003e/\u003c/code\u003e URL 前缀的\u003ccode\u003ehttp\u003c/code\u003e请求访问，例如：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003emyapp/public/favicon.ico\u003c/code\u003e 可通过 URL 地址 \u003ccode\u003ehttp://localhost:3000/favicon.ico\u003c/code\u003e 访问。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003emyapp/public/img/image-1.png\u003c/code\u003e 可通过 URL 地址 \u003ccode\u003ehttp://localhost:3000/img/image-1.png\u003c/code\u003e 访问。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003ccode\u003epublic\u003c/code\u003e 目录中的静态文件，仅在编译阶段处理，在 Joy 应用初始化时加载，不能在运行时动态添加和修改文件。\n建议使用第三方存储服务存放文件，例如阿里云和 AWS S3，可少了应用服务器的 CPU 和网络负载，也能动态的维护资源文件。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e注意： 静态文件的 URL 路径，需避免和 React 应用的页面路径或者 API 路径冲突，如果重复，将优先返回静态文件。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n                \u003ch3 id=\"react-%E4%BD%BF%E7%94%A8%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6\"\u003e\n                  React 使用静态文件\n                \u003c/h3\u003e\u003cp\u003e在 React 应用中，可使用其 URL 加载资源。导出 react 应用时，整个\u003ccode\u003epublic\u003c/code\u003e目录也将一起导出。\u003c/p\u003e\n\u003cp\u003e例如 \u003ccode\u003epublic/me.png\u003c/code\u003e，在 React 中访问：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-tsx\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eAvator\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eimg\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{\u003c/span\u003e\u0026quot;/\u003cspan class=\"hljs-attr\"\u003eme.png\u003c/span\u003e\u0026quot;} /\u0026gt;\u003c/span\u003e\u003c/span\u003e;\n}\n\u003c/code\u003e\u003c/pre\u003e\n","anchor":[{"type":"heading","raw":"## public 目录\n\n","depth":2,"text":"public 目录","tokens":[{"type":"text","raw":"public 目录","text":"public 目录"}],"id":"#public-%E7%9B%AE%E5%BD%95","children":[{"type":"heading","raw":"### React 使用静态文件\n\n","depth":3,"text":"React 使用静态文件","tokens":[{"type":"text","raw":"React 使用静态文件","text":"React 使用静态文件"}],"id":"#react-%E4%BD%BF%E7%94%A8%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6"}]}]}]},{"title":"Joy 进阶","path":"/joy/04-advanced-use","file":"docs/joy/04-advanced-use","children":[{"title":"使用 TypeScript","path":"/joy/advanced-use/typescript","file":"docs\\joy\\04-advanced-use\\typescript.md","hasMenu":false,"mdContent":"# 使用 TypeScript\r\n\r\n`@symph/joy`应用默认支持 `TypeScript`，无需配置，即可创建`ts、tsx`文件，开始应用开发。\r\n\r\n如果需更改TypeScript选项，可在项目根目录下创建`tsconfig.json`文件，添加自定义配置。\r\n\r\n以下是默认配置：\r\n```json\r\n{\r\n  \"compilerOptions\": {\r\n    \"target\": \"es5\",\r\n    \"lib\": [\"dom\", \"dom.iterable\", \"esnext\"],\r\n    \"allowJs\": true,\r\n    \"skipLibCheck\": true,\r\n    \"strict\": false,\r\n    \"forceConsistentCasingInFileNames\": true,\r\n    \"emitDecoratorMetadata\": true,\r\n    \"experimentalDecorators\": true,\r\n    \"noEmit\": true,\r\n    \"esModuleInterop\": true,\r\n    \"module\": \"esnext\",\r\n    \"moduleResolution\": \"node\",\r\n    \"resolveJsonModule\": true,\r\n    \"isolatedModules\": true,\r\n    \"jsx\": \"preserve\"\r\n  },\r\n  \"include\": [\"**/*.ts\", \"**/*.tsx\"],\r\n  \"exclude\": [\"node_modules\"]\r\n}\r\n```\r\n\r\n","htmlContent":"\n                \u003ch1 id=\"%E4%BD%BF%E7%94%A8-typescript\"\u003e\n                  使用 TypeScript\n                \u003c/h1\u003e\u003cp\u003e\u003ccode\u003e@symph/joy\u003c/code\u003e应用默认支持 \u003ccode\u003eTypeScript\u003c/code\u003e，无需配置，即可创建\u003ccode\u003ets、tsx\u003c/code\u003e文件，开始应用开发。\u003c/p\u003e\n\u003cp\u003e如果需更改TypeScript选项，可在项目根目录下创建\u003ccode\u003etsconfig.json\u003c/code\u003e文件，添加自定义配置。\u003c/p\u003e\n\u003cp\u003e以下是默认配置：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-json\"\u003e\u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;compilerOptions\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\u0026quot;target\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;es5\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\u0026quot;lib\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot;dom\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;dom.iterable\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;esnext\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\u0026quot;allowJs\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003etrue\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\u0026quot;skipLibCheck\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003etrue\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\u0026quot;strict\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efalse\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\u0026quot;forceConsistentCasingInFileNames\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003etrue\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\u0026quot;emitDecoratorMetadata\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003etrue\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\u0026quot;experimentalDecorators\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003etrue\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\u0026quot;noEmit\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003etrue\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\u0026quot;esModuleInterop\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003etrue\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\u0026quot;module\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;esnext\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\u0026quot;moduleResolution\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;node\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\u0026quot;resolveJsonModule\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003etrue\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\u0026quot;isolatedModules\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003etrue\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\u0026quot;jsx\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;preserve\u0026quot;\u003c/span\u003e\n  \u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;include\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot;**/*.ts\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;**/*.tsx\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;exclude\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot;node_modules\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e]\u003c/span\u003e\n\u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n","anchor":[]}]},{"title":"应用容器","path":"/joy/05-container","file":"docs/joy/05-container","children":[{"title":"应用容器","path":"/joy/container/dependency-inject","file":"docs\\joy\\05-container\\01-dependency-inject.md","hasMenu":false,"mdContent":"# 应用容器\r\n\r\n容器`ApplicationContext`是整个应用的核心，容器管理应用的所有组件`Component`，负责组件的创建和装配。\r\n\r\n`@symph/core` 库提供了应用容器的约定接口 `IApplicationContext` 和基本实现类`ApplicationContext`。\r\n\r\n## 依赖注入 Dependency Injection\r\n\r\n依赖注入指当一个对象在创建时，由容器将其依赖的其它对象的引用传递给它，是面向对象编程中的一种设计模式，是控制反转（IoC: Inversion of Control）的一种技术实现。\r\n我们只需关注组件内部的功能实现，组件的创建将由容器完成，用来减低代码之间的耦合度，让各个组件能够轻易的组装和替换，方便进行扩展和测试等。\r\n\r\n下面以服务端的代码为例，展示依赖注入是如何工作的。\r\n首选创建一个 Service 类。\r\n\r\n```ts\r\n// src/server/posts.service.ts\r\n\r\nimport { Component } from \"@symph/core\";\r\n\r\n@Component()\r\nexport class PostsService {\r\n  private readonly posts: Post[] = [];\r\n\r\n  findAll(): Post[] {\r\n    return this.posts;\r\n  }\r\n}\r\n```\r\n\r\n然后让容器将组件注入到 Controller 类中:\r\n\r\n```ts\r\n// src/server/posts.controller.ts\r\n\r\nimport { Component } from \"@symph/core\";\r\nimport { PostsService } from \"./posts.service\";\r\n\r\n@Controller(\"posts\")\r\nexport class PostsController {\r\n  constructor(private postsService: PostsService) {}\r\n\r\n  @Get()\r\n  async findAll(): Promise\u003cPost[]\u003e {\r\n    return this.postsService.findAll();\r\n  }\r\n}\r\n```\r\n\r\n最后，注册所有的组件到容器中：\r\n\r\n```ts\r\n// src/server/app.ts\r\nimport { INestApplication, ServerFactory } from \"@symph/server\";\r\nimport { PostsService } from \"./posts.service\";\r\nimport { PostsController } from \"./posts.controller\";\r\n\r\nasync function startApp() {\r\n  const app = await ServerFactory.create([PostsService, PostsController]);\r\n  await app.listen(3000);\r\n}\r\nstartApp();\r\n```\r\n\r\n此时我们运行`ts-node app.ts`，整个应用已能够正常运行。\r\n上面例子有 3 个关键步骤：\r\n\r\n1. 在 `posts.service.ts` 中， 使用 `@Component()` 装饰器，声明`PostsService`类是一个可被依赖注入容器管理的组件。\r\n2. 在 `posts.controller.ts`中， 在 `PostsController` 类的构造函数里， 声明其依赖 `PostsService`。\r\n3. 在 `app.ts`中， 创建应用实例并注册组件，然后启动应用。启动的过程中会逐个创建组件实例，下面我们看看如何创建 `PostsController` 实例：\r\n   1. 在依赖注入容器创建 `PostsController` 实例之前，首先检查其依赖的组件，找到了 `PostsService`。\r\n   2. 然后通过类型 `PostsService` 在容器找到了之前注册的 `PostsService` 组件。\r\n   3. 容器将先创建 `PostsService` 的实例（默认为 `SINGTON` 单例模式），缓存和返回该实例，如果缓存已经存在，则直接返回该实例。\r\n   4. 将返回的 `PostsService` 的实例作为 `PostsController`构造函数的参数，创建 `PostsController` 实例。\r\n\r\n## 和 Java Spring 的主要区别：\r\n\r\n1. Spring 中，容器管理的对象成为 Bean 在 Joy 中我们称为`Component`。\r\n2. JavaScript 没有 Java 包的概念，所以不能通过字符串的类名来指定组件的类型。 且 Joy 组件 `package` 属性，仅用于命名分组，避免命名冲突，不影响通过类型查找组件。\r\n","htmlContent":"\n                \u003ch1 id=\"%E5%BA%94%E7%94%A8%E5%AE%B9%E5%99%A8\"\u003e\n                  应用容器\n                \u003c/h1\u003e\u003cp\u003e容器\u003ccode\u003eApplicationContext\u003c/code\u003e是整个应用的核心，容器管理应用的所有组件\u003ccode\u003eComponent\u003c/code\u003e，负责组件的创建和装配。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e@symph/core\u003c/code\u003e 库提供了应用容器的约定接口 \u003ccode\u003eIApplicationContext\u003c/code\u003e 和基本实现类\u003ccode\u003eApplicationContext\u003c/code\u003e。\u003c/p\u003e\n\n                \u003ch2 id=\"%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5-dependency-injection\"\u003e\n                  依赖注入 Dependency Injection\n                \u003c/h2\u003e\u003cp\u003e依赖注入指当一个对象在创建时，由容器将其依赖的其它对象的引用传递给它，是面向对象编程中的一种设计模式，是控制反转（IoC: Inversion of Control）的一种技术实现。\n我们只需关注组件内部的功能实现，组件的创建将由容器完成，用来减低代码之间的耦合度，让各个组件能够轻易的组装和替换，方便进行扩展和测试等。\u003c/p\u003e\n\u003cp\u003e下面以服务端的代码为例，展示依赖注入是如何工作的。\n首选创建一个 Service 类。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-comment\"\u003e// src/server/posts.service.ts\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eComponent\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/core\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-meta\"\u003e@Component\u003c/span\u003e()\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003ePostsService\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eposts\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003ePost\u003c/span\u003e[] = [];\n\n  \u003cspan class=\"hljs-title function_\"\u003efindAll\u003c/span\u003e(): \u003cspan class=\"hljs-title class_\"\u003ePost\u003c/span\u003e[] {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eposts\u003c/span\u003e;\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e然后让容器将组件注入到 Controller 类中:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-comment\"\u003e// src/server/posts.controller.ts\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eComponent\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/core\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003ePostsService\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;./posts.service\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-meta\"\u003e@Controller\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;posts\u0026quot;\u003c/span\u003e)\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003ePostsController\u003c/span\u003e {\n  \u003cspan class=\"hljs-title function_\"\u003econstructor\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e postsService: PostsService\u003c/span\u003e) {}\n\n  \u003cspan class=\"hljs-meta\"\u003e@Get\u003c/span\u003e()\n  \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efindAll\u003c/span\u003e(): \u003cspan class=\"hljs-title class_\"\u003ePromise\u003c/span\u003e\u0026lt;\u003cspan class=\"hljs-title class_\"\u003ePost\u003c/span\u003e[]\u0026gt; {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003epostsService\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003efindAll\u003c/span\u003e();\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e最后，注册所有的组件到容器中：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-comment\"\u003e// src/server/app.ts\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eINestApplication\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eServerFactory\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/server\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003ePostsService\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;./posts.service\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003ePostsController\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;./posts.controller\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003estartApp\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e app = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eServerFactory\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ecreate\u003c/span\u003e([\u003cspan class=\"hljs-title class_\"\u003ePostsService\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003ePostsController\u003c/span\u003e]);\n  \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e app.\u003cspan class=\"hljs-title function_\"\u003elisten\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e);\n}\n\u003cspan class=\"hljs-title function_\"\u003estartApp\u003c/span\u003e();\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e此时我们运行\u003ccode\u003ets-node app.ts\u003c/code\u003e，整个应用已能够正常运行。\n上面例子有 3 个关键步骤：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e在 \u003ccode\u003eposts.service.ts\u003c/code\u003e 中， 使用 \u003ccode\u003e@Component()\u003c/code\u003e 装饰器，声明\u003ccode\u003ePostsService\u003c/code\u003e类是一个可被依赖注入容器管理的组件。\u003c/li\u003e\n\u003cli\u003e在 \u003ccode\u003eposts.controller.ts\u003c/code\u003e中， 在 \u003ccode\u003ePostsController\u003c/code\u003e 类的构造函数里， 声明其依赖 \u003ccode\u003ePostsService\u003c/code\u003e。\u003c/li\u003e\n\u003cli\u003e在 \u003ccode\u003eapp.ts\u003c/code\u003e中， 创建应用实例并注册组件，然后启动应用。启动的过程中会逐个创建组件实例，下面我们看看如何创建 \u003ccode\u003ePostsController\u003c/code\u003e 实例：\u003col\u003e\n\u003cli\u003e在依赖注入容器创建 \u003ccode\u003ePostsController\u003c/code\u003e 实例之前，首先检查其依赖的组件，找到了 \u003ccode\u003ePostsService\u003c/code\u003e。\u003c/li\u003e\n\u003cli\u003e然后通过类型 \u003ccode\u003ePostsService\u003c/code\u003e 在容器找到了之前注册的 \u003ccode\u003ePostsService\u003c/code\u003e 组件。\u003c/li\u003e\n\u003cli\u003e容器将先创建 \u003ccode\u003ePostsService\u003c/code\u003e 的实例（默认为 \u003ccode\u003eSINGTON\u003c/code\u003e 单例模式），缓存和返回该实例，如果缓存已经存在，则直接返回该实例。\u003c/li\u003e\n\u003cli\u003e将返回的 \u003ccode\u003ePostsService\u003c/code\u003e 的实例作为 \u003ccode\u003ePostsController\u003c/code\u003e构造函数的参数，创建 \u003ccode\u003ePostsController\u003c/code\u003e 实例。\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\n                \u003ch2 id=\"%E5%92%8C-java-spring-%E7%9A%84%E4%B8%BB%E8%A6%81%E5%8C%BA%E5%88%AB%EF%BC%9A\"\u003e\n                  和 Java Spring 的主要区别：\n                \u003c/h2\u003e\u003col\u003e\n\u003cli\u003eSpring 中，容器管理的对象成为 Bean 在 Joy 中我们称为\u003ccode\u003eComponent\u003c/code\u003e。\u003c/li\u003e\n\u003cli\u003eJavaScript 没有 Java 包的概念，所以不能通过字符串的类名来指定组件的类型。 且 Joy 组件 \u003ccode\u003epackage\u003c/code\u003e 属性，仅用于命名分组，避免命名冲突，不影响通过类型查找组件。\u003c/li\u003e\n\u003c/ol\u003e\n","anchor":[{"type":"heading","raw":"## 依赖注入 Dependency Injection\n\n","depth":2,"text":"依赖注入 Dependency Injection","tokens":[{"type":"text","raw":"依赖注入 Dependency Injection","text":"依赖注入 Dependency Injection"}],"id":"#%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5-dependency-injection"},{"type":"heading","raw":"## 和 Java Spring 的主要区别：\n\n","depth":2,"text":"和 Java Spring 的主要区别：","tokens":[{"type":"text","raw":"和 Java Spring 的主要区别：","text":"和 Java Spring 的主要区别："}],"id":"#%E5%92%8C-java-spring-%E7%9A%84%E4%B8%BB%E8%A6%81%E5%8C%BA%E5%88%AB%EF%BC%9A"}]},{"title":"组件","path":"/joy/container/components","file":"docs\\joy\\05-container\\components.md","hasMenu":false,"mdContent":"# 组件\r\n\r\n我们可以将一个类，一个常量值或者一个工厂方法注册为组件，一个组件有以自己的名称和类型，当需要它时，我们可以通过其名称或者类型获取到它的值。\r\n\r\n## 基本属性\r\n\r\n以下列举了一个组件的基本属性和作用。\r\n\r\n#### name\r\n\r\nType: `string | symbol | undefined`\r\n\r\n组件名称，可以通过名称找到组件。 即依赖注入时，我们可以通过类型注入，也能够通过名称注入。\r\n在同一个 `package` 下， 相同名称的组件，如果类型兼容，后注册的将替换之前注册的组件。\r\n\r\n在声明类组件是，如果没有指定名称，将默认通过类名生成名称，生成规则：类名首字母小写，例如：`PostsService`类生成的 组件名称为 `postsService`。\r\n\r\n#### package\r\n\r\nType: `string | undefined`\r\n\r\n为 `undefined` 时， 默认为全局组件。\r\n\r\n组件所在包名，仅用于对容器中的组件进行命名分组，相同 `package` 的组件将分内一个组， 组内是一个独立的命名空间，即同一组内的不同组件的 `name` 冲突，不同组内可以有同名的组件。\r\n组件创建时，如果有通过名称注入的依赖， 将优先在组内查找同名的组件，未找到再在全局公开组件中查找。\r\n\r\n\u003e `package` 只有在通过名称注入时有效，通过类型注入不受此影响，如果要限制通过类型注入，请在模块内限制 `export` 导出的类型，防止被外部访问。\r\n\r\n#### global\r\n\r\nType: `bool | undefined`, Default: `false`\r\n\r\n为 `true` 表示这是公开全局公开命名组件， 能够被所有的其它组件访问。\r\n需注意，全局组件的 `name` 可能冲突，我们在开发一个独立模块是，其公开组件建议采用可区分模块的命名方式，例如 Joy 提供的数据获取组件名为 `joyFectchService`，添加 `joy` 前缀来区分.\r\n\r\n当值为 `false`时， 表示为组内非公开组件，只有在同一个组内才能通过名称访问到。\r\n\r\n#### scope\r\n\r\nType: `Scope`, Default: `Scope.SINGLETON`\r\n\r\n组件的被注入时的生命周期：\r\n\r\n- `Scope.SINGLETON` 单例模式，每次获取该组件的实例，获取的是同一个实例，当多个依赖它的组件创建时，注入过去的是同一个实例。\r\n- `Scope.PROTOTYPE` 多例模式，每次获取该组件的实例，获取的是 **不同** 实例， 当多个依赖它的组件创建时，注入过去的是 **不同** 实例。\r\n- `Scope.REQUEST` 用在服务端请求到来时，为每个请求创建对应的实例，在同一个请求过程中，不会重复创建。\r\n\r\n#### alias\r\n\r\nType: `string[]|undefined`, Default: undefined\r\n\r\n组件的别名，组件名称不可以重复，但是别名可以重复， 后注册的同别名组件，将优先使用。\r\n\r\n## 类组件\r\n\r\n### 类组件装饰器 @Component\r\n\r\n声明类组件可以通过`@Component(ComponentOptions)`装饰器和自定义组件属性两种方式。\r\n\r\n通过 `@Component(ComponentOptions)`装饰器将一个类直接声明为组件，然后直接注册该类到容器中。\r\n\r\n\u003e 在`@symph/joy`应用中，应用启动时会自动扫描和注册工程里的所有组件。如果我们单独使用容器`ApplicationContext`，需调用`registerModule`方法注册组件到容器中。\r\n\r\n下面我们再次看一下 `PostsService` 组件，并注册到普通容器中：\r\n\r\n```ts\r\nimport { Component, Scope, ApplicationContext } from \"@symph/core\";\r\n\r\n@Component({ name: \"postService\", scope: Scope.SINGLETON })\r\nexport class PostsService {\r\n  private readonly posts: Post[] = [];\r\n\r\n  findAll(): Post[] {\r\n    return this.posts;\r\n  }\r\n}\r\n\r\nconst app = new ApplicationContext();\r\napp.registerModule([PostsService]); // 注册\r\n```\r\n\r\n`ComponentOptions` 装饰参数，除了可以设置组件的基本属性，还包含以下类组件特有的属性：\r\n\r\n##### lazyRegister\r\n\r\nType: `bool|undefined`, Default: `false`\r\n\r\n延迟注册组件，在应用启动时不注册组件，在应用运行的过程中，遇到通过类型注入，且注入的类标记为可延迟注册，则此时将该类作为组件注册到容器中，然后创建并返回该类的实例。\r\n\r\n\u003e 目前主要在 React 应用容器中使用该特性，用于动态的加载界面和其依赖，`@ReactComponent()` 也默认开启了该属性。\r\n\r\n### 自定义类组件 useClass \r\n\r\n第二中方式，是通过自定义属性的方式注册组件, 下面例子和装饰器方式注册的效果一样。\r\n\r\n```ts\r\nimport { Scope, ApplicationContext } from \"@symph/core\";\r\n\r\nexport class PostsService {\r\n  private readonly posts: Post[] = [];\r\n\r\n  findAll(): Post[] {\r\n    return this.posts;\r\n  }\r\n}\r\n\r\nconst app = new ApplicationContext();\r\napp.registerModule([\r\n  {\r\n    name: \"postsService\",\r\n    socpe: Scope.SINGLETON,\r\n    useClass: PostsService,\r\n  },\r\n]); // 注册\r\n```\r\n\r\n### 依赖声明和注入 @Inject()\r\n\r\n`@Inject\u003cT\u003e(typeOrName?: string | symbol | Type\u003cT\u003e) {)` 装饰器在类的构造方法或属性上声明一个外部依赖。\r\n\r\n\u003e 在面向对象编程里，强依赖建议采用构造方法注入，弱依赖采用属性注入。\r\n\r\n#### 构造方法依赖注入\r\n\r\n类构造方法的每个入参都声明了一个外部依赖，组件在创建之前，容器会逐个创建这些依赖，然后作为参数调用构造函数创建组件实例。\r\n入参上可以省略 `@Inject()` 装饰，默认采用类型注入。\r\n\r\n```ts\r\nimport { Inject, Component } from \"@symph/core\";\r\n\r\n@Component()\r\nclass PostsService {\r\n  constructor(\r\n    private databaseConnection: DatabaseConnection, // 注入 PostsService 类型的组件。\r\n    \r\n    @Inject(\"configService\")\r\n    private configService: ConfigService // 注入名称为 configService 的组件。\r\n  ) {}\r\n}\r\n```\r\n\r\n#### 属性依赖注入\r\n\r\n类声明的属性上，使用`@Inject()`装饰器声明这个是一个需依赖注入的属性.\r\n\r\n```ts\r\nimport { Inject,Component } from \"@symph/core\";\r\n\r\n@Component()\r\nclass PostsService {\r\n  @Inject()\r\n  private logService: LogService;\r\n}\r\n```\r\n\r\n## 值组件 useValue\r\n\r\n常量值也可以注册为组件，例如注册外部库到容器中，或者使用 Mock 值替换真实值等，下面我们为了测试，使用 mock 的`PostsService`替换真实的值。\r\n\r\n```ts\r\nimport { INestApplication, ServerFactory } from \"@symph/server\";\r\nimport { PostsService } from \"./posts.service\";\r\nimport { PostsController } from \"./posts.controller\";\r\n\r\nconst mockPostsService = {\r\n  /**\r\n   * mock 功能\r\n   */\r\n};\r\n\r\nasync function startApp() {\r\n  const app = await ServerFactory.create([\r\n    {\r\n      name: \"postsService\",\r\n      type: PostsService,\r\n      useValue: mockPostsService,\r\n    },\r\n    PostsController,\r\n  ]);\r\n  await app.listen(3000);\r\n}\r\nstartApp();\r\n```\r\n\r\n上例中，通过`PostsService`类型注入或者 `postsService`名字注入的地方，都将强制注入`mockPostsService`常量值。虽然是常量值，我们依然可以为组件设置`name`和`type`，用于在注入匹配组件。\r\n\r\n## 工厂组件 useFactory\r\n\r\n使用`useFactory`定义产生组件值得工厂方法，允许我们动态的创建组件。\r\n工厂方法可以使用容器中的其它的组件，`inject` 属性接受一个依赖的其它组件数组，该数组的顺序和工厂方法的入参顺序需一直，下看一个代码片段：使用配置动态创建数据库连接.\r\n\r\n```ts\r\nServerFactory.create([\r\n  {\r\n    name: \"databaseConnection\",\r\n    useFactory: (configService: ConfigService) =\u003e {\r\n      const dbOptions = configService.get(\"dbOptions\");\r\n      return new DatabaseConnection(dbOptions);\r\n    },\r\n    inject: [ConfigService], // 通过类型注入配置管理服务\r\n    scope: Scope.SINGLETON\r\n  },\r\n]);\r\n```\r\n\r\n## 注册组件\r\n\r\n我们可以在应用容器初始化之前注册组件，也可以在运行过程中加载组件。\r\n注册组件时，有已下几种数据结构可以作为参数传入，容器会自动识别这些数据结构得到里面的组件配置。\r\n\r\n1. 被 `@Component()` 装饰的组件类。\r\n2. 自定义的类组件、值组件和工厂组件。\r\n3. 被`@Configuration()`装饰的配置类。\r\n4. 包含以上 3 中结构的对象，例如`import`一个模块后，直接扫描整个模块导出的内容。\r\n5. 以上结构组成的数组。\r\n\r\n容器初始化之前注册的组件，能够在容器初始化时，第一时间扫描内部所有的组件，进行组件识别和初始化，例如识别所有的 Controller 组件，得到应用的路由信息。\r\n容器初始化之前，可以在一下 2 个地方注册组件：\r\n\r\n1. 在创建应用容器实例时，将组件列表作为容器的构造参数传入。\r\n2. 使用`registerModule(module)`方法注册组件。\r\n\r\n```ts\r\n// 1. 作为容器的构成参数传入\r\nconst applicationContext = new ApplicationContext(components);\r\n\r\n// 2. 调用注册方法注册\r\napplicationContext.registerModule(extraComponents);\r\n```\r\n\r\n应用运行时，调用 `loadModule(module)`方法动态加载组件，组件注册完成后，立即执行组件初始化。\r\n需注意：不允许重复注册同名且已经创建过实例的组件，动态注册将会报错中断，因为这会让应用导致无法预测的错误。\r\n\r\n## 获取组件值\r\n\r\n有以下 2 个方法可以容器中组件的值：\r\n\r\n```ts\r\ninterface IApplicationContext {\r\n  /**\r\n   * 获取组件值\r\n   * @param typeOrName 组件类型或名称\r\n   */\r\n  get\u003cTInput = any\u003e(typeOrName: TypeOrTokenType\u003cTInput\u003e): Promise\u003cTInput\u003e | TInput;\r\n\r\n  /**\r\n   * 获取组件值，如果组件不存在，返回null。\r\n   * @param typeOrName 组件类型或名称\r\n   */\r\n  getOptional\u003cTInput = any\u003e(typeOrName: TypeOrTokenType\u003cTInput\u003e): Promise\u003cTInput\u003e | TInput | undefined;\r\n}\r\n```\r\n\r\n如果组件时异步组件，返回的 `Promise\u003cInput\u003e`，什么是异步组件？\r\n\r\n1. 异步工厂方法定义的组件。\r\n2. 组件的 initialize 方法返回的 promise。\r\n3. 组件的依赖中有异步组件。\r\n\r\n当我们确定组件是非异步组件，且不想中断当前执行流程的时候，可以强制使用同步方式获取组件值。例如在 React 的渲染过程中，我们会尽力采用同步方式使用组件，避免打断渲染流程，减少不必要的重复渲染。\r\n\r\n```ts\r\ninterface IApplicationContext {\r\n  /**\r\n   * 同步获取组件值，如果组件是异步组件，将会抛出异常。\r\n   *  @param typeOrName 组件类型或名称\r\n   */\r\n  getSync\u003cTInput = any\u003e(typeOrName: TypeOrTokenType\u003cTInput\u003e): TInput;\r\n\r\n  /**\r\n   * 同步获取组件值，如果组件不存在，返回null，如果组件是异步组件，将会抛出异常。\r\n   * @param typeOrName 组件类型或名称\r\n   */\r\n  getOptionalSync\u003cTInput = any\u003e(typeOrName: TypeOrTokenType\u003cTInput\u003e): TInput | undefined;\r\n}\r\n```\r\n\r\n","htmlContent":"\n                \u003ch1 id=\"%E7%BB%84%E4%BB%B6\"\u003e\n                  组件\n                \u003c/h1\u003e\u003cp\u003e我们可以将一个类，一个常量值或者一个工厂方法注册为组件，一个组件有以自己的名称和类型，当需要它时，我们可以通过其名称或者类型获取到它的值。\u003c/p\u003e\n\n                \u003ch2 id=\"%E5%9F%BA%E6%9C%AC%E5%B1%9E%E6%80%A7\"\u003e\n                  基本属性\n                \u003c/h2\u003e\u003cp\u003e以下列举了一个组件的基本属性和作用。\u003c/p\u003e\n\n                \u003ch4 id=\"name\"\u003e\n                  name\n                \u003c/h4\u003e\u003cp\u003eType: \u003ccode\u003estring | symbol | undefined\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e组件名称，可以通过名称找到组件。 即依赖注入时，我们可以通过类型注入，也能够通过名称注入。\n在同一个 \u003ccode\u003epackage\u003c/code\u003e 下， 相同名称的组件，如果类型兼容，后注册的将替换之前注册的组件。\u003c/p\u003e\n\u003cp\u003e在声明类组件是，如果没有指定名称，将默认通过类名生成名称，生成规则：类名首字母小写，例如：\u003ccode\u003ePostsService\u003c/code\u003e类生成的 组件名称为 \u003ccode\u003epostsService\u003c/code\u003e。\u003c/p\u003e\n\n                \u003ch4 id=\"package\"\u003e\n                  package\n                \u003c/h4\u003e\u003cp\u003eType: \u003ccode\u003estring | undefined\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e为 \u003ccode\u003eundefined\u003c/code\u003e 时， 默认为全局组件。\u003c/p\u003e\n\u003cp\u003e组件所在包名，仅用于对容器中的组件进行命名分组，相同 \u003ccode\u003epackage\u003c/code\u003e 的组件将分内一个组， 组内是一个独立的命名空间，即同一组内的不同组件的 \u003ccode\u003ename\u003c/code\u003e 冲突，不同组内可以有同名的组件。\n组件创建时，如果有通过名称注入的依赖， 将优先在组内查找同名的组件，未找到再在全局公开组件中查找。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ccode\u003epackage\u003c/code\u003e 只有在通过名称注入时有效，通过类型注入不受此影响，如果要限制通过类型注入，请在模块内限制 \u003ccode\u003eexport\u003c/code\u003e 导出的类型，防止被外部访问。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n                \u003ch4 id=\"global\"\u003e\n                  global\n                \u003c/h4\u003e\u003cp\u003eType: \u003ccode\u003ebool | undefined\u003c/code\u003e, Default: \u003ccode\u003efalse\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e为 \u003ccode\u003etrue\u003c/code\u003e 表示这是公开全局公开命名组件， 能够被所有的其它组件访问。\n需注意，全局组件的 \u003ccode\u003ename\u003c/code\u003e 可能冲突，我们在开发一个独立模块是，其公开组件建议采用可区分模块的命名方式，例如 Joy 提供的数据获取组件名为 \u003ccode\u003ejoyFectchService\u003c/code\u003e，添加 \u003ccode\u003ejoy\u003c/code\u003e 前缀来区分.\u003c/p\u003e\n\u003cp\u003e当值为 \u003ccode\u003efalse\u003c/code\u003e时， 表示为组内非公开组件，只有在同一个组内才能通过名称访问到。\u003c/p\u003e\n\n                \u003ch4 id=\"scope\"\u003e\n                  scope\n                \u003c/h4\u003e\u003cp\u003eType: \u003ccode\u003eScope\u003c/code\u003e, Default: \u003ccode\u003eScope.SINGLETON\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e组件的被注入时的生命周期：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eScope.SINGLETON\u003c/code\u003e 单例模式，每次获取该组件的实例，获取的是同一个实例，当多个依赖它的组件创建时，注入过去的是同一个实例。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eScope.PROTOTYPE\u003c/code\u003e 多例模式，每次获取该组件的实例，获取的是 \u003cstrong\u003e不同\u003c/strong\u003e 实例， 当多个依赖它的组件创建时，注入过去的是 \u003cstrong\u003e不同\u003c/strong\u003e 实例。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eScope.REQUEST\u003c/code\u003e 用在服务端请求到来时，为每个请求创建对应的实例，在同一个请求过程中，不会重复创建。\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch4 id=\"alias\"\u003e\n                  alias\n                \u003c/h4\u003e\u003cp\u003eType: \u003ccode\u003estring[]|undefined\u003c/code\u003e, Default: undefined\u003c/p\u003e\n\u003cp\u003e组件的别名，组件名称不可以重复，但是别名可以重复， 后注册的同别名组件，将优先使用。\u003c/p\u003e\n\n                \u003ch2 id=\"%E7%B1%BB%E7%BB%84%E4%BB%B6\"\u003e\n                  类组件\n                \u003c/h2\u003e\n                \u003ch3 id=\"%E7%B1%BB%E7%BB%84%E4%BB%B6%E8%A3%85%E9%A5%B0%E5%99%A8-component\"\u003e\n                  类组件装饰器 @Component\n                \u003c/h3\u003e\u003cp\u003e声明类组件可以通过\u003ccode\u003e@Component(ComponentOptions)\u003c/code\u003e装饰器和自定义组件属性两种方式。\u003c/p\u003e\n\u003cp\u003e通过 \u003ccode\u003e@Component(ComponentOptions)\u003c/code\u003e装饰器将一个类直接声明为组件，然后直接注册该类到容器中。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e在\u003ccode\u003e@symph/joy\u003c/code\u003e应用中，应用启动时会自动扫描和注册工程里的所有组件。如果我们单独使用容器\u003ccode\u003eApplicationContext\u003c/code\u003e，需调用\u003ccode\u003eregisterModule\u003c/code\u003e方法注册组件到容器中。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e下面我们再次看一下 \u003ccode\u003ePostsService\u003c/code\u003e 组件，并注册到普通容器中：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eComponent\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eScope\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eApplicationContext\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/core\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-meta\"\u003e@Component\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;postService\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003escope\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eScope\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eSINGLETON\u003c/span\u003e })\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003ePostsService\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eposts\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003ePost\u003c/span\u003e[] = [];\n\n  \u003cspan class=\"hljs-title function_\"\u003efindAll\u003c/span\u003e(): \u003cspan class=\"hljs-title class_\"\u003ePost\u003c/span\u003e[] {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eposts\u003c/span\u003e;\n  }\n}\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e app = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eApplicationContext\u003c/span\u003e();\napp.\u003cspan class=\"hljs-title function_\"\u003eregisterModule\u003c/span\u003e([\u003cspan class=\"hljs-title class_\"\u003ePostsService\u003c/span\u003e]); \u003cspan class=\"hljs-comment\"\u003e// 注册\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eComponentOptions\u003c/code\u003e 装饰参数，除了可以设置组件的基本属性，还包含以下类组件特有的属性：\u003c/p\u003e\n\n                \u003ch5 id=\"lazyregister\"\u003e\n                  lazyRegister\n                \u003c/h5\u003e\u003cp\u003eType: \u003ccode\u003ebool|undefined\u003c/code\u003e, Default: \u003ccode\u003efalse\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e延迟注册组件，在应用启动时不注册组件，在应用运行的过程中，遇到通过类型注入，且注入的类标记为可延迟注册，则此时将该类作为组件注册到容器中，然后创建并返回该类的实例。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e目前主要在 React 应用容器中使用该特性，用于动态的加载界面和其依赖，\u003ccode\u003e@ReactComponent()\u003c/code\u003e 也默认开启了该属性。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n                \u003ch3 id=\"%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E7%BB%84%E4%BB%B6-useclass\"\u003e\n                  自定义类组件 useClass\n                \u003c/h3\u003e\u003cp\u003e第二中方式，是通过自定义属性的方式注册组件, 下面例子和装饰器方式注册的效果一样。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eScope\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eApplicationContext\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/core\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003ePostsService\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eposts\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003ePost\u003c/span\u003e[] = [];\n\n  \u003cspan class=\"hljs-title function_\"\u003efindAll\u003c/span\u003e(): \u003cspan class=\"hljs-title class_\"\u003ePost\u003c/span\u003e[] {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eposts\u003c/span\u003e;\n  }\n}\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e app = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eApplicationContext\u003c/span\u003e();\napp.\u003cspan class=\"hljs-title function_\"\u003eregisterModule\u003c/span\u003e([\n  {\n    \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;postsService\u0026quot;\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003esocpe\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eScope\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eSINGLETON\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003euseClass\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003ePostsService\u003c/span\u003e,\n  },\n]); \u003cspan class=\"hljs-comment\"\u003e// 注册\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch3 id=\"%E4%BE%9D%E8%B5%96%E5%A3%B0%E6%98%8E%E5%92%8C%E6%B3%A8%E5%85%A5-inject()\"\u003e\n                  依赖声明和注入 @Inject()\n                \u003c/h3\u003e\u003cp\u003e\u003ccode\u003e@Inject\u0026lt;T\u0026gt;(typeOrName?: string | symbol | Type\u0026lt;T\u0026gt;) {)\u003c/code\u003e 装饰器在类的构造方法或属性上声明一个外部依赖。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e在面向对象编程里，强依赖建议采用构造方法注入，弱依赖采用属性注入。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n                \u003ch4 id=\"%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5\"\u003e\n                  构造方法依赖注入\n                \u003c/h4\u003e\u003cp\u003e类构造方法的每个入参都声明了一个外部依赖，组件在创建之前，容器会逐个创建这些依赖，然后作为参数调用构造函数创建组件实例。\n入参上可以省略 \u003ccode\u003e@Inject()\u003c/code\u003e 装饰，默认采用类型注入。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eInject\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eComponent\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/core\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-meta\"\u003e@Component\u003c/span\u003e()\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003ePostsService\u003c/span\u003e {\n  \u003cspan class=\"hljs-title function_\"\u003econstructor\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\n    \u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e databaseConnection: DatabaseConnection, \u003cspan class=\"hljs-comment\"\u003e// 注入 PostsService 类型的组件。\u003c/span\u003e\n    \n    \u003cspan class=\"hljs-meta\"\u003e@Inject\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;configService\u0026quot;\u003c/span\u003e)\n    \u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e configService: ConfigService \u003cspan class=\"hljs-comment\"\u003e// 注入名称为 configService 的组件。\u003c/span\u003e\n  \u003c/span\u003e) {}\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch4 id=\"%E5%B1%9E%E6%80%A7%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5\"\u003e\n                  属性依赖注入\n                \u003c/h4\u003e\u003cp\u003e类声明的属性上，使用\u003ccode\u003e@Inject()\u003c/code\u003e装饰器声明这个是一个需依赖注入的属性.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eInject\u003c/span\u003e,\u003cspan class=\"hljs-title class_\"\u003eComponent\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/core\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-meta\"\u003e@Component\u003c/span\u003e()\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003ePostsService\u003c/span\u003e {\n  \u003cspan class=\"hljs-meta\"\u003e@Inject\u003c/span\u003e()\n  \u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003elogService\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eLogService\u003c/span\u003e;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch2 id=\"%E5%80%BC%E7%BB%84%E4%BB%B6-usevalue\"\u003e\n                  值组件 useValue\n                \u003c/h2\u003e\u003cp\u003e常量值也可以注册为组件，例如注册外部库到容器中，或者使用 Mock 值替换真实值等，下面我们为了测试，使用 mock 的\u003ccode\u003ePostsService\u003c/code\u003e替换真实的值。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eINestApplication\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eServerFactory\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/server\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003ePostsService\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;./posts.service\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003ePostsController\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;./posts.controller\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e mockPostsService = {\n  \u003cspan class=\"hljs-comment\"\u003e/**\n   * mock 功能\n   */\u003c/span\u003e\n};\n\n\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003estartApp\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e app = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eServerFactory\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ecreate\u003c/span\u003e([\n    {\n      \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;postsService\u0026quot;\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003ePostsService\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003euseValue\u003c/span\u003e: mockPostsService,\n    },\n    \u003cspan class=\"hljs-title class_\"\u003ePostsController\u003c/span\u003e,\n  ]);\n  \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e app.\u003cspan class=\"hljs-title function_\"\u003elisten\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e);\n}\n\u003cspan class=\"hljs-title function_\"\u003estartApp\u003c/span\u003e();\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e上例中，通过\u003ccode\u003ePostsService\u003c/code\u003e类型注入或者 \u003ccode\u003epostsService\u003c/code\u003e名字注入的地方，都将强制注入\u003ccode\u003emockPostsService\u003c/code\u003e常量值。虽然是常量值，我们依然可以为组件设置\u003ccode\u003ename\u003c/code\u003e和\u003ccode\u003etype\u003c/code\u003e，用于在注入匹配组件。\u003c/p\u003e\n\n                \u003ch2 id=\"%E5%B7%A5%E5%8E%82%E7%BB%84%E4%BB%B6-usefactory\"\u003e\n                  工厂组件 useFactory\n                \u003c/h2\u003e\u003cp\u003e使用\u003ccode\u003euseFactory\u003c/code\u003e定义产生组件值得工厂方法，允许我们动态的创建组件。\n工厂方法可以使用容器中的其它的组件，\u003ccode\u003einject\u003c/code\u003e 属性接受一个依赖的其它组件数组，该数组的顺序和工厂方法的入参顺序需一直，下看一个代码片段：使用配置动态创建数据库连接.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-title class_\"\u003eServerFactory\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ecreate\u003c/span\u003e([\n  {\n    \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;databaseConnection\u0026quot;\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003euseFactory\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003econfigService: ConfigService\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n      \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e dbOptions = configService.\u003cspan class=\"hljs-title function_\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;dbOptions\u0026quot;\u003c/span\u003e);\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDatabaseConnection\u003c/span\u003e(dbOptions);\n    },\n    \u003cspan class=\"hljs-attr\"\u003einject\u003c/span\u003e: [\u003cspan class=\"hljs-title class_\"\u003eConfigService\u003c/span\u003e], \u003cspan class=\"hljs-comment\"\u003e// 通过类型注入配置管理服务\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003escope\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eScope\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eSINGLETON\u003c/span\u003e\n  },\n]);\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch2 id=\"%E6%B3%A8%E5%86%8C%E7%BB%84%E4%BB%B6\"\u003e\n                  注册组件\n                \u003c/h2\u003e\u003cp\u003e我们可以在应用容器初始化之前注册组件，也可以在运行过程中加载组件。\n注册组件时，有已下几种数据结构可以作为参数传入，容器会自动识别这些数据结构得到里面的组件配置。\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e被 \u003ccode\u003e@Component()\u003c/code\u003e 装饰的组件类。\u003c/li\u003e\n\u003cli\u003e自定义的类组件、值组件和工厂组件。\u003c/li\u003e\n\u003cli\u003e被\u003ccode\u003e@Configuration()\u003c/code\u003e装饰的配置类。\u003c/li\u003e\n\u003cli\u003e包含以上 3 中结构的对象，例如\u003ccode\u003eimport\u003c/code\u003e一个模块后，直接扫描整个模块导出的内容。\u003c/li\u003e\n\u003cli\u003e以上结构组成的数组。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e容器初始化之前注册的组件，能够在容器初始化时，第一时间扫描内部所有的组件，进行组件识别和初始化，例如识别所有的 Controller 组件，得到应用的路由信息。\n容器初始化之前，可以在一下 2 个地方注册组件：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e在创建应用容器实例时，将组件列表作为容器的构造参数传入。\u003c/li\u003e\n\u003cli\u003e使用\u003ccode\u003eregisterModule(module)\u003c/code\u003e方法注册组件。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 1. 作为容器的构成参数传入\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e applicationContext = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eApplicationContext\u003c/span\u003e(components);\n\n\u003cspan class=\"hljs-comment\"\u003e// 2. 调用注册方法注册\u003c/span\u003e\napplicationContext.\u003cspan class=\"hljs-title function_\"\u003eregisterModule\u003c/span\u003e(extraComponents);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e应用运行时，调用 \u003ccode\u003eloadModule(module)\u003c/code\u003e方法动态加载组件，组件注册完成后，立即执行组件初始化。\n需注意：不允许重复注册同名且已经创建过实例的组件，动态注册将会报错中断，因为这会让应用导致无法预测的错误。\u003c/p\u003e\n\n                \u003ch2 id=\"%E8%8E%B7%E5%8F%96%E7%BB%84%E4%BB%B6%E5%80%BC\"\u003e\n                  获取组件值\n                \u003c/h2\u003e\u003cp\u003e有以下 2 个方法可以容器中组件的值：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eIApplicationContext\u003c/span\u003e {\n  \u003cspan class=\"hljs-comment\"\u003e/**\n   * 获取组件值\n   * \u003cspan class=\"hljs-doctag\"\u003e@param\u003c/span\u003e typeOrName 组件类型或名称\n   */\u003c/span\u003e\n  get\u0026lt;\u003cspan class=\"hljs-title class_\"\u003eTInput\u003c/span\u003e = \u003cspan class=\"hljs-built_in\"\u003eany\u003c/span\u003e\u0026gt;(\u003cspan class=\"hljs-attr\"\u003etypeOrName\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eTypeOrTokenType\u003c/span\u003e\u0026lt;\u003cspan class=\"hljs-title class_\"\u003eTInput\u003c/span\u003e\u0026gt;): \u003cspan class=\"hljs-title class_\"\u003ePromise\u003c/span\u003e\u0026lt;\u003cspan class=\"hljs-title class_\"\u003eTInput\u003c/span\u003e\u0026gt; | \u003cspan class=\"hljs-title class_\"\u003eTInput\u003c/span\u003e;\n\n  \u003cspan class=\"hljs-comment\"\u003e/**\n   * 获取组件值，如果组件不存在，返回null。\n   * \u003cspan class=\"hljs-doctag\"\u003e@param\u003c/span\u003e typeOrName 组件类型或名称\n   */\u003c/span\u003e\n  getOptional\u0026lt;\u003cspan class=\"hljs-title class_\"\u003eTInput\u003c/span\u003e = \u003cspan class=\"hljs-built_in\"\u003eany\u003c/span\u003e\u0026gt;(\u003cspan class=\"hljs-attr\"\u003etypeOrName\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eTypeOrTokenType\u003c/span\u003e\u0026lt;\u003cspan class=\"hljs-title class_\"\u003eTInput\u003c/span\u003e\u0026gt;): \u003cspan class=\"hljs-title class_\"\u003ePromise\u003c/span\u003e\u0026lt;\u003cspan class=\"hljs-title class_\"\u003eTInput\u003c/span\u003e\u0026gt; | \u003cspan class=\"hljs-title class_\"\u003eTInput\u003c/span\u003e | \u003cspan class=\"hljs-literal\"\u003eundefined\u003c/span\u003e;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e如果组件时异步组件，返回的 \u003ccode\u003ePromise\u0026lt;Input\u0026gt;\u003c/code\u003e，什么是异步组件？\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e异步工厂方法定义的组件。\u003c/li\u003e\n\u003cli\u003e组件的 initialize 方法返回的 promise。\u003c/li\u003e\n\u003cli\u003e组件的依赖中有异步组件。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e当我们确定组件是非异步组件，且不想中断当前执行流程的时候，可以强制使用同步方式获取组件值。例如在 React 的渲染过程中，我们会尽力采用同步方式使用组件，避免打断渲染流程，减少不必要的重复渲染。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eIApplicationContext\u003c/span\u003e {\n  \u003cspan class=\"hljs-comment\"\u003e/**\n   * 同步获取组件值，如果组件是异步组件，将会抛出异常。\n   *  \u003cspan class=\"hljs-doctag\"\u003e@param\u003c/span\u003e typeOrName 组件类型或名称\n   */\u003c/span\u003e\n  getSync\u0026lt;\u003cspan class=\"hljs-title class_\"\u003eTInput\u003c/span\u003e = \u003cspan class=\"hljs-built_in\"\u003eany\u003c/span\u003e\u0026gt;(\u003cspan class=\"hljs-attr\"\u003etypeOrName\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eTypeOrTokenType\u003c/span\u003e\u0026lt;\u003cspan class=\"hljs-title class_\"\u003eTInput\u003c/span\u003e\u0026gt;): \u003cspan class=\"hljs-title class_\"\u003eTInput\u003c/span\u003e;\n\n  \u003cspan class=\"hljs-comment\"\u003e/**\n   * 同步获取组件值，如果组件不存在，返回null，如果组件是异步组件，将会抛出异常。\n   * \u003cspan class=\"hljs-doctag\"\u003e@param\u003c/span\u003e typeOrName 组件类型或名称\n   */\u003c/span\u003e\n  getOptionalSync\u0026lt;\u003cspan class=\"hljs-title class_\"\u003eTInput\u003c/span\u003e = \u003cspan class=\"hljs-built_in\"\u003eany\u003c/span\u003e\u0026gt;(\u003cspan class=\"hljs-attr\"\u003etypeOrName\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eTypeOrTokenType\u003c/span\u003e\u0026lt;\u003cspan class=\"hljs-title class_\"\u003eTInput\u003c/span\u003e\u0026gt;): \u003cspan class=\"hljs-title class_\"\u003eTInput\u003c/span\u003e | \u003cspan class=\"hljs-literal\"\u003eundefined\u003c/span\u003e;\n}\n\u003c/code\u003e\u003c/pre\u003e\n","anchor":[{"type":"heading","raw":"## 基本属性\n\n","depth":2,"text":"基本属性","tokens":[{"type":"text","raw":"基本属性","text":"基本属性"}],"id":"#%E5%9F%BA%E6%9C%AC%E5%B1%9E%E6%80%A7","children":[{"type":"heading","raw":"#### name\n\n","depth":4,"text":"name","tokens":[{"type":"text","raw":"name","text":"name"}],"id":"#name"},{"type":"heading","raw":"#### package\n\n","depth":4,"text":"package","tokens":[{"type":"text","raw":"package","text":"package"}],"id":"#package"},{"type":"heading","raw":"#### global\n\n","depth":4,"text":"global","tokens":[{"type":"text","raw":"global","text":"global"}],"id":"#global"},{"type":"heading","raw":"#### scope\n\n","depth":4,"text":"scope","tokens":[{"type":"text","raw":"scope","text":"scope"}],"id":"#scope"},{"type":"heading","raw":"#### alias\n\n","depth":4,"text":"alias","tokens":[{"type":"text","raw":"alias","text":"alias"}],"id":"#alias"}]},{"type":"heading","raw":"## 类组件\n\n","depth":2,"text":"类组件","tokens":[{"type":"text","raw":"类组件","text":"类组件"}],"id":"#%E7%B1%BB%E7%BB%84%E4%BB%B6","children":[{"type":"heading","raw":"### 类组件装饰器 @Component\n\n","depth":3,"text":"类组件装饰器 @Component","tokens":[{"type":"text","raw":"类组件装饰器 @Component","text":"类组件装饰器 @Component"}],"id":"#%E7%B1%BB%E7%BB%84%E4%BB%B6%E8%A3%85%E9%A5%B0%E5%99%A8-component"},{"type":"heading","raw":"### 自定义类组件 useClass \n\n","depth":3,"text":"自定义类组件 useClass","tokens":[{"type":"text","raw":"自定义类组件 useClass","text":"自定义类组件 useClass"}],"id":"#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E7%BB%84%E4%BB%B6-useclass"},{"type":"heading","raw":"### 依赖声明和注入 @Inject()\n\n","depth":3,"text":"依赖声明和注入 @Inject()","tokens":[{"type":"text","raw":"依赖声明和注入 @Inject()","text":"依赖声明和注入 @Inject()"}],"id":"#%E4%BE%9D%E8%B5%96%E5%A3%B0%E6%98%8E%E5%92%8C%E6%B3%A8%E5%85%A5-inject()","children":[{"type":"heading","raw":"#### 构造方法依赖注入\n\n","depth":4,"text":"构造方法依赖注入","tokens":[{"type":"text","raw":"构造方法依赖注入","text":"构造方法依赖注入"}],"id":"#%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5"},{"type":"heading","raw":"#### 属性依赖注入\n\n","depth":4,"text":"属性依赖注入","tokens":[{"type":"text","raw":"属性依赖注入","text":"属性依赖注入"}],"id":"#%E5%B1%9E%E6%80%A7%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5"}]}]},{"type":"heading","raw":"## 值组件 useValue\n\n","depth":2,"text":"值组件 useValue","tokens":[{"type":"text","raw":"值组件 useValue","text":"值组件 useValue"}],"id":"#%E5%80%BC%E7%BB%84%E4%BB%B6-usevalue"},{"type":"heading","raw":"## 工厂组件 useFactory\n\n","depth":2,"text":"工厂组件 useFactory","tokens":[{"type":"text","raw":"工厂组件 useFactory","text":"工厂组件 useFactory"}],"id":"#%E5%B7%A5%E5%8E%82%E7%BB%84%E4%BB%B6-usefactory"},{"type":"heading","raw":"## 注册组件\n\n","depth":2,"text":"注册组件","tokens":[{"type":"text","raw":"注册组件","text":"注册组件"}],"id":"#%E6%B3%A8%E5%86%8C%E7%BB%84%E4%BB%B6"},{"type":"heading","raw":"## 获取组件值\n\n","depth":2,"text":"获取组件值","tokens":[{"type":"text","raw":"获取组件值","text":"获取组件值"}],"id":"#%E8%8E%B7%E5%8F%96%E7%BB%84%E4%BB%B6%E5%80%BC"}]},{"title":"配置类","path":"/joy/container/configuration","file":"docs\\joy\\05-container\\configuration.md","hasMenu":false,"mdContent":"# 配置类\r\n\r\n## @Configuration 装饰器\r\n\r\n配置类用于配置组件，可将一个模块的多个组件统一放在一个配置类里配置，而后只需注册配置类到容器。我们也可以使用继承等方式，扩展和定制配置类。\r\n\r\n使用 `@Configuration()` 装饰器，将一个类声明为配置类，在配置类的属性或方法上，使用 `Configuration.Component(options: ComponentOptions)` 声明一个组件，组件名称如果未设置，将默认采用属性名或方法名。\r\n参照比上面 [组件](#组件) 章节中的例子，下面我们看看如何使用配置类配置组件：\r\n\r\n```ts\r\nimport { Configuration, Scope } from \"@symph/core\";\r\nimport { ConfigService } from \"@symph/config\";\r\n\r\n@Configuration()\r\nclass PostConfiguration {\r\n  constructor(private configService: ConfigService) {}\r\n\r\n  // 使用工厂方法定义组件\r\n  @Configuration.Component({ scope: Scope.SINGLETON })\r\n  public databaseConnection(): DatabaseConnection {\r\n    const dbOptions = this.configService.get(\"dbOptions\");\r\n    return new DatabaseConnection(dbOptions);\r\n  }\r\n\r\n  // 快捷声明类组件\r\n  @Configuration.Component()\r\n  public postsService: PostsService;\r\n\r\n  @Configuration.Component()\r\n  public postsController: PostsController;\r\n}\r\n\r\n// 注册组件和启动应用。\r\nasync function startApp() {\r\n  const app = await ServerFactory.create(PostConfiguration);\r\n  await app.listen(3000);\r\n}\r\nstartApp();\r\n```\r\n\r\n配置类在容器中，其本身也是一个类组件，可以轻松的使用其它组件，例上例中，`PostConfiguration` 依赖 ` configService`组件来获取数据库连接配置。\r\n","htmlContent":"\n                \u003ch1 id=\"%E9%85%8D%E7%BD%AE%E7%B1%BB\"\u003e\n                  配置类\n                \u003c/h1\u003e\n                \u003ch2 id=\"configuration-%E8%A3%85%E9%A5%B0%E5%99%A8\"\u003e\n                  @Configuration 装饰器\n                \u003c/h2\u003e\u003cp\u003e配置类用于配置组件，可将一个模块的多个组件统一放在一个配置类里配置，而后只需注册配置类到容器。我们也可以使用继承等方式，扩展和定制配置类。\u003c/p\u003e\n\u003cp\u003e使用 \u003ccode\u003e@Configuration()\u003c/code\u003e 装饰器，将一个类声明为配置类，在配置类的属性或方法上，使用 \u003ccode\u003eConfiguration.Component(options: ComponentOptions)\u003c/code\u003e 声明一个组件，组件名称如果未设置，将默认采用属性名或方法名。\n参照比上面 \u003ca href=\"#%E7%BB%84%E4%BB%B6\"\u003e组件\u003c/a\u003e 章节中的例子，下面我们看看如何使用配置类配置组件：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eConfiguration\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eScope\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/core\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eConfigService\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/config\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-meta\"\u003e@Configuration\u003c/span\u003e()\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003ePostConfiguration\u003c/span\u003e {\n  \u003cspan class=\"hljs-title function_\"\u003econstructor\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e configService: ConfigService\u003c/span\u003e) {}\n\n  \u003cspan class=\"hljs-comment\"\u003e// 使用工厂方法定义组件\u003c/span\u003e\n  \u003cspan class=\"hljs-meta\"\u003e@Configuration\u003c/span\u003e.\u003cspan class=\"hljs-title class_\"\u003eComponent\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003escope\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eScope\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eSINGLETON\u003c/span\u003e })\n  \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003edatabaseConnection\u003c/span\u003e(): \u003cspan class=\"hljs-title class_\"\u003eDatabaseConnection\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e dbOptions = \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003econfigService\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;dbOptions\u0026quot;\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDatabaseConnection\u003c/span\u003e(dbOptions);\n  }\n\n  \u003cspan class=\"hljs-comment\"\u003e// 快捷声明类组件\u003c/span\u003e\n  \u003cspan class=\"hljs-meta\"\u003e@Configuration\u003c/span\u003e.\u003cspan class=\"hljs-title class_\"\u003eComponent\u003c/span\u003e()\n  \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003epostsService\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003ePostsService\u003c/span\u003e;\n\n  \u003cspan class=\"hljs-meta\"\u003e@Configuration\u003c/span\u003e.\u003cspan class=\"hljs-title class_\"\u003eComponent\u003c/span\u003e()\n  \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003epostsController\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003ePostsController\u003c/span\u003e;\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// 注册组件和启动应用。\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003estartApp\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e app = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eServerFactory\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ecreate\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003ePostConfiguration\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e app.\u003cspan class=\"hljs-title function_\"\u003elisten\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e);\n}\n\u003cspan class=\"hljs-title function_\"\u003estartApp\u003c/span\u003e();\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e配置类在容器中，其本身也是一个类组件，可以轻松的使用其它组件，例上例中，\u003ccode\u003ePostConfiguration\u003c/code\u003e 依赖 \u003ccode\u003e configService\u003c/code\u003e组件来获取数据库连接配置。\u003c/p\u003e\n","anchor":[{"type":"heading","raw":"## @Configuration 装饰器\n\n","depth":2,"text":"@Configuration 装饰器","tokens":[{"type":"text","raw":"@Configuration 装饰器","text":"@Configuration 装饰器"}],"id":"#configuration-%E8%A3%85%E9%A5%B0%E5%99%A8"}]}]},{"title":"配置管理","path":"/joy/06-config","file":"docs/joy/06-config","children":[{"title":"配置管理","path":"/joy/config/config-manager","file":"docs\\joy\\06-config\\config-manager.md","hasMenu":false,"mdContent":"# 配置管理\r\n\r\nJoy 遵循约定大于配置原则，参考最佳实践约定默认配置，0 配置也可启动应用，即新应用无需配置文件也可立即运行和发布。\r\n\r\n## 配置文件\r\n\r\nJoy 在`joy.config.ts`或者`config/config.ts`中配置项目，支持 ts、js、json、es6 文件格式。例如：\r\n\r\n```typescript\r\n// joy.config.ts\r\n\r\nexport default {\r\n  basePath: \"\",\r\n  apiPrefix: \"/api\",\r\n  ssr: true,\r\n};\r\n```\r\n\r\n如果项目的配置不复杂，推荐在 `joy.config.ts` 中写配置; 如果项目的配置比较复杂，可以将配置写在 config/config.ts 中，并把配置的一部分拆分出去，加载配置时会自动合并到主配置中，例如路由配置可以拆分成单独的 routes.ts：\r\n\r\n```typescript\r\n// config/routes.ts\r\n\r\nexport default [{ exact: true, path: \"/\", component: \"index\" }];\r\n```\r\n\r\n等同于：\r\n\r\n```typescript\r\n// joy.config.ts\r\n{\r\n  apiPrefix: \"/api\";\r\n  routes: [{ exact: true, path: \"/\", component: \"index\" }];\r\n}\r\n```\r\n\r\n## 多环境配置\r\n\r\n可以通过环境变量`NODE_ENV`或者`JOY_ENV`来区分不同环境配置，`JOY_ENV`的优先级更高。各环境配置文件，统一放在`/config`目录中，例如：`/config/config.beta.ts`、`/config/config.production.ts`。\r\n\r\n各配置的加载顺序：`.env` ➡ `joy.config.ts` ➡ `config/config.ts` ➡ `config/config.production.ts` ， 后加载的配置会覆盖之前的配置。\r\n\r\n## 本地临时配置\r\n\r\n可以新建 `config/config.local.ts`文件，例如该配置文件存在，则加载顺序为：\r\n`.env` ➡ `joy.config.ts` ➡ `config/config.ts` ➡ `config/config.development.ts` ➡ `config/config.local.ts` 。\r\n\r\n**注意：**\r\n\r\n- 该配置优先级最高，在最后加载该配置文件，且会覆盖之前读取的配置。\r\n- `config.local.ts` 是本地开发调试的临时配置，请将其添加到 `.gitignore`，**务必不要提交到 git 仓库中**\r\n\r\n## 环境变量配置\r\n\r\n### 执行命令时添加环境变量\r\n\r\n例如：\r\n\r\n```bash\r\n# OS X、 Linux\r\n$ port=3000 joy dev\r\n\r\n# Windows\r\n$ set port=3000\u0026\u0026joy dev\r\n```\r\n\r\n如果要同时考虑 OS X 和 Windows，可借助三方工具 cross-env。\r\n\r\n```bash\r\n$ yarn add cross-env --dev\r\n$ cross-env port=3000 umi dev\r\n```\r\n\r\n### .env 配置文件\r\n\r\nJoy 约定根目录下的`.env`为环境变量配置文件，该配置文件将在初始化配置时加载，其配置的值于 [执行命令时添加环境变量](#执行命令时添加环境变量)\r\n\r\n```typescript\r\n// .env\r\n\r\nport = 3000;\r\nhostname = \"localhost\";\r\n```\r\n\r\n## 应用内获取配置\r\n\r\n### 通过 ConfigService 服务获取\r\n\r\n`@symph/config`提供 `ConfigService`服务类，Joy 已内置该服务，通过其提供的`get\u003cT = any\u003e(configPath?:string, defaultValue?: T): T | undefined`方法获取配置值，方法参数：\r\n\r\n- configPath: 配置键值，支持 object path，获取配置值对象的内部值。\r\n- defaultValue: 默认值，如果配置不存在，则返回默认值。\r\n\r\n例如有以下配置内容：\r\n\r\n```typescript\r\n// joy.config.ts\r\nexport default {\r\n  database: {\r\n    type: \"mysql\",\r\n    host: \"localhost\",\r\n    port: 3306,\r\n  },\r\n};\r\n```\r\n\r\n在服务类中获取以上配置值：\r\n\r\n```typescript\r\nimport { ConfigService } from \"@symph/config\";\r\n\r\nimport { Component } from \"@symph/core\";\r\nimport { Value } from \"@symph/config\";\r\n\r\n@Component()\r\nexport class HelloService {\r\n  constructor(private configService: ConfigService) {\r\n    // 通过 configKey 获取 配置\r\n    const database = configService.get(\"database\");\r\n\r\n    // 如果配置值是一个对象，可以通过object path，获取获取对象内部属性的值\r\n    const host = configService.get\u003cstring\u003e(\"database.host\", \"localhost\");\r\n  }\r\n}\r\n```\r\n\r\n### @Value 装饰器方式获取\r\n\r\n在组件的属性上，通过`@Value(options)`装饰器申明需要自动注入配置，注入的属性键值默认为组件的属性名称，例如：\r\n\r\n```typescript\r\nimport { Component } from \"@symph/core\";\r\nimport { Value } from \"@symph/config\";\r\n\r\n@Component()\r\nexport class HelloService {\r\n  // 读取joy.config.ts中配置的msg的值。\r\n  @Value()\r\n  public msg: string;\r\n}\r\n```\r\n\r\n`@Value(options)` 定制参数列表：\r\n\r\n- **configKey** 类型`string`，默认等于被装饰的属性名称，指定注入是取的配置文件中的键值，由此属性名称和配置文件中的键值可以不相等。\r\n- **schema** 类型`json-schema`，自定义 [json-schema](https://json-schema.org/learn/getting-started-step-by-step) 定义属性规则，不推荐直接使用该属性，大部分情况下可使用`@tsed/schema`库提供的装饰器来申明校验规则，例如`@Max(3)`申明该配置的值不能大于 4，否则运行是抛出异常。\r\n\r\n[//]: # \"- **onChange** 类型`string`, 默认值`undefined`，设置当该值发生变化后，系统需如何处理，目前仅支持`reload`重新启动应用，或者为空不做任何操作。\"\r\n\r\n- **transform** 类型`(configValue: any) =\u003e any`, 注入值时被调用，入参为配置文件中的值，返回值为转换后的值，然后将转化后的值设置到属性上。\r\n\r\n\u003e `@Value()`声明的属性，也等于声明了一个配置项及其类型和验证规则，需要避免在不同地方声明相同的配置但又不兼容的类型，这种情况下，我们可以将声明移动到一个独立的配置类中，其它地方如果需要使用该配置，应该依赖和使用该类。\r\n\r\n#### 校验配置值\r\n\r\n使用`@tsed/schema`库提供的装饰器来申明校验规则。\r\n\r\n```typescript\r\nimport { Component } from \"@symph/core\";\r\nimport { Max, MaxLength, Required } from \"@tsed/schema\";\r\nimport { Value } from \"@symph/config\";\r\n\r\n@Component()\r\nexport class BasicConfig {\r\n  // 配置类型为number，且不能大于4，否则运行时抛出异常。\r\n  // 如果未配置，默认为 2\r\n  @Value({ default: 2 })\r\n  @Max(4)\r\n  public workers: number;\r\n\r\n  // 必须配置，且长度不能大于64.\r\n  @Value()\r\n  @MaxLength(64)\r\n  @Required()\r\n  public msg: string;\r\n\r\n  // 配置是一个负责对象数组，类型和验证规则声明在对象的类上。\r\n  @Value()\r\n  public routes: ReactRoute[];\r\n}\r\n\r\nclass ReactRoute {\r\n  @Required()\r\n  public path: string;\r\n\r\n  public extract: boolean;\r\n}\r\n```\r\n","htmlContent":"\n                \u003ch1 id=\"%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86\"\u003e\n                  配置管理\n                \u003c/h1\u003e\u003cp\u003eJoy 遵循约定大于配置原则，参考最佳实践约定默认配置，0 配置也可启动应用，即新应用无需配置文件也可立即运行和发布。\u003c/p\u003e\n\n                \u003ch2 id=\"%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6\"\u003e\n                  配置文件\n                \u003c/h2\u003e\u003cp\u003eJoy 在\u003ccode\u003ejoy.config.ts\u003c/code\u003e或者\u003ccode\u003econfig/config.ts\u003c/code\u003e中配置项目，支持 ts、js、json、es6 文件格式。例如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// joy.config.ts\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e {\n  \u003cspan class=\"hljs-attr\"\u003ebasePath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003eapiPrefix\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;/api\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003essr\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e如果项目的配置不复杂，推荐在 \u003ccode\u003ejoy.config.ts\u003c/code\u003e 中写配置; 如果项目的配置比较复杂，可以将配置写在 config/config.ts 中，并把配置的一部分拆分出去，加载配置时会自动合并到主配置中，例如路由配置可以拆分成单独的 routes.ts：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// config/routes.ts\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e [{ \u003cspan class=\"hljs-attr\"\u003eexact\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;/\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003ecomponent\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;index\u0026quot;\u003c/span\u003e }];\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e等同于：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// joy.config.ts\u003c/span\u003e\n{\n  \u003cspan class=\"hljs-attr\"\u003eapiPrefix\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;/api\u0026quot;\u003c/span\u003e;\n  \u003cspan class=\"hljs-attr\"\u003eroutes\u003c/span\u003e: [{ \u003cspan class=\"hljs-attr\"\u003eexact\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;/\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003ecomponent\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;index\u0026quot;\u003c/span\u003e }];\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch2 id=\"%E5%A4%9A%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE\"\u003e\n                  多环境配置\n                \u003c/h2\u003e\u003cp\u003e可以通过环境变量\u003ccode\u003eNODE_ENV\u003c/code\u003e或者\u003ccode\u003eJOY_ENV\u003c/code\u003e来区分不同环境配置，\u003ccode\u003eJOY_ENV\u003c/code\u003e的优先级更高。各环境配置文件，统一放在\u003ccode\u003e/config\u003c/code\u003e目录中，例如：\u003ccode\u003e/config/config.beta.ts\u003c/code\u003e、\u003ccode\u003e/config/config.production.ts\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e各配置的加载顺序：\u003ccode\u003e.env\u003c/code\u003e ➡ \u003ccode\u003ejoy.config.ts\u003c/code\u003e ➡ \u003ccode\u003econfig/config.ts\u003c/code\u003e ➡ \u003ccode\u003econfig/config.production.ts\u003c/code\u003e ， 后加载的配置会覆盖之前的配置。\u003c/p\u003e\n\n                \u003ch2 id=\"%E6%9C%AC%E5%9C%B0%E4%B8%B4%E6%97%B6%E9%85%8D%E7%BD%AE\"\u003e\n                  本地临时配置\n                \u003c/h2\u003e\u003cp\u003e可以新建 \u003ccode\u003econfig/config.local.ts\u003c/code\u003e文件，例如该配置文件存在，则加载顺序为：\n\u003ccode\u003e.env\u003c/code\u003e ➡ \u003ccode\u003ejoy.config.ts\u003c/code\u003e ➡ \u003ccode\u003econfig/config.ts\u003c/code\u003e ➡ \u003ccode\u003econfig/config.development.ts\u003c/code\u003e ➡ \u003ccode\u003econfig/config.local.ts\u003c/code\u003e 。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e注意：\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e该配置优先级最高，在最后加载该配置文件，且会覆盖之前读取的配置。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003econfig.local.ts\u003c/code\u003e 是本地开发调试的临时配置，请将其添加到 \u003ccode\u003e.gitignore\u003c/code\u003e，\u003cstrong\u003e务必不要提交到 git 仓库中\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch2 id=\"%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE\"\u003e\n                  环境变量配置\n                \u003c/h2\u003e\n                \u003ch3 id=\"%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%E6%97%B6%E6%B7%BB%E5%8A%A0%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F\"\u003e\n                  执行命令时添加环境变量\n                \u003c/h3\u003e\u003cp\u003e例如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-comment\"\u003e# OS X、 Linux\u003c/span\u003e\n$ port=3000 joy dev\n\n\u003cspan class=\"hljs-comment\"\u003e# Windows\u003c/span\u003e\n$ \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e port=3000\u0026amp;\u0026amp;joy dev\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e如果要同时考虑 OS X 和 Windows，可借助三方工具 cross-env。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e$ yarn add cross-env --dev\n$ cross-env port=3000 umi dev\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch3 id=\"env-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6\"\u003e\n                  .env 配置文件\n                \u003c/h3\u003e\u003cp\u003eJoy 约定根目录下的\u003ccode\u003e.env\u003c/code\u003e为环境变量配置文件，该配置文件将在初始化配置时加载，其配置的值于 \u003ca href=\"#%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%E6%97%B6%E6%B7%BB%E5%8A%A0%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F\"\u003e执行命令时添加环境变量\u003c/a\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// .env\u003c/span\u003e\n\nport = \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e;\nhostname = \u003cspan class=\"hljs-string\"\u003e\u0026quot;localhost\u0026quot;\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch2 id=\"%E5%BA%94%E7%94%A8%E5%86%85%E8%8E%B7%E5%8F%96%E9%85%8D%E7%BD%AE\"\u003e\n                  应用内获取配置\n                \u003c/h2\u003e\n                \u003ch3 id=\"%E9%80%9A%E8%BF%87-configservice-%E6%9C%8D%E5%8A%A1%E8%8E%B7%E5%8F%96\"\u003e\n                  通过 ConfigService 服务获取\n                \u003c/h3\u003e\u003cp\u003e\u003ccode\u003e@symph/config\u003c/code\u003e提供 \u003ccode\u003eConfigService\u003c/code\u003e服务类，Joy 已内置该服务，通过其提供的\u003ccode\u003eget\u0026lt;T = any\u0026gt;(configPath?:string, defaultValue?: T): T | undefined\u003c/code\u003e方法获取配置值，方法参数：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003econfigPath: 配置键值，支持 object path，获取配置值对象的内部值。\u003c/li\u003e\n\u003cli\u003edefaultValue: 默认值，如果配置不存在，则返回默认值。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e例如有以下配置内容：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// joy.config.ts\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e {\n  \u003cspan class=\"hljs-attr\"\u003edatabase\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;mysql\u0026quot;\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003ehost\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;localhost\u0026quot;\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003eport\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e3306\u003c/span\u003e,\n  },\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e在服务类中获取以上配置值：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eConfigService\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/config\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eComponent\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/core\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eValue\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/config\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-meta\"\u003e@Component\u003c/span\u003e()\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eHelloService\u003c/span\u003e {\n  \u003cspan class=\"hljs-title function_\"\u003econstructor\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e configService: ConfigService\u003c/span\u003e) {\n    \u003cspan class=\"hljs-comment\"\u003e// 通过 configKey 获取 配置\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e database = configService.\u003cspan class=\"hljs-title function_\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;database\u0026quot;\u003c/span\u003e);\n\n    \u003cspan class=\"hljs-comment\"\u003e// 如果配置值是一个对象，可以通过object path，获取获取对象内部属性的值\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e host = configService.\u003cspan class=\"hljs-property\"\u003eget\u003c/span\u003e\u0026lt;\u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e\u0026gt;(\u003cspan class=\"hljs-string\"\u003e\u0026quot;database.host\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;localhost\u0026quot;\u003c/span\u003e);\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch3 id=\"value-%E8%A3%85%E9%A5%B0%E5%99%A8%E6%96%B9%E5%BC%8F%E8%8E%B7%E5%8F%96\"\u003e\n                  @Value 装饰器方式获取\n                \u003c/h3\u003e\u003cp\u003e在组件的属性上，通过\u003ccode\u003e@Value(options)\u003c/code\u003e装饰器申明需要自动注入配置，注入的属性键值默认为组件的属性名称，例如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eComponent\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/core\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eValue\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/config\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-meta\"\u003e@Component\u003c/span\u003e()\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eHelloService\u003c/span\u003e {\n  \u003cspan class=\"hljs-comment\"\u003e// 读取joy.config.ts中配置的msg的值。\u003c/span\u003e\n  \u003cspan class=\"hljs-meta\"\u003e@Value\u003c/span\u003e()\n  \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003emsg\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003e@Value(options)\u003c/code\u003e 定制参数列表：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003econfigKey\u003c/strong\u003e 类型\u003ccode\u003estring\u003c/code\u003e，默认等于被装饰的属性名称，指定注入是取的配置文件中的键值，由此属性名称和配置文件中的键值可以不相等。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eschema\u003c/strong\u003e 类型\u003ccode\u003ejson-schema\u003c/code\u003e，自定义 \u003ca href=\"https://json-schema.org/learn/getting-started-step-by-step\"\u003ejson-schema\u003c/a\u003e 定义属性规则，不推荐直接使用该属性，大部分情况下可使用\u003ccode\u003e@tsed/schema\u003c/code\u003e库提供的装饰器来申明校验规则，例如\u003ccode\u003e@Max(3)\u003c/code\u003e申明该配置的值不能大于 4，否则运行是抛出异常。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003etransform\u003c/strong\u003e 类型\u003ccode\u003e(configValue: any) =\u0026gt; any\u003c/code\u003e, 注入值时被调用，入参为配置文件中的值，返回值为转换后的值，然后将转化后的值设置到属性上。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ccode\u003e@Value()\u003c/code\u003e声明的属性，也等于声明了一个配置项及其类型和验证规则，需要避免在不同地方声明相同的配置但又不兼容的类型，这种情况下，我们可以将声明移动到一个独立的配置类中，其它地方如果需要使用该配置，应该依赖和使用该类。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n                \u003ch4 id=\"%E6%A0%A1%E9%AA%8C%E9%85%8D%E7%BD%AE%E5%80%BC\"\u003e\n                  校验配置值\n                \u003c/h4\u003e\u003cp\u003e使用\u003ccode\u003e@tsed/schema\u003c/code\u003e库提供的装饰器来申明校验规则。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eComponent\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/core\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eMax\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eMaxLength\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eRequired\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@tsed/schema\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eValue\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/config\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-meta\"\u003e@Component\u003c/span\u003e()\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eBasicConfig\u003c/span\u003e {\n  \u003cspan class=\"hljs-comment\"\u003e// 配置类型为number，且不能大于4，否则运行时抛出异常。\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// 如果未配置，默认为 2\u003c/span\u003e\n  \u003cspan class=\"hljs-meta\"\u003e@Value\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003edefault\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e })\n  \u003cspan class=\"hljs-meta\"\u003e@Max\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e)\n  \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eworkers\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003enumber\u003c/span\u003e;\n\n  \u003cspan class=\"hljs-comment\"\u003e// 必须配置，且长度不能大于64.\u003c/span\u003e\n  \u003cspan class=\"hljs-meta\"\u003e@Value\u003c/span\u003e()\n  \u003cspan class=\"hljs-meta\"\u003e@MaxLength\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e64\u003c/span\u003e)\n  \u003cspan class=\"hljs-meta\"\u003e@Required\u003c/span\u003e()\n  \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003emsg\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e;\n\n  \u003cspan class=\"hljs-comment\"\u003e// 配置是一个负责对象数组，类型和验证规则声明在对象的类上。\u003c/span\u003e\n  \u003cspan class=\"hljs-meta\"\u003e@Value\u003c/span\u003e()\n  \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eroutes\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eReactRoute\u003c/span\u003e[];\n}\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eReactRoute\u003c/span\u003e {\n  \u003cspan class=\"hljs-meta\"\u003e@Required\u003c/span\u003e()\n  \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e;\n\n  \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eextract\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003eboolean\u003c/span\u003e;\n}\n\u003c/code\u003e\u003c/pre\u003e\n","anchor":[{"type":"heading","raw":"## 配置文件\n\n","depth":2,"text":"配置文件","tokens":[{"type":"text","raw":"配置文件","text":"配置文件"}],"id":"#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"},{"type":"heading","raw":"## 多环境配置\n\n","depth":2,"text":"多环境配置","tokens":[{"type":"text","raw":"多环境配置","text":"多环境配置"}],"id":"#%E5%A4%9A%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"},{"type":"heading","raw":"## 本地临时配置\n\n","depth":2,"text":"本地临时配置","tokens":[{"type":"text","raw":"本地临时配置","text":"本地临时配置"}],"id":"#%E6%9C%AC%E5%9C%B0%E4%B8%B4%E6%97%B6%E9%85%8D%E7%BD%AE"},{"type":"heading","raw":"## 环境变量配置\n\n","depth":2,"text":"环境变量配置","tokens":[{"type":"text","raw":"环境变量配置","text":"环境变量配置"}],"id":"#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE","children":[{"type":"heading","raw":"### 执行命令时添加环境变量\n\n","depth":3,"text":"执行命令时添加环境变量","tokens":[{"type":"text","raw":"执行命令时添加环境变量","text":"执行命令时添加环境变量"}],"id":"#%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%E6%97%B6%E6%B7%BB%E5%8A%A0%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"},{"type":"heading","raw":"### .env 配置文件\n\n","depth":3,"text":".env 配置文件","tokens":[{"type":"text","raw":".env 配置文件","text":".env 配置文件"}],"id":"#env-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"}]},{"type":"heading","raw":"## 应用内获取配置\n\n","depth":2,"text":"应用内获取配置","tokens":[{"type":"text","raw":"应用内获取配置","text":"应用内获取配置"}],"id":"#%E5%BA%94%E7%94%A8%E5%86%85%E8%8E%B7%E5%8F%96%E9%85%8D%E7%BD%AE","children":[{"type":"heading","raw":"### 通过 ConfigService 服务获取\n\n","depth":3,"text":"通过 ConfigService 服务获取","tokens":[{"type":"text","raw":"通过 ConfigService 服务获取","text":"通过 ConfigService 服务获取"}],"id":"#%E9%80%9A%E8%BF%87-configservice-%E6%9C%8D%E5%8A%A1%E8%8E%B7%E5%8F%96"},{"type":"heading","raw":"### @Value 装饰器方式获取\n\n","depth":3,"text":"@Value 装饰器方式获取","tokens":[{"type":"text","raw":"@Value 装饰器方式获取","text":"@Value 装饰器方式获取"}],"id":"#value-%E8%A3%85%E9%A5%B0%E5%99%A8%E6%96%B9%E5%BC%8F%E8%8E%B7%E5%8F%96","children":[{"type":"heading","raw":"#### 校验配置值\n\n","depth":4,"text":"校验配置值","tokens":[{"type":"text","raw":"校验配置值","text":"校验配置值"}],"id":"#%E6%A0%A1%E9%AA%8C%E9%85%8D%E7%BD%AE%E5%80%BC"}]}]}]},{"title":"Joy 应用配置","path":"/joy/config/joy-config","file":"docs\\joy\\06-config\\joy-config.md","hasMenu":false,"mdContent":"# Joy 应用配置\r\n\r\n## basePath\r\n\r\n类型：`string` 默认值：`\"\"`\r\n\r\n发布 Joy 应用到子路径下时，使用`basePath`设置子路径名称。 例如我们开发了一个文档应用，现将它发布到`/docs`子路径下，例如`www.mydomian.com/docs`。\r\n\r\n```typescript\r\n// config/config.production.ts\r\n// 只配置 production 环境\r\nexport default {\r\n  basePath: \"/docs\",\r\n};\r\n```\r\n\r\n\u003e 注意：该配置值在构建编译时设置，会打包到客户端的运行包中，如果修改该值，需要重新编译。\r\n\r\n## assetPrefix\r\n\r\n类型：string，默认:`\"\"`\r\n\r\n在浏览器上运行时，加载应用资源的路径前缀。一般是在生产环境，将打包好的静态资源部署到不同的服务器（CDN，静态文件服务器）上时配置该值，而开发调试环境无需配置。 例如图片默认路径是`${basePath}/static/logo.png`，假如我们将资源部署到 CDN 上，图片的加载路径变为 CDN 的地址`https://cdn.mydomain.com/myapp/static/logo.png` ,此时我们更改`assetPrefix`为 CDN 的地址：\r\n\r\n```typescript\r\n// config/config.production.ts\r\n\r\nexport default {\r\n  assetPrefix: \"https://cdn.mydomain.com/myapp\",\r\n};\r\n```\r\n\r\n## distDir\r\n\r\n类型：`string`，默认: `\".joy\"`\r\n\r\n编译阶段输出的临时目录，你也可以设置自定义的目录名称。\r\n","htmlContent":"\n                \u003ch1 id=\"joy-%E5%BA%94%E7%94%A8%E9%85%8D%E7%BD%AE\"\u003e\n                  Joy 应用配置\n                \u003c/h1\u003e\n                \u003ch2 id=\"basepath\"\u003e\n                  basePath\n                \u003c/h2\u003e\u003cp\u003e类型：\u003ccode\u003estring\u003c/code\u003e 默认值：\u003ccode\u003e\u0026quot;\u0026quot;\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e发布 Joy 应用到子路径下时，使用\u003ccode\u003ebasePath\u003c/code\u003e设置子路径名称。 例如我们开发了一个文档应用，现将它发布到\u003ccode\u003e/docs\u003c/code\u003e子路径下，例如\u003ccode\u003ewww.mydomian.com/docs\u003c/code\u003e。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// config/config.production.ts\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// 只配置 production 环境\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e {\n  \u003cspan class=\"hljs-attr\"\u003ebasePath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;/docs\u0026quot;\u003c/span\u003e,\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cblockquote\u003e\n\u003cp\u003e注意：该配置值在构建编译时设置，会打包到客户端的运行包中，如果修改该值，需要重新编译。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n                \u003ch2 id=\"assetprefix\"\u003e\n                  assetPrefix\n                \u003c/h2\u003e\u003cp\u003e类型：string，默认:\u003ccode\u003e\u0026quot;\u0026quot;\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e在浏览器上运行时，加载应用资源的路径前缀。一般是在生产环境，将打包好的静态资源部署到不同的服务器（CDN，静态文件服务器）上时配置该值，而开发调试环境无需配置。 例如图片默认路径是\u003ccode\u003e${basePath}/static/logo.png\u003c/code\u003e，假如我们将资源部署到 CDN 上，图片的加载路径变为 CDN 的地址\u003ccode\u003ehttps://cdn.mydomain.com/myapp/static/logo.png\u003c/code\u003e ,此时我们更改\u003ccode\u003eassetPrefix\u003c/code\u003e为 CDN 的地址：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// config/config.production.ts\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e {\n  \u003cspan class=\"hljs-attr\"\u003eassetPrefix\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;https://cdn.mydomain.com/myapp\u0026quot;\u003c/span\u003e,\n};\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch2 id=\"distdir\"\u003e\n                  distDir\n                \u003c/h2\u003e\u003cp\u003e类型：\u003ccode\u003estring\u003c/code\u003e，默认: \u003ccode\u003e\u0026quot;.joy\u0026quot;\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e编译阶段输出的临时目录，你也可以设置自定义的目录名称。\u003c/p\u003e\n","anchor":[{"type":"heading","raw":"## basePath\n\n","depth":2,"text":"basePath","tokens":[{"type":"text","raw":"basePath","text":"basePath"}],"id":"#basepath"},{"type":"heading","raw":"## assetPrefix\n\n","depth":2,"text":"assetPrefix","tokens":[{"type":"text","raw":"assetPrefix","text":"assetPrefix"}],"id":"#assetprefix"},{"type":"heading","raw":"## distDir\n\n","depth":2,"text":"distDir","tokens":[{"type":"text","raw":"distDir","text":"distDir"}],"id":"#distdir"}]}]}],"defaultOpenKeys":["/joy/01-start","/joy/02-react","/joy/03-server","/joy/04-advanced-use","/joy/05-container","/joy/06-config"]}},{"type":"reactAppInitManager/__SET_STATE","state":{"/joy":{"pathname":"/joy","index":false,"initStatic":2}}}]},{"pathname":"/joy/react/dir-tree","ssgData":[{"type":"docsModel/__SET_STATE","state":{"loadingCurrentDoc":true}},{"type":"docsModel/__SET_STATE","state":{"loadingCurrentDoc":true}},{"type":"docsModel/__SET_STATE","state":{"loadCurrentDocErr":null,"currentDoc":{"title":"目录结构","path":"/joy/react/dir-tree","file":"docs\\joy\\02-react\\02-dir-tree.md","hasMenu":false,"mdContent":"# 目录结构\r\n\r\n## 约定目录结构\r\n\r\nJoy 支持 React 和 Node 以及两者的混合应用，下面列举各种应用类型常用的约定目录结构。\r\n\r\n### React 应用\r\n\r\n```text\r\nmyapp\r\n    src             // 源代码目录\r\n        pages       // React文件约定路由目录\r\n        models      // ReactModel目录\r\n        components  // React组件目录\r\n        server      // 可选，server端目录\r\n    config          // 配置目录\r\n        config.ts   // 配置文件\r\n    public          // 静态文件目录\r\n        logo.png    // 静态图片文件\r\n    package.json\r\n```\r\n\r\n### 前后端混合应用\r\n\r\n```text\r\nmyapp\r\n    src                 // 源代码目录\r\n        common:         // 前后端共享的代码，如类接口定义，通用处理方法等。\r\n        server          // 服务端代码\r\n            controllers\r\n            services\r\n        client          // 可选，客户端目录\r\n            pages       // 约定React路由目录\r\n            models      // ReactModel目录\r\n            components  // React组件目录\r\n    config              // 配置目录\r\n        config.ts       // 配置文件\r\n    public              // 静态文件目录\r\n        logo.png        // 静态图片文件\r\n    package.json\r\n```\r\n\r\n## 目录说明\r\n\r\n### src 目录\r\n\r\n源代码目录。\r\n\r\n### server 目录\r\n\r\n服务端相关代码，如果不需要服务端提供后端服务，可以没有该目录。\r\n\r\n### client 目录\r\n\r\nReact 客户端应用相关的代码，该目录可选：\r\n\r\n- `client`这级目录可以省略，直接在`src`下创建 React 的源代码文件，例如`src/pages/index.tsx`。\r\n- 如果应用只提供 Api 服务，不需要前端 React 界面，可以没有该目录。\r\n\r\n#### client/pages 或者 pages 目录\r\n\r\nReact 约定文件路由目录，具体使用方法，请查看 [路由](/joy/basic/joy-fs-router) 章节。\r\n\r\n### config 目录\r\n\r\n存放应用配置文件， 请转到 [配置管理](/joy/config/config-manage) 查看如何配置应用。\r\n\r\n### .env\r\n\r\n[dotenv](https://github.com/motdotla/dotenv) 环境变量配置文件。\r\n例如：\r\n\r\n```text\r\nport=8888\r\nhost=localhost\r\n```\r\n\r\n### public 目录\r\n\r\n存放静态资源文件，可直接通过 http 直接访问，例如文件 `/myapp/public/logo.png` 可通过 `http://localhost:3000/logo.png`访问。\r\n\r\n### .joy 目录\r\n\r\n`.joy` 目录是在运行时自动生成的目录，是 Joy 应用必须的，可以随时删除，在下次运行时重新生成该目录。\r\n日常开发时，我们不用去关注和修改里面的文件。\r\n里面主要包含的文件有：\r\n\r\n- 用于代码扫描分析的临时文件，以及分析后的产出物。\r\n- webpack 构建的缓存、日志物。\r\n- Joy 应用运行加载的源文件，这些文件是编译打包后的源文件。\r\n\r\n### out 目录\r\n\r\n运行`joy export` 命令的默认输出目录，存放 React 导出后的静态文件，部署该目录到静态文件服务器即可，例如 Nginx 。\r\n","htmlContent":"\n                \u003ch1 id=\"%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84\"\u003e\n                  目录结构\n                \u003c/h1\u003e\n                \u003ch2 id=\"%E7%BA%A6%E5%AE%9A%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84\"\u003e\n                  约定目录结构\n                \u003c/h2\u003e\u003cp\u003eJoy 支持 React 和 Node 以及两者的混合应用，下面列举各种应用类型常用的约定目录结构。\u003c/p\u003e\n\n                \u003ch3 id=\"react-%E5%BA%94%E7%94%A8\"\u003e\n                  React 应用\n                \u003c/h3\u003e\u003cpre\u003e\u003ccode class=\"hljs language-text\"\u003emyapp\n    src             // 源代码目录\n        pages       // React文件约定路由目录\n        models      // ReactModel目录\n        components  // React组件目录\n        server      // 可选，server端目录\n    config          // 配置目录\n        config.ts   // 配置文件\n    public          // 静态文件目录\n        logo.png    // 静态图片文件\n    package.json\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch3 id=\"%E5%89%8D%E5%90%8E%E7%AB%AF%E6%B7%B7%E5%90%88%E5%BA%94%E7%94%A8\"\u003e\n                  前后端混合应用\n                \u003c/h3\u003e\u003cpre\u003e\u003ccode class=\"hljs language-text\"\u003emyapp\n    src                 // 源代码目录\n        common:         // 前后端共享的代码，如类接口定义，通用处理方法等。\n        server          // 服务端代码\n            controllers\n            services\n        client          // 可选，客户端目录\n            pages       // 约定React路由目录\n            models      // ReactModel目录\n            components  // React组件目录\n    config              // 配置目录\n        config.ts       // 配置文件\n    public              // 静态文件目录\n        logo.png        // 静态图片文件\n    package.json\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch2 id=\"%E7%9B%AE%E5%BD%95%E8%AF%B4%E6%98%8E\"\u003e\n                  目录说明\n                \u003c/h2\u003e\n                \u003ch3 id=\"src-%E7%9B%AE%E5%BD%95\"\u003e\n                  src 目录\n                \u003c/h3\u003e\u003cp\u003e源代码目录。\u003c/p\u003e\n\n                \u003ch3 id=\"server-%E7%9B%AE%E5%BD%95\"\u003e\n                  server 目录\n                \u003c/h3\u003e\u003cp\u003e服务端相关代码，如果不需要服务端提供后端服务，可以没有该目录。\u003c/p\u003e\n\n                \u003ch3 id=\"client-%E7%9B%AE%E5%BD%95\"\u003e\n                  client 目录\n                \u003c/h3\u003e\u003cp\u003eReact 客户端应用相关的代码，该目录可选：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eclient\u003c/code\u003e这级目录可以省略，直接在\u003ccode\u003esrc\u003c/code\u003e下创建 React 的源代码文件，例如\u003ccode\u003esrc/pages/index.tsx\u003c/code\u003e。\u003c/li\u003e\n\u003cli\u003e如果应用只提供 Api 服务，不需要前端 React 界面，可以没有该目录。\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch4 id=\"clientpages-%E6%88%96%E8%80%85-pages-%E7%9B%AE%E5%BD%95\"\u003e\n                  client/pages 或者 pages 目录\n                \u003c/h4\u003e\u003cp\u003eReact 约定文件路由目录，具体使用方法，请查看 \u003ca href=\"/joy/basic/joy-fs-router\"\u003e路由\u003c/a\u003e 章节。\u003c/p\u003e\n\n                \u003ch3 id=\"config-%E7%9B%AE%E5%BD%95\"\u003e\n                  config 目录\n                \u003c/h3\u003e\u003cp\u003e存放应用配置文件， 请转到 \u003ca href=\"/joy/config/config-manage\"\u003e配置管理\u003c/a\u003e 查看如何配置应用。\u003c/p\u003e\n\n                \u003ch3 id=\"env\"\u003e\n                  .env\n                \u003c/h3\u003e\u003cp\u003e\u003ca href=\"https://github.com/motdotla/dotenv\"\u003edotenv\u003c/a\u003e 环境变量配置文件。\n例如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-text\"\u003eport=8888\nhost=localhost\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch3 id=\"public-%E7%9B%AE%E5%BD%95\"\u003e\n                  public 目录\n                \u003c/h3\u003e\u003cp\u003e存放静态资源文件，可直接通过 http 直接访问，例如文件 \u003ccode\u003e/myapp/public/logo.png\u003c/code\u003e 可通过 \u003ccode\u003ehttp://localhost:3000/logo.png\u003c/code\u003e访问。\u003c/p\u003e\n\n                \u003ch3 id=\"joy-%E7%9B%AE%E5%BD%95\"\u003e\n                  .joy 目录\n                \u003c/h3\u003e\u003cp\u003e\u003ccode\u003e.joy\u003c/code\u003e 目录是在运行时自动生成的目录，是 Joy 应用必须的，可以随时删除，在下次运行时重新生成该目录。\n日常开发时，我们不用去关注和修改里面的文件。\n里面主要包含的文件有：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e用于代码扫描分析的临时文件，以及分析后的产出物。\u003c/li\u003e\n\u003cli\u003ewebpack 构建的缓存、日志物。\u003c/li\u003e\n\u003cli\u003eJoy 应用运行加载的源文件，这些文件是编译打包后的源文件。\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch3 id=\"out-%E7%9B%AE%E5%BD%95\"\u003e\n                  out 目录\n                \u003c/h3\u003e\u003cp\u003e运行\u003ccode\u003ejoy export\u003c/code\u003e 命令的默认输出目录，存放 React 导出后的静态文件，部署该目录到静态文件服务器即可，例如 Nginx 。\u003c/p\u003e\n","anchor":[{"type":"heading","raw":"## 约定目录结构\n\n","depth":2,"text":"约定目录结构","tokens":[{"type":"text","raw":"约定目录结构","text":"约定目录结构"}],"id":"#%E7%BA%A6%E5%AE%9A%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84","children":[{"type":"heading","raw":"### React 应用\n\n","depth":3,"text":"React 应用","tokens":[{"type":"text","raw":"React 应用","text":"React 应用"}],"id":"#react-%E5%BA%94%E7%94%A8"},{"type":"heading","raw":"### 前后端混合应用\n\n","depth":3,"text":"前后端混合应用","tokens":[{"type":"text","raw":"前后端混合应用","text":"前后端混合应用"}],"id":"#%E5%89%8D%E5%90%8E%E7%AB%AF%E6%B7%B7%E5%90%88%E5%BA%94%E7%94%A8"}]},{"type":"heading","raw":"## 目录说明\n\n","depth":2,"text":"目录说明","tokens":[{"type":"text","raw":"目录说明","text":"目录说明"}],"id":"#%E7%9B%AE%E5%BD%95%E8%AF%B4%E6%98%8E","children":[{"type":"heading","raw":"### src 目录\n\n","depth":3,"text":"src 目录","tokens":[{"type":"text","raw":"src 目录","text":"src 目录"}],"id":"#src-%E7%9B%AE%E5%BD%95"},{"type":"heading","raw":"### server 目录\n\n","depth":3,"text":"server 目录","tokens":[{"type":"text","raw":"server 目录","text":"server 目录"}],"id":"#server-%E7%9B%AE%E5%BD%95"},{"type":"heading","raw":"### client 目录\n\n","depth":3,"text":"client 目录","tokens":[{"type":"text","raw":"client 目录","text":"client 目录"}],"id":"#client-%E7%9B%AE%E5%BD%95","children":[{"type":"heading","raw":"#### client/pages 或者 pages 目录\n\n","depth":4,"text":"client/pages 或者 pages 目录","tokens":[{"type":"text","raw":"client/pages 或者 pages 目录","text":"client/pages 或者 pages 目录"}],"id":"#clientpages-%E6%88%96%E8%80%85-pages-%E7%9B%AE%E5%BD%95"}]},{"type":"heading","raw":"### config 目录\n\n","depth":3,"text":"config 目录","tokens":[{"type":"text","raw":"config 目录","text":"config 目录"}],"id":"#config-%E7%9B%AE%E5%BD%95"},{"type":"heading","raw":"### .env\n\n","depth":3,"text":".env","tokens":[{"type":"text","raw":".env","text":".env"}],"id":"#env"},{"type":"heading","raw":"### public 目录\n\n","depth":3,"text":"public 目录","tokens":[{"type":"text","raw":"public 目录","text":"public 目录"}],"id":"#public-%E7%9B%AE%E5%BD%95"},{"type":"heading","raw":"### .joy 目录\n\n","depth":3,"text":".joy 目录","tokens":[{"type":"text","raw":".joy 目录","text":".joy 目录"}],"id":"#joy-%E7%9B%AE%E5%BD%95"},{"type":"heading","raw":"### out 目录\n\n","depth":3,"text":"out 目录","tokens":[{"type":"text","raw":"out 目录","text":"out 目录"}],"id":"#out-%E7%9B%AE%E5%BD%95"}]}]},"titleTrees":[{"type":"heading","raw":"## 约定目录结构\n\n","depth":2,"text":"约定目录结构","tokens":[{"type":"text","raw":"约定目录结构","text":"约定目录结构"}],"id":"#%E7%BA%A6%E5%AE%9A%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84","children":[{"type":"heading","raw":"### React 应用\n\n","depth":3,"text":"React 应用","tokens":[{"type":"text","raw":"React 应用","text":"React 应用"}],"id":"#react-%E5%BA%94%E7%94%A8"},{"type":"heading","raw":"### 前后端混合应用\n\n","depth":3,"text":"前后端混合应用","tokens":[{"type":"text","raw":"前后端混合应用","text":"前后端混合应用"}],"id":"#%E5%89%8D%E5%90%8E%E7%AB%AF%E6%B7%B7%E5%90%88%E5%BA%94%E7%94%A8"}]},{"type":"heading","raw":"## 目录说明\n\n","depth":2,"text":"目录说明","tokens":[{"type":"text","raw":"目录说明","text":"目录说明"}],"id":"#%E7%9B%AE%E5%BD%95%E8%AF%B4%E6%98%8E","children":[{"type":"heading","raw":"### src 目录\n\n","depth":3,"text":"src 目录","tokens":[{"type":"text","raw":"src 目录","text":"src 目录"}],"id":"#src-%E7%9B%AE%E5%BD%95"},{"type":"heading","raw":"### server 目录\n\n","depth":3,"text":"server 目录","tokens":[{"type":"text","raw":"server 目录","text":"server 目录"}],"id":"#server-%E7%9B%AE%E5%BD%95"},{"type":"heading","raw":"### client 目录\n\n","depth":3,"text":"client 目录","tokens":[{"type":"text","raw":"client 目录","text":"client 目录"}],"id":"#client-%E7%9B%AE%E5%BD%95","children":[{"type":"heading","raw":"#### client/pages 或者 pages 目录\n\n","depth":4,"text":"client/pages 或者 pages 目录","tokens":[{"type":"text","raw":"client/pages 或者 pages 目录","text":"client/pages 或者 pages 目录"}],"id":"#clientpages-%E6%88%96%E8%80%85-pages-%E7%9B%AE%E5%BD%95"}]},{"type":"heading","raw":"### config 目录\n\n","depth":3,"text":"config 目录","tokens":[{"type":"text","raw":"config 目录","text":"config 目录"}],"id":"#config-%E7%9B%AE%E5%BD%95"},{"type":"heading","raw":"### .env\n\n","depth":3,"text":".env","tokens":[{"type":"text","raw":".env","text":".env"}],"id":"#env"},{"type":"heading","raw":"### public 目录\n\n","depth":3,"text":"public 目录","tokens":[{"type":"text","raw":"public 目录","text":"public 目录"}],"id":"#public-%E7%9B%AE%E5%BD%95"},{"type":"heading","raw":"### .joy 目录\n\n","depth":3,"text":".joy 目录","tokens":[{"type":"text","raw":".joy 目录","text":".joy 目录"}],"id":"#joy-%E7%9B%AE%E5%BD%95"},{"type":"heading","raw":"### out 目录\n\n","depth":3,"text":"out 目录","tokens":[{"type":"text","raw":"out 目录","text":"out 目录"}],"id":"#out-%E7%9B%AE%E5%BD%95"}]}],"loadingCurrentDoc":false}},{"type":"reactAppInitManager/__SET_STATE","state":{"/joy/react/dir-tree":{"pathname":"/joy/react/dir-tree","index":false,"initStatic":2}}}]}],"props":{},"page":"/joy/react/dir-tree","query":{},"buildId":"wlOsApI5V3lmjJftaMJj9","joyExport":true,"isFallback":false,"ssr":true,"gip":true}</script><script nomodule="" src="/_joy/static/chunks/polyfills-661efe1e66c152d86266.js"></script><script src="/_joy/static/chunks/main-afae04c633ecb7831b2d.js" async=""></script><script src="/_joy/static/chunks/webpack-373fdeea3ec48be3183e.js" async=""></script><script src="/_joy/static/chunks/framework-c68016514741a3bee8af.js" async=""></script><script src="/_joy/static/chunks/commons-661a67bd51344448fa8d.js" async=""></script><script src="/_joy/static/chunks/pages/_app-7b903e89152bab22741a.js" async=""></script><script src="/_joy/static/wlOsApI5V3lmjJftaMJj9/_buildManifest.js" async=""></script><script src="/_joy/static/wlOsApI5V3lmjJftaMJj9/_ssgManifest.js" async=""></script></body></html>