<!DOCTYPE html><html><head><style id="theme-color">:root {
              --ant-primary-color: rgb(250, 84, 28);
              --ant-primary-color-disabled: #ffd8bf;
              --ant-primary-color-hover: #ff7a45;
              --ant-primary-color-active: #ad2102;
              --ant-primary-color-outline: rgba(250, 84, 28, 0.2);
              --ant-primary-color-deprecated-bg: #ffd8bf;
              --ant-primary-color-deprecated-border: #ff9c6e;
              --ant-primary-1: #fff2e8;
              --ant-primary-2: #ffd8bf;
              --ant-primary-3: #ffbb96;
              --ant-primary-4: #ff9c6e;
              --ant-primary-5: #ff7a45;
              --ant-primary-6: #fa541c;
              --ant-primary-7: #d4380d;
              --ant-primary-8: #ad2102;
              --ant-primary-9: #871400;
              --ant-primary-10: #610b00;
              --ant-primary-color-deprecated-l-35: rgb(254, 216, 203);
              --ant-primary-color-deprecated-l-20: rgb(252, 159, 128);
              --ant-primary-color-deprecated-t-20: rgb(251, 118, 73);
              --ant-primary-color-deprecated-t-50: rgb(253, 170, 142);
              --ant-primary-color-deprecated-f-12: rgba(250, 84, 28, 0.12);
              --ant-primary-color-active-deprecated-f-30: rgba(255, 242, 232, 0.3);
              --ant-primary-color-active-deprecated-d-02: rgb(255, 236, 222);
            }</style><link rel="stylesheet" href="/static/antd.variable.css"/><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>示例</title><meta name="joy-head-count" content="3"/><link rel="icon" href="data:image/ico;base64,aWNv"/><link rel="preload" href="/_joy/static/css/5839b0d50b0b717131ce.css" as="style"/><link rel="stylesheet" href="/_joy/static/css/5839b0d50b0b717131ce.css" data-n-g=""/><noscript data-n-css="true"></noscript><link rel="preload" href="/_joy/static/chunks/main-afae04c633ecb7831b2d.js" as="script"/><link rel="preload" href="/_joy/static/chunks/webpack-373fdeea3ec48be3183e.js" as="script"/><link rel="preload" href="/_joy/static/chunks/framework-c68016514741a3bee8af.js" as="script"/><link rel="preload" href="/_joy/static/chunks/commons-661a67bd51344448fa8d.js" as="script"/><link rel="preload" href="/_joy/static/chunks/pages/_app-7b903e89152bab22741a.js" as="script"/></head><body data-theme="light" data-is-mobile="false"><script src="https://cdn.staticfile.org/darkreader/4.9.44/darkreader.min.js"></script><script>
                if (typeof window !== "undefined") {
                  const theme = window.localStorage.getItem("theme") || 'light';
                  const oBody = document.getElementsByTagName("body")[0];
                  oBody.setAttribute("data-theme", theme);

                  if (theme === "dark") {
                    const defaultTheme = {
                      brightness: 100,
                      contrast: 90,
                      sepia: 10,
                    };

                    const defaultFixes = {
                      invert: [],
                      css: "",
                      ignoreInlineStyle: [".react-switch-handle"],
                      ignoreImageAnalysis: [],
                      disableStyleSheetsProxy: true,
                    };
                    if (window.MutationObserver) DarkReader.enable(defaultTheme, defaultFixes);
                  } else {
                    if (window.MutationObserver) DarkReader.disable();
                  }
                }
              </script><div id="__joy"><section class="ant-layout"><header class="layout_header__1OM0M"><nav id="nav" class="layout_nav__K3mbB"><div id="nav-inner" class="layout_nav__inner__2uMRU"><a id="logo" class="layout_logo__FKYzP" href="/">Symph Joy</a><button id="collapseBtn" type="button" class="ant-btn ant-btn-text ant-btn-lg layout_menu__collapseBtn__FF_4T"><span role="img" aria-label="menu-unfold" class="anticon anticon-menu-unfold"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu-unfold" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM142.4 642.1L298.7 519a8.84 8.84 0 000-13.9L142.4 381.9c-5.8-4.6-14.4-.5-14.4 6.9v246.3a8.9 8.9 0 0014.4 7z"></path></svg></span></button><ul class="ant-menu-overflow ant-menu ant-menu-root ant-menu-horizontal ant-menu-light layout_menu__2a0TM layout_menu__collapsed__cIvBb" role="menu" tabindex="0" data-menu-list="true"><li class="ant-menu-overflow-item ant-menu-item ant-menu-item-only-child" style="opacity:1;order:0" role="menuitem" tabindex="-1"><span class="ant-menu-title-content"><div class="ant-select ant-select-auto-complete ant-select-single ant-select-allow-clear ant-select-customize-input ant-select-show-search"><div class="ant-select-selector"><span class="ant-select-selection-search"><span class="ant-input-affix-wrapper ant-select-selection-search-input layout_search__3NGXd"><span class="ant-input-prefix"><span role="img" aria-label="search" class="anticon anticon-search"><svg viewBox="64 64 896 896" focusable="false" data-icon="search" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0011.6 0l43.6-43.5a8.2 8.2 0 000-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"></path></svg></span></span><input type="search" autoComplete="off" placeholder="搜索" class="ant-input" role="combobox" aria-haspopup="listbox" aria-owns="undefined_list" aria-autocomplete="list" aria-controls="undefined_list" aria-activedescendant="undefined_list_0" value=""/></span></span><span class="ant-select-selection-placeholder"></span></div></div></span></li><li class="ant-menu-overflow-item ant-menu-submenu ant-menu-submenu-horizontal" style="opacity:1;order:1" role="none"><div role="menuitem" class="ant-menu-submenu-title" tabindex="-1" aria-expanded="false" aria-haspopup="true"><span class="ant-menu-title-content">项目</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-overflow-item ant-menu-item ant-menu-item-only-child" style="opacity:1;order:2" role="menuitem" tabindex="-1"><span class="ant-menu-title-content"><a href="/plugin/index">插件</a></span></li><li class="ant-menu-overflow-item ant-menu-item ant-menu-item-only-child" style="opacity:1;order:3" role="menuitem" tabindex="-1"><span class="ant-menu-title-content"><a href="/v1/readme">v1</a></span></li><li class="ant-menu-overflow-item ant-menu-item ant-menu-item-only-child" style="opacity:1;order:4" role="menuitem" tabindex="-1"><span class="ant-menu-title-content"><a target="_blank" href="https://github.com/lnlfps/symph-joy">Github</a></span></li><li class="ant-menu-overflow-item ant-menu-item ant-menu-item-only-child" style="opacity:1;order:5" role="menuitem" tabindex="-1"><span class="ant-menu-title-content"><a id="change-theme" class="layout_theme__switch__133kS"><span><span role="img" class="anticon"><svg viewBox="0 0 1024 1024" fill="currentColor" width="1em" height="1em"><path d="M512 832a64 64 0 0 1 64 64v64a64 64 0 1 1-128 0v-64a64 64 0 0 1 64-64z m0-640a64 64 0 0 1-64-64V64a64 64 0 1 1 128 0v64a64 64 0 0 1-64 64z m448 256a64 64 0 1 1 0 128h-64a64 64 0 1 1 0-128h64zM192 512a64 64 0 0 1-64 64H64a64 64 0 1 1 0-128h64a64 64 0 0 1 64 64z m636.768 226.272l45.248 45.248a64 64 0 1 1-90.496 90.496l-45.248-45.248a64 64 0 1 1 90.496-90.496zM195.232 285.728L149.984 240.48a64 64 0 1 1 90.496-90.496l45.248 45.248a64 64 0 1 1-90.496 90.496z m633.536 0a64 64 0 1 1-90.496-90.496l45.248-45.248a64 64 0 1 1 90.496 90.496l-45.248 45.248zM195.232 738.272a64 64 0 1 1 90.496 90.496l-45.248 45.248a64 64 0 1 1-90.496-90.496l45.248-45.248zM512 256a256 256 0 1 0 0 512 256 256 0 0 0 0-512z m0 416a160 160 0 1 1 0.032-320.032A160 160 0 0 1 512 672z" p-id="2605"></path></svg></span><span role="img" class="anticon"><svg viewBox="0 0 1024 1024" fill="currentColor" width="1em" height="1em"><path d="M514.56 938.666667h-40.106667a426.666667 426.666667 0 0 1 0-853.333334 42.666667 42.666667 0 0 1 42.666667 21.76A42.666667 42.666667 0 0 1 512 153.173333a256 256 0 0 0 358.4 358.4 42.666667 42.666667 0 0 1 46.08-2.986666 42.666667 42.666667 0 0 1 21.76 42.666666A426.666667 426.666667 0 0 1 514.56 938.666667zM397.226667 189.44a341.333333 341.333333 0 1 0 437.333333 437.333333A341.333333 341.333333 0 0 1 381.013333 356.266667a341.333333 341.333333 0 0 1 16.213334-166.826667z" p-id="3227"></path></svg></span></span></a></span></li><li class="ant-menu-overflow-item ant-menu-overflow-item-rest ant-menu-submenu ant-menu-submenu-horizontal" style="opacity:0;height:0;overflow-y:hidden;order:9007199254740991;pointer-events:none;position:absolute" aria-hidden="true" role="none"><div role="menuitem" class="ant-menu-submenu-title" tabindex="-1" aria-expanded="false" aria-haspopup="true"><span role="img" aria-label="ellipsis" class="anticon anticon-ellipsis"><svg viewBox="64 64 896 896" focusable="false" data-icon="ellipsis" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M176 511a56 56 0 10112 0 56 56 0 10-112 0zm280 0a56 56 0 10112 0 56 56 0 10-112 0zm280 0a56 56 0 10112 0 56 56 0 10-112 0z"></path></svg></span><i class="ant-menu-submenu-arrow"></i></div></li></ul><div style="display:none" aria-hidden="true"></div></div></nav></header><main class="ant-layout-content"><div class="docs_layoutContent__1N8MU"><div class="docs_docMenus__2pe7u"><div class=""><ul class="ant-menu ant-menu-root ant-menu-inline ant-menu-light" role="menu" tabindex="0" data-menu-list="true"><li class="ant-menu-item ant-menu-item-only-child" style="padding-left:24px" role="menuitem" tabindex="-1"><span class="ant-menu-title-content">V1 文档</span></li><li class="ant-menu-item ant-menu-item-only-child" style="padding-left:24px" role="menuitem" tabindex="-1"><span class="ant-menu-title-content">使用指南</span></li><li class="ant-menu-item ant-menu-item-only-child" style="padding-left:24px" role="menuitem" tabindex="-1"><span class="ant-menu-title-content">配置文档</span></li><li class="ant-menu-item ant-menu-item-only-child" style="padding-left:24px" role="menuitem" tabindex="-1"><span class="ant-menu-title-content"> 插件列表</span></li><li class="ant-menu-item ant-menu-item-selected ant-menu-item-only-child" style="padding-left:24px" role="menuitem" tabindex="-1"><span class="ant-menu-title-content">示例</span></li><li class="ant-menu-item ant-menu-item-only-child" style="padding-left:24px" role="menuitem" tabindex="-1"><span class="ant-menu-title-content">了解 @symph/joy</span></li><li class="ant-menu-item ant-menu-item-only-child" style="padding-left:24px" role="menuitem" tabindex="-1"><span class="ant-menu-title-content">主要版本升级日志</span></li></ul><div style="display:none" aria-hidden="true"></div></div></div><div class="docs_menuIcon__3YKAQ"><span role="img" aria-label="menu-unfold" class="anticon anticon-menu-unfold"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu-unfold" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM142.4 642.1L298.7 519a8.84 8.84 0 000-13.9L142.4 381.9c-5.8-4.6-14.4-.5-14.4 6.9v246.3a8.9 8.9 0 0014.4 7z"></path></svg></span></div><div class="docs_right__1ZHMG"><div class="docs_center__23l0Z"><div class="ant-spin-nested-loading"><div class="ant-spin-container"><div class="docs_docContent__jPjeX">
                <h1 id="%E7%A4%BA%E4%BE%8B">
                  示例
                </h1><ul>
<li><a href="https://github.com/lnlfps/symph-joy/tree/master/examples/hello-world">hello-world</a> 最简单的例子</li>
<li><a href="https://github.com/lnlfps/symph-joy/tree/master/examples/basic">basic</a> 展示主要特性的使用方法</li>
<li><a href="https://github.com/lnlfps/symph-joy/tree/master/examples/with-element-react">with-element-react</a> 集成 element-react UI 框架</li>
<li><a href="https://github.com/lnlfps/symph-joy/tree/master/examples/with-antd">with-antd</a> 集成 antd UI 框架</li>
<li><a href="https://github.com/lnlfps/symph-joy/tree/master/examples/with-antd-mobile">with-antd</a> 集成 antd-mobile UI 框架</li>
</ul>
</div></div></div></div><div class="docs_titleTree__2wlEA"><div><div class=""><div class="ant-anchor-wrapper" style="max-height:100vh"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div></div></div></div></div></div></div></div></main></section></div><script id="__JOY_DATA__" type="application/json">{"initState":[{"pathname":"INIT@/v1/examples","ssgData":[{"type":"__INIT_MODEL","state":{"noop":{},"reactAppInitManager":{},"layoutModel":{"collapsed":true,"isMobile":false},"docsModel":{"loadingCurrentDoc":false,"docMenus":[],"titleTrees":[],"result":[],"openKeys":[],"snippets":{},"defaultOpenKeys":[]}}}]},{"pathname":"/","ssgData":[{"type":"reactAppInitManager/__SET_STATE","state":{"/":{"pathname":"/","index":false,"initStatic":2}}}]},{"pathname":"/v1","ssgData":[{"type":"docsModel/__SET_STATE","state":{"docMenus":[{"title":"V1 文档","path":"/v1/readme","file":"docs\\v1\\01-readme.md","hasMenu":false,"mdContent":"# V1 文档\r\n\r\n## 介绍\r\n\r\n@symph/joy 让我们轻松的进行前端应用开发，零配置可用，简单清晰的业务和数据管理模块，已集成大量最佳实践的优化方案，即使你才刚接触 React，也可以轻松创建高可用、可维护的前端应用。\r\n\r\n\u003e 该项目已在生产环境大量使用，如有任何疑问、使用帮助、bug 反馈、特性讨论，请和我们联系(邮件：lnlfps@gmail.com; QQ 群：929743297)，或者到 github 创建 issue，欢迎加入。\r\n\r\n## 特征\r\n\r\n- 零配置可用，优化的默认配置，快速开发，已集成 react、redux、react-router4 和 ES6、7 语法支持等\r\n- 支持服务端渲染，在业务组件内部获取渲染数据，组件内聚更高，便于维护\r\n- MVC 架构，模块化设计，简化 redux 的学习和使用\r\n- 依赖自动注入，专注组件内部实现，依赖关系更明确，方便调用\r\n- 支持`@`装饰器将普通 Class 申明为 Controller 或 Model 等，不侵入业务代码\r\n- 支持 react hook 模式开发函数式组件，轻松链接 Model 管理业务流程\r\n- 全局支持 async 语法，复杂的业务逻辑也能轻松找到解决方案\r\n- 支持静态版本导出，脱离 Node.js 运行，也可单独导出静态页面\r\n- 内置网络请求代理服务，解决跨域和服务中转问题，前后端分离开发畅通无阻\r\n- 支持插件化配置，便于功能扩展\r\n\r\n## 安装和开始\r\n\r\n运行`npm init`创建一个空工程，并填写项目的基本信息，当然也可以在一个已有的项目中直接安装。\r\n\r\n```bash\r\nnpm install --save  @symph/joy react react-dom\r\n```\r\n\r\n\u003e @symph/joy 只支持 [React 16](https://reactjs.org/blog/2017/09/26/react-v16.0.html)及以上版本\r\n\r\n添加 NPM 脚本到 package.json 文件：\r\n\r\n```json\r\n{\r\n  \"scripts\": {\r\n    \"dev\": \"joy dev\"\r\n  }\r\n}\r\n```\r\n\r\n然后就可以开始正式工作了，下面从`hello world`示例开始，首先编写一个 Model 组件来管理应用的数据和业务。\r\n\r\n```javascript\r\n// /src/models/HelloModel.js\r\n\r\nimport model from \"@symph/joy/model\";\r\n\r\n@model() // 标明这是一个Model。\r\nexport default class HelloModel {\r\n  namespace = \"hello\";\r\n\r\n  // model的初始状态数据\r\n  initState = {\r\n    message: \"Welcome to @symph/joy!\",\r\n  };\r\n\r\n  // async业务方法，从服务端异步获取新的欢迎消息\r\n  async fetchMessage() {\r\n    let newMsg = await fetch(\"/hello_message\");\r\n    //更新model的状态，界面的状态也会自动更新\r\n    this.setState({\r\n      message: newMsg,\r\n    });\r\n  }\r\n}\r\n```\r\n\r\n接下来编写界面，展示欢迎消息。`@symph/joy`默认使用`/src/index.js`文件作为应用的启动入口组件，可以在这里初始化基础功能模块和设置子页面路由等。\r\n\r\n```javascript\r\n// /src/index.js\r\nimport React, { Component } from \"react\";\r\nimport { controller, autowire } from \"@symph/joy/controller\";\r\nimport HelloModel from \"./models/HelloModel\";\r\n\r\n@controller((store) =\u003e {\r\n  // 标明这是一个Controller\r\n  return {\r\n    message: store.hello.message, // 绑定model中的数据\r\n  };\r\n})\r\nexport default class HelloController extends Component {\r\n  @autowire() // 声明依赖的Model\r\n  helloModel: HelloModel;\r\n\r\n  async componentDidMount() {\r\n    await this.helloModel.fetchMessage(); //调用model\r\n  }\r\n\r\n  render() {\r\n    return \u003cdiv\u003e${this.props.message}\u003c/div\u003e;\r\n  }\r\n}\r\n```\r\n\r\n最后运行`npm run dev`命令，在浏览器中输入访问地址`http://localhost:3000`，即可看到刚才写的页面。如果需要使用其它端口来启动应用 `npm run dev -- -p \u003cyour port here\u003e`\r\n\r\n到目前为止，一个简单完整的前端应用已经创建完成，可以开始工作了。\r\n\r\n## 联系我们\r\n\r\n邮件：lnlfps@gmail.com\r\nQQ 群：929743297\r\n","htmlContent":"\n                \u003ch1 id=\"v1-%E6%96%87%E6%A1%A3\"\u003e\n                  V1 文档\n                \u003c/h1\u003e\n                \u003ch2 id=\"%E4%BB%8B%E7%BB%8D\"\u003e\n                  介绍\n                \u003c/h2\u003e\u003cp\u003e@symph/joy 让我们轻松的进行前端应用开发，零配置可用，简单清晰的业务和数据管理模块，已集成大量最佳实践的优化方案，即使你才刚接触 React，也可以轻松创建高可用、可维护的前端应用。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e该项目已在生产环境大量使用，如有任何疑问、使用帮助、bug 反馈、特性讨论，请和我们联系(邮件：\u003ca href=\"mailto:\u0026#x6c;\u0026#110;\u0026#108;\u0026#x66;\u0026#112;\u0026#x73;\u0026#x40;\u0026#103;\u0026#109;\u0026#x61;\u0026#105;\u0026#108;\u0026#x2e;\u0026#x63;\u0026#111;\u0026#x6d;\"\u003e\u0026#x6c;\u0026#110;\u0026#108;\u0026#x66;\u0026#112;\u0026#x73;\u0026#x40;\u0026#103;\u0026#109;\u0026#x61;\u0026#105;\u0026#108;\u0026#x2e;\u0026#x63;\u0026#111;\u0026#x6d;\u003c/a\u003e; QQ 群：929743297)，或者到 github 创建 issue，欢迎加入。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n                \u003ch2 id=\"%E7%89%B9%E5%BE%81\"\u003e\n                  特征\n                \u003c/h2\u003e\u003cul\u003e\n\u003cli\u003e零配置可用，优化的默认配置，快速开发，已集成 react、redux、react-router4 和 ES6、7 语法支持等\u003c/li\u003e\n\u003cli\u003e支持服务端渲染，在业务组件内部获取渲染数据，组件内聚更高，便于维护\u003c/li\u003e\n\u003cli\u003eMVC 架构，模块化设计，简化 redux 的学习和使用\u003c/li\u003e\n\u003cli\u003e依赖自动注入，专注组件内部实现，依赖关系更明确，方便调用\u003c/li\u003e\n\u003cli\u003e支持\u003ccode\u003e@\u003c/code\u003e装饰器将普通 Class 申明为 Controller 或 Model 等，不侵入业务代码\u003c/li\u003e\n\u003cli\u003e支持 react hook 模式开发函数式组件，轻松链接 Model 管理业务流程\u003c/li\u003e\n\u003cli\u003e全局支持 async 语法，复杂的业务逻辑也能轻松找到解决方案\u003c/li\u003e\n\u003cli\u003e支持静态版本导出，脱离 Node.js 运行，也可单独导出静态页面\u003c/li\u003e\n\u003cli\u003e内置网络请求代理服务，解决跨域和服务中转问题，前后端分离开发畅通无阻\u003c/li\u003e\n\u003cli\u003e支持插件化配置，便于功能扩展\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch2 id=\"%E5%AE%89%E8%A3%85%E5%92%8C%E5%BC%80%E5%A7%8B\"\u003e\n                  安装和开始\n                \u003c/h2\u003e\u003cp\u003e运行\u003ccode\u003enpm init\u003c/code\u003e创建一个空工程，并填写项目的基本信息，当然也可以在一个已有的项目中直接安装。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003enpm install --save  @symph/joy react react-dom\n\u003c/code\u003e\u003c/pre\u003e\n\u003cblockquote\u003e\n\u003cp\u003e@symph/joy 只支持 \u003ca href=\"https://reactjs.org/blog/2017/09/26/react-v16.0.html\"\u003eReact 16\u003c/a\u003e及以上版本\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e添加 NPM 脚本到 package.json 文件：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-json\"\u003e\u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;scripts\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\u0026quot;dev\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;joy dev\u0026quot;\u003c/span\u003e\n  \u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e然后就可以开始正式工作了，下面从\u003ccode\u003ehello world\u003c/code\u003e示例开始，首先编写一个 Model 组件来管理应用的数据和业务。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// /src/models/HelloModel.js\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e model \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/model\u0026quot;\u003c/span\u003e;\n\n@\u003cspan class=\"hljs-title function_\"\u003emodel\u003c/span\u003e() \u003cspan class=\"hljs-comment\"\u003e// 标明这是一个Model。\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eHelloModel\u003c/span\u003e {\n  namespace = \u003cspan class=\"hljs-string\"\u003e\u0026quot;hello\u0026quot;\u003c/span\u003e;\n\n  \u003cspan class=\"hljs-comment\"\u003e// model的初始状态数据\u003c/span\u003e\n  initState = {\n    \u003cspan class=\"hljs-attr\"\u003emessage\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;Welcome to @symph/joy!\u0026quot;\u003c/span\u003e,\n  };\n\n  \u003cspan class=\"hljs-comment\"\u003e// async业务方法，从服务端异步获取新的欢迎消息\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efetchMessage\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e newMsg = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efetch\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;/hello_message\u0026quot;\u003c/span\u003e);\n    \u003cspan class=\"hljs-comment\"\u003e//更新model的状态，界面的状态也会自动更新\u003c/span\u003e\n    \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003esetState\u003c/span\u003e({\n      \u003cspan class=\"hljs-attr\"\u003emessage\u003c/span\u003e: newMsg,\n    });\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e接下来编写界面，展示欢迎消息。\u003ccode\u003e@symph/joy\u003c/code\u003e默认使用\u003ccode\u003e/src/index.js\u003c/code\u003e文件作为应用的启动入口组件，可以在这里初始化基础功能模块和设置子页面路由等。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// /src/index.js\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eReact\u003c/span\u003e, { \u003cspan class=\"hljs-title class_\"\u003eComponent\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { controller, autowire } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/controller\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eHelloModel\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;./models/HelloModel\u0026quot;\u003c/span\u003e;\n\n@\u003cspan class=\"hljs-title function_\"\u003econtroller\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003estore\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-comment\"\u003e// 标明这是一个Controller\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n    \u003cspan class=\"hljs-attr\"\u003emessage\u003c/span\u003e: store.\u003cspan class=\"hljs-property\"\u003ehello\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003emessage\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// 绑定model中的数据\u003c/span\u003e\n  };\n})\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eHelloController\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title class_ inherited__\"\u003eComponent\u003c/span\u003e {\n  @\u003cspan class=\"hljs-title function_\"\u003eautowire\u003c/span\u003e() \u003cspan class=\"hljs-comment\"\u003e// 声明依赖的Model\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003ehelloModel\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eHelloModel\u003c/span\u003e;\n\n  \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003ecomponentDidMount\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ehelloModel\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003efetchMessage\u003c/span\u003e(); \u003cspan class=\"hljs-comment\"\u003e//调用model\u003c/span\u003e\n  }\n\n  \u003cspan class=\"hljs-title function_\"\u003erender\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e${this.props.message}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e;\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e最后运行\u003ccode\u003enpm run dev\u003c/code\u003e命令，在浏览器中输入访问地址\u003ccode\u003ehttp://localhost:3000\u003c/code\u003e，即可看到刚才写的页面。如果需要使用其它端口来启动应用 \u003ccode\u003enpm run dev -- -p \u0026lt;your port here\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e到目前为止，一个简单完整的前端应用已经创建完成，可以开始工作了。\u003c/p\u003e\n\n                \u003ch2 id=\"%E8%81%94%E7%B3%BB%E6%88%91%E4%BB%AC\"\u003e\n                  联系我们\n                \u003c/h2\u003e\u003cp\u003e邮件：\u003ca href=\"mailto:\u0026#108;\u0026#x6e;\u0026#x6c;\u0026#x66;\u0026#x70;\u0026#115;\u0026#64;\u0026#103;\u0026#x6d;\u0026#x61;\u0026#x69;\u0026#x6c;\u0026#46;\u0026#99;\u0026#111;\u0026#x6d;\"\u003e\u0026#108;\u0026#x6e;\u0026#x6c;\u0026#x66;\u0026#x70;\u0026#115;\u0026#64;\u0026#103;\u0026#x6d;\u0026#x61;\u0026#x69;\u0026#x6c;\u0026#46;\u0026#99;\u0026#111;\u0026#x6d;\u003c/a\u003e\nQQ 群：929743297\u003c/p\u003e\n","anchor":[{"type":"heading","raw":"## 介绍\n\n","depth":2,"text":"介绍","tokens":[{"type":"text","raw":"介绍","text":"介绍"}],"id":"#%E4%BB%8B%E7%BB%8D"},{"type":"heading","raw":"## 特征\n\n","depth":2,"text":"特征","tokens":[{"type":"text","raw":"特征","text":"特征"}],"id":"#%E7%89%B9%E5%BE%81"},{"type":"heading","raw":"## 安装和开始\n\n","depth":2,"text":"安装和开始","tokens":[{"type":"text","raw":"安装和开始","text":"安装和开始"}],"id":"#%E5%AE%89%E8%A3%85%E5%92%8C%E5%BC%80%E5%A7%8B"},{"type":"heading","raw":"## 联系我们\n\n","depth":2,"text":"联系我们","tokens":[{"type":"text","raw":"联系我们","text":"联系我们"}],"id":"#%E8%81%94%E7%B3%BB%E6%88%91%E4%BB%AC"}]},{"title":"使用指南","path":"/v1/v1-getting-started","file":"docs\\v1\\02-v1-getting-started.md","hasMenu":false,"mdContent":"# 使用指南\r\n\r\n## 安装和开始\r\n\r\n运行`npm init`创建一个空工程，填写项目的基本信息，当然也可以在一个已有的项目中安装使用。\r\n\r\n```bash\r\nnpm install --save @symph/joy react react-dom\r\n```\r\n\r\n\u003e @symph/joy 只支持 [React 16](https://reactjs.org/blog/2017/09/26/react-v16.0.html)及以上版本\r\n\r\n\b 添加 NPM 脚本到 package.json 文件：\r\n\r\n```json\r\n{\r\n  \"scripts\": {\r\n    \"dev\": \"joy dev\"\r\n  }\r\n}\r\n```\r\n\r\n创建`./src/index.js`文件，并插入以下代码：\r\n\r\n```javascript\r\nimport React, { Component } from \"react\";\r\n\r\nexport default class Index extends Component {\r\n  render() {\r\n    return \u003cdiv\u003eWelcome to symphony joy!\u003c/div\u003e;\r\n  }\r\n}\r\n```\r\n\r\n然后运行`npm run dev` 命令，在浏览器中输入访问地址`http://localhost:3000`。如果需要使用其它端口来启动应用 `npm run dev -- -p \u003cyour port here\u003e`\r\n\r\n到目前为止，一个简单且完整的前端应用已经创建完成，接下来，我们可以开始进行业务开发了。例子完整工程：[hello-world](https://github.com/lnlfps/symph-joy/tree/master/examples/hello-world)。\r\n\r\n到这儿我们拥有了哪些功能呢？\r\n\r\n- 应用入口（`./src/index.js`），一切都从这里开始，以后可以添加子路由、布局、Model 等组件\r\n- 启动了一个调试服务器，支持服务端渲染和业务请求代理转发等\r\n- 一个零配置的 webpack+babel 编译器，确保代码在 Node.js 和浏览器上正确运行\r\n- ES6、7、8 等高级语法支持，如：`import`、`class`、`async`、`@`注解、`{...}`解构等\r\n- 热更新，调试模式下，在浏览器不刷新的情况下，使更改立即生效\r\n- 静态资源服务，在`/static/`目录下的静态资源，可通过`http://localhost:3000/static/`访问\r\n\r\n## 样式 CSS\r\n\r\n### jsx 内建样式\r\n\r\n内建了 [styled-jsx](https://github.com/zeit/styled-jsx) 模块，无需配置，可直接使用。支持 Component 内独立域的 CSS 样式，不会和其他组件的同名样式冲突。\r\n\r\n```javascript\r\nimport React from \"react\";\r\n\r\nexport default () =\u003e (\r\n  \u003cdiv\u003e\r\n    Hello world\r\n    \u003cp\u003escoped!\u003c/p\u003e\r\n    \u003cstyle jsx\u003e{`\r\n      p {\r\n        color: blue;\r\n      }\r\n      div {\r\n        background: red;\r\n      }\r\n      @media (max-width: 600px) {\r\n        div {\r\n          background: blue;\r\n        }\r\n      }\r\n    `}\u003c/style\u003e\r\n    \u003cstyle global jsx\u003e{`\r\n      body {\r\n        background: black;\r\n      }\r\n    `}\u003c/style\u003e\r\n  \u003c/div\u003e\r\n);\r\n```\r\n\r\n查看 [styled-jsx 详细使用文档](https://www.npmjs.com/package/styled-jsx)\r\n\r\n### Import CSS / LESS 文件\r\n\r\n@symph/joy 提供下列插件来处理样式，默认支持 post-css、autoprefixer、css-modules、extract-text-webpack 等，具体使用方法请查看插件使用文档。\r\n\r\n- [@symph/joy-css](https://github.com/lnlfps/joy-plugins/tree/master/packages/joy-css)\r\n- [@symph/joy-less](https://github.com/lnlfps/joy-plugins/tree/master/packages/joy-less)\r\n\r\n### 导入图片\r\n\r\n[@symph/joy-image](https://github.com/lnlfps/joy-plugins/tree/master/packages/joy-image)插件提供图片导入功能，详细的配置请参见[插件主页](https://github.com/lnlfps/joy-plugins/tree/master/packages/joy-image)。\r\n\r\n```javascript\r\n// joy.config.js\r\nconst withLess = require(\"@symph/joy-less\");\r\nconst withImageLoader = require(\"@symph/joy-image\");\r\n\r\nmodule.exports = {\r\n  serverRender: true,\r\n  plugins: [withImageLoader({ limit: 8192 })],\r\n};\r\n```\r\n\r\n使用方法\r\n\r\n```javascript\r\n// in jsx\r\nexport default () =\u003e \u003cimg src={require(\"./image.png\")} /\u003e;\r\n```\r\n\r\n在 css、less 文件中使用\r\n\r\n```css\r\n.bg {\r\n  background: url(\"./image.png\");\r\n}\r\n```\r\n\r\n## 静态文件\r\n\r\n在工程根目录下创建`static`目录，将静态文件放入其中，例如：图片、第三方 js、css 等，也可以创建子目录管理文件，可以通过`{assetPrefix}/static/{file}`访问这些文件，也可使用`asset`方法得到最终的访问路径 。\r\n\r\n```javascript\r\nexport default () =\u003e \u003cimg src=\"/static/my-image.png\" /\u003e\r\n\r\n//or\r\nimport asset from '@symph/joy/asset'\r\nexport default () =\u003e \u003cimg src={asset(\"/my-image.png\")} /\u003e\r\n```\r\n\r\n## 自定义 Head\r\n\r\n@symph/joy 提供了`Head` Component 来设置 html 页面的`\u003chead\u003e`标签中的内容\r\n\r\n```javascript\r\nimport Head from \"@symph/joy/head\";\r\n\r\nexport default () =\u003e (\r\n  \u003cdiv\u003e\r\n    \u003cHead\u003e\r\n      \u003ctitle\u003eMy page title\u003c/title\u003e\r\n      \u003cmeta name=\"viewport\" content=\"initial-scale=1.0, width=device-width\" /\u003e\r\n    \u003c/Head\u003e\r\n    \u003cp\u003eHello world!\u003c/p\u003e\r\n  \u003c/div\u003e\r\n);\r\n```\r\n\r\n在`head`中重复添加多个相同标签，可以给标签添加`key`属性， 相同的 key 只会在 head 中输出一次。\r\n\r\n```javascript\r\nimport Head from \"@symph/joy/head\";\r\nexport default () =\u003e (\r\n  \u003cdiv\u003e\r\n    \u003cHead\u003e\r\n      \u003ctitle\u003eMy page title\u003c/title\u003e\r\n      \u003cmeta name=\"viewport\" content=\"initial-scale=1.0, width=device-width\" key=\"viewport\" /\u003e\r\n    \u003c/Head\u003e\r\n    \u003cHead\u003e\r\n      \u003cmeta name=\"viewport\" content=\"initial-scale=1.2, width=device-width\" key=\"viewport\" /\u003e\r\n    \u003c/Head\u003e\r\n    \u003cp\u003eHello world!\u003c/p\u003e\r\n  \u003c/div\u003e\r\n);\r\n```\r\n\r\n在上面的例子中，只有第二个`\u003cmeta key=\"viewport\" /\u003e`被渲染和添加到最终页面。\r\n\r\n## 代理服务\r\n\r\n`@symph/joy`内建了代理转发服务器，支持`web`和`websocket`转发，请求由浏览器发送到代理服务器，再由代理服务器发送到业务服务器。\r\n\r\n在`joy.config.js`中配置代理服务器，下面实例如何开启代理服务器，并转发`/api`路径上的请求。\r\n\r\n```javascript\r\n// joy.config.js 里配置代理点\r\nmodule.exports = {\r\n  proxy: {\r\n    enable: true,\r\n    routes: [\r\n      {\r\n        type: \"web\",\r\n        path: \"^/zhihu-api/\", // 匹配到该路径的请求，都会被转发到target指定的目标地址上。\r\n        target: \"https://news-at.zhihu.com\",\r\n        pathRewrite: {\r\n          \"/zhihu-api/\": \"/\",\r\n        },\r\n      },\r\n    ],\r\n  },\r\n};\r\n```\r\n\r\n```javascript\r\n// 客户端浏览器上，通过该代理点请求数据\r\n\r\nasync function fetchData() {\r\n  // 最终访问的地址为 https://news-at.zhihu.com/api/3/news/hot\r\n  let response = await fetch(\"/zhihu-api/api/3/news/hot\", { method: \"GET\" });\r\n}\r\n```\r\n\r\n和自定义 server 服务器集成，例如`express`，需要开发者将`@symph/joy/proxy-middleware`中间件注册到`express`中。\r\n\r\n```javascript\r\nconst express = require(\"express\");\r\nconst joy = require(\"@symph/joy\");\r\nconst { createProxyMiddleware } = require(\"@symph/joy/proxy-middleware\");\r\nconst dev = process.env.NODE_ENV !== \"production\";\r\n\r\nconst server = express();\r\nconst app = joy({ dev });\r\nconst handle = app.getRequestHandler();\r\nconst preparedApp = app.prepare();\r\nconst proxyOptions = { enable: true, dev: true };\r\nserver.use(createProxyMiddleware(proxyOptions)); //register proxy,\r\nserver.use((req, res, next) =\u003e {\r\n  preparedApp.then(() =\u003e {\r\n    handle(req, res);\r\n  });\r\n});\r\nserver.listen(3000);\r\n```\r\n\r\n`createProxyMiddleware(options)`支持的参数和在`joy.config.js`中配置`proxy`时一致。\r\n\r\n### 使用注意事项\r\n\r\n- 前端域名下的 cookie 会一起发送到目标服务器，如对目标服务器不信任，需采取措施来避免数据的泄露和冲突，例如监听`onProxyReq`事件，在 proxy 发送请求到目标服务器之前，去掉敏感数据。\r\n\r\n### proxy 配置\r\n\r\n- **enable**: 类型`bool`，默认`true`， 如果为 false，将关闭整个代理服务器。\r\n\r\n- **autoProxy**: 类型`bool`，开发环境(NODE_ENV=development)默认 true，其它环境默认 false。配置自动代理服务，在浏览器上使用[`@symph/joy/fetch`](#发送请求-fetch)发送请求，在浏览器上`@symph/joy/fetch`检测到请求跨域了，会将请求地址转为`${proxy.host}/__proxy/${pathname}`，请请求发送到代理服务器，再由代理发送请求到目标服务器。\r\n\r\n\u003e 注意：在生产环境，要谨慎使用`autoProxy`自动代理服务器，以防被人恶意利用，例如试探内部网络和接口、或者转发恶意非法请求、网络攻击等。在生产环境，建议使用`proxy.routes`配置，明确定义每个代理点的行为，避免越界使用。\r\n\r\n- **routes**: 类型`ProxyRoute`的数组，默认空，设置各个代理点。\r\n\r\n- **dev**: 类型`bool`，默认`false`，开启调试模式后，会打印一些代理日志。\r\n\r\n#### ProxyRoute 配置\r\n\r\n- **path**: 类型`string`，不能为空，定义该代理点能处理的客户端请求路径，支持正则字符串，最终由 RegExp 生成正则表达式，和`request.path`进行匹配。\r\n\r\n- **target**: 类型`string`, 不能为空，目标服务器地址，包含协议、域名、端口，也可以包含部分公共路径。例如：`https://service.com:8080/api/v1`。\r\n\r\n- **type**: 类型`string`, 默认`web`，支持`web`和`websocket`。\r\n\r\n- **xfwd**: 类型`bool`，默认`true`，在转发请求时，是否在发往目标服务器的请求里追加`x-forwarded-xxx`协议头。\r\n\r\n- **secure**: 类型`bool`，默认`false`，是否验证 SSL 证书。\r\n\r\n- **ssl**: 类型`Object`，默认`null`，配置 https 连接，将会被传入 https.createServer()中。\r\n\r\n- **ignorePath**: 类型`bool`，默认`false`，是否忽略客户端请求的 path 部分，如果为 true，则代理服务器发送请求到目标服务器上时，将不会包含原始请求的 path 部分。\r\n\r\n- **pathRewrite**: 类型`Object`，默认`null`, 重写客户端请求路径，可配置的值:\r\n  - Object, 但在对应关系替换，只替换第一次匹配到的路径。例如：\r\n\r\n```javascript\r\n{\r\n  \"/old_path/\": \"/new_path/\",  // 替换为新的path\r\n  \"/path/\": \"/\",               // 删除path\r\n  \"/\": \"/path/\"                // 在路径前面添加新的path\r\n}\r\n```\r\n\r\n- **prependPath**: 类型`bool`，默认`true`，将 target 定义 path 部分，添加到客户端请求 path 的前面。\r\n\r\n- **localAddress**: 类型`string`，默认`null`, 本地连接到远程的接口地址。\r\n\r\n- **changeOrigin**: 类型`bool`，默认`true`，改变客户端请求 header 中的 host 值，如果为 false，客户端在发送请求时，必须确保 header 中设置正确目标的 host，否则浏览器默认添加为代理服务器的 host 地址，这可能导致最终请求失败。\r\n\r\n- **preserveHeaderKeyCase**: 类型`bool`，默认`true`, 设置是否需要保持客户端请求 header 字段名称的大小写，默认会将 header 中的字段转换为全小写。\r\n\r\n- **auth**: 类型`string`，默认`null`, 在发往目标服务器的请求中添加基本认证信息。例如：'user:password'。\r\n\r\n- **hostRewrite**: 类型`string`，默认`null`，当 (201/301/302/307/308) 时，使用该值重写业务服务器响应 headers[\"location\"]里的 hostname。\r\n\r\n- **autoRewrite**: 类型`bool`，默认`false`, 当 (201/301/302/307/308) 时，基于客户端的原始请求，自动重写业务服务器响应 headers[\"location\"]里的 host/port。\r\n\r\n- **protocolRewrite**: 类型`string`，默认`null`，使用该值重写业务服务器响应 headers[\"location\"]里的协议部分，例如：http 或者 https。\r\n\r\n- **cookieDomainRewrite**: 类型`bool|string|object`，默认`false`，重写'set-cookie'头中的 domain，可配置的值:\r\n\r\n  - bool, 默认 false， 关闭 cookie 重写\r\n  - string，新的 domain，例如：`cookieDomainRewrite: \"new.domain\"`。如果需要删除 domain，使用`cookieDomainRewrite: \"\"`\r\n  - object, 按照对应关系替换，使用`\"*\"`匹配所有的 domain，例如：\r\n\r\n```javascript\r\ncookieDomainRewrite: {\r\n  \"unchanged.domain\": \"unchanged.domain\", //保存不变\r\n  \"old.domain\": \"new.domain\",             // 替换为新的domain\r\n  \"*\": \"\"                                 // 删除其它的domain\r\n}\r\n```\r\n\r\n- **cookiePathRewrite**: 类型`bool|string|object`，默认`false`，重写'set-cookie'头中的路径，可配置的值:\r\n\r\n  - bool, 默认 false， 关闭 cookie 重写， TODO 支持 true 选项，代表 auto 选项，自动根据原始请求设置该值\r\n  - string，新的 path，例如：`cookiePathRewrite: \"/newPath/\"`。删除 path `cookiePathRewrite: \"\"`，设置为根路径`cookiePathRewrite: \"/\"`\r\n  - object, 按照对应关系替换，使用`\"*\"`匹配所有的 path，例如：\r\n\r\n```javascript\r\ncookiePathRewrite: {\r\n  \"/unchanged_path/\": \"/unchanged_path/\",   //保存不变\r\n  \"/old_path/\": \"/new_path/\",               // 替换为新的path\r\n  \"*\": \"\"                                   // 删除其它的path\r\n}\r\n```\r\n\r\n- **headers**: 类型`object`，默认`null`, 设置额外的请求头到目标请求上。\r\n\r\n- **proxyTimeout**: 类型`number`，默认`0`, 单位毫秒，发往目标服务器请求 socket 超时时间。\r\n\r\n- **timeout**: 类型`number`，默认`0`, 单位毫秒，接收客户端请求 socket 超时时间。\r\n\r\n- **followRedirects**: 类型`bool`，默认`false`, 和目标服务器通信是自动处理重定向。\r\n\r\n- **onError**: 当发生异常时触发该事件。代理内部不会处理任何的异常信息，包括客户端和代理之间通信时发现的异常，以及代理和目标服务器通信时发现的异常，所以我们建议由你来监听和处理异常。\r\n\r\n```javascript\r\nfunction onError(err, req, res) {\r\n  res.writeHead(500, {\r\n    \"Content-Type\": \"text/plain\",\r\n  });\r\n\r\n  res.end(\"Something went wrong. And we are reporting a custom error message.\");\r\n}\r\n```\r\n\r\n- **onProxyReq**: 代理向目标服务器发送数据之前触发该事件，可以在这里修改 proxyReq 请求对象，适用于 websocket 类型的连接。\r\n\r\n```javascript\r\nfunction onProxyReq(proxyReq, req, res) {\r\n  console.log(\"Target path\", proxyReq.path);\r\n}\r\n```\r\n\r\n- **onProxyReqWs**: 代理向目标服务器发送数据之前触发该事件，可以在这里修改 proxyReq 请求对象。适用于 websocket 类型的连接。\r\n\r\n```javascript\r\nfunction onProxyReqWs(proxyReq, req, res) {\r\n  console.log(\"Target path\", proxyReq.path);\r\n}\r\n```\r\n\r\n- **onProxyRes**: 当从目标服务器得到响应时触发，可以在这里得到响应的数据，对数据进行编辑，然后输出给客户端。\r\n\r\n```javascript\r\nfunction onProxyRes(proxyRes, req, res) {\r\n  console.log(\"RAW Response from the target\", JSON.stringify(proxyRes.headers, true, 2));\r\n}\r\n```\r\n\r\n- **onOpen**: 当代理和目标服务器的 websocket 创建完成，并且管道建立连接时触发一次。\r\n\r\n```javascript\r\nfunction onOpen(proxySocket) {\r\n  // listen for messages coming FROM the target here\r\n  proxySocket.on(\"data\", hybiParseAndLogMessage);\r\n}\r\n```\r\n\r\n- **onClose**: 当代理的 websocket 关闭时触发一次。\r\n\r\n```javascript\r\nfunction onClose(res, socket, head) {\r\n  // view disconnected websocket connections\r\n  console.log(\"Client disconnected\");\r\n}\r\n```\r\n\r\n## 发送请求 fetch\r\n\r\n和浏览器端的[fetch](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch)完全兼容，`@sympy/joy/fetch`提供了额外功能：\r\n\r\n- 在浏览器和 node.js 都可以正常运行，可实现一份代码多处运行，在启用服务器渲染时，这是必须的。\r\n- 自动代理，当检测到跨域请求，请求将被自动转发到[代理服务器](#代理服务)上，再由代理发送请求到目标服务器，最后将数据返回给客户端。如果使用`joy dev`以开发模式运行应用，该特性默认开启，方便前后端分离开发。\r\n\r\n```javascript\r\nimport fetch from \"@symph/joy/fetch\";\r\n\r\n// 下面是跨域请求\r\nfetch(\"https://news-at.zhihu.com/api/3/news/hot\").then((respone) =\u003e {\r\n  // 处理数据\r\n});\r\n\r\n// or\r\nasync function fetchData() {\r\n  let response = await fetch(\"https://news-at.zhihu.com/api/3/news/hot\", { method: \"GET\" });\r\n}\r\n```\r\n\r\n如果关闭代理转发功能，例如使用 cors 来完成跨域请求，可以在 fetch 的 options 参数明确设定`mode='cors'`\r\n\r\n```javascript\r\nimport fetch from \"@symph/joy/fetch\";\r\n\r\nasync function fetchData() {\r\n  let response = await fetch(\"https://news-at.zhihu.com/api/3/news/hot\", { method: \"GET\", mode: \"cors\" });\r\n}\r\n```\r\n\r\n当`joy.config.js`的`autoProxy`开启时，默认代理路径为`http://my_host.com/__proxy/`，如我们将其部署在`http://my_host.com/h5/__new_proxy/`时，需要通过`proxyPath`参数设置代理访问路径，例如：\r\n\r\n```javascript\r\nimport fetch from \"@symph/joy/fetch\";\r\n\r\nasync function fetchData() {\r\n  let response = await fetch(\"https://news-at.zhihu.com/api/3/news/hot\", { method: \"GET\", proxyPath: \"/h5/__new_proxy/\" });\r\n}\r\n```\r\n\r\n\u003e 也可以使用其它的类似解决方案，例如：[node-http-proxy](https://github.com/nodejitsu/node-http-proxy#using-https)、[express-http-proxy](https://github.com/villadora/express-http-proxy)等。我们内建了这个服务，是为了可以像原生端开发人员一样，更专注于业务开发。\r\n\r\n## 应用组件\r\n\r\n@symph/joy 采用 [MVC 组件](https://lnlfps.github.io/symph-joy/#/thinking-in-joy?id=mvc%E7%9A%84%E6%80%9D%E8%80%83) 来规范应用各组件的职责。\r\n\r\n- Model 类: 管理应用行为，其内部状态保存着应用数据，业务运行中不断更新内部状态，控制业务流和数据流的流转。\r\n- View 组件: 负责展示应用数据，继承 React.Component\r\n- Controller 组件: 控制和协调 View 和 Model，绑定 Model 数据到 View，响应用户的操作，调用 Model 中的业务, 其继承于 React.Component，或是实现了 hook 的函数组件。\r\n\r\n![app work flow](https://github.com/lnlfps/static/blob/master/symphony-joy/images/app-work-flow.jpeg?raw=true)\r\n\r\n图中蓝色的箭头表示数据流的方向，红色箭头表示控制流的方向，他们都是单向流。和[redux](https://redux.js.org/)的运行流程一样，store 中的`state`对象是不可修改的，状态发生改变后，都会生成一个新的 state 对象，且只将有变化的部分更新到界面上。\r\n\r\n\u003e 这里只是对 redux 进行 MVC 层面的封装，并未添加新的技术，依然可以使用 redux 的原生接口，如果想深入了解 redux，请阅读其详细文档：[redux](https://redux.js.org/)\r\n\r\n### 依赖注入 @autowire\r\n\r\n依赖注入是指，组件在创建的时候，系统自动将其所依赖的其它组件对象传递给它，这使组件内部不再负责其它依赖组件的引用和初始化，系统将保证其内部各组件以正确的顺序初始化，并管理初始化后的组件。在@symph/joy 中，Controller 依赖于 Model 实现业务调用，Model 也可能需要其它 Model 共同完成一件事情，系统将在需要的时候加载 Model 并初始化它。\r\n\r\n下面简单介绍下如何在 Controller 中申明依赖的 Model，以及如何调用 Model 中的业务方法，本文稍后将详细接受 Controller 和 Model 组件。\r\n\r\n```javascript\r\nimport React from \"react\";\r\nimport controller from \"@symph/joy/controller\";\r\nimport autowire from \"@symph/joy/autowire\";\r\nimport UserModel from \"./UserModel\";\r\n\r\n@controller()\r\nexport default class Comp extends React.Component {\r\n  @autowire()\r\n  userModel: UserModel;\r\n\r\n  onClickBtnLogin = () =\u003e {\r\n    this.userModel.login();\r\n  };\r\n\r\n  render() {\r\n    // ...\r\n  }\r\n}\r\n```\r\n\r\n`@autowire()`装饰器申明一个属性需要依赖注入，`userModel: UserModel`是 ES6 申明类实例属性的语法，`: UserModel`部分是 TypeScript 的类型申明语法，声明该属性的类型为`UserModel`。系统将在初始化该组件的时候，自动注入`UserModel`的实例到该属性上，之后就可以通过`this.userModel.login()`的方式调用 model 中定义的业务方法。\r\n\r\n### Model\r\n\r\nModel 管理应用的行为和数据，Model 拥有初始状态`initState`和更新状态的方法`setState(nextState)`，这和 Component 的 state 概念类似，业务在执行的过程中，不断更新`state`，当`state`发生改变时，和`state`绑定的 View 也会自动的更新。这里并没有什么魔法和创造新的东西，只是将 redux 的`action`、`actionCreator`、\u001b`reducer`、`thunk`、`saga`等复杂概念简化为业务方法和业务数据两个概念，让我们更专注于业务实现.\r\n\r\n下面是一个简单的 model 示例：\r\n\r\n```javascript\r\nimport model from \"@symph/joy/model\";\r\nimport fetch from \"@symph/joy/fetch\";\r\n\r\n@model()\r\nexport default class TodosModel {\r\n  // the mount point of store state tree, must unique in the app.\r\n  namespace = \"todos\";\r\n\r\n  // this is the initial state of model\r\n  initState = {\r\n    pageSize: 5,\r\n    count: 0,\r\n    entities: [],\r\n  };\r\n\r\n  async getTodos({ pageIndex = 0, pageSize = 5 }) {\r\n    // fetch remote data\r\n    let reponse = await fetch(\"https://www.example.com/api/hello\", { body: { pageIndex, pageSize } });\r\n    let pagedTodos = await response.json();\r\n\r\n    let { entities } = this.getState();\r\n    if (lastId === 0) {\r\n      // first page\r\n      entities = pagedTodos;\r\n    } else {\r\n      entities = [...entities, ...pagedTodos];\r\n    }\r\n\r\n    // update model's state\r\n    this.setState({\r\n      entities,\r\n      pageIndex,\r\n      pageSize,\r\n    });\r\n  }\r\n}\r\n```\r\n\r\n我们使用`@model()`将一个类声明为 Model 类，Model 类在实例化的时候会添加`getState`、`setState`，`dispatch`等快捷方法。\r\n\r\n#### Model API\r\n\r\n##### namespace\r\n\r\nmodel 将会被注册到 redux store 中，由 store 统一管理 model 的状态，使用`store.getState()[namespace]`来访问对应 model 的 state, store 中不能存在两个相同的`namespace`的 model。\r\n\r\n##### initState\r\n\r\n设置 model 的初始化状态，由于`model.state`可能会被多个`async`业务方法同时操作，所以为了保证 state 的有效性，请在需要使用 state 时使用`getState()`来获取当前 state 的最新值，并使用`setState(nextState)`方法更新当前的 state。\r\n\r\n##### setState(nextState)\r\n\r\n`setState(nextState)`更新 model 的状态，`nextState`是当前 state 的一个子集，系统将使用浅拷贝的方式合并当前的状态。\r\n\r\n##### getState()\r\n\r\n`getState()`获取当前 model 的状态。\r\n\r\n##### getStoreState()\r\n\r\n`getStoreState(）`获取当前整个 store 的状态。\r\n\r\n##### dispatch(action)\r\n\r\n返回值：Promise，被调用业务的返回值。\r\n\r\n在 model 中使用`await this.dispatch(action)`调用其它业务方法，这和 redux 的`store.dispatch(action)`的使用一样，由系统分发`action`到指定的 model 业务方法中, `action.type`的格式为`modelNamespace/serviceFunction`。\r\n\r\n如果是调用 model 自身的业务方法，可以使用`await this.otherService(options)`的方式，`this`指的是 model 本身。\r\n\r\n#### 业务方法\r\n\r\n我们可以在 Model 中定义任意的实例方法来实现业务逻辑，例如：`async getTodos()` ，该方法是一个`async`函数，所以可以轻松的使用`await`指令来实现异步逻辑调用，以及调用其它业务方法。\r\n\r\n调用方式：\r\n\r\n1. `todosModel.getTodos({lastId: 0, pagesSize:5})` 在 Model 的实例上直接调用\r\n2. `dispatch({type:\"todos/getTodos\", lastId: 0, pageSize: 5})` 通过 redux 的 dispatch 方法，调用当前 store 中已注册的 model 实例上的方法。\r\n\r\n### Controller\r\n\r\nController 需要申明其依赖哪些 Model，并绑定 Model 的中的状态，以及调用 Model 里的业务方法。它是一个 React 组件，可以像其它 React 组件一样创建和使用，新增了[`async componentPrepare()`](https://lnlfps.github.io/symph-joy/#/thinking-in-joy?id=componentprepare-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F)生命周期方法，在组件执行完构造方法后执行，在服务端渲染时，会等待其执行完成后，再渲染出 html，接着在浏览器上运行时，会直接使用在服务端 prepare 得到的数据，不再执行该方法。如果没有启用服务端渲染，或者在浏览器上动态加载 Controller 组件时，该方法将在组件初始化完成后，立即上运行。在一次页面请求的过程中，系统会保证该方法只执行一次，避免重复加载数据。\r\n\r\n```javascript\r\nimport React, { Component } from \"react\";\r\nimport TodosModel from \"../models/TodosModel\";\r\nimport { controller } from \"@symph/joy/controller\";\r\nimport { autowire } from \"@symph/joy/autowire\";\r\n\r\n@controller((state) =\u003e {\r\n  // state is store's state\r\n  return {\r\n    todos: state.todos.entities, // bind model's state to props\r\n  };\r\n})\r\nexport default class IndexController extends Component {\r\n  @autowire()\r\n  todosModel: TodosModel; // register model\r\n\r\n  async componentPrepare() {\r\n    // call model\r\n    await this.todosModel.getTodos({ pageIndex: 0, pageSize: 5 });\r\n    // or use dispatch to call model\r\n    // await this.props.dispath({type: 'todos/getTodos', pageIndex: 0, pageSize: 5})\r\n  }\r\n\r\n  render() {\r\n    let { todos = [] } = this.props;\r\n    return (\r\n      \u003cdiv\u003e\r\n        \u003cdiv\u003eTodo List\u003c/div\u003e\r\n        \u003cdiv\u003e\r\n          {todos.map((todo, i) =\u003e {\r\n            return (\r\n              \u003cdiv key={todo.id}\u003e\r\n                {todo.id}:{todo.content}\r\n              \u003c/div\u003e\r\n            );\r\n          })}\r\n        \u003c/div\u003e\r\n      \u003c/div\u003e\r\n    );\r\n  }\r\n}\r\n```\r\n\r\n创建和使用 Controller 的步骤：\r\n\r\n- 使用`@controller(mapStateToProps)`装饰器将一个普通的 Component 声明为一个 Controller，参数`mapStateToProps`实现 model 状态和组件 props 属性绑定，当 model 的 state 发生改变时，会触发组件使用新数据重新渲染界面。\r\n\r\n- `@autowire()`声明该属性的类型是一个 Model，运行时，`@symph/joy`将自动初始化该 Model，并绑定到该属性上。打包时，Controller 依赖的 Model 也将一起打包 thunk 中，这样在 controller 运行时，才会去加载依赖的 Model。\r\n\r\n- 每个 controller 的`props`会被注入一个`dispatch`方法，`dispatch`是 redux 提供的方法，我们可以由此来调用 model、reducer、effect 等 redux 支持的方法。\r\n\r\n### View\r\n\r\nView 是一个普通的 React 组件，其只负责界面展示，展示的数据来自父组件，通过`this.props`属性读取。\r\n\r\n```javascript\r\nimport React, { Component } from \"react\";\r\n\r\nexport default class ImageView extends Component {\r\n  render() {\r\n    let { src } = this.props;\r\n    return \u003cimg src={src} /\u003e;\r\n  }\r\n}\r\n```\r\n\r\n### Hooks\r\n\r\n`@symph/joy/hooks`提供了一些 hook，以便在 React 函数组件中，获取 Model 的状态，以及调用 Model 中的业务方法。\r\n\r\n`React.useEffect` hook 是在 render 以后执行，类似于`componentDidMount`和`componentDidUpdate`生命周期，在服务端渲染时，`React.useEffect`不会被执行，因此我们也无法获取到应用数据，渲染出需要的界面。 所以在编译期，`@symph/joy`所以使用了`@symph/joy/hook`中的同名方法`useEffect`方法替换了`React.useEffect`，使其支持服务端渲染，以及防止数据重复加载等问题。如果你想保持其默认行为，可以在代码中直接使用用`@symph/joy/hook`中的`useReactEffect`，它只是`React.useEffect`的别名。\r\n\r\n下面示例了如果在函数组件中使用 hook\r\n\r\n```javascript\r\nimport React, { useCallback, useEffect } from \"react\";\r\nimport { useMappedState, useModel } from \"@symph/tempo/hook\";\r\nimport TodosModel from \"../models/TodosModel\";\r\n\r\nexport default function TodoDetailController({ match }) {\r\n  const todoId = Number(match.params.id);\r\n  const [todosModel] = useModel([TodosModel]);\r\n\r\n  // Declare your memoized mapState function\r\n  const mapState = useCallback(\r\n    (state) =\u003e {\r\n      // state is store's state\r\n      return {\r\n        todo: state.todos.details[todoId],\r\n      };\r\n    },\r\n    [todoId]\r\n  );\r\n  // Get data from and subscribe to the store\r\n  let { todo } = useMappedState(mapState);\r\n\r\n  useEffect(() =\u003e {\r\n    todosModel.getTodo(todoId);\r\n  }, [todoId]);\r\n\r\n  if (todo) {\r\n    return \u003cdiv\u003eloading...\u003c/div\u003e;\r\n  }\r\n  return (\r\n    \u003cdiv className={styles.root}\u003e\r\n      \u003ch1\u003eTodo Detail\u003c/h1\u003e\r\n      \u003cdiv\u003e\r\n        \u003cdiv\u003eID: {todo.id}\u003c/div\u003e\r\n        \u003cdiv\u003econtent: {todo.content}\u003c/div\u003e\r\n      \u003c/div\u003e\r\n    \u003c/div\u003e\r\n  );\r\n}\r\n```\r\n\r\n#### Hooks API\r\n\r\n##### useMappedState(mapState)\r\n\r\nmapState: `useCallback((state) =\u003e newState, inputs)` 和 mapStateToProps 方法类似，用于获取和绑定 model 中的状态，返回供组件使用的状态对象。\r\n\r\n这里需要使用`React.useCallback`对状态映射函数进行包装，可避免每次 render 都执行一次状态绑定。\r\n\r\n```javascript\r\n// Declare your memoized mapState function\r\nconst mapState = useCallback(\r\n  (state) =\u003e {\r\n    // state is store's state\r\n    return {\r\n      todo: state.todos.details[todoId],\r\n    };\r\n  },\r\n  [todoId]\r\n);\r\n// Get data from and subscribe to the store\r\nlet { todo } = useMappedState(mapState);\r\n```\r\n\r\n##### useModel(modelArray)\r\n\r\nmodelArray: 数组类型，元素为需要使用的 Model 的 class。\r\n\r\n返回值: 数组类型，返回 Model 类的实例，和 modelArray 参数中传入的 class 列表一一对应。\r\n\r\n我们传入 Model 的 class 类，得到 Model 的实例，这里依然使用了依赖注入的部分概念，不用关系 Model 如何被加载和初始化的，系统会在适当的时候处理这些，我们在业务组件里，只需要关心拿到 Model 实例，以及调用他们。\r\n\r\n```javascript\r\nimport UserModel from \"./UserModel\";\r\nimport TodoModel from \"./TodoModel\";\r\n\r\nconst [userModel, todoModel] = useModel([UserModel, TodoModel]);\r\n```\r\n\r\n##### useDispatch()\r\n\r\n返回值: 返回`dispatch`方法，用于调用`redux`的原生 api。\r\n\r\n```javascript\r\nconst dispatch = useDispatch();\r\n```\r\n\r\n##### useEffect(effect, inputs)\r\n\r\n和[`React.useEffect`](https://reactjs.org/docs/hooks-reference.html#useeffect)和用途和用法一样，但该方法支持服务端渲染。开发者一般不会直接调用该方法，`@symph/joy`在编译期间，会使用该方法替换`React.useEffect`，以保证应用内的`useEffect`在服务端渲染时，被正确的执行。\r\n\r\n**effect**: 副作用函数\r\n\r\n**inputs**: 数组类型，只有当数组内的元素值发生改变后，`effect`才会被重新执行。 等于`[]`空数组时，`effect`函数只执行一次， 等于`undefined`时，`effect`每次都会执行。\r\n\r\n```javascript\r\nuseReactEffect(() =\u003e {\r\n  const subscription = props.source.subscribe();\r\n  return () =\u003e {\r\n    subscription.unsubscribe();\r\n  };\r\n}, [props.source]);\r\n```\r\n\r\n##### useReactEffect(effect, inputs)\r\n\r\n等于 react 原生提供的`React.useEffect`，`@symph/joy`默认会对`React.useEffect`进行封装，以便其支持服务端渲染，如果需要屏蔽该默认行为，请在代码中直接使用该方法替换`React.useEffect`。\r\n\r\n#### 兼容 Dva\r\n\r\n@symph/joy 兼容 dva 的 Model 开发模式，[Dva 概念 官方文档](https://dvajs.com/guide/concepts.html#models)\r\n\r\n```javascript\r\nimport { controller, requireModel } from \"@symph/joy/controller\";\r\nimport MyDvaModel from \"./MyDvaModel\";\r\n\r\n@requireModel(MyDvaModel)\r\n@controller()\r\nclass MyComponent extends Component {\r\n  componentDidMount() {\r\n    this.props.dispatch({\r\n      type: \"myDvaModel/getData\",\r\n    });\r\n  }\r\n\r\n  // ...\r\n}\r\n```\r\n\r\n使用`@requireModel()`注册 dva 的 model，其它使用方法和 dva 保持一致\r\n\r\n## Router\r\n\r\n请查看 [react-router-4 官方文档](https://reacttraining.com/react-router/web/example/basic)\r\n\r\n### 导入方法\r\n\r\n```javascript\r\nimport {\r\n  StaticRouter,\r\n  BrowserRouter,\r\n  Switch,\r\n  Route,\r\n  createServerRouter,\r\n  createClientRouter,\r\n  Link,\r\n  HashRouter,\r\n  NavLink,\r\n  Prompt,\r\n  MemoryRouter,\r\n  Redirect,\r\n  Router,\r\n  withRouter,\r\n  routerRedux,\r\n} from \"@symph/joy/router\";\r\n```\r\n\r\n### react-router-redux\r\n\r\n在代码中控制页面跳转\r\n\r\n```javascript\r\nimport {routerRedux} from '@symph/joy/router'\r\n\r\n...\r\n  dispatch(routerRedux.push('/abount')))\r\n\r\n  //or\r\n  dispatch(routerRedux.push({\r\n    pathname: '/about',\r\n    search: `?x=xxx`\r\n  }))\r\n...\r\n\r\n```\r\n\r\n## 代码启动 Server\r\n\r\n如果需要把`@symph/joy`集成到`express`、`koa`等服务端框架中，可以使用代码启动`@symph/joy`应用。\r\n\r\n下面例子展示如何集成到 express 中，并且修改路由`\\a`到`\\b`.\r\n\r\n```js\r\n// server.js\r\nconst express = require(\"express\");\r\nconst joy = require(\"@symph/joy\");\r\n\r\nconst port = parseInt(process.env.PORT, 10) || 3000;\r\nconst dev = process.env.NODE_ENV !== \"production\";\r\nconst app = joy({ dev, dir: \".\" });\r\nconst handle = app.getRequestHandler();\r\n\r\nconst server = express();\r\nconst preapredApp = app.prepare();\r\n\r\nserver.get(\"/a\", (req, res) =\u003e {\r\n  preapredApp.then(() =\u003e {\r\n    return app.render(req, res, \"/b\", req.query);\r\n  });\r\n});\r\n\r\nserver.get(\"*\", (req, res) =\u003e {\r\n  preapredApp.then(() =\u003e {\r\n    return handle(req, res);\r\n  });\r\n});\r\n\r\nserver.listen(port, (err) =\u003e {\r\n  if (err) throw err;\r\n  console.log(`\u003e Ready on http://localhost:${port}`);\r\n});\r\n```\r\n\r\n\u003e 集成到已有的 express 服务器中时，我们的应用通常是挂载到 url 的某个子路径上的，此时请参考[assetPrefix](./configurations#assetPrefix)的配置说明。\r\n\r\n`joy(options: object)` API 提供以下参数：\r\n\r\n- dev: bool: false 设置为 true 时，启动开发调试模式，将实时编译源代码、启动热更新等，关闭时，直接运行提前编译好的目标代码(`.joy`目录)。\r\n- dir: string: '.' \b 应用放置的路径，相对于 server.js 文件\r\n- quiet: bool: false 是否隐藏服务器错误信息\r\n- conf: object: {} 和`joy.config.js`相同的配置对象，如果设置了该值，则忽略`joy.config.js`文件。\r\n\r\n最后修改 NPM `start`脚本:\r\n\r\n```json\r\n// package.json\r\n{\r\n  \"scripts\": {\r\n    \"build\": \"build-your-code \u0026\u0026 joy build\",\r\n    \"start\": \"NODE_ENV=production node server.js\"\r\n  }\r\n}\r\n```\r\n\r\n\u003e 如果 express 作为业务服务器时，可以将@symph/joy 当作 express 的 View 模块来使用。\r\n\r\n## 按需加载 dynamic\r\n\r\n`@symph/joy`支持 JavaScript 的 TC39 [dynamic import](https://github.com/tc39/proposal-dynamic-import)提议，意味着你可以将代码分割为多个代码块，在浏览器上运行时，只加载当前需要的代码块。\r\n\r\n`@symph/joy/dynamic`模块实现了分割代码、动态加载等功能，下面展示了其 2 种用法：\r\n\r\n### 基础用法:\r\n\r\n```js\r\nimport dynamic from \"@symph/joy/dynamic\";\r\n\r\nconst DynamicComponent = dynamic({\r\n  loader: () =\u003e import(\"../components/hello\"),\r\n  ssr: true, // 如果关闭，服务端渲染时，该组件将不会被渲染。\r\n  loading: () =\u003e \u003cdiv\u003e...\u003c/div\u003e,\r\n});\r\n\r\nexport default () =\u003e (\r\n  \u003cdiv\u003e\r\n    \u003cHeader /\u003e\r\n    \u003cp\u003eHOME PAGE is here!\u003c/p\u003e\r\n    \u003cDynamicComponent /\u003e\r\n  \u003c/div\u003e\r\n);\r\n```\r\n\r\n### 一次加载多个模块\r\n\r\n```js\r\nimport dynamic from \"@symph/joy/dynamic\";\r\n\r\nconst HelloBundle = dynamic({\r\n  modules: {\r\n    Hello1: () =\u003e import(\"../components/hello1\"),\r\n    Hello2: () =\u003e import(\"../components/hello2\"),\r\n  },\r\n  render: (props, { Hello1, Hello2 }) =\u003e (\r\n    \u003cdiv\u003e\r\n      \u003ch1\u003e{props.title}\u003c/h1\u003e\r\n      \u003cHello1 /\u003e\r\n      \u003cHello2 /\u003e\r\n    \u003c/div\u003e\r\n  ),\r\n});\r\n\r\nexport default () =\u003e \u003cHelloBundle title=\"Dynamic Bundle\" /\u003e;\r\n```\r\n\r\n配置参数：\r\n\r\n- loader: function: null, 加载器，定义动态加载的内容\r\n- ssr: bool: true, 设置是否开启服务端渲染\r\n- loading: Component: `\u003cp\u003eloading...\u003c/p\u003e` 加载过程中，展示的动画组件\r\n\r\n## 自定义 `\u003cDocument\u003e`\r\n\r\n如果需要定制 html 文档的内容，例如引入 \b 额外的`\u003cscript\u003e`或`\u003clink\u003e`等，可在 src 目录中新建`_document.js`文件，参考下面的示例加入自定义的内容。\r\n\r\n```javascript\r\n// /src/_document.js\r\nimport Document, { Head, Main, JoyScript } from \"@symph/joy/document\";\r\n\r\nexport default class MyDocument extends Document {\r\n  render() {\r\n    return (\r\n      \u003chtml\u003e\r\n        \u003cHead\u003e\r\n          {/* add custom style */}\r\n          \u003clink rel=\"stylesheet\" href=\"/_joy/static/style.css\" /\u003e\r\n        \u003c/Head\u003e\r\n        \u003cbody\u003e\r\n          \u003cMain /\u003e\r\n          \u003cJoyScript /\u003e\r\n        \u003c/body\u003e\r\n      \u003c/html\u003e\r\n    );\r\n  }\r\n}\r\n```\r\n\r\n`_document.js`只在服务端渲染时使用，不会在浏览器端加载，所以不能在这里放置任何的业务代码，如果希望在整个应用里共享一部分功能，请将它们放到`src/index.js`应用入口组件中。\r\n\r\n## 自定义 Error 界面\r\n\r\n渲染时出现未捕获的异常时，可以自定义错误展示组件，来友好的提示或者引导用户，例如 500 错误。这只在`process.env.NODE_ENV=\"production\"`环境有效，在开发模式下，系统将展示详细的错误堆栈信息，来帮助开发人员定位问题。\r\n\r\n创建`src/_error.js`文件来替换默认的错误展示组件。\r\n\r\n```javascript\r\n// src/_error.js\r\n\r\nimport React from \"react\";\r\nimport Head from \"./head\";\r\n\r\nexport default class _Error extends React.Component {\r\n  render() {\r\n    const { statusCode, message } = this.props;\r\n    const title = statusCode === 404 ? \"This page could not be found\" : \"An unexpected error has occurred\";\r\n\r\n    return (\r\n      \u003cdiv\u003e\r\n        \u003cHead\u003e\r\n          \u003ctitle\u003e\r\n            {statusCode}: {title}\r\n          \u003c/title\u003e\r\n        \u003c/Head\u003e\r\n\r\n        \u003ch1\u003e{statusCode}\u003c/h1\u003e\r\n        \u003cdiv\u003e{message}\u003c/div\u003e\r\n      \u003c/div\u003e\r\n    );\r\n  }\r\n}\r\n```\r\n\r\n## 打包部署\r\n\r\n在 package.json 中配置一下脚本，用于打包和启动应用\r\n\r\n// package.json\r\n\r\n```json\r\n{\r\n  \"scripts\": {\r\n    \"dev\": \"joy dev\",\r\n    \"build\": \"joy build\",\r\n    \"start\": \"joy start\"\r\n  }\r\n}\r\n```\r\n\r\n1. 编译：运行`npm run build`命令，启动编译流程，生成可在浏览器和 node.js 里直接运行的目标代码，并对生成的代码进行压缩、混淆、分割等优化处理。编译后的代码放在`.joy`([distDir](./configurations#distDir)可自定义输出目录名称)目录中。\r\n2. 部署：将项目目录下的`.joy`、`package.json`、`node_modules`、`joy.config.js`文件复制到生产机器上。\r\n3. 启动应用：在生产机器上，运行`npm run start`启动应用。\r\n\r\n`@symph/joy` 可以部署到不同的域名或路径上，这需要对应用内引用的资源路径进行配置，参考[assetPrefix](./configurations#assetPrefix)的设置说明。\r\n\r\n\u003e 在运行`joy build`的时候，`NODE_ENV`被默认设置为`production`， 使用`joy dev`启动开发环境时，设置为`development`。如果你是在自定义的 Server 内启动应用，需要你自己设置`NODE_ENV=production`。\r\n\r\n## 静态版本部署\r\n\r\n`joy export`用于将`@symph/joy` app 输出为静态版本，只包含 html、js、css 等静态资源文件，不需要 node 作为服务器，可直接部署在 cCDN 或者静态资源服务器上，\b 浏览器端直接加载运行。静态版本仍然支持`@symph/joy`的大部分特性，比如：MVC\b 组件、动态路由、按需加载等。\r\n\r\n`joy export`的原理是提前假设用户的请求，预先 \b 将 React 应用渲染为 HTML 文件，\b 这和当请求到达 Node.js 服务器上时，实时渲染的工作流程类似。\r\n\r\n### 导出配置\r\n\r\n默认只导出首页，即 url `/` 根路径对应的页面，如果需要导出其它页面，请先在`joy.config.js`中设置[`exportPathMap`](./configurations#exportPathMap)。\r\n\r\n下面是一个简单的配置示例，配置了导出首页`index.html`和`about.html`这两个页面，且最终应用会部署到`http:www.example-cdn.com/my-app`这个静态 url 路径下。\r\n\r\n```js\r\n// joy.config.js\r\nmodule.exports = {\r\n  assetPath: \"http://www.example-cdn.com/my-app\",\r\n  exportPathMap: async function () {\r\n    return {\r\n      \"/\": null, // 导出首页\r\n      \"/about.html\": request, // 导出about.html页面，request为渲染页面的request参数对象，可以这样{query:{pageIndex:1}}设置query参数\r\n    };\r\n  },\r\n};\r\n```\r\n\r\n### 导出步骤\r\n\r\n在 package.json 中添加 NPM 脚本\r\n\r\n// package.json\r\n\r\n```json\r\n{\r\n  \"scripts\": {\r\n    \"build\": \"joy build\",\r\n    \"export\": \"npm run build \u0026\u0026 joy export\"\r\n  }\r\n}\r\n```\r\n\r\n执行 `npm run export` 执行导出过程，导出过程分为两步：\r\n\r\n1. 编译源码：运行`npm run build`命令，生成可在浏览器和 node.js 里直接运行的目标代码，并对生成的代码进行压缩、混淆、分割等优化处理。编译后的代码放在`.joy`([distDir](./configurations#distDir)可自定义输出目录名称)目录中。\r\n2. 导出静态版本: `joy export`命令，启动一个用于导出的 Node 服务器，导出`exportPathMap`中配置的页面。\r\n\r\n最终生成目录结构\r\n\r\n```\r\nproject\r\n|   .joy.config.js\r\n└---.joy\r\n|  |  server/\r\n|  |  static/\r\n|  |  build-manifest.json\r\n└---out\r\n|  |  _joy/\r\n|  |  static/\r\n|  |  index.html\r\n|  |  about.html\r\n|  ...\r\n```\r\n\r\n执行完导出操作后，应用根目录下将会生成`out`目录，其中包含在浏览器上运行时需要的所有文件。\r\n\r\n### 部署\r\n\r\n只需要将`out`目录中的内容部署到静态文件服务器，最终通过`http://www.example-cdn.com/my-app/about.html` url 路径，访问导出的`about.html`文件。\r\n\r\n\u003e 你可以定制`out`目录名称，请运行`joy export -h`指令，按提示操作。\r\n\r\n### 应用服务器配置\r\n\r\n\b 默认只渲染输出`index.html`文件，这也是单页面应用常见的入口页面，\b 浏览器加载该文件 \b 后，由浏览器端的路由组件[Router](https://reacttraining.com/react-router/web/example/basic)根据当前完整`window.location.href`路径，渲染具体的页面内容。\r\n\r\n这要求我们在业务服务器上，例如 JAVA 的 Spring MVC 中，使用正则路由来匹配应用内部的所有的页面路径，并都返回`index.js`这个文件，例如：`@RequestMapping(path=\"/**\", method=RequestMethod.GET)`。\r\n\r\n```java\r\n@Controller\r\n@RequestMapping(\"/**\")\r\npublic class ViewController {\r\n\r\n    @RequestMapping(path = \"/**\", method = RequestMethod.GET)\r\n    public Map\u003cString, Appointment\u003e pages() {\r\n       return \"forward:/static/index.html\";\r\n    }\r\n\r\n}\r\n```\r\n\r\n也可以在 nginx 中配置反向代理路由，当任何页面请求到达时，返回`index.html`文件给浏览器。\r\n\r\n下面的 nginx 配置例子展示了，在 nginx 服务器上，将`http://www.nginx-example.com/frontend-app/todo/1`请求代理到静态资源服务器`http://www.static-example.com/static-app/index.html`文件上。\r\n\r\n```\r\nlocation ^~ /frontend-app/ {\r\n            proxy_set_header X-Real-IP $remote_addr;\r\n            proxy_set_header X-http_x_forwarded_for $proxy_add_x_forwarded_for;\r\n            proxy_set_header Host $http_host;\r\n            rewrite /frontend-app/(.+)$ /static-app break;\r\n            proxy_pass http://www.static-example.com ;\r\n        }\r\n```\r\n","htmlContent":"\n                \u003ch1 id=\"%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97\"\u003e\n                  使用指南\n                \u003c/h1\u003e\n                \u003ch2 id=\"%E5%AE%89%E8%A3%85%E5%92%8C%E5%BC%80%E5%A7%8B\"\u003e\n                  安装和开始\n                \u003c/h2\u003e\u003cp\u003e运行\u003ccode\u003enpm init\u003c/code\u003e创建一个空工程，填写项目的基本信息，当然也可以在一个已有的项目中安装使用。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003enpm install --save @symph/joy react react-dom\n\u003c/code\u003e\u003c/pre\u003e\n\u003cblockquote\u003e\n\u003cp\u003e@symph/joy 只支持 \u003ca href=\"https://reactjs.org/blog/2017/09/26/react-v16.0.html\"\u003eReact 16\u003c/a\u003e及以上版本\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\b 添加 NPM 脚本到 package.json 文件：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-json\"\u003e\u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;scripts\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\u0026quot;dev\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;joy dev\u0026quot;\u003c/span\u003e\n  \u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e创建\u003ccode\u003e./src/index.js\u003c/code\u003e文件，并插入以下代码：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eReact\u003c/span\u003e, { \u003cspan class=\"hljs-title class_\"\u003eComponent\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eIndex\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title class_ inherited__\"\u003eComponent\u003c/span\u003e {\n  \u003cspan class=\"hljs-title function_\"\u003erender\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003eWelcome to symphony joy!\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e;\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e然后运行\u003ccode\u003enpm run dev\u003c/code\u003e 命令，在浏览器中输入访问地址\u003ccode\u003ehttp://localhost:3000\u003c/code\u003e。如果需要使用其它端口来启动应用 \u003ccode\u003enpm run dev -- -p \u0026lt;your port here\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e到目前为止，一个简单且完整的前端应用已经创建完成，接下来，我们可以开始进行业务开发了。例子完整工程：\u003ca href=\"https://github.com/lnlfps/symph-joy/tree/master/examples/hello-world\"\u003ehello-world\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e到这儿我们拥有了哪些功能呢？\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e应用入口（\u003ccode\u003e./src/index.js\u003c/code\u003e），一切都从这里开始，以后可以添加子路由、布局、Model 等组件\u003c/li\u003e\n\u003cli\u003e启动了一个调试服务器，支持服务端渲染和业务请求代理转发等\u003c/li\u003e\n\u003cli\u003e一个零配置的 webpack+babel 编译器，确保代码在 Node.js 和浏览器上正确运行\u003c/li\u003e\n\u003cli\u003eES6、7、8 等高级语法支持，如：\u003ccode\u003eimport\u003c/code\u003e、\u003ccode\u003eclass\u003c/code\u003e、\u003ccode\u003easync\u003c/code\u003e、\u003ccode\u003e@\u003c/code\u003e注解、\u003ccode\u003e{...}\u003c/code\u003e解构等\u003c/li\u003e\n\u003cli\u003e热更新，调试模式下，在浏览器不刷新的情况下，使更改立即生效\u003c/li\u003e\n\u003cli\u003e静态资源服务，在\u003ccode\u003e/static/\u003c/code\u003e目录下的静态资源，可通过\u003ccode\u003ehttp://localhost:3000/static/\u003c/code\u003e访问\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch2 id=\"%E6%A0%B7%E5%BC%8F-css\"\u003e\n                  样式 CSS\n                \u003c/h2\u003e\n                \u003ch3 id=\"jsx-%E5%86%85%E5%BB%BA%E6%A0%B7%E5%BC%8F\"\u003e\n                  jsx 内建样式\n                \u003c/h3\u003e\u003cp\u003e内建了 \u003ca href=\"https://github.com/zeit/styled-jsx\"\u003estyled-jsx\u003c/a\u003e 模块，无需配置，可直接使用。支持 Component 内独立域的 CSS 样式，不会和其他组件的同名样式冲突。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eReact\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e () =\u0026gt; (\n  \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    Hello world\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003escoped!\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003estyle\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ejsx\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"language-css\"\u003e{`\n      \u003cspan class=\"hljs-selector-tag\"\u003ep\u003c/span\u003e {\n        \u003cspan class=\"hljs-attribute\"\u003ecolor\u003c/span\u003e: blue;\n      }\n      \u003cspan class=\"hljs-selector-tag\"\u003ediv\u003c/span\u003e {\n        \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: red;\n      }\n      \u003cspan class=\"hljs-keyword\"\u003e@media\u003c/span\u003e (\u003cspan class=\"hljs-attribute\"\u003emax-width\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e600px\u003c/span\u003e) {\n        \u003cspan class=\"hljs-selector-tag\"\u003ediv\u003c/span\u003e {\n          \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: blue;\n        }\n      }\n    `}\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003estyle\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003estyle\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eglobal\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ejsx\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"language-css\"\u003e{`\n      \u003cspan class=\"hljs-selector-tag\"\u003ebody\u003c/span\u003e {\n        \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: black;\n      }\n    `}\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003estyle\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e查看 \u003ca href=\"https://www.npmjs.com/package/styled-jsx\"\u003estyled-jsx 详细使用文档\u003c/a\u003e\u003c/p\u003e\n\n                \u003ch3 id=\"import-css--less-%E6%96%87%E4%BB%B6\"\u003e\n                  Import CSS / LESS 文件\n                \u003c/h3\u003e\u003cp\u003e@symph/joy 提供下列插件来处理样式，默认支持 post-css、autoprefixer、css-modules、extract-text-webpack 等，具体使用方法请查看插件使用文档。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/lnlfps/joy-plugins/tree/master/packages/joy-css\"\u003e@symph/joy-css\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/lnlfps/joy-plugins/tree/master/packages/joy-less\"\u003e@symph/joy-less\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch3 id=\"%E5%AF%BC%E5%85%A5%E5%9B%BE%E7%89%87\"\u003e\n                  导入图片\n                \u003c/h3\u003e\u003cp\u003e\u003ca href=\"https://github.com/lnlfps/joy-plugins/tree/master/packages/joy-image\"\u003e@symph/joy-image\u003c/a\u003e插件提供图片导入功能，详细的配置请参见\u003ca href=\"https://github.com/lnlfps/joy-plugins/tree/master/packages/joy-image\"\u003e插件主页\u003c/a\u003e。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// joy.config.js\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e withLess = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy-less\u0026quot;\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e withImageLoader = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy-image\u0026quot;\u003c/span\u003e);\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = {\n  \u003cspan class=\"hljs-attr\"\u003eserverRender\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003eplugins\u003c/span\u003e: [\u003cspan class=\"hljs-title function_\"\u003ewithImageLoader\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003elimit\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e8192\u003c/span\u003e })],\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e使用方法\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// in jsx\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e () =\u0026gt; \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eimg\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{require(\u003c/span\u003e\u0026quot;\u003cspan class=\"hljs-attr\"\u003e.\u003c/span\u003e/\u003cspan class=\"hljs-attr\"\u003eimage.png\u003c/span\u003e\u0026quot;)} /\u0026gt;\u003c/span\u003e\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e在 css、less 文件中使用\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-css\"\u003e\u003cspan class=\"hljs-selector-class\"\u003e.bg\u003c/span\u003e {\n  \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003eurl\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;./image.png\u0026quot;\u003c/span\u003e);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch2 id=\"%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6\"\u003e\n                  静态文件\n                \u003c/h2\u003e\u003cp\u003e在工程根目录下创建\u003ccode\u003estatic\u003c/code\u003e目录，将静态文件放入其中，例如：图片、第三方 js、css 等，也可以创建子目录管理文件，可以通过\u003ccode\u003e{assetPrefix}/static/{file}\u003c/code\u003e访问这些文件，也可使用\u003ccode\u003easset\u003c/code\u003e方法得到最终的访问路径 。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e () =\u0026gt; \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eimg\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;/static/my-image.png\u0026quot;\u003c/span\u003e /\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e//or\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e asset \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;@symph/joy/asset\u0026#x27;\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e () =\u0026gt; \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eimg\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{asset(\u003c/span\u003e\u0026quot;/\u003cspan class=\"hljs-attr\"\u003emy-image.png\u003c/span\u003e\u0026quot;)} /\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch2 id=\"%E8%87%AA%E5%AE%9A%E4%B9%89-head\"\u003e\n                  自定义 Head\n                \u003c/h2\u003e\u003cp\u003e@symph/joy 提供了\u003ccode\u003eHead\u003c/code\u003e Component 来设置 html 页面的\u003ccode\u003e\u0026lt;head\u0026gt;\u003c/code\u003e标签中的内容\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eHead\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/head\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e () =\u0026gt; (\n  \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eHead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u0026gt;\u003c/span\u003eMy page title\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003emeta\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;viewport\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003econtent\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;initial-scale=1.0, width=device-width\u0026quot;\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eHead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003eHello world!\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e在\u003ccode\u003ehead\u003c/code\u003e中重复添加多个相同标签，可以给标签添加\u003ccode\u003ekey\u003c/code\u003e属性， 相同的 key 只会在 head 中输出一次。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eHead\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/head\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e () =\u0026gt; (\n  \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eHead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u0026gt;\u003c/span\u003eMy page title\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003emeta\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;viewport\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003econtent\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;initial-scale=1.0, width=device-width\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ekey\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;viewport\u0026quot;\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eHead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eHead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003emeta\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;viewport\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003econtent\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;initial-scale=1.2, width=device-width\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ekey\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;viewport\u0026quot;\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eHead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003eHello world!\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e在上面的例子中，只有第二个\u003ccode\u003e\u0026lt;meta key=\u0026quot;viewport\u0026quot; /\u0026gt;\u003c/code\u003e被渲染和添加到最终页面。\u003c/p\u003e\n\n                \u003ch2 id=\"%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1\"\u003e\n                  代理服务\n                \u003c/h2\u003e\u003cp\u003e\u003ccode\u003e@symph/joy\u003c/code\u003e内建了代理转发服务器，支持\u003ccode\u003eweb\u003c/code\u003e和\u003ccode\u003ewebsocket\u003c/code\u003e转发，请求由浏览器发送到代理服务器，再由代理服务器发送到业务服务器。\u003c/p\u003e\n\u003cp\u003e在\u003ccode\u003ejoy.config.js\u003c/code\u003e中配置代理服务器，下面实例如何开启代理服务器，并转发\u003ccode\u003e/api\u003c/code\u003e路径上的请求。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// joy.config.js 里配置代理点\u003c/span\u003e\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = {\n  \u003cspan class=\"hljs-attr\"\u003eproxy\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003eenable\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003eroutes\u003c/span\u003e: [\n      {\n        \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;web\u0026quot;\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;^/zhihu-api/\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// 匹配到该路径的请求，都会被转发到target指定的目标地址上。\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003etarget\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;https://news-at.zhihu.com\u0026quot;\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003epathRewrite\u003c/span\u003e: {\n          \u003cspan class=\"hljs-string\"\u003e\u0026quot;/zhihu-api/\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;/\u0026quot;\u003c/span\u003e,\n        },\n      },\n    ],\n  },\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 客户端浏览器上，通过该代理点请求数据\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efetchData\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-comment\"\u003e// 最终访问的地址为 https://news-at.zhihu.com/api/3/news/hot\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e response = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efetch\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;/zhihu-api/api/3/news/hot\u0026quot;\u003c/span\u003e, { \u003cspan class=\"hljs-attr\"\u003emethod\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;GET\u0026quot;\u003c/span\u003e });\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e和自定义 server 服务器集成，例如\u003ccode\u003eexpress\u003c/code\u003e，需要开发者将\u003ccode\u003e@symph/joy/proxy-middleware\u003c/code\u003e中间件注册到\u003ccode\u003eexpress\u003c/code\u003e中。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e express = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;express\u0026quot;\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e joy = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy\u0026quot;\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { createProxyMiddleware } = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/proxy-middleware\u0026quot;\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e dev = process.\u003cspan class=\"hljs-property\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eNODE_ENV\u003c/span\u003e !== \u003cspan class=\"hljs-string\"\u003e\u0026quot;production\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e server = \u003cspan class=\"hljs-title function_\"\u003eexpress\u003c/span\u003e();\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e app = \u003cspan class=\"hljs-title function_\"\u003ejoy\u003c/span\u003e({ dev });\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e handle = app.\u003cspan class=\"hljs-title function_\"\u003egetRequestHandler\u003c/span\u003e();\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e preparedApp = app.\u003cspan class=\"hljs-title function_\"\u003eprepare\u003c/span\u003e();\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e proxyOptions = { \u003cspan class=\"hljs-attr\"\u003eenable\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003edev\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e };\nserver.\u003cspan class=\"hljs-title function_\"\u003euse\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003ecreateProxyMiddleware\u003c/span\u003e(proxyOptions)); \u003cspan class=\"hljs-comment\"\u003e//register proxy,\u003c/span\u003e\nserver.\u003cspan class=\"hljs-title function_\"\u003euse\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ereq, res, next\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n  preparedApp.\u003cspan class=\"hljs-title function_\"\u003ethen\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-title function_\"\u003ehandle\u003c/span\u003e(req, res);\n  });\n});\nserver.\u003cspan class=\"hljs-title function_\"\u003elisten\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003ecreateProxyMiddleware(options)\u003c/code\u003e支持的参数和在\u003ccode\u003ejoy.config.js\u003c/code\u003e中配置\u003ccode\u003eproxy\u003c/code\u003e时一致。\u003c/p\u003e\n\n                \u003ch3 id=\"%E4%BD%BF%E7%94%A8%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9\"\u003e\n                  使用注意事项\n                \u003c/h3\u003e\u003cul\u003e\n\u003cli\u003e前端域名下的 cookie 会一起发送到目标服务器，如对目标服务器不信任，需采取措施来避免数据的泄露和冲突，例如监听\u003ccode\u003eonProxyReq\u003c/code\u003e事件，在 proxy 发送请求到目标服务器之前，去掉敏感数据。\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch3 id=\"proxy-%E9%85%8D%E7%BD%AE\"\u003e\n                  proxy 配置\n                \u003c/h3\u003e\u003cul\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003eenable\u003c/strong\u003e: 类型\u003ccode\u003ebool\u003c/code\u003e，默认\u003ccode\u003etrue\u003c/code\u003e， 如果为 false，将关闭整个代理服务器。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003eautoProxy\u003c/strong\u003e: 类型\u003ccode\u003ebool\u003c/code\u003e，开发环境(NODE_ENV=development)默认 true，其它环境默认 false。配置自动代理服务，在浏览器上使用\u003ca href=\"#%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82-fetch\"\u003e\u003ccode\u003e@symph/joy/fetch\u003c/code\u003e\u003c/a\u003e发送请求，在浏览器上\u003ccode\u003e@symph/joy/fetch\u003c/code\u003e检测到请求跨域了，会将请求地址转为\u003ccode\u003e${proxy.host}/__proxy/${pathname}\u003c/code\u003e，请请求发送到代理服务器，再由代理发送请求到目标服务器。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e注意：在生产环境，要谨慎使用\u003ccode\u003eautoProxy\u003c/code\u003e自动代理服务器，以防被人恶意利用，例如试探内部网络和接口、或者转发恶意非法请求、网络攻击等。在生产环境，建议使用\u003ccode\u003eproxy.routes\u003c/code\u003e配置，明确定义每个代理点的行为，避免越界使用。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003eroutes\u003c/strong\u003e: 类型\u003ccode\u003eProxyRoute\u003c/code\u003e的数组，默认空，设置各个代理点。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003edev\u003c/strong\u003e: 类型\u003ccode\u003ebool\u003c/code\u003e，默认\u003ccode\u003efalse\u003c/code\u003e，开启调试模式后，会打印一些代理日志。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch4 id=\"proxyroute-%E9%85%8D%E7%BD%AE\"\u003e\n                  ProxyRoute 配置\n                \u003c/h4\u003e\u003cul\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003epath\u003c/strong\u003e: 类型\u003ccode\u003estring\u003c/code\u003e，不能为空，定义该代理点能处理的客户端请求路径，支持正则字符串，最终由 RegExp 生成正则表达式，和\u003ccode\u003erequest.path\u003c/code\u003e进行匹配。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003etarget\u003c/strong\u003e: 类型\u003ccode\u003estring\u003c/code\u003e, 不能为空，目标服务器地址，包含协议、域名、端口，也可以包含部分公共路径。例如：\u003ccode\u003ehttps://service.com:8080/api/v1\u003c/code\u003e。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003etype\u003c/strong\u003e: 类型\u003ccode\u003estring\u003c/code\u003e, 默认\u003ccode\u003eweb\u003c/code\u003e，支持\u003ccode\u003eweb\u003c/code\u003e和\u003ccode\u003ewebsocket\u003c/code\u003e。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003exfwd\u003c/strong\u003e: 类型\u003ccode\u003ebool\u003c/code\u003e，默认\u003ccode\u003etrue\u003c/code\u003e，在转发请求时，是否在发往目标服务器的请求里追加\u003ccode\u003ex-forwarded-xxx\u003c/code\u003e协议头。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003esecure\u003c/strong\u003e: 类型\u003ccode\u003ebool\u003c/code\u003e，默认\u003ccode\u003efalse\u003c/code\u003e，是否验证 SSL 证书。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003essl\u003c/strong\u003e: 类型\u003ccode\u003eObject\u003c/code\u003e，默认\u003ccode\u003enull\u003c/code\u003e，配置 https 连接，将会被传入 https.createServer()中。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003eignorePath\u003c/strong\u003e: 类型\u003ccode\u003ebool\u003c/code\u003e，默认\u003ccode\u003efalse\u003c/code\u003e，是否忽略客户端请求的 path 部分，如果为 true，则代理服务器发送请求到目标服务器上时，将不会包含原始请求的 path 部分。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003epathRewrite\u003c/strong\u003e: 类型\u003ccode\u003eObject\u003c/code\u003e，默认\u003ccode\u003enull\u003c/code\u003e, 重写客户端请求路径，可配置的值:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eObject, 但在对应关系替换，只替换第一次匹配到的路径。例如：\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e{\n  \u003cspan class=\"hljs-string\"\u003e\u0026quot;/old_path/\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;/new_path/\u0026quot;\u003c/span\u003e,  \u003cspan class=\"hljs-comment\"\u003e// 替换为新的path\u003c/span\u003e\n  \u003cspan class=\"hljs-string\"\u003e\u0026quot;/path/\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;/\u0026quot;\u003c/span\u003e,               \u003cspan class=\"hljs-comment\"\u003e// 删除path\u003c/span\u003e\n  \u003cspan class=\"hljs-string\"\u003e\u0026quot;/\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;/path/\u0026quot;\u003c/span\u003e                \u003cspan class=\"hljs-comment\"\u003e// 在路径前面添加新的path\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003eprependPath\u003c/strong\u003e: 类型\u003ccode\u003ebool\u003c/code\u003e，默认\u003ccode\u003etrue\u003c/code\u003e，将 target 定义 path 部分，添加到客户端请求 path 的前面。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003elocalAddress\u003c/strong\u003e: 类型\u003ccode\u003estring\u003c/code\u003e，默认\u003ccode\u003enull\u003c/code\u003e, 本地连接到远程的接口地址。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003echangeOrigin\u003c/strong\u003e: 类型\u003ccode\u003ebool\u003c/code\u003e，默认\u003ccode\u003etrue\u003c/code\u003e，改变客户端请求 header 中的 host 值，如果为 false，客户端在发送请求时，必须确保 header 中设置正确目标的 host，否则浏览器默认添加为代理服务器的 host 地址，这可能导致最终请求失败。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003epreserveHeaderKeyCase\u003c/strong\u003e: 类型\u003ccode\u003ebool\u003c/code\u003e，默认\u003ccode\u003etrue\u003c/code\u003e, 设置是否需要保持客户端请求 header 字段名称的大小写，默认会将 header 中的字段转换为全小写。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003eauth\u003c/strong\u003e: 类型\u003ccode\u003estring\u003c/code\u003e，默认\u003ccode\u003enull\u003c/code\u003e, 在发往目标服务器的请求中添加基本认证信息。例如：\u0026#39;user:password\u0026#39;。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003ehostRewrite\u003c/strong\u003e: 类型\u003ccode\u003estring\u003c/code\u003e，默认\u003ccode\u003enull\u003c/code\u003e，当 (201/301/302/307/308) 时，使用该值重写业务服务器响应 headers[\u0026quot;location\u0026quot;]里的 hostname。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003eautoRewrite\u003c/strong\u003e: 类型\u003ccode\u003ebool\u003c/code\u003e，默认\u003ccode\u003efalse\u003c/code\u003e, 当 (201/301/302/307/308) 时，基于客户端的原始请求，自动重写业务服务器响应 headers[\u0026quot;location\u0026quot;]里的 host/port。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003eprotocolRewrite\u003c/strong\u003e: 类型\u003ccode\u003estring\u003c/code\u003e，默认\u003ccode\u003enull\u003c/code\u003e，使用该值重写业务服务器响应 headers[\u0026quot;location\u0026quot;]里的协议部分，例如：http 或者 https。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003ecookieDomainRewrite\u003c/strong\u003e: 类型\u003ccode\u003ebool|string|object\u003c/code\u003e，默认\u003ccode\u003efalse\u003c/code\u003e，重写\u0026#39;set-cookie\u0026#39;头中的 domain，可配置的值:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ebool, 默认 false， 关闭 cookie 重写\u003c/li\u003e\n\u003cli\u003estring，新的 domain，例如：\u003ccode\u003ecookieDomainRewrite: \u0026quot;new.domain\u0026quot;\u003c/code\u003e。如果需要删除 domain，使用\u003ccode\u003ecookieDomainRewrite: \u0026quot;\u0026quot;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eobject, 按照对应关系替换，使用\u003ccode\u003e\u0026quot;*\u0026quot;\u003c/code\u003e匹配所有的 domain，例如：\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-attr\"\u003ecookieDomainRewrite\u003c/span\u003e: {\n  \u003cspan class=\"hljs-string\"\u003e\u0026quot;unchanged.domain\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;unchanged.domain\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e//保存不变\u003c/span\u003e\n  \u003cspan class=\"hljs-string\"\u003e\u0026quot;old.domain\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;new.domain\u0026quot;\u003c/span\u003e,             \u003cspan class=\"hljs-comment\"\u003e// 替换为新的domain\u003c/span\u003e\n  \u003cspan class=\"hljs-string\"\u003e\u0026quot;*\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e                                 \u003cspan class=\"hljs-comment\"\u003e// 删除其它的domain\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003ecookiePathRewrite\u003c/strong\u003e: 类型\u003ccode\u003ebool|string|object\u003c/code\u003e，默认\u003ccode\u003efalse\u003c/code\u003e，重写\u0026#39;set-cookie\u0026#39;头中的路径，可配置的值:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ebool, 默认 false， 关闭 cookie 重写， TODO 支持 true 选项，代表 auto 选项，自动根据原始请求设置该值\u003c/li\u003e\n\u003cli\u003estring，新的 path，例如：\u003ccode\u003ecookiePathRewrite: \u0026quot;/newPath/\u0026quot;\u003c/code\u003e。删除 path \u003ccode\u003ecookiePathRewrite: \u0026quot;\u0026quot;\u003c/code\u003e，设置为根路径\u003ccode\u003ecookiePathRewrite: \u0026quot;/\u0026quot;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eobject, 按照对应关系替换，使用\u003ccode\u003e\u0026quot;*\u0026quot;\u003c/code\u003e匹配所有的 path，例如：\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-attr\"\u003ecookiePathRewrite\u003c/span\u003e: {\n  \u003cspan class=\"hljs-string\"\u003e\u0026quot;/unchanged_path/\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;/unchanged_path/\u0026quot;\u003c/span\u003e,   \u003cspan class=\"hljs-comment\"\u003e//保存不变\u003c/span\u003e\n  \u003cspan class=\"hljs-string\"\u003e\u0026quot;/old_path/\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;/new_path/\u0026quot;\u003c/span\u003e,               \u003cspan class=\"hljs-comment\"\u003e// 替换为新的path\u003c/span\u003e\n  \u003cspan class=\"hljs-string\"\u003e\u0026quot;*\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e                                   \u003cspan class=\"hljs-comment\"\u003e// 删除其它的path\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003eheaders\u003c/strong\u003e: 类型\u003ccode\u003eobject\u003c/code\u003e，默认\u003ccode\u003enull\u003c/code\u003e, 设置额外的请求头到目标请求上。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003eproxyTimeout\u003c/strong\u003e: 类型\u003ccode\u003enumber\u003c/code\u003e，默认\u003ccode\u003e0\u003c/code\u003e, 单位毫秒，发往目标服务器请求 socket 超时时间。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003etimeout\u003c/strong\u003e: 类型\u003ccode\u003enumber\u003c/code\u003e，默认\u003ccode\u003e0\u003c/code\u003e, 单位毫秒，接收客户端请求 socket 超时时间。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003efollowRedirects\u003c/strong\u003e: 类型\u003ccode\u003ebool\u003c/code\u003e，默认\u003ccode\u003efalse\u003c/code\u003e, 和目标服务器通信是自动处理重定向。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003eonError\u003c/strong\u003e: 当发生异常时触发该事件。代理内部不会处理任何的异常信息，包括客户端和代理之间通信时发现的异常，以及代理和目标服务器通信时发现的异常，所以我们建议由你来监听和处理异常。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eonError\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eerr, req, res\u003c/span\u003e) {\n  res.\u003cspan class=\"hljs-title function_\"\u003ewriteHead\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e500\u003c/span\u003e, {\n    \u003cspan class=\"hljs-string\"\u003e\u0026quot;Content-Type\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;text/plain\u0026quot;\u003c/span\u003e,\n  });\n\n  res.\u003cspan class=\"hljs-title function_\"\u003eend\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Something went wrong. And we are reporting a custom error message.\u0026quot;\u003c/span\u003e);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eonProxyReq\u003c/strong\u003e: 代理向目标服务器发送数据之前触发该事件，可以在这里修改 proxyReq 请求对象，适用于 websocket 类型的连接。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eonProxyReq\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eproxyReq, req, res\u003c/span\u003e) {\n  \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Target path\u0026quot;\u003c/span\u003e, proxyReq.\u003cspan class=\"hljs-property\"\u003epath\u003c/span\u003e);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eonProxyReqWs\u003c/strong\u003e: 代理向目标服务器发送数据之前触发该事件，可以在这里修改 proxyReq 请求对象。适用于 websocket 类型的连接。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eonProxyReqWs\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eproxyReq, req, res\u003c/span\u003e) {\n  \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Target path\u0026quot;\u003c/span\u003e, proxyReq.\u003cspan class=\"hljs-property\"\u003epath\u003c/span\u003e);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eonProxyRes\u003c/strong\u003e: 当从目标服务器得到响应时触发，可以在这里得到响应的数据，对数据进行编辑，然后输出给客户端。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eonProxyRes\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eproxyRes, req, res\u003c/span\u003e) {\n  \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;RAW Response from the target\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eJSON\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003estringify\u003c/span\u003e(proxyRes.\u003cspan class=\"hljs-property\"\u003eheaders\u003c/span\u003e, \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e));\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eonOpen\u003c/strong\u003e: 当代理和目标服务器的 websocket 创建完成，并且管道建立连接时触发一次。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eonOpen\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eproxySocket\u003c/span\u003e) {\n  \u003cspan class=\"hljs-comment\"\u003e// listen for messages coming FROM the target here\u003c/span\u003e\n  proxySocket.\u003cspan class=\"hljs-title function_\"\u003eon\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;data\u0026quot;\u003c/span\u003e, hybiParseAndLogMessage);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eonClose\u003c/strong\u003e: 当代理的 websocket 关闭时触发一次。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eonClose\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eres, socket, head\u003c/span\u003e) {\n  \u003cspan class=\"hljs-comment\"\u003e// view disconnected websocket connections\u003c/span\u003e\n  \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Client disconnected\u0026quot;\u003c/span\u003e);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch2 id=\"%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82-fetch\"\u003e\n                  发送请求 fetch\n                \u003c/h2\u003e\u003cp\u003e和浏览器端的\u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch\"\u003efetch\u003c/a\u003e完全兼容，\u003ccode\u003e@sympy/joy/fetch\u003c/code\u003e提供了额外功能：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e在浏览器和 node.js 都可以正常运行，可实现一份代码多处运行，在启用服务器渲染时，这是必须的。\u003c/li\u003e\n\u003cli\u003e自动代理，当检测到跨域请求，请求将被自动转发到\u003ca href=\"#%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1\"\u003e代理服务器\u003c/a\u003e上，再由代理发送请求到目标服务器，最后将数据返回给客户端。如果使用\u003ccode\u003ejoy dev\u003c/code\u003e以开发模式运行应用，该特性默认开启，方便前后端分离开发。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e fetch \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/fetch\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment\"\u003e// 下面是跨域请求\u003c/span\u003e\n\u003cspan class=\"hljs-title function_\"\u003efetch\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;https://news-at.zhihu.com/api/3/news/hot\u0026quot;\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ethen\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003erespone\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-comment\"\u003e// 处理数据\u003c/span\u003e\n});\n\n\u003cspan class=\"hljs-comment\"\u003e// or\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efetchData\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e response = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efetch\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;https://news-at.zhihu.com/api/3/news/hot\u0026quot;\u003c/span\u003e, { \u003cspan class=\"hljs-attr\"\u003emethod\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;GET\u0026quot;\u003c/span\u003e });\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e如果关闭代理转发功能，例如使用 cors 来完成跨域请求，可以在 fetch 的 options 参数明确设定\u003ccode\u003emode=\u0026#39;cors\u0026#39;\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e fetch \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/fetch\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efetchData\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e response = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efetch\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;https://news-at.zhihu.com/api/3/news/hot\u0026quot;\u003c/span\u003e, { \u003cspan class=\"hljs-attr\"\u003emethod\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;GET\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003emode\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;cors\u0026quot;\u003c/span\u003e });\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e当\u003ccode\u003ejoy.config.js\u003c/code\u003e的\u003ccode\u003eautoProxy\u003c/code\u003e开启时，默认代理路径为\u003ccode\u003ehttp://my_host.com/__proxy/\u003c/code\u003e，如我们将其部署在\u003ccode\u003ehttp://my_host.com/h5/__new_proxy/\u003c/code\u003e时，需要通过\u003ccode\u003eproxyPath\u003c/code\u003e参数设置代理访问路径，例如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e fetch \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/fetch\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efetchData\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e response = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efetch\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;https://news-at.zhihu.com/api/3/news/hot\u0026quot;\u003c/span\u003e, { \u003cspan class=\"hljs-attr\"\u003emethod\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;GET\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eproxyPath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;/h5/__new_proxy/\u0026quot;\u003c/span\u003e });\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cblockquote\u003e\n\u003cp\u003e也可以使用其它的类似解决方案，例如：\u003ca href=\"https://github.com/nodejitsu/node-http-proxy#using-https\"\u003enode-http-proxy\u003c/a\u003e、\u003ca href=\"https://github.com/villadora/express-http-proxy\"\u003eexpress-http-proxy\u003c/a\u003e等。我们内建了这个服务，是为了可以像原生端开发人员一样，更专注于业务开发。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n                \u003ch2 id=\"%E5%BA%94%E7%94%A8%E7%BB%84%E4%BB%B6\"\u003e\n                  应用组件\n                \u003c/h2\u003e\u003cp\u003e@symph/joy 采用 \u003ca href=\"https://lnlfps.github.io/symph-joy/#/thinking-in-joy?id=mvc%E7%9A%84%E6%80%9D%E8%80%83\"\u003eMVC 组件\u003c/a\u003e 来规范应用各组件的职责。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eModel 类: 管理应用行为，其内部状态保存着应用数据，业务运行中不断更新内部状态，控制业务流和数据流的流转。\u003c/li\u003e\n\u003cli\u003eView 组件: 负责展示应用数据，继承 React.Component\u003c/li\u003e\n\u003cli\u003eController 组件: 控制和协调 View 和 Model，绑定 Model 数据到 View，响应用户的操作，调用 Model 中的业务, 其继承于 React.Component，或是实现了 hook 的函数组件。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/lnlfps/static/blob/master/symphony-joy/images/app-work-flow.jpeg?raw=true\" alt=\"app work flow\"\u003e\u003c/p\u003e\n\u003cp\u003e图中蓝色的箭头表示数据流的方向，红色箭头表示控制流的方向，他们都是单向流。和\u003ca href=\"https://redux.js.org/\"\u003eredux\u003c/a\u003e的运行流程一样，store 中的\u003ccode\u003estate\u003c/code\u003e对象是不可修改的，状态发生改变后，都会生成一个新的 state 对象，且只将有变化的部分更新到界面上。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e这里只是对 redux 进行 MVC 层面的封装，并未添加新的技术，依然可以使用 redux 的原生接口，如果想深入了解 redux，请阅读其详细文档：\u003ca href=\"https://redux.js.org/\"\u003eredux\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n                \u003ch3 id=\"%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5-autowire\"\u003e\n                  依赖注入 @autowire\n                \u003c/h3\u003e\u003cp\u003e依赖注入是指，组件在创建的时候，系统自动将其所依赖的其它组件对象传递给它，这使组件内部不再负责其它依赖组件的引用和初始化，系统将保证其内部各组件以正确的顺序初始化，并管理初始化后的组件。在@symph/joy 中，Controller 依赖于 Model 实现业务调用，Model 也可能需要其它 Model 共同完成一件事情，系统将在需要的时候加载 Model 并初始化它。\u003c/p\u003e\n\u003cp\u003e下面简单介绍下如何在 Controller 中申明依赖的 Model，以及如何调用 Model 中的业务方法，本文稍后将详细接受 Controller 和 Model 组件。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eReact\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e controller \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/controller\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e autowire \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/autowire\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eUserModel\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;./UserModel\u0026quot;\u003c/span\u003e;\n\n@\u003cspan class=\"hljs-title function_\"\u003econtroller\u003c/span\u003e()\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eComp\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title class_ inherited__\"\u003eReact.Component\u003c/span\u003e {\n  @\u003cspan class=\"hljs-title function_\"\u003eautowire\u003c/span\u003e()\n  \u003cspan class=\"hljs-attr\"\u003euserModel\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eUserModel\u003c/span\u003e;\n\n  onClickBtnLogin = \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003euserModel\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elogin\u003c/span\u003e();\n  };\n\n  \u003cspan class=\"hljs-title function_\"\u003erender\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003e@autowire()\u003c/code\u003e装饰器申明一个属性需要依赖注入，\u003ccode\u003euserModel: UserModel\u003c/code\u003e是 ES6 申明类实例属性的语法，\u003ccode\u003e: UserModel\u003c/code\u003e部分是 TypeScript 的类型申明语法，声明该属性的类型为\u003ccode\u003eUserModel\u003c/code\u003e。系统将在初始化该组件的时候，自动注入\u003ccode\u003eUserModel\u003c/code\u003e的实例到该属性上，之后就可以通过\u003ccode\u003ethis.userModel.login()\u003c/code\u003e的方式调用 model 中定义的业务方法。\u003c/p\u003e\n\n                \u003ch3 id=\"model\"\u003e\n                  Model\n                \u003c/h3\u003e\u003cp\u003eModel 管理应用的行为和数据，Model 拥有初始状态\u003ccode\u003einitState\u003c/code\u003e和更新状态的方法\u003ccode\u003esetState(nextState)\u003c/code\u003e，这和 Component 的 state 概念类似，业务在执行的过程中，不断更新\u003ccode\u003estate\u003c/code\u003e，当\u003ccode\u003estate\u003c/code\u003e发生改变时，和\u003ccode\u003estate\u003c/code\u003e绑定的 View 也会自动的更新。这里并没有什么魔法和创造新的东西，只是将 redux 的\u003ccode\u003eaction\u003c/code\u003e、\u003ccode\u003eactionCreator\u003c/code\u003e、\u001b\u003ccode\u003ereducer\u003c/code\u003e、\u003ccode\u003ethunk\u003c/code\u003e、\u003ccode\u003esaga\u003c/code\u003e等复杂概念简化为业务方法和业务数据两个概念，让我们更专注于业务实现.\u003c/p\u003e\n\u003cp\u003e下面是一个简单的 model 示例：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e model \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/model\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e fetch \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/fetch\u0026quot;\u003c/span\u003e;\n\n@\u003cspan class=\"hljs-title function_\"\u003emodel\u003c/span\u003e()\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTodosModel\u003c/span\u003e {\n  \u003cspan class=\"hljs-comment\"\u003e// the mount point of store state tree, must unique in the app.\u003c/span\u003e\n  namespace = \u003cspan class=\"hljs-string\"\u003e\u0026quot;todos\u0026quot;\u003c/span\u003e;\n\n  \u003cspan class=\"hljs-comment\"\u003e// this is the initial state of model\u003c/span\u003e\n  initState = {\n    \u003cspan class=\"hljs-attr\"\u003epageSize\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003ecount\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003eentities\u003c/span\u003e: [],\n  };\n\n  \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003egetTodos\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e{ pageIndex = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, pageSize = \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e }\u003c/span\u003e) {\n    \u003cspan class=\"hljs-comment\"\u003e// fetch remote data\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e reponse = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efetch\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;https://www.example.com/api/hello\u0026quot;\u003c/span\u003e, { \u003cspan class=\"hljs-attr\"\u003ebody\u003c/span\u003e: { pageIndex, pageSize } });\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e pagedTodos = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e response.\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e();\n\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e { entities } = \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003egetState\u003c/span\u003e();\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (lastId === \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) {\n      \u003cspan class=\"hljs-comment\"\u003e// first page\u003c/span\u003e\n      entities = pagedTodos;\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n      entities = [...entities, ...pagedTodos];\n    }\n\n    \u003cspan class=\"hljs-comment\"\u003e// update model\u0026#x27;s state\u003c/span\u003e\n    \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003esetState\u003c/span\u003e({\n      entities,\n      pageIndex,\n      pageSize,\n    });\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e我们使用\u003ccode\u003e@model()\u003c/code\u003e将一个类声明为 Model 类，Model 类在实例化的时候会添加\u003ccode\u003egetState\u003c/code\u003e、\u003ccode\u003esetState\u003c/code\u003e，\u003ccode\u003edispatch\u003c/code\u003e等快捷方法。\u003c/p\u003e\n\n                \u003ch4 id=\"model-api\"\u003e\n                  Model API\n                \u003c/h4\u003e\n                \u003ch5 id=\"namespace\"\u003e\n                  namespace\n                \u003c/h5\u003e\u003cp\u003emodel 将会被注册到 redux store 中，由 store 统一管理 model 的状态，使用\u003ccode\u003estore.getState()[namespace]\u003c/code\u003e来访问对应 model 的 state, store 中不能存在两个相同的\u003ccode\u003enamespace\u003c/code\u003e的 model。\u003c/p\u003e\n\n                \u003ch5 id=\"initstate\"\u003e\n                  initState\n                \u003c/h5\u003e\u003cp\u003e设置 model 的初始化状态，由于\u003ccode\u003emodel.state\u003c/code\u003e可能会被多个\u003ccode\u003easync\u003c/code\u003e业务方法同时操作，所以为了保证 state 的有效性，请在需要使用 state 时使用\u003ccode\u003egetState()\u003c/code\u003e来获取当前 state 的最新值，并使用\u003ccode\u003esetState(nextState)\u003c/code\u003e方法更新当前的 state。\u003c/p\u003e\n\n                \u003ch5 id=\"setstate(nextstate)\"\u003e\n                  setState(nextState)\n                \u003c/h5\u003e\u003cp\u003e\u003ccode\u003esetState(nextState)\u003c/code\u003e更新 model 的状态，\u003ccode\u003enextState\u003c/code\u003e是当前 state 的一个子集，系统将使用浅拷贝的方式合并当前的状态。\u003c/p\u003e\n\n                \u003ch5 id=\"getstate()\"\u003e\n                  getState()\n                \u003c/h5\u003e\u003cp\u003e\u003ccode\u003egetState()\u003c/code\u003e获取当前 model 的状态。\u003c/p\u003e\n\n                \u003ch5 id=\"getstorestate()\"\u003e\n                  getStoreState()\n                \u003c/h5\u003e\u003cp\u003e\u003ccode\u003egetStoreState(）\u003c/code\u003e获取当前整个 store 的状态。\u003c/p\u003e\n\n                \u003ch5 id=\"dispatch(action)\"\u003e\n                  dispatch(action)\n                \u003c/h5\u003e\u003cp\u003e返回值：Promise，被调用业务的返回值。\u003c/p\u003e\n\u003cp\u003e在 model 中使用\u003ccode\u003eawait this.dispatch(action)\u003c/code\u003e调用其它业务方法，这和 redux 的\u003ccode\u003estore.dispatch(action)\u003c/code\u003e的使用一样，由系统分发\u003ccode\u003eaction\u003c/code\u003e到指定的 model 业务方法中, \u003ccode\u003eaction.type\u003c/code\u003e的格式为\u003ccode\u003emodelNamespace/serviceFunction\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e如果是调用 model 自身的业务方法，可以使用\u003ccode\u003eawait this.otherService(options)\u003c/code\u003e的方式，\u003ccode\u003ethis\u003c/code\u003e指的是 model 本身。\u003c/p\u003e\n\n                \u003ch4 id=\"%E4%B8%9A%E5%8A%A1%E6%96%B9%E6%B3%95\"\u003e\n                  业务方法\n                \u003c/h4\u003e\u003cp\u003e我们可以在 Model 中定义任意的实例方法来实现业务逻辑，例如：\u003ccode\u003easync getTodos()\u003c/code\u003e ，该方法是一个\u003ccode\u003easync\u003c/code\u003e函数，所以可以轻松的使用\u003ccode\u003eawait\u003c/code\u003e指令来实现异步逻辑调用，以及调用其它业务方法。\u003c/p\u003e\n\u003cp\u003e调用方式：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003ccode\u003etodosModel.getTodos({lastId: 0, pagesSize:5})\u003c/code\u003e 在 Model 的实例上直接调用\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003edispatch({type:\u0026quot;todos/getTodos\u0026quot;, lastId: 0, pageSize: 5})\u003c/code\u003e 通过 redux 的 dispatch 方法，调用当前 store 中已注册的 model 实例上的方法。\u003c/li\u003e\n\u003c/ol\u003e\n\n                \u003ch3 id=\"controller\"\u003e\n                  Controller\n                \u003c/h3\u003e\u003cp\u003eController 需要申明其依赖哪些 Model，并绑定 Model 的中的状态，以及调用 Model 里的业务方法。它是一个 React 组件，可以像其它 React 组件一样创建和使用，新增了\u003ca href=\"https://lnlfps.github.io/symph-joy/#/thinking-in-joy?id=componentprepare-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F\"\u003e\u003ccode\u003easync componentPrepare()\u003c/code\u003e\u003c/a\u003e生命周期方法，在组件执行完构造方法后执行，在服务端渲染时，会等待其执行完成后，再渲染出 html，接着在浏览器上运行时，会直接使用在服务端 prepare 得到的数据，不再执行该方法。如果没有启用服务端渲染，或者在浏览器上动态加载 Controller 组件时，该方法将在组件初始化完成后，立即上运行。在一次页面请求的过程中，系统会保证该方法只执行一次，避免重复加载数据。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eReact\u003c/span\u003e, { \u003cspan class=\"hljs-title class_\"\u003eComponent\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTodosModel\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;../models/TodosModel\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { controller } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/controller\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { autowire } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/autowire\u0026quot;\u003c/span\u003e;\n\n@\u003cspan class=\"hljs-title function_\"\u003econtroller\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003estate\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-comment\"\u003e// state is store\u0026#x27;s state\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n    \u003cspan class=\"hljs-attr\"\u003etodos\u003c/span\u003e: state.\u003cspan class=\"hljs-property\"\u003etodos\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eentities\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// bind model\u0026#x27;s state to props\u003c/span\u003e\n  };\n})\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eIndexController\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title class_ inherited__\"\u003eComponent\u003c/span\u003e {\n  @\u003cspan class=\"hljs-title function_\"\u003eautowire\u003c/span\u003e()\n  \u003cspan class=\"hljs-attr\"\u003etodosModel\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eTodosModel\u003c/span\u003e; \u003cspan class=\"hljs-comment\"\u003e// register model\u003c/span\u003e\n\n  \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003ecomponentPrepare\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-comment\"\u003e// call model\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003etodosModel\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003egetTodos\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003epageIndex\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003epageSize\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e });\n    \u003cspan class=\"hljs-comment\"\u003e// or use dispatch to call model\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// await this.props.dispath({type: \u0026#x27;todos/getTodos\u0026#x27;, pageIndex: 0, pageSize: 5})\u003c/span\u003e\n  }\n\n  \u003cspan class=\"hljs-title function_\"\u003erender\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e { todos = [] } = \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eprops\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n      \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003eTodo List\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          {todos.map((todo, i) =\u0026gt; {\n            return (\n              \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ekey\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{todo.id}\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                {todo.id}:{todo.content}\n              \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n            );\n          })}\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n    );\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e创建和使用 Controller 的步骤：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003e使用\u003ccode\u003e@controller(mapStateToProps)\u003c/code\u003e装饰器将一个普通的 Component 声明为一个 Controller，参数\u003ccode\u003emapStateToProps\u003c/code\u003e实现 model 状态和组件 props 属性绑定，当 model 的 state 发生改变时，会触发组件使用新数据重新渲染界面。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ccode\u003e@autowire()\u003c/code\u003e声明该属性的类型是一个 Model，运行时，\u003ccode\u003e@symph/joy\u003c/code\u003e将自动初始化该 Model，并绑定到该属性上。打包时，Controller 依赖的 Model 也将一起打包 thunk 中，这样在 controller 运行时，才会去加载依赖的 Model。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e每个 controller 的\u003ccode\u003eprops\u003c/code\u003e会被注入一个\u003ccode\u003edispatch\u003c/code\u003e方法，\u003ccode\u003edispatch\u003c/code\u003e是 redux 提供的方法，我们可以由此来调用 model、reducer、effect 等 redux 支持的方法。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch3 id=\"view\"\u003e\n                  View\n                \u003c/h3\u003e\u003cp\u003eView 是一个普通的 React 组件，其只负责界面展示，展示的数据来自父组件，通过\u003ccode\u003ethis.props\u003c/code\u003e属性读取。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eReact\u003c/span\u003e, { \u003cspan class=\"hljs-title class_\"\u003eComponent\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eImageView\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title class_ inherited__\"\u003eComponent\u003c/span\u003e {\n  \u003cspan class=\"hljs-title function_\"\u003erender\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e { src } = \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eprops\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eimg\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{src}\u003c/span\u003e /\u0026gt;\u003c/span\u003e\u003c/span\u003e;\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch3 id=\"hooks\"\u003e\n                  Hooks\n                \u003c/h3\u003e\u003cp\u003e\u003ccode\u003e@symph/joy/hooks\u003c/code\u003e提供了一些 hook，以便在 React 函数组件中，获取 Model 的状态，以及调用 Model 中的业务方法。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eReact.useEffect\u003c/code\u003e hook 是在 render 以后执行，类似于\u003ccode\u003ecomponentDidMount\u003c/code\u003e和\u003ccode\u003ecomponentDidUpdate\u003c/code\u003e生命周期，在服务端渲染时，\u003ccode\u003eReact.useEffect\u003c/code\u003e不会被执行，因此我们也无法获取到应用数据，渲染出需要的界面。 所以在编译期，\u003ccode\u003e@symph/joy\u003c/code\u003e所以使用了\u003ccode\u003e@symph/joy/hook\u003c/code\u003e中的同名方法\u003ccode\u003euseEffect\u003c/code\u003e方法替换了\u003ccode\u003eReact.useEffect\u003c/code\u003e，使其支持服务端渲染，以及防止数据重复加载等问题。如果你想保持其默认行为，可以在代码中直接使用用\u003ccode\u003e@symph/joy/hook\u003c/code\u003e中的\u003ccode\u003euseReactEffect\u003c/code\u003e，它只是\u003ccode\u003eReact.useEffect\u003c/code\u003e的别名。\u003c/p\u003e\n\u003cp\u003e下面示例了如果在函数组件中使用 hook\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eReact\u003c/span\u003e, { useCallback, useEffect } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { useMappedState, useModel } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/tempo/hook\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTodosModel\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;../models/TodosModel\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eTodoDetailController\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e{ match }\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e todoId = \u003cspan class=\"hljs-title class_\"\u003eNumber\u003c/span\u003e(match.\u003cspan class=\"hljs-property\"\u003eparams\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eid\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e [todosModel] = \u003cspan class=\"hljs-title function_\"\u003euseModel\u003c/span\u003e([\u003cspan class=\"hljs-title class_\"\u003eTodosModel\u003c/span\u003e]);\n\n  \u003cspan class=\"hljs-comment\"\u003e// Declare your memoized mapState function\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e mapState = \u003cspan class=\"hljs-title function_\"\u003euseCallback\u003c/span\u003e(\n    \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003estate\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n      \u003cspan class=\"hljs-comment\"\u003e// state is store\u0026#x27;s state\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n        \u003cspan class=\"hljs-attr\"\u003etodo\u003c/span\u003e: state.\u003cspan class=\"hljs-property\"\u003etodos\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003edetails\u003c/span\u003e[todoId],\n      };\n    },\n    [todoId]\n  );\n  \u003cspan class=\"hljs-comment\"\u003e// Get data from and subscribe to the store\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e { todo } = \u003cspan class=\"hljs-title function_\"\u003euseMappedState\u003c/span\u003e(mapState);\n\n  \u003cspan class=\"hljs-title function_\"\u003euseEffect\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n    todosModel.\u003cspan class=\"hljs-title function_\"\u003egetTodo\u003c/span\u003e(todoId);\n  }, [todoId]);\n\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (todo) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003eloading...\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e;\n  }\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n    \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclassName\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{styles.root}\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh1\u003c/span\u003e\u0026gt;\u003c/span\u003eTodo Detail\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh1\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003eID: {todo.id}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003econtent: {todo.content}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n  );\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch4 id=\"hooks-api\"\u003e\n                  Hooks API\n                \u003c/h4\u003e\n                \u003ch5 id=\"usemappedstate(mapstate)\"\u003e\n                  useMappedState(mapState)\n                \u003c/h5\u003e\u003cp\u003emapState: \u003ccode\u003euseCallback((state) =\u0026gt; newState, inputs)\u003c/code\u003e 和 mapStateToProps 方法类似，用于获取和绑定 model 中的状态，返回供组件使用的状态对象。\u003c/p\u003e\n\u003cp\u003e这里需要使用\u003ccode\u003eReact.useCallback\u003c/code\u003e对状态映射函数进行包装，可避免每次 render 都执行一次状态绑定。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// Declare your memoized mapState function\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e mapState = \u003cspan class=\"hljs-title function_\"\u003euseCallback\u003c/span\u003e(\n  \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003estate\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e// state is store\u0026#x27;s state\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n      \u003cspan class=\"hljs-attr\"\u003etodo\u003c/span\u003e: state.\u003cspan class=\"hljs-property\"\u003etodos\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003edetails\u003c/span\u003e[todoId],\n    };\n  },\n  [todoId]\n);\n\u003cspan class=\"hljs-comment\"\u003e// Get data from and subscribe to the store\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e { todo } = \u003cspan class=\"hljs-title function_\"\u003euseMappedState\u003c/span\u003e(mapState);\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch5 id=\"usemodel(modelarray)\"\u003e\n                  useModel(modelArray)\n                \u003c/h5\u003e\u003cp\u003emodelArray: 数组类型，元素为需要使用的 Model 的 class。\u003c/p\u003e\n\u003cp\u003e返回值: 数组类型，返回 Model 类的实例，和 modelArray 参数中传入的 class 列表一一对应。\u003c/p\u003e\n\u003cp\u003e我们传入 Model 的 class 类，得到 Model 的实例，这里依然使用了依赖注入的部分概念，不用关系 Model 如何被加载和初始化的，系统会在适当的时候处理这些，我们在业务组件里，只需要关心拿到 Model 实例，以及调用他们。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eUserModel\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;./UserModel\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTodoModel\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;./TodoModel\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e [userModel, todoModel] = \u003cspan class=\"hljs-title function_\"\u003euseModel\u003c/span\u003e([\u003cspan class=\"hljs-title class_\"\u003eUserModel\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eTodoModel\u003c/span\u003e]);\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch5 id=\"usedispatch()\"\u003e\n                  useDispatch()\n                \u003c/h5\u003e\u003cp\u003e返回值: 返回\u003ccode\u003edispatch\u003c/code\u003e方法，用于调用\u003ccode\u003eredux\u003c/code\u003e的原生 api。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e dispatch = \u003cspan class=\"hljs-title function_\"\u003euseDispatch\u003c/span\u003e();\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch5 id=\"useeffect(effect%2C-inputs)\"\u003e\n                  useEffect(effect, inputs)\n                \u003c/h5\u003e\u003cp\u003e和\u003ca href=\"https://reactjs.org/docs/hooks-reference.html#useeffect\"\u003e\u003ccode\u003eReact.useEffect\u003c/code\u003e\u003c/a\u003e和用途和用法一样，但该方法支持服务端渲染。开发者一般不会直接调用该方法，\u003ccode\u003e@symph/joy\u003c/code\u003e在编译期间，会使用该方法替换\u003ccode\u003eReact.useEffect\u003c/code\u003e，以保证应用内的\u003ccode\u003euseEffect\u003c/code\u003e在服务端渲染时，被正确的执行。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eeffect\u003c/strong\u003e: 副作用函数\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003einputs\u003c/strong\u003e: 数组类型，只有当数组内的元素值发生改变后，\u003ccode\u003eeffect\u003c/code\u003e才会被重新执行。 等于\u003ccode\u003e[]\u003c/code\u003e空数组时，\u003ccode\u003eeffect\u003c/code\u003e函数只执行一次， 等于\u003ccode\u003eundefined\u003c/code\u003e时，\u003ccode\u003eeffect\u003c/code\u003e每次都会执行。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-title function_\"\u003euseReactEffect\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e subscription = props.\u003cspan class=\"hljs-property\"\u003esource\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003esubscribe\u003c/span\u003e();\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n    subscription.\u003cspan class=\"hljs-title function_\"\u003eunsubscribe\u003c/span\u003e();\n  };\n}, [props.\u003cspan class=\"hljs-property\"\u003esource\u003c/span\u003e]);\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch5 id=\"usereacteffect(effect%2C-inputs)\"\u003e\n                  useReactEffect(effect, inputs)\n                \u003c/h5\u003e\u003cp\u003e等于 react 原生提供的\u003ccode\u003eReact.useEffect\u003c/code\u003e，\u003ccode\u003e@symph/joy\u003c/code\u003e默认会对\u003ccode\u003eReact.useEffect\u003c/code\u003e进行封装，以便其支持服务端渲染，如果需要屏蔽该默认行为，请在代码中直接使用该方法替换\u003ccode\u003eReact.useEffect\u003c/code\u003e。\u003c/p\u003e\n\n                \u003ch4 id=\"%E5%85%BC%E5%AE%B9-dva\"\u003e\n                  兼容 Dva\n                \u003c/h4\u003e\u003cp\u003e@symph/joy 兼容 dva 的 Model 开发模式，\u003ca href=\"https://dvajs.com/guide/concepts.html#models\"\u003eDva 概念 官方文档\u003c/a\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { controller, requireModel } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/controller\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eMyDvaModel\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;./MyDvaModel\u0026quot;\u003c/span\u003e;\n\n@requireModel(\u003cspan class=\"hljs-title class_\"\u003eMyDvaModel\u003c/span\u003e)\n@\u003cspan class=\"hljs-title function_\"\u003econtroller\u003c/span\u003e()\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eMyComponent\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title class_ inherited__\"\u003eComponent\u003c/span\u003e {\n  \u003cspan class=\"hljs-title function_\"\u003ecomponentDidMount\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eprops\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003edispatch\u003c/span\u003e({\n      \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;myDvaModel/getData\u0026quot;\u003c/span\u003e,\n    });\n  }\n\n  \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e使用\u003ccode\u003e@requireModel()\u003c/code\u003e注册 dva 的 model，其它使用方法和 dva 保持一致\u003c/p\u003e\n\n                \u003ch2 id=\"router\"\u003e\n                  Router\n                \u003c/h2\u003e\u003cp\u003e请查看 \u003ca href=\"https://reacttraining.com/react-router/web/example/basic\"\u003ereact-router-4 官方文档\u003c/a\u003e\u003c/p\u003e\n\n                \u003ch3 id=\"%E5%AF%BC%E5%85%A5%E6%96%B9%E6%B3%95\"\u003e\n                  导入方法\n                \u003c/h3\u003e\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e {\n  \u003cspan class=\"hljs-title class_\"\u003eStaticRouter\u003c/span\u003e,\n  \u003cspan class=\"hljs-title class_\"\u003eBrowserRouter\u003c/span\u003e,\n  \u003cspan class=\"hljs-title class_\"\u003eSwitch\u003c/span\u003e,\n  \u003cspan class=\"hljs-title class_\"\u003eRoute\u003c/span\u003e,\n  createServerRouter,\n  createClientRouter,\n  \u003cspan class=\"hljs-title class_\"\u003eLink\u003c/span\u003e,\n  \u003cspan class=\"hljs-title class_\"\u003eHashRouter\u003c/span\u003e,\n  \u003cspan class=\"hljs-title class_\"\u003eNavLink\u003c/span\u003e,\n  \u003cspan class=\"hljs-title class_\"\u003ePrompt\u003c/span\u003e,\n  \u003cspan class=\"hljs-title class_\"\u003eMemoryRouter\u003c/span\u003e,\n  \u003cspan class=\"hljs-title class_\"\u003eRedirect\u003c/span\u003e,\n  \u003cspan class=\"hljs-title class_\"\u003eRouter\u003c/span\u003e,\n  withRouter,\n  routerRedux,\n} \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/router\u0026quot;\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch3 id=\"react-router-redux\"\u003e\n                  react-router-redux\n                \u003c/h3\u003e\u003cp\u003e在代码中控制页面跳转\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e {routerRedux} \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;@symph/joy/router\u0026#x27;\u003c/span\u003e\n\n...\n  \u003cspan class=\"hljs-title function_\"\u003edispatch\u003c/span\u003e(routerRedux.\u003cspan class=\"hljs-title function_\"\u003epush\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;/abount\u0026#x27;\u003c/span\u003e)))\n\n  \u003cspan class=\"hljs-comment\"\u003e//or\u003c/span\u003e\n  \u003cspan class=\"hljs-title function_\"\u003edispatch\u003c/span\u003e(routerRedux.\u003cspan class=\"hljs-title function_\"\u003epush\u003c/span\u003e({\n    \u003cspan class=\"hljs-attr\"\u003epathname\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;/about\u0026#x27;\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003esearch\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e`?x=xxx`\u003c/span\u003e\n  }))\n...\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch2 id=\"%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-server\"\u003e\n                  代码启动 Server\n                \u003c/h2\u003e\u003cp\u003e如果需要把\u003ccode\u003e@symph/joy\u003c/code\u003e集成到\u003ccode\u003eexpress\u003c/code\u003e、\u003ccode\u003ekoa\u003c/code\u003e等服务端框架中，可以使用代码启动\u003ccode\u003e@symph/joy\u003c/code\u003e应用。\u003c/p\u003e\n\u003cp\u003e下面例子展示如何集成到 express 中，并且修改路由\u003ccode\u003e\\a\u003c/code\u003e到\u003ccode\u003e\\b\u003c/code\u003e.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// server.js\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e express = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;express\u0026quot;\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e joy = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy\u0026quot;\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e port = \u003cspan class=\"hljs-built_in\"\u003eparseInt\u003c/span\u003e(process.\u003cspan class=\"hljs-property\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ePORT\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e) || \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e dev = process.\u003cspan class=\"hljs-property\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eNODE_ENV\u003c/span\u003e !== \u003cspan class=\"hljs-string\"\u003e\u0026quot;production\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e app = \u003cspan class=\"hljs-title function_\"\u003ejoy\u003c/span\u003e({ dev, \u003cspan class=\"hljs-attr\"\u003edir\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;.\u0026quot;\u003c/span\u003e });\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e handle = app.\u003cspan class=\"hljs-title function_\"\u003egetRequestHandler\u003c/span\u003e();\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e server = \u003cspan class=\"hljs-title function_\"\u003eexpress\u003c/span\u003e();\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e preapredApp = app.\u003cspan class=\"hljs-title function_\"\u003eprepare\u003c/span\u003e();\n\nserver.\u003cspan class=\"hljs-title function_\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;/a\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ereq, res\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n  preapredApp.\u003cspan class=\"hljs-title function_\"\u003ethen\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e app.\u003cspan class=\"hljs-title function_\"\u003erender\u003c/span\u003e(req, res, \u003cspan class=\"hljs-string\"\u003e\u0026quot;/b\u0026quot;\u003c/span\u003e, req.\u003cspan class=\"hljs-property\"\u003equery\u003c/span\u003e);\n  });\n});\n\nserver.\u003cspan class=\"hljs-title function_\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;*\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ereq, res\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n  preapredApp.\u003cspan class=\"hljs-title function_\"\u003ethen\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003ehandle\u003c/span\u003e(req, res);\n  });\n});\n\nserver.\u003cspan class=\"hljs-title function_\"\u003elisten\u003c/span\u003e(port, \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eerr\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (err) \u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e err;\n  \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e`\u0026gt; Ready on http://localhost:\u003cspan class=\"hljs-subst\"\u003e${port}\u003c/span\u003e`\u003c/span\u003e);\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003cblockquote\u003e\n\u003cp\u003e集成到已有的 express 服务器中时，我们的应用通常是挂载到 url 的某个子路径上的，此时请参考\u003ca href=\"./configurations#assetPrefix\"\u003eassetPrefix\u003c/a\u003e的配置说明。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003ccode\u003ejoy(options: object)\u003c/code\u003e API 提供以下参数：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003edev: bool: false 设置为 true 时，启动开发调试模式，将实时编译源代码、启动热更新等，关闭时，直接运行提前编译好的目标代码(\u003ccode\u003e.joy\u003c/code\u003e目录)。\u003c/li\u003e\n\u003cli\u003edir: string: \u0026#39;.\u0026#39; \b 应用放置的路径，相对于 server.js 文件\u003c/li\u003e\n\u003cli\u003equiet: bool: false 是否隐藏服务器错误信息\u003c/li\u003e\n\u003cli\u003econf: object: {} 和\u003ccode\u003ejoy.config.js\u003c/code\u003e相同的配置对象，如果设置了该值，则忽略\u003ccode\u003ejoy.config.js\u003c/code\u003e文件。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e最后修改 NPM \u003ccode\u003estart\u003c/code\u003e脚本:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-json\"\u003e\u003cspan class=\"hljs-comment\"\u003e// package.json\u003c/span\u003e\n\u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;scripts\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\u0026quot;build\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;build-your-code \u0026amp;\u0026amp; joy build\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\u0026quot;start\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;NODE_ENV=production node server.js\u0026quot;\u003c/span\u003e\n  \u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cblockquote\u003e\n\u003cp\u003e如果 express 作为业务服务器时，可以将@symph/joy 当作 express 的 View 模块来使用。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n                \u003ch2 id=\"%E6%8C%89%E9%9C%80%E5%8A%A0%E8%BD%BD-dynamic\"\u003e\n                  按需加载 dynamic\n                \u003c/h2\u003e\u003cp\u003e\u003ccode\u003e@symph/joy\u003c/code\u003e支持 JavaScript 的 TC39 \u003ca href=\"https://github.com/tc39/proposal-dynamic-import\"\u003edynamic import\u003c/a\u003e提议，意味着你可以将代码分割为多个代码块，在浏览器上运行时，只加载当前需要的代码块。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e@symph/joy/dynamic\u003c/code\u003e模块实现了分割代码、动态加载等功能，下面展示了其 2 种用法：\u003c/p\u003e\n\n                \u003ch3 id=\"%E5%9F%BA%E7%A1%80%E7%94%A8%E6%B3%95%3A\"\u003e\n                  基础用法:\n                \u003c/h3\u003e\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e dynamic \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/dynamic\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDynamicComponent\u003c/span\u003e = \u003cspan class=\"hljs-title function_\"\u003edynamic\u003c/span\u003e({\n  \u003cspan class=\"hljs-attr\"\u003eloader\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eimport\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;../components/hello\u0026quot;\u003c/span\u003e),\n  \u003cspan class=\"hljs-attr\"\u003essr\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// 如果关闭，服务端渲染时，该组件将不会被渲染。\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eloading\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e...\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e,\n});\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e () =\u0026gt; (\n  \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eHeader\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003eHOME PAGE is here!\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eDynamicComponent\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n);\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch3 id=\"%E4%B8%80%E6%AC%A1%E5%8A%A0%E8%BD%BD%E5%A4%9A%E4%B8%AA%E6%A8%A1%E5%9D%97\"\u003e\n                  一次加载多个模块\n                \u003c/h3\u003e\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e dynamic \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/dynamic\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eHelloBundle\u003c/span\u003e = \u003cspan class=\"hljs-title function_\"\u003edynamic\u003c/span\u003e({\n  \u003cspan class=\"hljs-attr\"\u003emodules\u003c/span\u003e: {\n    \u003cspan class=\"hljs-title class_\"\u003eHello1\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eimport\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;../components/hello1\u0026quot;\u003c/span\u003e),\n    \u003cspan class=\"hljs-title class_\"\u003eHello2\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eimport\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;../components/hello2\u0026quot;\u003c/span\u003e),\n  },\n  \u003cspan class=\"hljs-attr\"\u003erender\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eprops, { Hello1, Hello2 }\u003c/span\u003e) =\u0026gt;\u003c/span\u003e (\n    \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh1\u003c/span\u003e\u0026gt;\u003c/span\u003e{props.title}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh1\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eHello1\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eHello2\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n  ),\n});\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e () =\u0026gt; \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eHelloBundle\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etitle\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;Dynamic Bundle\u0026quot;\u003c/span\u003e /\u0026gt;\u003c/span\u003e\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e配置参数：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eloader: function: null, 加载器，定义动态加载的内容\u003c/li\u003e\n\u003cli\u003essr: bool: true, 设置是否开启服务端渲染\u003c/li\u003e\n\u003cli\u003eloading: Component: \u003ccode\u003e\u0026lt;p\u0026gt;loading...\u0026lt;/p\u0026gt;\u003c/code\u003e 加载过程中，展示的动画组件\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch2 id=\"%E8%87%AA%E5%AE%9A%E4%B9%89-document\"\u003e\n                  自定义 \u003ccode\u003e\u0026lt;Document\u0026gt;\u003c/code\u003e\n                \u003c/h2\u003e\u003cp\u003e如果需要定制 html 文档的内容，例如引入 \b 额外的\u003ccode\u003e\u0026lt;script\u0026gt;\u003c/code\u003e或\u003ccode\u003e\u0026lt;link\u0026gt;\u003c/code\u003e等，可在 src 目录中新建\u003ccode\u003e_document.js\u003c/code\u003e文件，参考下面的示例加入自定义的内容。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// /src/_document.js\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDocument\u003c/span\u003e, { \u003cspan class=\"hljs-title class_\"\u003eHead\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eMain\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eJoyScript\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/document\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eMyDocument\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title class_ inherited__\"\u003eDocument\u003c/span\u003e {\n  \u003cspan class=\"hljs-title function_\"\u003erender\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n      \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eHead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          {/* add custom style */}\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003elink\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003erel\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;stylesheet\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;/_joy/static/style.css\u0026quot;\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eHead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eMain\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eJoyScript\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n    );\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003e_document.js\u003c/code\u003e只在服务端渲染时使用，不会在浏览器端加载，所以不能在这里放置任何的业务代码，如果希望在整个应用里共享一部分功能，请将它们放到\u003ccode\u003esrc/index.js\u003c/code\u003e应用入口组件中。\u003c/p\u003e\n\n                \u003ch2 id=\"%E8%87%AA%E5%AE%9A%E4%B9%89-error-%E7%95%8C%E9%9D%A2\"\u003e\n                  自定义 Error 界面\n                \u003c/h2\u003e\u003cp\u003e渲染时出现未捕获的异常时，可以自定义错误展示组件，来友好的提示或者引导用户，例如 500 错误。这只在\u003ccode\u003eprocess.env.NODE_ENV=\u0026quot;production\u0026quot;\u003c/code\u003e环境有效，在开发模式下，系统将展示详细的错误堆栈信息，来帮助开发人员定位问题。\u003c/p\u003e\n\u003cp\u003e创建\u003ccode\u003esrc/_error.js\u003c/code\u003e文件来替换默认的错误展示组件。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// src/_error.js\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eReact\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eHead\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;./head\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003e_Error\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title class_ inherited__\"\u003eReact.Component\u003c/span\u003e {\n  \u003cspan class=\"hljs-title function_\"\u003erender\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { statusCode, message } = \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eprops\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e title = statusCode === \u003cspan class=\"hljs-number\"\u003e404\u003c/span\u003e ? \u003cspan class=\"hljs-string\"\u003e\u0026quot;This page could not be found\u0026quot;\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e\u0026quot;An unexpected error has occurred\u0026quot;\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n      \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eHead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u0026gt;\u003c/span\u003e\n            {statusCode}: {title}\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eHead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh1\u003c/span\u003e\u0026gt;\u003c/span\u003e{statusCode}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh1\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e{message}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n    );\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch2 id=\"%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2\"\u003e\n                  打包部署\n                \u003c/h2\u003e\u003cp\u003e在 package.json 中配置一下脚本，用于打包和启动应用\u003c/p\u003e\n\u003cp\u003e// package.json\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-json\"\u003e\u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;scripts\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\u0026quot;dev\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;joy dev\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\u0026quot;build\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;joy build\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\u0026quot;start\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;joy start\u0026quot;\u003c/span\u003e\n  \u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003col\u003e\n\u003cli\u003e编译：运行\u003ccode\u003enpm run build\u003c/code\u003e命令，启动编译流程，生成可在浏览器和 node.js 里直接运行的目标代码，并对生成的代码进行压缩、混淆、分割等优化处理。编译后的代码放在\u003ccode\u003e.joy\u003c/code\u003e(\u003ca href=\"./configurations#distDir\"\u003edistDir\u003c/a\u003e可自定义输出目录名称)目录中。\u003c/li\u003e\n\u003cli\u003e部署：将项目目录下的\u003ccode\u003e.joy\u003c/code\u003e、\u003ccode\u003epackage.json\u003c/code\u003e、\u003ccode\u003enode_modules\u003c/code\u003e、\u003ccode\u003ejoy.config.js\u003c/code\u003e文件复制到生产机器上。\u003c/li\u003e\n\u003cli\u003e启动应用：在生产机器上，运行\u003ccode\u003enpm run start\u003c/code\u003e启动应用。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003ccode\u003e@symph/joy\u003c/code\u003e 可以部署到不同的域名或路径上，这需要对应用内引用的资源路径进行配置，参考\u003ca href=\"./configurations#assetPrefix\"\u003eassetPrefix\u003c/a\u003e的设置说明。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e在运行\u003ccode\u003ejoy build\u003c/code\u003e的时候，\u003ccode\u003eNODE_ENV\u003c/code\u003e被默认设置为\u003ccode\u003eproduction\u003c/code\u003e， 使用\u003ccode\u003ejoy dev\u003c/code\u003e启动开发环境时，设置为\u003ccode\u003edevelopment\u003c/code\u003e。如果你是在自定义的 Server 内启动应用，需要你自己设置\u003ccode\u003eNODE_ENV=production\u003c/code\u003e。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n                \u003ch2 id=\"%E9%9D%99%E6%80%81%E7%89%88%E6%9C%AC%E9%83%A8%E7%BD%B2\"\u003e\n                  静态版本部署\n                \u003c/h2\u003e\u003cp\u003e\u003ccode\u003ejoy export\u003c/code\u003e用于将\u003ccode\u003e@symph/joy\u003c/code\u003e app 输出为静态版本，只包含 html、js、css 等静态资源文件，不需要 node 作为服务器，可直接部署在 cCDN 或者静态资源服务器上，\b 浏览器端直接加载运行。静态版本仍然支持\u003ccode\u003e@symph/joy\u003c/code\u003e的大部分特性，比如：MVC\b 组件、动态路由、按需加载等。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ejoy export\u003c/code\u003e的原理是提前假设用户的请求，预先 \b 将 React 应用渲染为 HTML 文件，\b 这和当请求到达 Node.js 服务器上时，实时渲染的工作流程类似。\u003c/p\u003e\n\n                \u003ch3 id=\"%E5%AF%BC%E5%87%BA%E9%85%8D%E7%BD%AE\"\u003e\n                  导出配置\n                \u003c/h3\u003e\u003cp\u003e默认只导出首页，即 url \u003ccode\u003e/\u003c/code\u003e 根路径对应的页面，如果需要导出其它页面，请先在\u003ccode\u003ejoy.config.js\u003c/code\u003e中设置\u003ca href=\"./configurations#exportPathMap\"\u003e\u003ccode\u003eexportPathMap\u003c/code\u003e\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e下面是一个简单的配置示例，配置了导出首页\u003ccode\u003eindex.html\u003c/code\u003e和\u003ccode\u003eabout.html\u003c/code\u003e这两个页面，且最终应用会部署到\u003ccode\u003ehttp:www.example-cdn.com/my-app\u003c/code\u003e这个静态 url 路径下。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// joy.config.js\u003c/span\u003e\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = {\n  \u003cspan class=\"hljs-attr\"\u003eassetPath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;http://www.example-cdn.com/my-app\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003eexportPathMap\u003c/span\u003e: \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n      \u003cspan class=\"hljs-string\"\u003e\u0026quot;/\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// 导出首页\u003c/span\u003e\n      \u003cspan class=\"hljs-string\"\u003e\u0026quot;/about.html\u0026quot;\u003c/span\u003e: request, \u003cspan class=\"hljs-comment\"\u003e// 导出about.html页面，request为渲染页面的request参数对象，可以这样{query:{pageIndex:1}}设置query参数\u003c/span\u003e\n    };\n  },\n};\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch3 id=\"%E5%AF%BC%E5%87%BA%E6%AD%A5%E9%AA%A4\"\u003e\n                  导出步骤\n                \u003c/h3\u003e\u003cp\u003e在 package.json 中添加 NPM 脚本\u003c/p\u003e\n\u003cp\u003e// package.json\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-json\"\u003e\u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;scripts\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\u0026quot;build\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;joy build\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\u0026quot;export\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;npm run build \u0026amp;\u0026amp; joy export\u0026quot;\u003c/span\u003e\n  \u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e执行 \u003ccode\u003enpm run export\u003c/code\u003e 执行导出过程，导出过程分为两步：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e编译源码：运行\u003ccode\u003enpm run build\u003c/code\u003e命令，生成可在浏览器和 node.js 里直接运行的目标代码，并对生成的代码进行压缩、混淆、分割等优化处理。编译后的代码放在\u003ccode\u003e.joy\u003c/code\u003e(\u003ca href=\"./configurations#distDir\"\u003edistDir\u003c/a\u003e可自定义输出目录名称)目录中。\u003c/li\u003e\n\u003cli\u003e导出静态版本: \u003ccode\u003ejoy export\u003c/code\u003e命令，启动一个用于导出的 Node 服务器，导出\u003ccode\u003eexportPathMap\u003c/code\u003e中配置的页面。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e最终生成目录结构\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eproject\n|   .joy.config.js\n└---.joy\n|  |  server/\n|  |  static/\n|  |  build-manifest.json\n└---out\n|  |  _joy/\n|  |  static/\n|  |  index.html\n|  |  about.html\n|  ...\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e执行完导出操作后，应用根目录下将会生成\u003ccode\u003eout\u003c/code\u003e目录，其中包含在浏览器上运行时需要的所有文件。\u003c/p\u003e\n\n                \u003ch3 id=\"%E9%83%A8%E7%BD%B2\"\u003e\n                  部署\n                \u003c/h3\u003e\u003cp\u003e只需要将\u003ccode\u003eout\u003c/code\u003e目录中的内容部署到静态文件服务器，最终通过\u003ccode\u003ehttp://www.example-cdn.com/my-app/about.html\u003c/code\u003e url 路径，访问导出的\u003ccode\u003eabout.html\u003c/code\u003e文件。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e你可以定制\u003ccode\u003eout\u003c/code\u003e目录名称，请运行\u003ccode\u003ejoy export -h\u003c/code\u003e指令，按提示操作。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n                \u003ch3 id=\"%E5%BA%94%E7%94%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE\"\u003e\n                  应用服务器配置\n                \u003c/h3\u003e\u003cp\u003e\b 默认只渲染输出\u003ccode\u003eindex.html\u003c/code\u003e文件，这也是单页面应用常见的入口页面，\b 浏览器加载该文件 \b 后，由浏览器端的路由组件\u003ca href=\"https://reacttraining.com/react-router/web/example/basic\"\u003eRouter\u003c/a\u003e根据当前完整\u003ccode\u003ewindow.location.href\u003c/code\u003e路径，渲染具体的页面内容。\u003c/p\u003e\n\u003cp\u003e这要求我们在业务服务器上，例如 JAVA 的 Spring MVC 中，使用正则路由来匹配应用内部的所有的页面路径，并都返回\u003ccode\u003eindex.js\u003c/code\u003e这个文件，例如：\u003ccode\u003e@RequestMapping(path=\u0026quot;/**\u0026quot;, method=RequestMethod.GET)\u003c/code\u003e。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-java\"\u003e\u003cspan class=\"hljs-meta\"\u003e@Controller\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e@RequestMapping(\u0026quot;/**\u0026quot;)\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eViewController\u003c/span\u003e {\n\n    \u003cspan class=\"hljs-meta\"\u003e@RequestMapping(path = \u0026quot;/**\u0026quot;, method = RequestMethod.GET)\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e Map\u0026lt;String, Appointment\u0026gt; \u003cspan class=\"hljs-title function_\"\u003epages\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e {\n       \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;forward:/static/index.html\u0026quot;\u003c/span\u003e;\n    }\n\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e也可以在 nginx 中配置反向代理路由，当任何页面请求到达时，返回\u003ccode\u003eindex.html\u003c/code\u003e文件给浏览器。\u003c/p\u003e\n\u003cp\u003e下面的 nginx 配置例子展示了，在 nginx 服务器上，将\u003ccode\u003ehttp://www.nginx-example.com/frontend-app/todo/1\u003c/code\u003e请求代理到静态资源服务器\u003ccode\u003ehttp://www.static-example.com/static-app/index.html\u003c/code\u003e文件上。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003elocation ^~ /frontend-app/ {\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-http_x_forwarded_for $proxy_add_x_forwarded_for;\n            proxy_set_header Host $http_host;\n            rewrite /frontend-app/(.+)$ /static-app break;\n            proxy_pass http://www.static-example.com ;\n        }\n\u003c/code\u003e\u003c/pre\u003e\n","anchor":[{"type":"heading","raw":"## 安装和开始\n\n","depth":2,"text":"安装和开始","tokens":[{"type":"text","raw":"安装和开始","text":"安装和开始"}],"id":"#%E5%AE%89%E8%A3%85%E5%92%8C%E5%BC%80%E5%A7%8B"},{"type":"heading","raw":"## 样式 CSS\n\n","depth":2,"text":"样式 CSS","tokens":[{"type":"text","raw":"样式 CSS","text":"样式 CSS"}],"id":"#%E6%A0%B7%E5%BC%8F-css","children":[{"type":"heading","raw":"### jsx 内建样式\n\n","depth":3,"text":"jsx 内建样式","tokens":[{"type":"text","raw":"jsx 内建样式","text":"jsx 内建样式"}],"id":"#jsx-%E5%86%85%E5%BB%BA%E6%A0%B7%E5%BC%8F"},{"type":"heading","raw":"### Import CSS / LESS 文件\n\n","depth":3,"text":"Import CSS / LESS 文件","tokens":[{"type":"text","raw":"Import CSS / LESS 文件","text":"Import CSS / LESS 文件"}],"id":"#import-css--less-%E6%96%87%E4%BB%B6"},{"type":"heading","raw":"### 导入图片\n\n","depth":3,"text":"导入图片","tokens":[{"type":"text","raw":"导入图片","text":"导入图片"}],"id":"#%E5%AF%BC%E5%85%A5%E5%9B%BE%E7%89%87"}]},{"type":"heading","raw":"## 静态文件\n\n","depth":2,"text":"静态文件","tokens":[{"type":"text","raw":"静态文件","text":"静态文件"}],"id":"#%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6"},{"type":"heading","raw":"## 自定义 Head\n\n","depth":2,"text":"自定义 Head","tokens":[{"type":"text","raw":"自定义 Head","text":"自定义 Head"}],"id":"#%E8%87%AA%E5%AE%9A%E4%B9%89-head"},{"type":"heading","raw":"## 代理服务\n\n","depth":2,"text":"代理服务","tokens":[{"type":"text","raw":"代理服务","text":"代理服务"}],"id":"#%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1","children":[{"type":"heading","raw":"### 使用注意事项\n\n","depth":3,"text":"使用注意事项","tokens":[{"type":"text","raw":"使用注意事项","text":"使用注意事项"}],"id":"#%E4%BD%BF%E7%94%A8%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"},{"type":"heading","raw":"### proxy 配置\n\n","depth":3,"text":"proxy 配置","tokens":[{"type":"text","raw":"proxy 配置","text":"proxy 配置"}],"id":"#proxy-%E9%85%8D%E7%BD%AE","children":[{"type":"heading","raw":"#### ProxyRoute 配置\n\n","depth":4,"text":"ProxyRoute 配置","tokens":[{"type":"text","raw":"ProxyRoute 配置","text":"ProxyRoute 配置"}],"id":"#proxyroute-%E9%85%8D%E7%BD%AE"}]}]},{"type":"heading","raw":"## 发送请求 fetch\n\n","depth":2,"text":"发送请求 fetch","tokens":[{"type":"text","raw":"发送请求 fetch","text":"发送请求 fetch"}],"id":"#%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82-fetch"},{"type":"heading","raw":"## 应用组件\n\n","depth":2,"text":"应用组件","tokens":[{"type":"text","raw":"应用组件","text":"应用组件"}],"id":"#%E5%BA%94%E7%94%A8%E7%BB%84%E4%BB%B6","children":[{"type":"heading","raw":"### 依赖注入 @autowire\n\n","depth":3,"text":"依赖注入 @autowire","tokens":[{"type":"text","raw":"依赖注入 @autowire","text":"依赖注入 @autowire"}],"id":"#%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5-autowire"},{"type":"heading","raw":"### Model\n\n","depth":3,"text":"Model","tokens":[{"type":"text","raw":"Model","text":"Model"}],"id":"#model","children":[{"type":"heading","raw":"#### Model API\n\n","depth":4,"text":"Model API","tokens":[{"type":"text","raw":"Model API","text":"Model API"}],"id":"#model-api"},{"type":"heading","raw":"#### 业务方法\n\n","depth":4,"text":"业务方法","tokens":[{"type":"text","raw":"业务方法","text":"业务方法"}],"id":"#%E4%B8%9A%E5%8A%A1%E6%96%B9%E6%B3%95"}]},{"type":"heading","raw":"### Controller\n\n","depth":3,"text":"Controller","tokens":[{"type":"text","raw":"Controller","text":"Controller"}],"id":"#controller"},{"type":"heading","raw":"### View\n\n","depth":3,"text":"View","tokens":[{"type":"text","raw":"View","text":"View"}],"id":"#view"},{"type":"heading","raw":"### Hooks\n\n","depth":3,"text":"Hooks","tokens":[{"type":"text","raw":"Hooks","text":"Hooks"}],"id":"#hooks","children":[{"type":"heading","raw":"#### Hooks API\n\n","depth":4,"text":"Hooks API","tokens":[{"type":"text","raw":"Hooks API","text":"Hooks API"}],"id":"#hooks-api"},{"type":"heading","raw":"#### 兼容 Dva\n\n","depth":4,"text":"兼容 Dva","tokens":[{"type":"text","raw":"兼容 Dva","text":"兼容 Dva"}],"id":"#%E5%85%BC%E5%AE%B9-dva"}]}]},{"type":"heading","raw":"## Router\n\n","depth":2,"text":"Router","tokens":[{"type":"text","raw":"Router","text":"Router"}],"id":"#router","children":[{"type":"heading","raw":"### 导入方法\n\n","depth":3,"text":"导入方法","tokens":[{"type":"text","raw":"导入方法","text":"导入方法"}],"id":"#%E5%AF%BC%E5%85%A5%E6%96%B9%E6%B3%95"},{"type":"heading","raw":"### react-router-redux\n\n","depth":3,"text":"react-router-redux","tokens":[{"type":"text","raw":"react-router-redux","text":"react-router-redux"}],"id":"#react-router-redux"}]},{"type":"heading","raw":"## 代码启动 Server\n\n","depth":2,"text":"代码启动 Server","tokens":[{"type":"text","raw":"代码启动 Server","text":"代码启动 Server"}],"id":"#%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-server"},{"type":"heading","raw":"## 按需加载 dynamic\n\n","depth":2,"text":"按需加载 dynamic","tokens":[{"type":"text","raw":"按需加载 dynamic","text":"按需加载 dynamic"}],"id":"#%E6%8C%89%E9%9C%80%E5%8A%A0%E8%BD%BD-dynamic","children":[{"type":"heading","raw":"### 基础用法:\n\n","depth":3,"text":"基础用法:","tokens":[{"type":"text","raw":"基础用法:","text":"基础用法:"}],"id":"#%E5%9F%BA%E7%A1%80%E7%94%A8%E6%B3%95%3A"},{"type":"heading","raw":"### 一次加载多个模块\n\n","depth":3,"text":"一次加载多个模块","tokens":[{"type":"text","raw":"一次加载多个模块","text":"一次加载多个模块"}],"id":"#%E4%B8%80%E6%AC%A1%E5%8A%A0%E8%BD%BD%E5%A4%9A%E4%B8%AA%E6%A8%A1%E5%9D%97"}]},{"type":"heading","raw":"## 自定义 `\u003cDocument\u003e`\n\n","depth":2,"text":"自定义 `\u003cDocument\u003e`","tokens":[{"type":"text","raw":"自定义 ","text":"自定义 "},{"type":"codespan","raw":"`\u003cDocument\u003e`","text":"\u0026lt;Document\u0026gt;"}],"id":"#%E8%87%AA%E5%AE%9A%E4%B9%89-%60%3Cdocument%3E%60"},{"type":"heading","raw":"## 自定义 Error 界面\n\n","depth":2,"text":"自定义 Error 界面","tokens":[{"type":"text","raw":"自定义 Error 界面","text":"自定义 Error 界面"}],"id":"#%E8%87%AA%E5%AE%9A%E4%B9%89-error-%E7%95%8C%E9%9D%A2"},{"type":"heading","raw":"## 打包部署\n\n","depth":2,"text":"打包部署","tokens":[{"type":"text","raw":"打包部署","text":"打包部署"}],"id":"#%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2"},{"type":"heading","raw":"## 静态版本部署\n\n","depth":2,"text":"静态版本部署","tokens":[{"type":"text","raw":"静态版本部署","text":"静态版本部署"}],"id":"#%E9%9D%99%E6%80%81%E7%89%88%E6%9C%AC%E9%83%A8%E7%BD%B2","children":[{"type":"heading","raw":"### 导出配置\n\n","depth":3,"text":"导出配置","tokens":[{"type":"text","raw":"导出配置","text":"导出配置"}],"id":"#%E5%AF%BC%E5%87%BA%E9%85%8D%E7%BD%AE"},{"type":"heading","raw":"### 导出步骤\n\n","depth":3,"text":"导出步骤","tokens":[{"type":"text","raw":"导出步骤","text":"导出步骤"}],"id":"#%E5%AF%BC%E5%87%BA%E6%AD%A5%E9%AA%A4"},{"type":"heading","raw":"### 部署\n\n","depth":3,"text":"部署","tokens":[{"type":"text","raw":"部署","text":"部署"}],"id":"#%E9%83%A8%E7%BD%B2"},{"type":"heading","raw":"### 应用服务器配置\n\n","depth":3,"text":"应用服务器配置","tokens":[{"type":"text","raw":"应用服务器配置","text":"应用服务器配置"}],"id":"#%E5%BA%94%E7%94%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE"}]}]},{"title":"配置文档","path":"/v1/configurations","file":"docs\\v1\\03-configurations.md","hasMenu":false,"mdContent":"# 配置文档\r\n\r\n默认情况下`@symph/joy`已经提供了从开发到发布所需的默认配置，如需定制功能，请在项目根目录下创建`joy.config.js`配置文件，同`src`和`static`目录同级。\r\n\r\n`joy.config.js`它通常使用在`@symph/joy` Server 运行时和 Build 阶段，并不会被导入到浏览器上运行。它是一个常规的 Node.js 模块，所以要求在其内部使用`module.exports`输出配置对象，并且这里暂时还不能使用 ES6 等高级语法。\r\n\r\n```jsx\r\n// joy.config.js\r\nmodule.exports = {\r\n  /* config options here */\r\n  main: \"src/index.js\",\r\n  distDir: \".joy\",\r\n  assetPrefix: \"\",\r\n  webpack: null,\r\n};\r\n```\r\n\r\n或者使用函数\r\n\r\n```jsx\r\n// joy.config.js\r\n\r\nmodule.exports = (phase, { defaultConfig }) =\u003e {\r\n  return {\r\n    /* config options here */\r\n  };\r\n};\r\n```\r\n\r\n`phase`是加载当前配置文件的上下文，你可以在[`constants`](https://github.com/lnlfps/symph-joy/blob/master/lib/constants.js)中查看所以的枚举值，使用时请从`@symph/joy/constants`中导入。\r\n\r\n```jsx\r\nconst { PHASE_DEVELOPMENT_SERVER } = require(\"@symph/joy/constants\");\r\nmodule.exports = (phase, { defaultConfig }) =\u003e {\r\n  if (phase === PHASE_DEVELOPMENT_SERVER) {\r\n    return {\r\n      /* development only config options here */\r\n    };\r\n  }\r\n\r\n  return {\r\n    /* config options for all phases except development here */\r\n  };\r\n};\r\n```\r\n\r\n## 配置选项\r\n\r\n### main\r\n\r\n类型：string，默认`src/index.js`\r\n\r\n设定应用入口组件所在的文件路径，这个大部分开发语言执行 Main 入口一样，一般会在应用入口的地方，设置应用内路由，以及整个应用的公共模块，。\r\n\r\n### distDir\r\n\r\n类型：string，默认`.joy`\r\n\r\n目标目录是指在编译阶段输出的目标文件夹，你也可以设置自定义的目录名称。\r\n\r\n### assetPrefix\r\n\r\n类型：string，默认`''`空字符串，即在 URL 域名的根目录下访问脚本和资源。\r\n\r\n如果使用 CDN，或者在 URL 的某个子路径上，你可以设置`assetPrefix`来更改`@symph/joy`应用的访问路径。例如: 下面将生产环境的访问路径设置为`https://cdn.mydomain.com/myapp`， 开发环境访问路径`localhost:3000`\r\n\r\n```jsx\r\nconst isProd = process.env.NODE_ENV === \"production\";\r\nmodule.exports = {\r\n  assetPrefix: isProd ? \"https://cdn.mydomain.com/myapp\" : \"\",\r\n};\r\n```\r\n\r\n\u003e `@symph/joy`会自动将`assetPrefix`引入到加载的 scripts 和 styles 的路径上，但`/static`文件夹下的资源除外，你必须自己在路径前面加上`assetprefix`，例如：`\u003cimg src='/assetprefix/static/logo.png'/\u003e`；\r\n\r\n### serverRuntimeConfig\r\n\r\n配置在业务代码中使用的配置信息，`serverRuntimeConfig`定义的配置只能在 Node.js Server 端读取，\r\n\r\n```jsx\r\n// joy.config.js\r\nmodule.exports = {\r\n  serverRuntimeConfig: {\r\n    // Will only be available on the server side\r\n    mySecret: \"secret\",\r\n  },\r\n  publicRuntimeConfig: {\r\n    // Will be available on both server and client\r\n    staticFolder: \"/static\",\r\n  },\r\n};\r\n```\r\n\r\n在业务代码中读取配置\r\n\r\n```jsx\r\n// src/index.js\r\nimport getConfig from \"@symph/joy/config\";\r\n// Only holds serverRuntimeConfig and publicRuntimeConfig from joy.config.js nothing else.\r\nconst { serverRuntimeConfig, publicRuntimeConfig } = getConfig();\r\n\r\nconsole.log(serverRuntimeConfig.mySecret); // Will only be available on the server side\r\nconsole.log(publicRuntimeConfig.staticFolder); // Will be available on both server and client\r\n\r\nexport default () =\u003e (\r\n  \u003cdiv\u003e\r\n    \u003cimg src={`${publicRuntimeConfig.staticFolder}/logo.png`} alt=\"logo\" /\u003e\r\n  \u003c/div\u003e\r\n);\r\n```\r\n\r\n### publicRuntimeConfig\r\n\r\n请见: [serverRuntimeConfig](#serverRuntimeConfig), `publicRuntimeConfig`中的配置在 Server 和 Client 都可读取。\r\n\r\n### exportPathMap\r\n\r\n类型：async functon, 默认`async () =\u003e ({'/': {}})`\r\n\r\n在导出应用的静态版本时，该配置定义了需要导出的页面。\r\n\r\n```js\r\n// joy.config.js\r\nconst withLess = require(\"@symph/joy-less\");\r\n\r\nmodule.exports = {\r\n  exportPathMap: async function () {\r\n    return {\r\n      \"/\": null,\r\n      \"/about.html\": {},\r\n      \"/learn/getting-started.html\": { query: { title: \"getting-started\" } },\r\n    };\r\n  },\r\n};\r\n```\r\n\r\n对象的`key`是需要渲染的 url 路径，`query`将作为 url 的 query 参数，传递给被渲染的页面。如果 url 路径是以目录结束，将会被导出为`/dir-name/index.html`文件，如果以文件名结尾，将导出为相同的文件名称，例如上面的`/about.html`。\r\n\r\n### plugins\r\n\r\n类型：array, 默认`[]`\r\n\r\n[查看可用的插件列表](./plugins)\r\n\r\n`@symph/joy`提供了插件机制来扩展其能力，例如支持 less 样式和导入图片等，插件的配置请参考各插件的使用说明文档。插件按照列表定义的顺序依次执行。\r\n\r\n```js\r\nconst withLess = require(\"@symph/joy-less\");\r\nconst withImageLoader = require(\"@symph/joy-image\");\r\n\r\nmodule.exports = {\r\n  serverRender: true,\r\n  plugins: [withLess({ cssModules: true }), withImageLoader({ limit: 8192 })],\r\n};\r\n```\r\n\r\n### webpack\r\n\r\n类型：function\r\n\r\n一些常用的功能，`@symph/joy`提供了插件来支持，请先查看[插件列表](#plugins)是否有你想要额外功能。你也可以定义函数来增加或修改 webpack 的配置。\r\n\r\n```jsx\r\n// This file is not going through babel transformation.\r\n// So, we write it in vanilla JS\r\n// (But you could use ES2015 features supported by your Node.js version)\r\n\r\nmodule.exports = {\r\n  webpack: (config, { buildId, dev, isServer, defaultLoaders }) =\u003e {\r\n    // Perform customizations to webpack config\r\n\r\n    // Important: return the modified config\r\n    return config;\r\n  },\r\n  webpackDevMiddleware: (config) =\u003e {\r\n    // Perform customizations to webpack dev middleware config\r\n\r\n    // Important: return the modified config\r\n    return config;\r\n  },\r\n};\r\n```\r\n\r\n注意：`webpack`函数会被执行两次，分别是为了编译出在服务端和 \b 客户端运行的代码，你可以通过`isServer`入参来区分。\r\n\r\n## 自定义 Babel config\r\n\r\n为了扩展`babel`的配置，可以在应用的根目录下创建`.babelrc`的文件，这个文件是可选的，如果它存在，就必须包含`@symph/joy/babel` preset，这样 joy 才能正常运行。\r\n\r\n下面是一个`.babelrc`的例子：\r\n\r\n```json\r\n{\r\n  \"presets\": [\"@symph/joy/babel\"],\r\n  \"plugins\": []\r\n}\r\n```\r\n\r\n`@symph/joy/babel` 里包含了编译应用的所需的所有配置，比如：\r\n\r\n- preset-env\r\n- preset-react\r\n- plugin-proposal-class-properties\r\n- plugin-proposal-object-rest-spread\r\n- plugin-transform-runtime\r\n- styled-jsx\r\n\r\n上面这些已有的 preset 和 plugin 不能再添加到自定义的`.babelrc`中，你可以直接在`@symph/joy/babel` preset 的基础上修改,比如：\r\n\r\n```json\r\n{\r\n  \"presets\": [\r\n    [\r\n      \"@symph/joy/babel\",\r\n      {\r\n        \"preset-env\": {},\r\n        \"transform-runtime\": {},\r\n        \"styled-jsx\": {}\r\n      }\r\n    ]\r\n  ],\r\n  \"plugins\": []\r\n}\r\n```\r\n\r\n注意：`preset-env`里的`modules`配置项必须保持为`false`，否则 webpack 的代码分离功能将不可以用。\r\n","htmlContent":"\n                \u003ch1 id=\"%E9%85%8D%E7%BD%AE%E6%96%87%E6%A1%A3\"\u003e\n                  配置文档\n                \u003c/h1\u003e\u003cp\u003e默认情况下\u003ccode\u003e@symph/joy\u003c/code\u003e已经提供了从开发到发布所需的默认配置，如需定制功能，请在项目根目录下创建\u003ccode\u003ejoy.config.js\u003c/code\u003e配置文件，同\u003ccode\u003esrc\u003c/code\u003e和\u003ccode\u003estatic\u003c/code\u003e目录同级。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ejoy.config.js\u003c/code\u003e它通常使用在\u003ccode\u003e@symph/joy\u003c/code\u003e Server 运行时和 Build 阶段，并不会被导入到浏览器上运行。它是一个常规的 Node.js 模块，所以要求在其内部使用\u003ccode\u003emodule.exports\u003c/code\u003e输出配置对象，并且这里暂时还不能使用 ES6 等高级语法。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-jsx\"\u003e\u003cspan class=\"hljs-comment\"\u003e// joy.config.js\u003c/span\u003e\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = {\n  \u003cspan class=\"hljs-comment\"\u003e/* config options here */\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003emain\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;src/index.js\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003edistDir\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;.joy\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003eassetPrefix\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003ewebpack\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e,\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e或者使用函数\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-jsx\"\u003e\u003cspan class=\"hljs-comment\"\u003e// joy.config.js\u003c/span\u003e\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ephase, { defaultConfig }\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e/* config options here */\u003c/span\u003e\n  };\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003ephase\u003c/code\u003e是加载当前配置文件的上下文，你可以在\u003ca href=\"https://github.com/lnlfps/symph-joy/blob/master/lib/constants.js\"\u003e\u003ccode\u003econstants\u003c/code\u003e\u003c/a\u003e中查看所以的枚举值，使用时请从\u003ccode\u003e@symph/joy/constants\u003c/code\u003e中导入。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-jsx\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { \u003cspan class=\"hljs-variable constant_\"\u003ePHASE_DEVELOPMENT_SERVER\u003c/span\u003e } = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/constants\u0026quot;\u003c/span\u003e);\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ephase, { defaultConfig }\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (phase === \u003cspan class=\"hljs-variable constant_\"\u003ePHASE_DEVELOPMENT_SERVER\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n      \u003cspan class=\"hljs-comment\"\u003e/* development only config options here */\u003c/span\u003e\n    };\n  }\n\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e/* config options for all phases except development here */\u003c/span\u003e\n  };\n};\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch2 id=\"%E9%85%8D%E7%BD%AE%E9%80%89%E9%A1%B9\"\u003e\n                  配置选项\n                \u003c/h2\u003e\n                \u003ch3 id=\"main\"\u003e\n                  main\n                \u003c/h3\u003e\u003cp\u003e类型：string，默认\u003ccode\u003esrc/index.js\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e设定应用入口组件所在的文件路径，这个大部分开发语言执行 Main 入口一样，一般会在应用入口的地方，设置应用内路由，以及整个应用的公共模块，。\u003c/p\u003e\n\n                \u003ch3 id=\"distdir\"\u003e\n                  distDir\n                \u003c/h3\u003e\u003cp\u003e类型：string，默认\u003ccode\u003e.joy\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e目标目录是指在编译阶段输出的目标文件夹，你也可以设置自定义的目录名称。\u003c/p\u003e\n\n                \u003ch3 id=\"assetprefix\"\u003e\n                  assetPrefix\n                \u003c/h3\u003e\u003cp\u003e类型：string，默认\u003ccode\u003e\u0026#39;\u0026#39;\u003c/code\u003e空字符串，即在 URL 域名的根目录下访问脚本和资源。\u003c/p\u003e\n\u003cp\u003e如果使用 CDN，或者在 URL 的某个子路径上，你可以设置\u003ccode\u003eassetPrefix\u003c/code\u003e来更改\u003ccode\u003e@symph/joy\u003c/code\u003e应用的访问路径。例如: 下面将生产环境的访问路径设置为\u003ccode\u003ehttps://cdn.mydomain.com/myapp\u003c/code\u003e， 开发环境访问路径\u003ccode\u003elocalhost:3000\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-jsx\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e isProd = process.\u003cspan class=\"hljs-property\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eNODE_ENV\u003c/span\u003e === \u003cspan class=\"hljs-string\"\u003e\u0026quot;production\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = {\n  \u003cspan class=\"hljs-attr\"\u003eassetPrefix\u003c/span\u003e: isProd ? \u003cspan class=\"hljs-string\"\u003e\u0026quot;https://cdn.mydomain.com/myapp\u0026quot;\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e,\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ccode\u003e@symph/joy\u003c/code\u003e会自动将\u003ccode\u003eassetPrefix\u003c/code\u003e引入到加载的 scripts 和 styles 的路径上，但\u003ccode\u003e/static\u003c/code\u003e文件夹下的资源除外，你必须自己在路径前面加上\u003ccode\u003eassetprefix\u003c/code\u003e，例如：\u003ccode\u003e\u0026lt;img src=\u0026#39;/assetprefix/static/logo.png\u0026#39;/\u0026gt;\u003c/code\u003e；\u003c/p\u003e\n\u003c/blockquote\u003e\n\n                \u003ch3 id=\"serverruntimeconfig\"\u003e\n                  serverRuntimeConfig\n                \u003c/h3\u003e\u003cp\u003e配置在业务代码中使用的配置信息，\u003ccode\u003eserverRuntimeConfig\u003c/code\u003e定义的配置只能在 Node.js Server 端读取，\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-jsx\"\u003e\u003cspan class=\"hljs-comment\"\u003e// joy.config.js\u003c/span\u003e\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = {\n  \u003cspan class=\"hljs-attr\"\u003eserverRuntimeConfig\u003c/span\u003e: {\n    \u003cspan class=\"hljs-comment\"\u003e// Will only be available on the server side\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003emySecret\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;secret\u0026quot;\u003c/span\u003e,\n  },\n  \u003cspan class=\"hljs-attr\"\u003epublicRuntimeConfig\u003c/span\u003e: {\n    \u003cspan class=\"hljs-comment\"\u003e// Will be available on both server and client\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003estaticFolder\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;/static\u0026quot;\u003c/span\u003e,\n  },\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e在业务代码中读取配置\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-jsx\"\u003e\u003cspan class=\"hljs-comment\"\u003e// src/index.js\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e getConfig \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/config\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-comment\"\u003e// Only holds serverRuntimeConfig and publicRuntimeConfig from joy.config.js nothing else.\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { serverRuntimeConfig, publicRuntimeConfig } = \u003cspan class=\"hljs-title function_\"\u003egetConfig\u003c/span\u003e();\n\n\u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(serverRuntimeConfig.\u003cspan class=\"hljs-property\"\u003emySecret\u003c/span\u003e); \u003cspan class=\"hljs-comment\"\u003e// Will only be available on the server side\u003c/span\u003e\n\u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(publicRuntimeConfig.\u003cspan class=\"hljs-property\"\u003estaticFolder\u003c/span\u003e); \u003cspan class=\"hljs-comment\"\u003e// Will be available on both server and client\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e () =\u0026gt; (\n  \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eimg\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{\u003c/span\u003e`${\u003cspan class=\"hljs-attr\"\u003epublicRuntimeConfig.staticFolder\u003c/span\u003e}/\u003cspan class=\"hljs-attr\"\u003elogo.png\u003c/span\u003e`} \u003cspan class=\"hljs-attr\"\u003ealt\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;logo\u0026quot;\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n);\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch3 id=\"publicruntimeconfig\"\u003e\n                  publicRuntimeConfig\n                \u003c/h3\u003e\u003cp\u003e请见: \u003ca href=\"#serverRuntimeConfig\"\u003eserverRuntimeConfig\u003c/a\u003e, \u003ccode\u003epublicRuntimeConfig\u003c/code\u003e中的配置在 Server 和 Client 都可读取。\u003c/p\u003e\n\n                \u003ch3 id=\"exportpathmap\"\u003e\n                  exportPathMap\n                \u003c/h3\u003e\u003cp\u003e类型：async functon, 默认\u003ccode\u003easync () =\u0026gt; ({\u0026#39;/\u0026#39;: {}})\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e在导出应用的静态版本时，该配置定义了需要导出的页面。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// joy.config.js\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e withLess = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy-less\u0026quot;\u003c/span\u003e);\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = {\n  \u003cspan class=\"hljs-attr\"\u003eexportPathMap\u003c/span\u003e: \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n      \u003cspan class=\"hljs-string\"\u003e\u0026quot;/\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e,\n      \u003cspan class=\"hljs-string\"\u003e\u0026quot;/about.html\u0026quot;\u003c/span\u003e: {},\n      \u003cspan class=\"hljs-string\"\u003e\u0026quot;/learn/getting-started.html\u0026quot;\u003c/span\u003e: { \u003cspan class=\"hljs-attr\"\u003equery\u003c/span\u003e: { \u003cspan class=\"hljs-attr\"\u003etitle\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;getting-started\u0026quot;\u003c/span\u003e } },\n    };\n  },\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e对象的\u003ccode\u003ekey\u003c/code\u003e是需要渲染的 url 路径，\u003ccode\u003equery\u003c/code\u003e将作为 url 的 query 参数，传递给被渲染的页面。如果 url 路径是以目录结束，将会被导出为\u003ccode\u003e/dir-name/index.html\u003c/code\u003e文件，如果以文件名结尾，将导出为相同的文件名称，例如上面的\u003ccode\u003e/about.html\u003c/code\u003e。\u003c/p\u003e\n\n                \u003ch3 id=\"plugins\"\u003e\n                  plugins\n                \u003c/h3\u003e\u003cp\u003e类型：array, 默认\u003ccode\u003e[]\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"./plugins\"\u003e查看可用的插件列表\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e@symph/joy\u003c/code\u003e提供了插件机制来扩展其能力，例如支持 less 样式和导入图片等，插件的配置请参考各插件的使用说明文档。插件按照列表定义的顺序依次执行。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e withLess = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy-less\u0026quot;\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e withImageLoader = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy-image\u0026quot;\u003c/span\u003e);\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = {\n  \u003cspan class=\"hljs-attr\"\u003eserverRender\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003eplugins\u003c/span\u003e: [\u003cspan class=\"hljs-title function_\"\u003ewithLess\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003ecssModules\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e }), \u003cspan class=\"hljs-title function_\"\u003ewithImageLoader\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003elimit\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e8192\u003c/span\u003e })],\n};\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch3 id=\"webpack\"\u003e\n                  webpack\n                \u003c/h3\u003e\u003cp\u003e类型：function\u003c/p\u003e\n\u003cp\u003e一些常用的功能，\u003ccode\u003e@symph/joy\u003c/code\u003e提供了插件来支持，请先查看\u003ca href=\"#plugins\"\u003e插件列表\u003c/a\u003e是否有你想要额外功能。你也可以定义函数来增加或修改 webpack 的配置。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-jsx\"\u003e\u003cspan class=\"hljs-comment\"\u003e// This file is not going through babel transformation.\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// So, we write it in vanilla JS\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// (But you could use ES2015 features supported by your Node.js version)\u003c/span\u003e\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = {\n  \u003cspan class=\"hljs-attr\"\u003ewebpack\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003econfig, { buildId, dev, isServer, defaultLoaders }\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e// Perform customizations to webpack config\u003c/span\u003e\n\n    \u003cspan class=\"hljs-comment\"\u003e// Important: return the modified config\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e config;\n  },\n  \u003cspan class=\"hljs-attr\"\u003ewebpackDevMiddleware\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003econfig\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e// Perform customizations to webpack dev middleware config\u003c/span\u003e\n\n    \u003cspan class=\"hljs-comment\"\u003e// Important: return the modified config\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e config;\n  },\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e注意：\u003ccode\u003ewebpack\u003c/code\u003e函数会被执行两次，分别是为了编译出在服务端和 \b 客户端运行的代码，你可以通过\u003ccode\u003eisServer\u003c/code\u003e入参来区分。\u003c/p\u003e\n\n                \u003ch2 id=\"%E8%87%AA%E5%AE%9A%E4%B9%89-babel-config\"\u003e\n                  自定义 Babel config\n                \u003c/h2\u003e\u003cp\u003e为了扩展\u003ccode\u003ebabel\u003c/code\u003e的配置，可以在应用的根目录下创建\u003ccode\u003e.babelrc\u003c/code\u003e的文件，这个文件是可选的，如果它存在，就必须包含\u003ccode\u003e@symph/joy/babel\u003c/code\u003e preset，这样 joy 才能正常运行。\u003c/p\u003e\n\u003cp\u003e下面是一个\u003ccode\u003e.babelrc\u003c/code\u003e的例子：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-json\"\u003e\u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;presets\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/babel\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;plugins\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e]\u003c/span\u003e\n\u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003e@symph/joy/babel\u003c/code\u003e 里包含了编译应用的所需的所有配置，比如：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003epreset-env\u003c/li\u003e\n\u003cli\u003epreset-react\u003c/li\u003e\n\u003cli\u003eplugin-proposal-class-properties\u003c/li\u003e\n\u003cli\u003eplugin-proposal-object-rest-spread\u003c/li\u003e\n\u003cli\u003eplugin-transform-runtime\u003c/li\u003e\n\u003cli\u003estyled-jsx\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e上面这些已有的 preset 和 plugin 不能再添加到自定义的\u003ccode\u003e.babelrc\u003c/code\u003e中，你可以直接在\u003ccode\u003e@symph/joy/babel\u003c/code\u003e preset 的基础上修改,比如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-json\"\u003e\u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;presets\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-punctuation\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"hljs-punctuation\"\u003e[\u003c/span\u003e\n      \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/babel\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003e\u0026quot;preset-env\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003e\u0026quot;transform-runtime\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003e\u0026quot;styled-jsx\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"hljs-punctuation\"\u003e]\u003c/span\u003e\n  \u003cspan class=\"hljs-punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;plugins\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e]\u003c/span\u003e\n\u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e注意：\u003ccode\u003epreset-env\u003c/code\u003e里的\u003ccode\u003emodules\u003c/code\u003e配置项必须保持为\u003ccode\u003efalse\u003c/code\u003e，否则 webpack 的代码分离功能将不可以用。\u003c/p\u003e\n","anchor":[{"type":"heading","raw":"## 配置选项\n\n","depth":2,"text":"配置选项","tokens":[{"type":"text","raw":"配置选项","text":"配置选项"}],"id":"#%E9%85%8D%E7%BD%AE%E9%80%89%E9%A1%B9","children":[{"type":"heading","raw":"### main\n\n","depth":3,"text":"main","tokens":[{"type":"text","raw":"main","text":"main"}],"id":"#main"},{"type":"heading","raw":"### distDir\n\n","depth":3,"text":"distDir","tokens":[{"type":"text","raw":"distDir","text":"distDir"}],"id":"#distdir"},{"type":"heading","raw":"### assetPrefix\n\n","depth":3,"text":"assetPrefix","tokens":[{"type":"text","raw":"assetPrefix","text":"assetPrefix"}],"id":"#assetprefix"},{"type":"heading","raw":"### serverRuntimeConfig\n\n","depth":3,"text":"serverRuntimeConfig","tokens":[{"type":"text","raw":"serverRuntimeConfig","text":"serverRuntimeConfig"}],"id":"#serverruntimeconfig"},{"type":"heading","raw":"### publicRuntimeConfig\n\n","depth":3,"text":"publicRuntimeConfig","tokens":[{"type":"text","raw":"publicRuntimeConfig","text":"publicRuntimeConfig"}],"id":"#publicruntimeconfig"},{"type":"heading","raw":"### exportPathMap\n\n","depth":3,"text":"exportPathMap","tokens":[{"type":"text","raw":"exportPathMap","text":"exportPathMap"}],"id":"#exportpathmap"},{"type":"heading","raw":"### plugins\n\n","depth":3,"text":"plugins","tokens":[{"type":"text","raw":"plugins","text":"plugins"}],"id":"#plugins"},{"type":"heading","raw":"### webpack\n\n","depth":3,"text":"webpack","tokens":[{"type":"text","raw":"webpack","text":"webpack"}],"id":"#webpack"}]},{"type":"heading","raw":"## 自定义 Babel config\n\n","depth":2,"text":"自定义 Babel config","tokens":[{"type":"text","raw":"自定义 Babel config","text":"自定义 Babel config"}],"id":"#%E8%87%AA%E5%AE%9A%E4%B9%89-babel-config"}]},{"title":"\b 插件列表","path":"/v1/plugins","file":"docs\\v1\\04-plugins.md","hasMenu":false,"mdContent":"# \b 插件列表\r\n\r\n我们将不断提供新的插件，如果你需要帮助或建议，请联系我们lnlfps@gmail.com，或者创建 issue。如果你完成了一个新的插件，并愿意分享，请提交到[`https://github.com/lnlfps/joy-plugins`](https://github.com/lnlfps/joy-plugins).\r\n\r\n下面列举了[`joy-pluins`](https://github.com/lnlfps/joy-plugins)提供的插件：\r\n\r\n- [@symph/joy-css](https://github.com/lnlfps/joy-plugins/tree/master/packages/joy-css) 支持 css 样式导入，例如`import './index.css'`\r\n- [@symph/joy-less](https://github.com/lnlfps/joy-plugins/tree/master/packages/joy-less) 支持 less 样式导入， 例如`import styles form './index.css'`\r\n- [@symph/joy-image](https://github.com/lnlfps/joy-plugins/tree/master/packages/joy-image) 提供图片的导入，例如`\u003cimg src={require('./logo.png')} /\u003e`\r\n","htmlContent":"\n                \u003ch1 id=\"%08-%E6%8F%92%E4%BB%B6%E5%88%97%E8%A1%A8\"\u003e\n                  \b 插件列表\n                \u003c/h1\u003e\u003cp\u003e我们将不断提供新的插件，如果你需要帮助或建议，请联系我们\u003ca href=\"mailto:\u0026#x6c;\u0026#x6e;\u0026#x6c;\u0026#x66;\u0026#112;\u0026#115;\u0026#x40;\u0026#x67;\u0026#x6d;\u0026#97;\u0026#105;\u0026#108;\u0026#46;\u0026#x63;\u0026#x6f;\u0026#109;\"\u003e\u0026#x6c;\u0026#x6e;\u0026#x6c;\u0026#x66;\u0026#112;\u0026#115;\u0026#x40;\u0026#x67;\u0026#x6d;\u0026#97;\u0026#105;\u0026#108;\u0026#46;\u0026#x63;\u0026#x6f;\u0026#109;\u003c/a\u003e，或者创建 issue。如果你完成了一个新的插件，并愿意分享，请提交到\u003ca href=\"https://github.com/lnlfps/joy-plugins\"\u003e\u003ccode\u003ehttps://github.com/lnlfps/joy-plugins\u003c/code\u003e\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003e下面列举了\u003ca href=\"https://github.com/lnlfps/joy-plugins\"\u003e\u003ccode\u003ejoy-pluins\u003c/code\u003e\u003c/a\u003e提供的插件：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/lnlfps/joy-plugins/tree/master/packages/joy-css\"\u003e@symph/joy-css\u003c/a\u003e 支持 css 样式导入，例如\u003ccode\u003eimport \u0026#39;./index.css\u0026#39;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/lnlfps/joy-plugins/tree/master/packages/joy-less\"\u003e@symph/joy-less\u003c/a\u003e 支持 less 样式导入， 例如\u003ccode\u003eimport styles form \u0026#39;./index.css\u0026#39;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/lnlfps/joy-plugins/tree/master/packages/joy-image\"\u003e@symph/joy-image\u003c/a\u003e 提供图片的导入，例如\u003ccode\u003e\u0026lt;img src={require(\u0026#39;./logo.png\u0026#39;)} /\u0026gt;\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","anchor":[]},{"title":"示例","path":"/v1/examples","file":"docs\\v1\\05-examples.md","hasMenu":false,"mdContent":"# 示例\r\n\r\n- [hello-world](https://github.com/lnlfps/symph-joy/tree/master/examples/hello-world) 最简单的例子\r\n- [basic](https://github.com/lnlfps/symph-joy/tree/master/examples/basic) 展示主要特性的使用方法\r\n- [with-element-react](https://github.com/lnlfps/symph-joy/tree/master/examples/with-element-react) 集成 element-react UI 框架\r\n- [with-antd](https://github.com/lnlfps/symph-joy/tree/master/examples/with-antd) 集成 antd UI 框架\r\n- [with-antd](https://github.com/lnlfps/symph-joy/tree/master/examples/with-antd-mobile) 集成 antd-mobile UI 框架\r\n","htmlContent":"\n                \u003ch1 id=\"%E7%A4%BA%E4%BE%8B\"\u003e\n                  示例\n                \u003c/h1\u003e\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/lnlfps/symph-joy/tree/master/examples/hello-world\"\u003ehello-world\u003c/a\u003e 最简单的例子\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/lnlfps/symph-joy/tree/master/examples/basic\"\u003ebasic\u003c/a\u003e 展示主要特性的使用方法\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/lnlfps/symph-joy/tree/master/examples/with-element-react\"\u003ewith-element-react\u003c/a\u003e 集成 element-react UI 框架\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/lnlfps/symph-joy/tree/master/examples/with-antd\"\u003ewith-antd\u003c/a\u003e 集成 antd UI 框架\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/lnlfps/symph-joy/tree/master/examples/with-antd-mobile\"\u003ewith-antd\u003c/a\u003e 集成 antd-mobile UI 框架\u003c/li\u003e\n\u003c/ul\u003e\n","anchor":[]},{"title":"了解 @symph/joy","path":"/v1/thinking-in-joy","file":"docs\\v1\\06-thinking-in-joy.md","hasMenu":false,"mdContent":"# 了解 @symph/joy\r\n\r\n我们希望有一个结合了 next.js 和 dva 优点的基础框架，它们都是目前非常流行的前端框架，next.js 为我们解决了服务端渲染和零配置的问题，而 dva 能够更好的管理应用中的业务流程和数据，但两者现有结合的方案里，我们遇到了些问题，并尝试解决这些问题之后，发现直接 import 集成是无法完整的发挥其各自的优势的，甚至还不得不做出一些妥协，虽然他们的着重点相同，但实际上还是前端框架，模块直接难免会有冲突，所以我们选择以一个全新的起点出发，取他们的优点，创建了@symph/joy，希望她能像其名字一样(交响曲-欢乐颂)，融合了前端的各种最佳实践，创建出一首交响曲，能给我们带来欢乐。\r\n\r\n## 集成 next.js 和 dva 遇到的一些问题\r\n\r\n- 数据获取方法存在于 dva `model`和 next.js `getInitialProps`两个地方，如何统一？在服务端渲染时，无法调用 model 中的业务方法来初始化应用数据，只能将获取方法放在 next.js 里 getInitialProps 里，然后将获取到的数据作 initState 来初始化 dva 的 store。而我们希望，所有的业务都只存在于 model 中，不管是在服务端渲染加载页面初始数据时，还是浏览器上用户交互时，都可以自由的调用 model 中的业务方法来获取、处理数据。\r\n- 不同的 router 体系，如何统一为 react-router-4？next.js 使用文件系统路由，一个页面对应目录中的一个文件，切换页面时，上个页面的内容和数据将会被完全销毁，被新的界面替换，这让页面数据恢复、数据共享、局部更新等功能实现起来较困难，而 react-router-4 却能轻松解决这些问题。 例如我们有个分页展示的产品列表页，当点击某个产品进入详情页后，点击返回按钮再次回到列表页，但此时之前的列表数据已经不存在了，无法恢复到用户之前浏览到的位置，只能重新获取第一页数据。\r\n- 如何调用多层嵌套 route 中的数据初始化方法？react-route-4 的路由是动态的，无法使用类似 next.js 的方式，在最外层的 route 上定义`getInitialProps`来加载整个页面的数据。为了保证模块间的独立性，我们仍然希望各业务组件的数据获取方法，定义在组件其内部。\r\n- dva `model`在服务端不能重复载入问题？dva 中的 model 是单例的， 在服务端每次请求都会创建新的 dva 实例，而重新载入 model，此时会对 model 对象进行修改，例如给 reducers 方法名称前添加 namespace 前缀。\r\n\r\n## 需要一个怎样的基础框架\r\n\r\n### 远离复杂的配置\r\n\r\n这点继承于 next.js，从项目创建、启动测试和打生产包，都不用编写任何配置(webpack、开发调试插件、热加载插件、样式处理插、混淆压缩插件等)，默认配置已经能够保证应用良好运行。\r\n\r\n我们并不希望把配置做的大而全，而是把常用的，可能存在差异的配置做成了配置插件，例如 less、sass、图片加载插件等，开发者可以根据需要选用需要的插件，或者轻松的封装自定义插件。\r\n\r\n### 简单的项目结构\r\n\r\n框架对项目目录结构有一些约定，例如静态文件目录`static`、源代码目录`src`、编译输出目录`.joy`等，这没什么难点，只是一个约定，也可以通过配置修改目录结构。\r\n\r\n采用工程化的 MVC 分层思想，保证架构层、功能模块、目录的职责明确、依赖清晰，以便项目不断更新迭代，以及多人协同开发。\r\n\r\n例如：在以往，我们为了在加载页面之前获取页面数据，通常在路由组件定义路径的时候也需要定义一个获取页面数据方法，这让路由组件处理了路由以外的业务，也让本该属于一个业务组件的逻辑定义在其它地方，看起来都不算是一个好方案. 在@symph/joy 里，可以把组件获取数据的业务方法放其内部，系统可以保证在界面渲染之前，调用这个方法来加载组件相关的数据，开发人员可以专心的在业务组件内部实现其所有的功能。\r\n\r\n\u003e 为什么不采用其它的类似 MVVM 的框架呢？稍后会有更详细的讨论。\r\n\r\n### 简化前端技术概念\r\n\r\n前端的技术概念层出不穷，npm 的包数量已经超越 maven，整个技术栈已经不亚于 java 后台的服务架构，且不同的工具库内部，还有各种各样的概念，要把这些技术组合在一起，形成一个高效的框架，并不是一件容易的事儿。例如仅 redux 涉及的概念就有 store、middleware、state、dispatch、connect、action、ActionConst、actonCreater、reducer、promise-thunk、saga(helper、effects、task、yield\\*)等，这让学习成本变得很高，也不利于在不同技术栈的团队间分享资源，即使采用了相同的技术库，不同的团队之间代码风格，实现细节也会有的差异。\r\n\r\n@symph/joy，从一个整体框架出发，屏蔽了复杂的底层技术细节，以一个工程的界面展现给开发者，尽量减少新概念的引入，仅用两个概念`@controller` `@model`实现了 MVC 组件、依赖注册、服务端渲染等高级功能，了为了减少对业务代码的侵入，使用装饰器`@`的方式将普通 Class 标识为 Controller 和 Model，同时简化了 React+Redux 的使用，开发人员甚至不用学习 Redux 的知识即可开始 Model 开发。\r\n\r\n### 封装一些通用模块\r\n\r\n- 支持`react-dom`的方式(`renderToStaticMarkup(\u003chtml\u003e\u003chead\u003e\u003c/head\u003e\u003cbody\u003e\u003c/body\u003e\u003c/html\u003e)`)渲染 html 文档，不引入其它的模板引擎\r\n- es6、7、8 高级语法支持，不管是在 Node.js 还是浏览器上运行的代码，都可以放心的使用高级语法\r\n- css 样式处理，PostCss 集成、css 样式提取等。\r\n- 静态资源访问，只需要将图片、字体等文件放入`static`目录下，即可通过`/static/{patch}`访问\r\n- 支持调试，不要任何配置，即可在开发环境支持热加载、热刷新、redux 日志、断点调试等功能\r\n- 加载优化，提高浏览器资源加载效率，提升用户体验，支持按需加载、依赖 js 提前载入、代码压缩、css 压缩等\r\n\r\n## MVC 的思考\r\n\r\n### 为什么不是 MVVM？\r\n\r\nMVC 是最著名的软件架构，也是我们最容易理解，最基础的框架之一，其它架构大部分都是来自在特定技术环境下 MVC 的改进，例如：HMVC、MVA、MVP、MVVM。MVVM 在前端开发社区里，也很流行，我们经常在争论遵循什么什么架构的是 MVVM，MVVM 有什么组件、没有什么组件，哪些数据该放在哪个 ViewModel 里等问题，其实这些疑问已经在阻碍了我们的开发工作了，框架的职责本就是定义系统该由哪些部分组成，以及各部分是如何工作的，从而减少这些疑问，让开发效率更高。从这点上讲，MVC 的疑问好像要少的多，我们希望一切都变得简单，所以 MVC 成为了第一选择。\r\n\r\n### 如何实现 MVC\r\n\r\n实现 MVC 的核心技术仅有 React+Redux，Redux 实现的是 Model，React 分为展现类组件(View)和控制类组件(Controller)。为了方便使用，@symph/joy 提供了`@controller`和`@model`两个类装饰器，明确标识一个 Class 是 Controller 还是 Model，这可有效的避免 Class 职责不明确，依赖混乱的问题。\r\n\r\n他们各自的职责如下：\r\n\r\n- Model: 管理应用的行为和数据，Class 类，有初始状态(Redux store 中的一部分内容)，业务过程中更新 model 状态(更新 store 的状态)\r\n- View: 展示 Model 中的数据，继承 React.Component，展示的数据来源于`props`\r\n- Controller: 控制 View 的展示，绑定 Model 数据到 View，响应用户的操作，调用 Model 中的业务, 被`@controller`注释的 React.Component\r\n\r\n### 如何编排业务流程？\r\n\r\n在 Model 中定义的一个方法通常只处理一个业务，例如对象的增删改查方法为四个不同的业务流程，应保证业务方法的原子性和独立性时，但我们时常需要调用多个子业务来完成一件更大的事情，此时我们有两个选择，在 Model 或者 Controller 中组装业务，那到底改放在哪里呢？我们可以先回答下面几个问题：\r\n\r\n- 组装的业务执行过程中，是否需要和用户交互？如果需要，适合放在 Controller 中组装，封装为可复用的交互组件\r\n- 是否和某个具体的界面无关？即组合好的业务，在任何地方都可发起起调，而不会产生副作用，此时适合放在 Model 中组装\r\n- 被组装的子业务，是否可以拆分出来，并发独立执行？可并发执行的业务，建议在 Controller 中根据页面功能组装，不可拆分的部分在 Model 中封装为一个大业务\r\n\r\n#### 在 Controller 中组合业务\r\n\r\n根据版面内容，和用户交互流程来组合业务。下面展示了一个博客首页加载数据的例子，需要获取当前登陆用户信息和博客列表。\r\n\r\n```js\r\nimport React from 'react'\r\nimport controller, {requireModel} from '@symph/joy/controller'\r\nimport UserModel from '../models/UsersModel'\r\nimport BlogsModel from '../models/BlogsModel'\r\nimport Dialog from 'some-dialog'\r\n\r\n@requireModel(UserModel, MessagesModel, BlogsModel)\r\n@controller((store)=\u003e ({\r\n    me: store.users.me，\r\n    blogs: store.blogs.list\r\n}))\r\nexport default class IndexController extends React.Component {\r\n\r\n    async componentDidmount () {\r\n        let {dispatch} = this.props;\r\n\r\n        Dialog.showLoadingProgress();\r\n\r\n        // invoke services\r\n        let [me, blogs] = await Promise.all([\r\n            dispatch({type:'users/getUser'}),\r\n            dispatch({type:'blogs/getBlogs', pageIndex:1, pageSize: 10});\r\n        ]);\r\n\r\n        if(me != null){\r\n            // an user has logined， done some acton about the user.\r\n        }\r\n\r\n         Dialog.hideLoadingProgress();\r\n    }\r\n\r\n    render () {\r\n        let {me, blogs} = this.props;\r\n        return \u003cdiv\u003eme.name\u003c/div\u003e\r\n    }\r\n}\r\n```\r\n\r\n#### 在 Model 中组装业务\r\n\r\n在 Model 中也使用`this.dispatch(action)`来调用其它业务，和 Controller 中调用 model 中的业务方法一致。如果是调用 Model 自身的其它方法，可以直接执行函数调用。\r\n\r\n下面假设了一个场景：用户在博客列表页，点击收藏了某个博客文章，调用服务端收藏接口成功后，为了保持本地数据一致，需要更新统计模块的收藏总数，以及博客列表中文章的收藏状态，使整个应用的数据状态保持一致和及时更新界面，下面使用了片段代码来演示如何实现。\r\n\r\n```js\r\nimport React from \"react\";\r\nimport model from \"@symph/joy/model\";\r\nimport UserModel from \"../models/UsersModel\";\r\nimport BlogsModel from \"../models/BlogsModel\";\r\n\r\n@model()\r\nexport default class BlogsModel {\r\n  initState = {\r\n    blogs: null, // all blogs in brower memory\r\n    favBlogs: [], //all favourite blogs in brower memory\r\n  };\r\n\r\n  async favBlog({ blog }) {\r\n    let { favBlogs } = this.getState();\r\n    let resp = await fetch(\"https://www.example.com/api/blogs/fav\", { blogId: blog.id }, { method: \"POST\" });\r\n\r\n    blog.isFav = true; // update the blog's fav status\r\n    this.setState({\r\n      favBlogs: [...favBlogs, blog],\r\n    });\r\n\r\n    await this.updateBlog({ blog }); // invoke self service\r\n\r\n    // update the count of user‘s favourite blogs\r\n    await this.dispatch({\r\n      // invoke other model’s service\r\n      type: \"statistics/favBlogsCount\",\r\n      increase: 1,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * update the  blog, if the blog has changed\r\n   **/\r\n  async updateBlog({ blog }) {\r\n    let { blogs } = this.getState();\r\n    for (let i = 0; i \u003c blogs.lenght; i++) {\r\n      if (blog.id === blogs[i].id) {\r\n        this.setState({\r\n          blogs: [...blogs.splice(i, 1, blog)],\r\n        });\r\n        bread;\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n### 作为 Node.js 服务端应用的 View 模块\r\n\r\n[使用方法](https://lnlfps.github.io/symph-joy/#/getting-started?id=代码启动-server)\r\n\r\n@symph/joy 可以作为 express 或者 koa 等框架的 View 模块，和传统的模板渲染方式不一样的是\r\n\r\n- api 接口和 View 完全分离，View 是@symph/joy 的一个应用，在服务端和客户端渲染界面时，根据需要主动从 api 里获取数据，express 里不再编写任何界面相关的代码了\r\n- 不需要给每个页面编写服务端路由，只需要一个能匹配@symph/joy 应用所有页面路径的正则路径即可\r\n- 不再需要任何其他模板技术（jade、handlebars、ejs 等），使用 React 渲染出 html 内容和业务界面\r\n\r\n## 服务端渲染的问题\r\n\r\n### 同一份代码，在两端运行？\r\n\r\n这个问题，看起来是如何实现同构的问题，但事实上现阶段实现前端同构应用还是件很困难的事，对框架和业务开发都是件有挑战的事，同构还只是停留在概念阶段。而我们想做的是，让开发人员在进行业务开发时拥有同构的体验，让框架来解决部分跨端运行的问题。在@symph/joy 中，应用的 Model、Controller 和 View 组件都支持在两端运行，开发人员只需要专注于业务实现。\r\n\r\n### 同构的模块\r\n\r\n@symph/joy 只将两端运行的有差异的模块进行了同构化，例如`fetch`方法使用了[isomorphic-fetch](https://github.com/matthew-andrews/isomorphic-fetch)库，当`fetch`识别到在服务端运行时，底层调用`node-fetch`来发送网络请求，如果是在浏览器上，则使用`whatwg-fetch`发送请求，在进行工功能开发是，我们只需要直接调用`fetch`方法来获取数据即可。\r\n\r\n为了方便使用，@symph/joy-plugins 提供的插件，都解决了日常开发中常见的跨端运行问题。\r\n\r\n\u003e 在使用第三方 UI 控件的时，要注意它是否支持服务端渲染。\r\n\r\n### 自动编译到目标环境\r\n\r\n在 Node.js 和浏览器上运行的 js 代码并不是完全相同的，例如在 Node.js 上不需要加载样式、不加载图片、动态 import 模块无法同步渲染等。他们执行的结果也不一样，Node.js 主要是渲染出 html，客户端则是渲染出用户可见的画面。同时需要针对目标环境做打包优化，在所以@symph/joy 提供了两套 webpack 配置，将同一份源码编译到浏览器和服务器上的两套代码，在编译时，这两个编译过程会同步进行 \b\b 以提高编译效率。\r\n\r\n下面列举了两端打包的一些差异性\r\n\r\n客户端\r\n\r\n- 开发环境输出错误详情 \b\r\n- 热加载插件\r\n- 代码混淆压缩\r\n- 公共代码提取\r\n- 应用入口 Component 标识\r\n\r\n服务端\r\n\r\n- `import`导入指令替换为同步方式导入，支持服务端渲染\r\n\r\n### `componentPrepare` 生命周期\r\n\r\n在用户请求页面时，服务端加载页面所包含的组件，运行所有`controller`组件的`componentPrepare`方法，获取组件需要的数据，然后渲染出 html 文档，最后在浏览器上渲染 DOM 和绑定事件。`componentPrepare`方法保证了在服务端和客户端只执行一次数据获取。以上几个执行步骤，可以根据运行环境和配置，自动的安排其执行的地方，例如可以通过自定义配置，手动关闭服务端的 html 渲染，只预加载界面数据，浏览器直接使用数据渲染出界面，这样依然可以提升首屏渲染效率，同时也减少了服务端运行的部分压力，也可以完全关闭服务端的 \b 数据获取和 html 渲染两个步骤，全部执行步骤在浏览器上完成。\b\r\n\r\n`componentPrepare`只是定义在`Controller`上的一个普通实例方法，\b 框架在 \b 组件初始化时自动调用，也可以在运行的过程中手动调用，\b 用于重新刷新界面数据等操作。\r\n\r\n## 跨域问题\r\n\r\n在浏览器上使用 js 发送的异步网络请求，处于安全考虑是不允许跨域的，常见的解决方案有 jsonp 或者在服务端集成一个代理服务器，在@sympy/joy 中，我们希望前端开发也能拥有和原生开发一样的体验，不再为跨域请求烦恼，在@symph/joy 中集成了一个自动代理转发服务，发送请求时只需要指定目标地址即可，例如`fetch('https://www.example.com/api/hello')`，`fetch`内部会判断是否跨域，以及是否启动代理转发请求。\r\n\r\n代理服务在@symph/joy 服务端上运行，所以如果打包成静态版本，部署在其它服务器或者静态文件服务器上，该功能将无法启动。如果部署在其它 Node.js 服务器上，依然可以通过手动集成`proxy-api-middleware`插件来启动该服务。\r\n\r\n## 打包静态版本\r\n\r\n静态版本即不需要 Node.js 做任何的渲染工作，也可以脱离 Node.js 运行。几乎不用做任何更改，就可以使用`joy export`将@symph/joy 打包为静态版本，直接将打包后的输出文件(`out`目录下的所有文件)拷贝到静态服务器上就可完成部署，浏览器加载这些静态资源(js、css、image 等)运行应用。静态版本依然支持@symph/joy 提供的大部分功能，例如 MVC 组件、代码分割、动态路由等。\r\n\r\n由于没有了 Node.js 服务端的支持，将失去服务端数据预加载、渲染、跨域请求代理转发等功能，对于用户的影响主要是首屏等待的时间更长，但代码压缩、按需加载、动态路由等功能依然能保证首屏加载足够快，建议此时添加页面加载动画，用户体验会更好。对于业务开发人员来说，跨域业务请求将不能直接发送，常见的解决方案有，在后方业务服务上返回`index.html`(静态版本中已经渲染好的 html 文件)文件，这样 html 文档和业务 api 请求在就在同一个域名下了，或者配置 nginx 反向代理，将业务请求和页面请求合并到同一个域名下，还可以使用 jsonp 发送跨域请求等。\r\n","htmlContent":"\n                \u003ch1 id=\"%E4%BA%86%E8%A7%A3-symph%2Fjoy\"\u003e\n                  了解 @symph/joy\n                \u003c/h1\u003e\u003cp\u003e我们希望有一个结合了 next.js 和 dva 优点的基础框架，它们都是目前非常流行的前端框架，next.js 为我们解决了服务端渲染和零配置的问题，而 dva 能够更好的管理应用中的业务流程和数据，但两者现有结合的方案里，我们遇到了些问题，并尝试解决这些问题之后，发现直接 import 集成是无法完整的发挥其各自的优势的，甚至还不得不做出一些妥协，虽然他们的着重点相同，但实际上还是前端框架，模块直接难免会有冲突，所以我们选择以一个全新的起点出发，取他们的优点，创建了@symph/joy，希望她能像其名字一样(交响曲-欢乐颂)，融合了前端的各种最佳实践，创建出一首交响曲，能给我们带来欢乐。\u003c/p\u003e\n\n                \u003ch2 id=\"%E9%9B%86%E6%88%90-nextjs-%E5%92%8C-dva-%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98\"\u003e\n                  集成 next.js 和 dva 遇到的一些问题\n                \u003c/h2\u003e\u003cul\u003e\n\u003cli\u003e数据获取方法存在于 dva \u003ccode\u003emodel\u003c/code\u003e和 next.js \u003ccode\u003egetInitialProps\u003c/code\u003e两个地方，如何统一？在服务端渲染时，无法调用 model 中的业务方法来初始化应用数据，只能将获取方法放在 next.js 里 getInitialProps 里，然后将获取到的数据作 initState 来初始化 dva 的 store。而我们希望，所有的业务都只存在于 model 中，不管是在服务端渲染加载页面初始数据时，还是浏览器上用户交互时，都可以自由的调用 model 中的业务方法来获取、处理数据。\u003c/li\u003e\n\u003cli\u003e不同的 router 体系，如何统一为 react-router-4？next.js 使用文件系统路由，一个页面对应目录中的一个文件，切换页面时，上个页面的内容和数据将会被完全销毁，被新的界面替换，这让页面数据恢复、数据共享、局部更新等功能实现起来较困难，而 react-router-4 却能轻松解决这些问题。 例如我们有个分页展示的产品列表页，当点击某个产品进入详情页后，点击返回按钮再次回到列表页，但此时之前的列表数据已经不存在了，无法恢复到用户之前浏览到的位置，只能重新获取第一页数据。\u003c/li\u003e\n\u003cli\u003e如何调用多层嵌套 route 中的数据初始化方法？react-route-4 的路由是动态的，无法使用类似 next.js 的方式，在最外层的 route 上定义\u003ccode\u003egetInitialProps\u003c/code\u003e来加载整个页面的数据。为了保证模块间的独立性，我们仍然希望各业务组件的数据获取方法，定义在组件其内部。\u003c/li\u003e\n\u003cli\u003edva \u003ccode\u003emodel\u003c/code\u003e在服务端不能重复载入问题？dva 中的 model 是单例的， 在服务端每次请求都会创建新的 dva 实例，而重新载入 model，此时会对 model 对象进行修改，例如给 reducers 方法名称前添加 namespace 前缀。\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch2 id=\"%E9%9C%80%E8%A6%81%E4%B8%80%E4%B8%AA%E6%80%8E%E6%A0%B7%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A1%86%E6%9E%B6\"\u003e\n                  需要一个怎样的基础框架\n                \u003c/h2\u003e\n                \u003ch3 id=\"%E8%BF%9C%E7%A6%BB%E5%A4%8D%E6%9D%82%E7%9A%84%E9%85%8D%E7%BD%AE\"\u003e\n                  远离复杂的配置\n                \u003c/h3\u003e\u003cp\u003e这点继承于 next.js，从项目创建、启动测试和打生产包，都不用编写任何配置(webpack、开发调试插件、热加载插件、样式处理插、混淆压缩插件等)，默认配置已经能够保证应用良好运行。\u003c/p\u003e\n\u003cp\u003e我们并不希望把配置做的大而全，而是把常用的，可能存在差异的配置做成了配置插件，例如 less、sass、图片加载插件等，开发者可以根据需要选用需要的插件，或者轻松的封装自定义插件。\u003c/p\u003e\n\n                \u003ch3 id=\"%E7%AE%80%E5%8D%95%E7%9A%84%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84\"\u003e\n                  简单的项目结构\n                \u003c/h3\u003e\u003cp\u003e框架对项目目录结构有一些约定，例如静态文件目录\u003ccode\u003estatic\u003c/code\u003e、源代码目录\u003ccode\u003esrc\u003c/code\u003e、编译输出目录\u003ccode\u003e.joy\u003c/code\u003e等，这没什么难点，只是一个约定，也可以通过配置修改目录结构。\u003c/p\u003e\n\u003cp\u003e采用工程化的 MVC 分层思想，保证架构层、功能模块、目录的职责明确、依赖清晰，以便项目不断更新迭代，以及多人协同开发。\u003c/p\u003e\n\u003cp\u003e例如：在以往，我们为了在加载页面之前获取页面数据，通常在路由组件定义路径的时候也需要定义一个获取页面数据方法，这让路由组件处理了路由以外的业务，也让本该属于一个业务组件的逻辑定义在其它地方，看起来都不算是一个好方案. 在@symph/joy 里，可以把组件获取数据的业务方法放其内部，系统可以保证在界面渲染之前，调用这个方法来加载组件相关的数据，开发人员可以专心的在业务组件内部实现其所有的功能。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e为什么不采用其它的类似 MVVM 的框架呢？稍后会有更详细的讨论。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n                \u003ch3 id=\"%E7%AE%80%E5%8C%96%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%A6%82%E5%BF%B5\"\u003e\n                  简化前端技术概念\n                \u003c/h3\u003e\u003cp\u003e前端的技术概念层出不穷，npm 的包数量已经超越 maven，整个技术栈已经不亚于 java 后台的服务架构，且不同的工具库内部，还有各种各样的概念，要把这些技术组合在一起，形成一个高效的框架，并不是一件容易的事儿。例如仅 redux 涉及的概念就有 store、middleware、state、dispatch、connect、action、ActionConst、actonCreater、reducer、promise-thunk、saga(helper、effects、task、yield*)等，这让学习成本变得很高，也不利于在不同技术栈的团队间分享资源，即使采用了相同的技术库，不同的团队之间代码风格，实现细节也会有的差异。\u003c/p\u003e\n\u003cp\u003e@symph/joy，从一个整体框架出发，屏蔽了复杂的底层技术细节，以一个工程的界面展现给开发者，尽量减少新概念的引入，仅用两个概念\u003ccode\u003e@controller\u003c/code\u003e \u003ccode\u003e@model\u003c/code\u003e实现了 MVC 组件、依赖注册、服务端渲染等高级功能，了为了减少对业务代码的侵入，使用装饰器\u003ccode\u003e@\u003c/code\u003e的方式将普通 Class 标识为 Controller 和 Model，同时简化了 React+Redux 的使用，开发人员甚至不用学习 Redux 的知识即可开始 Model 开发。\u003c/p\u003e\n\n                \u003ch3 id=\"%E5%B0%81%E8%A3%85%E4%B8%80%E4%BA%9B%E9%80%9A%E7%94%A8%E6%A8%A1%E5%9D%97\"\u003e\n                  封装一些通用模块\n                \u003c/h3\u003e\u003cul\u003e\n\u003cli\u003e支持\u003ccode\u003ereact-dom\u003c/code\u003e的方式(\u003ccode\u003erenderToStaticMarkup(\u0026lt;html\u0026gt;\u0026lt;head\u0026gt;\u0026lt;/head\u0026gt;\u0026lt;body\u0026gt;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;)\u003c/code\u003e)渲染 html 文档，不引入其它的模板引擎\u003c/li\u003e\n\u003cli\u003ees6、7、8 高级语法支持，不管是在 Node.js 还是浏览器上运行的代码，都可以放心的使用高级语法\u003c/li\u003e\n\u003cli\u003ecss 样式处理，PostCss 集成、css 样式提取等。\u003c/li\u003e\n\u003cli\u003e静态资源访问，只需要将图片、字体等文件放入\u003ccode\u003estatic\u003c/code\u003e目录下，即可通过\u003ccode\u003e/static/{patch}\u003c/code\u003e访问\u003c/li\u003e\n\u003cli\u003e支持调试，不要任何配置，即可在开发环境支持热加载、热刷新、redux 日志、断点调试等功能\u003c/li\u003e\n\u003cli\u003e加载优化，提高浏览器资源加载效率，提升用户体验，支持按需加载、依赖 js 提前载入、代码压缩、css 压缩等\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch2 id=\"mvc-%E7%9A%84%E6%80%9D%E8%80%83\"\u003e\n                  MVC 的思考\n                \u003c/h2\u003e\n                \u003ch3 id=\"%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E6%98%AF-mvvm%EF%BC%9F\"\u003e\n                  为什么不是 MVVM？\n                \u003c/h3\u003e\u003cp\u003eMVC 是最著名的软件架构，也是我们最容易理解，最基础的框架之一，其它架构大部分都是来自在特定技术环境下 MVC 的改进，例如：HMVC、MVA、MVP、MVVM。MVVM 在前端开发社区里，也很流行，我们经常在争论遵循什么什么架构的是 MVVM，MVVM 有什么组件、没有什么组件，哪些数据该放在哪个 ViewModel 里等问题，其实这些疑问已经在阻碍了我们的开发工作了，框架的职责本就是定义系统该由哪些部分组成，以及各部分是如何工作的，从而减少这些疑问，让开发效率更高。从这点上讲，MVC 的疑问好像要少的多，我们希望一切都变得简单，所以 MVC 成为了第一选择。\u003c/p\u003e\n\n                \u003ch3 id=\"%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0-mvc\"\u003e\n                  如何实现 MVC\n                \u003c/h3\u003e\u003cp\u003e实现 MVC 的核心技术仅有 React+Redux，Redux 实现的是 Model，React 分为展现类组件(View)和控制类组件(Controller)。为了方便使用，@symph/joy 提供了\u003ccode\u003e@controller\u003c/code\u003e和\u003ccode\u003e@model\u003c/code\u003e两个类装饰器，明确标识一个 Class 是 Controller 还是 Model，这可有效的避免 Class 职责不明确，依赖混乱的问题。\u003c/p\u003e\n\u003cp\u003e他们各自的职责如下：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eModel: 管理应用的行为和数据，Class 类，有初始状态(Redux store 中的一部分内容)，业务过程中更新 model 状态(更新 store 的状态)\u003c/li\u003e\n\u003cli\u003eView: 展示 Model 中的数据，继承 React.Component，展示的数据来源于\u003ccode\u003eprops\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eController: 控制 View 的展示，绑定 Model 数据到 View，响应用户的操作，调用 Model 中的业务, 被\u003ccode\u003e@controller\u003c/code\u003e注释的 React.Component\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch3 id=\"%E5%A6%82%E4%BD%95%E7%BC%96%E6%8E%92%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B%EF%BC%9F\"\u003e\n                  如何编排业务流程？\n                \u003c/h3\u003e\u003cp\u003e在 Model 中定义的一个方法通常只处理一个业务，例如对象的增删改查方法为四个不同的业务流程，应保证业务方法的原子性和独立性时，但我们时常需要调用多个子业务来完成一件更大的事情，此时我们有两个选择，在 Model 或者 Controller 中组装业务，那到底改放在哪里呢？我们可以先回答下面几个问题：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e组装的业务执行过程中，是否需要和用户交互？如果需要，适合放在 Controller 中组装，封装为可复用的交互组件\u003c/li\u003e\n\u003cli\u003e是否和某个具体的界面无关？即组合好的业务，在任何地方都可发起起调，而不会产生副作用，此时适合放在 Model 中组装\u003c/li\u003e\n\u003cli\u003e被组装的子业务，是否可以拆分出来，并发独立执行？可并发执行的业务，建议在 Controller 中根据页面功能组装，不可拆分的部分在 Model 中封装为一个大业务\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch4 id=\"%E5%9C%A8-controller-%E4%B8%AD%E7%BB%84%E5%90%88%E4%B8%9A%E5%8A%A1\"\u003e\n                  在 Controller 中组合业务\n                \u003c/h4\u003e\u003cp\u003e根据版面内容，和用户交互流程来组合业务。下面展示了一个博客首页加载数据的例子，需要获取当前登陆用户信息和博客列表。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eReact\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;react\u0026#x27;\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e controller, {requireModel} \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;@symph/joy/controller\u0026#x27;\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eUserModel\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;../models/UsersModel\u0026#x27;\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eBlogsModel\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;../models/BlogsModel\u0026#x27;\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDialog\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;some-dialog\u0026#x27;\u003c/span\u003e\n\n@requireModel(\u003cspan class=\"hljs-title class_\"\u003eUserModel\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eMessagesModel\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eBlogsModel\u003c/span\u003e)\n@\u003cspan class=\"hljs-title function_\"\u003econtroller\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003estore\u003c/span\u003e)=\u0026gt;\u003c/span\u003e ({\n    \u003cspan class=\"hljs-attr\"\u003eme\u003c/span\u003e: store.\u003cspan class=\"hljs-property\"\u003eusers\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eme\u003c/span\u003e，\n    \u003cspan class=\"hljs-attr\"\u003eblogs\u003c/span\u003e: store.\u003cspan class=\"hljs-property\"\u003eblogs\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003elist\u003c/span\u003e\n}))\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eIndexController\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title class_ inherited__\"\u003eReact.Component\u003c/span\u003e {\n\n    \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e componentDidmount () {\n        \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e {dispatch} = \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eprops\u003c/span\u003e;\n\n        \u003cspan class=\"hljs-title class_\"\u003eDialog\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eshowLoadingProgress\u003c/span\u003e();\n\n        \u003cspan class=\"hljs-comment\"\u003e// invoke services\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e [me, blogs] = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003ePromise\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eall\u003c/span\u003e([\n            \u003cspan class=\"hljs-title function_\"\u003edispatch\u003c/span\u003e({\u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\u0026#x27;users/getUser\u0026#x27;\u003c/span\u003e}),\n            \u003cspan class=\"hljs-title function_\"\u003edispatch\u003c/span\u003e({\u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\u0026#x27;blogs/getBlogs\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003epageIndex\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003epageSize\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e});\n        ]);\n\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(me != \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e){\n            \u003cspan class=\"hljs-comment\"\u003e// an user has logined， done some acton about the user.\u003c/span\u003e\n        }\n\n         \u003cspan class=\"hljs-title class_\"\u003eDialog\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ehideLoadingProgress\u003c/span\u003e();\n    }\n\n    render () {\n        \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e {me, blogs} = \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eprops\u003c/span\u003e;\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003eme.name\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch4 id=\"%E5%9C%A8-model-%E4%B8%AD%E7%BB%84%E8%A3%85%E4%B8%9A%E5%8A%A1\"\u003e\n                  在 Model 中组装业务\n                \u003c/h4\u003e\u003cp\u003e在 Model 中也使用\u003ccode\u003ethis.dispatch(action)\u003c/code\u003e来调用其它业务，和 Controller 中调用 model 中的业务方法一致。如果是调用 Model 自身的其它方法，可以直接执行函数调用。\u003c/p\u003e\n\u003cp\u003e下面假设了一个场景：用户在博客列表页，点击收藏了某个博客文章，调用服务端收藏接口成功后，为了保持本地数据一致，需要更新统计模块的收藏总数，以及博客列表中文章的收藏状态，使整个应用的数据状态保持一致和及时更新界面，下面使用了片段代码来演示如何实现。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eReact\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e model \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@symph/joy/model\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eUserModel\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;../models/UsersModel\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eBlogsModel\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;../models/BlogsModel\u0026quot;\u003c/span\u003e;\n\n@\u003cspan class=\"hljs-title function_\"\u003emodel\u003c/span\u003e()\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eBlogsModel\u003c/span\u003e {\n  initState = {\n    \u003cspan class=\"hljs-attr\"\u003eblogs\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// all blogs in brower memory\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003efavBlogs\u003c/span\u003e: [], \u003cspan class=\"hljs-comment\"\u003e//all favourite blogs in brower memory\u003c/span\u003e\n  };\n\n  \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efavBlog\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e{ blog }\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e { favBlogs } = \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003egetState\u003c/span\u003e();\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e resp = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efetch\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;https://www.example.com/api/blogs/fav\u0026quot;\u003c/span\u003e, { \u003cspan class=\"hljs-attr\"\u003eblogId\u003c/span\u003e: blog.\u003cspan class=\"hljs-property\"\u003eid\u003c/span\u003e }, { \u003cspan class=\"hljs-attr\"\u003emethod\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;POST\u0026quot;\u003c/span\u003e });\n\n    blog.\u003cspan class=\"hljs-property\"\u003eisFav\u003c/span\u003e = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e; \u003cspan class=\"hljs-comment\"\u003e// update the blog\u0026#x27;s fav status\u003c/span\u003e\n    \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003esetState\u003c/span\u003e({\n      \u003cspan class=\"hljs-attr\"\u003efavBlogs\u003c/span\u003e: [...favBlogs, blog],\n    });\n\n    \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eupdateBlog\u003c/span\u003e({ blog }); \u003cspan class=\"hljs-comment\"\u003e// invoke self service\u003c/span\u003e\n\n    \u003cspan class=\"hljs-comment\"\u003e// update the count of user‘s favourite blogs\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003edispatch\u003c/span\u003e({\n      \u003cspan class=\"hljs-comment\"\u003e// invoke other model’s service\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;statistics/favBlogsCount\u0026quot;\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003eincrease\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e,\n    });\n  }\n\n  \u003cspan class=\"hljs-comment\"\u003e/**\n   * update the  blog, if the blog has changed\n   **/\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eupdateBlog\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e{ blog }\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e { blogs } = \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003egetState\u003c/span\u003e();\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e i = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e; i \u0026lt; blogs.\u003cspan class=\"hljs-property\"\u003elenght\u003c/span\u003e; i++) {\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (blog.\u003cspan class=\"hljs-property\"\u003eid\u003c/span\u003e === blogs[i].\u003cspan class=\"hljs-property\"\u003eid\u003c/span\u003e) {\n        \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003esetState\u003c/span\u003e({\n          \u003cspan class=\"hljs-attr\"\u003eblogs\u003c/span\u003e: [...blogs.\u003cspan class=\"hljs-title function_\"\u003esplice\u003c/span\u003e(i, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, blog)],\n        });\n        bread;\n      }\n    }\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n                \u003ch3 id=\"%E4%BD%9C%E4%B8%BA-nodejs-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BA%94%E7%94%A8%E7%9A%84-view-%E6%A8%A1%E5%9D%97\"\u003e\n                  作为 Node.js 服务端应用的 View 模块\n                \u003c/h3\u003e\u003cp\u003e\u003ca href=\"https://lnlfps.github.io/symph-joy/#/getting-started?id=%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-server\"\u003e使用方法\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e@symph/joy 可以作为 express 或者 koa 等框架的 View 模块，和传统的模板渲染方式不一样的是\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eapi 接口和 View 完全分离，View 是@symph/joy 的一个应用，在服务端和客户端渲染界面时，根据需要主动从 api 里获取数据，express 里不再编写任何界面相关的代码了\u003c/li\u003e\n\u003cli\u003e不需要给每个页面编写服务端路由，只需要一个能匹配@symph/joy 应用所有页面路径的正则路径即可\u003c/li\u003e\n\u003cli\u003e不再需要任何其他模板技术（jade、handlebars、ejs 等），使用 React 渲染出 html 内容和业务界面\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch2 id=\"%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93%E7%9A%84%E9%97%AE%E9%A2%98\"\u003e\n                  服务端渲染的问题\n                \u003c/h2\u003e\n                \u003ch3 id=\"%E5%90%8C%E4%B8%80%E4%BB%BD%E4%BB%A3%E7%A0%81%EF%BC%8C%E5%9C%A8%E4%B8%A4%E7%AB%AF%E8%BF%90%E8%A1%8C%EF%BC%9F\"\u003e\n                  同一份代码，在两端运行？\n                \u003c/h3\u003e\u003cp\u003e这个问题，看起来是如何实现同构的问题，但事实上现阶段实现前端同构应用还是件很困难的事，对框架和业务开发都是件有挑战的事，同构还只是停留在概念阶段。而我们想做的是，让开发人员在进行业务开发时拥有同构的体验，让框架来解决部分跨端运行的问题。在@symph/joy 中，应用的 Model、Controller 和 View 组件都支持在两端运行，开发人员只需要专注于业务实现。\u003c/p\u003e\n\n                \u003ch3 id=\"%E5%90%8C%E6%9E%84%E7%9A%84%E6%A8%A1%E5%9D%97\"\u003e\n                  同构的模块\n                \u003c/h3\u003e\u003cp\u003e@symph/joy 只将两端运行的有差异的模块进行了同构化，例如\u003ccode\u003efetch\u003c/code\u003e方法使用了\u003ca href=\"https://github.com/matthew-andrews/isomorphic-fetch\"\u003eisomorphic-fetch\u003c/a\u003e库，当\u003ccode\u003efetch\u003c/code\u003e识别到在服务端运行时，底层调用\u003ccode\u003enode-fetch\u003c/code\u003e来发送网络请求，如果是在浏览器上，则使用\u003ccode\u003ewhatwg-fetch\u003c/code\u003e发送请求，在进行工功能开发是，我们只需要直接调用\u003ccode\u003efetch\u003c/code\u003e方法来获取数据即可。\u003c/p\u003e\n\u003cp\u003e为了方便使用，@symph/joy-plugins 提供的插件，都解决了日常开发中常见的跨端运行问题。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e在使用第三方 UI 控件的时，要注意它是否支持服务端渲染。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n                \u003ch3 id=\"%E8%87%AA%E5%8A%A8%E7%BC%96%E8%AF%91%E5%88%B0%E7%9B%AE%E6%A0%87%E7%8E%AF%E5%A2%83\"\u003e\n                  自动编译到目标环境\n                \u003c/h3\u003e\u003cp\u003e在 Node.js 和浏览器上运行的 js 代码并不是完全相同的，例如在 Node.js 上不需要加载样式、不加载图片、动态 import 模块无法同步渲染等。他们执行的结果也不一样，Node.js 主要是渲染出 html，客户端则是渲染出用户可见的画面。同时需要针对目标环境做打包优化，在所以@symph/joy 提供了两套 webpack 配置，将同一份源码编译到浏览器和服务器上的两套代码，在编译时，这两个编译过程会同步进行 \b\b 以提高编译效率。\u003c/p\u003e\n\u003cp\u003e下面列举了两端打包的一些差异性\u003c/p\u003e\n\u003cp\u003e客户端\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e开发环境输出错误详情 \b\u003c/li\u003e\n\u003cli\u003e热加载插件\u003c/li\u003e\n\u003cli\u003e代码混淆压缩\u003c/li\u003e\n\u003cli\u003e公共代码提取\u003c/li\u003e\n\u003cli\u003e应用入口 Component 标识\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e服务端\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eimport\u003c/code\u003e导入指令替换为同步方式导入，支持服务端渲染\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch3 id=\"componentprepare-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F\"\u003e\n                  \u003ccode\u003ecomponentPrepare\u003c/code\u003e 生命周期\n                \u003c/h3\u003e\u003cp\u003e在用户请求页面时，服务端加载页面所包含的组件，运行所有\u003ccode\u003econtroller\u003c/code\u003e组件的\u003ccode\u003ecomponentPrepare\u003c/code\u003e方法，获取组件需要的数据，然后渲染出 html 文档，最后在浏览器上渲染 DOM 和绑定事件。\u003ccode\u003ecomponentPrepare\u003c/code\u003e方法保证了在服务端和客户端只执行一次数据获取。以上几个执行步骤，可以根据运行环境和配置，自动的安排其执行的地方，例如可以通过自定义配置，手动关闭服务端的 html 渲染，只预加载界面数据，浏览器直接使用数据渲染出界面，这样依然可以提升首屏渲染效率，同时也减少了服务端运行的部分压力，也可以完全关闭服务端的 \b 数据获取和 html 渲染两个步骤，全部执行步骤在浏览器上完成。\b\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ecomponentPrepare\u003c/code\u003e只是定义在\u003ccode\u003eController\u003c/code\u003e上的一个普通实例方法，\b 框架在 \b 组件初始化时自动调用，也可以在运行的过程中手动调用，\b 用于重新刷新界面数据等操作。\u003c/p\u003e\n\n                \u003ch2 id=\"%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98\"\u003e\n                  跨域问题\n                \u003c/h2\u003e\u003cp\u003e在浏览器上使用 js 发送的异步网络请求，处于安全考虑是不允许跨域的，常见的解决方案有 jsonp 或者在服务端集成一个代理服务器，在@sympy/joy 中，我们希望前端开发也能拥有和原生开发一样的体验，不再为跨域请求烦恼，在@symph/joy 中集成了一个自动代理转发服务，发送请求时只需要指定目标地址即可，例如\u003ccode\u003efetch(\u0026#39;https://www.example.com/api/hello\u0026#39;)\u003c/code\u003e，\u003ccode\u003efetch\u003c/code\u003e内部会判断是否跨域，以及是否启动代理转发请求。\u003c/p\u003e\n\u003cp\u003e代理服务在@symph/joy 服务端上运行，所以如果打包成静态版本，部署在其它服务器或者静态文件服务器上，该功能将无法启动。如果部署在其它 Node.js 服务器上，依然可以通过手动集成\u003ccode\u003eproxy-api-middleware\u003c/code\u003e插件来启动该服务。\u003c/p\u003e\n\n                \u003ch2 id=\"%E6%89%93%E5%8C%85%E9%9D%99%E6%80%81%E7%89%88%E6%9C%AC\"\u003e\n                  打包静态版本\n                \u003c/h2\u003e\u003cp\u003e静态版本即不需要 Node.js 做任何的渲染工作，也可以脱离 Node.js 运行。几乎不用做任何更改，就可以使用\u003ccode\u003ejoy export\u003c/code\u003e将@symph/joy 打包为静态版本，直接将打包后的输出文件(\u003ccode\u003eout\u003c/code\u003e目录下的所有文件)拷贝到静态服务器上就可完成部署，浏览器加载这些静态资源(js、css、image 等)运行应用。静态版本依然支持@symph/joy 提供的大部分功能，例如 MVC 组件、代码分割、动态路由等。\u003c/p\u003e\n\u003cp\u003e由于没有了 Node.js 服务端的支持，将失去服务端数据预加载、渲染、跨域请求代理转发等功能，对于用户的影响主要是首屏等待的时间更长，但代码压缩、按需加载、动态路由等功能依然能保证首屏加载足够快，建议此时添加页面加载动画，用户体验会更好。对于业务开发人员来说，跨域业务请求将不能直接发送，常见的解决方案有，在后方业务服务上返回\u003ccode\u003eindex.html\u003c/code\u003e(静态版本中已经渲染好的 html 文件)文件，这样 html 文档和业务 api 请求在就在同一个域名下了，或者配置 nginx 反向代理，将业务请求和页面请求合并到同一个域名下，还可以使用 jsonp 发送跨域请求等。\u003c/p\u003e\n","anchor":[{"type":"heading","raw":"## 集成 next.js 和 dva 遇到的一些问题\n\n","depth":2,"text":"集成 next.js 和 dva 遇到的一些问题","tokens":[{"type":"text","raw":"集成 next.js 和 dva 遇到的一些问题","text":"集成 next.js 和 dva 遇到的一些问题"}],"id":"#%E9%9B%86%E6%88%90-nextjs-%E5%92%8C-dva-%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98"},{"type":"heading","raw":"## 需要一个怎样的基础框架\n\n","depth":2,"text":"需要一个怎样的基础框架","tokens":[{"type":"text","raw":"需要一个怎样的基础框架","text":"需要一个怎样的基础框架"}],"id":"#%E9%9C%80%E8%A6%81%E4%B8%80%E4%B8%AA%E6%80%8E%E6%A0%B7%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A1%86%E6%9E%B6","children":[{"type":"heading","raw":"### 远离复杂的配置\n\n","depth":3,"text":"远离复杂的配置","tokens":[{"type":"text","raw":"远离复杂的配置","text":"远离复杂的配置"}],"id":"#%E8%BF%9C%E7%A6%BB%E5%A4%8D%E6%9D%82%E7%9A%84%E9%85%8D%E7%BD%AE"},{"type":"heading","raw":"### 简单的项目结构\n\n","depth":3,"text":"简单的项目结构","tokens":[{"type":"text","raw":"简单的项目结构","text":"简单的项目结构"}],"id":"#%E7%AE%80%E5%8D%95%E7%9A%84%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"},{"type":"heading","raw":"### 简化前端技术概念\n\n","depth":3,"text":"简化前端技术概念","tokens":[{"type":"text","raw":"简化前端技术概念","text":"简化前端技术概念"}],"id":"#%E7%AE%80%E5%8C%96%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%A6%82%E5%BF%B5"},{"type":"heading","raw":"### 封装一些通用模块\n\n","depth":3,"text":"封装一些通用模块","tokens":[{"type":"text","raw":"封装一些通用模块","text":"封装一些通用模块"}],"id":"#%E5%B0%81%E8%A3%85%E4%B8%80%E4%BA%9B%E9%80%9A%E7%94%A8%E6%A8%A1%E5%9D%97"}]},{"type":"heading","raw":"## MVC 的思考\n\n","depth":2,"text":"MVC 的思考","tokens":[{"type":"text","raw":"MVC 的思考","text":"MVC 的思考"}],"id":"#mvc-%E7%9A%84%E6%80%9D%E8%80%83","children":[{"type":"heading","raw":"### 为什么不是 MVVM？\n\n","depth":3,"text":"为什么不是 MVVM？","tokens":[{"type":"text","raw":"为什么不是 MVVM？","text":"为什么不是 MVVM？"}],"id":"#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E6%98%AF-mvvm%EF%BC%9F"},{"type":"heading","raw":"### 如何实现 MVC\n\n","depth":3,"text":"如何实现 MVC","tokens":[{"type":"text","raw":"如何实现 MVC","text":"如何实现 MVC"}],"id":"#%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0-mvc"},{"type":"heading","raw":"### 如何编排业务流程？\n\n","depth":3,"text":"如何编排业务流程？","tokens":[{"type":"text","raw":"如何编排业务流程？","text":"如何编排业务流程？"}],"id":"#%E5%A6%82%E4%BD%95%E7%BC%96%E6%8E%92%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B%EF%BC%9F","children":[{"type":"heading","raw":"#### 在 Controller 中组合业务\n\n","depth":4,"text":"在 Controller 中组合业务","tokens":[{"type":"text","raw":"在 Controller 中组合业务","text":"在 Controller 中组合业务"}],"id":"#%E5%9C%A8-controller-%E4%B8%AD%E7%BB%84%E5%90%88%E4%B8%9A%E5%8A%A1"},{"type":"heading","raw":"#### 在 Model 中组装业务\n\n","depth":4,"text":"在 Model 中组装业务","tokens":[{"type":"text","raw":"在 Model 中组装业务","text":"在 Model 中组装业务"}],"id":"#%E5%9C%A8-model-%E4%B8%AD%E7%BB%84%E8%A3%85%E4%B8%9A%E5%8A%A1"}]},{"type":"heading","raw":"### 作为 Node.js 服务端应用的 View 模块\n\n","depth":3,"text":"作为 Node.js 服务端应用的 View 模块","tokens":[{"type":"text","raw":"作为 Node.js 服务端应用的 View 模块","text":"作为 Node.js 服务端应用的 View 模块"}],"id":"#%E4%BD%9C%E4%B8%BA-nodejs-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BA%94%E7%94%A8%E7%9A%84-view-%E6%A8%A1%E5%9D%97"}]},{"type":"heading","raw":"## 服务端渲染的问题\n\n","depth":2,"text":"服务端渲染的问题","tokens":[{"type":"text","raw":"服务端渲染的问题","text":"服务端渲染的问题"}],"id":"#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93%E7%9A%84%E9%97%AE%E9%A2%98","children":[{"type":"heading","raw":"### 同一份代码，在两端运行？\n\n","depth":3,"text":"同一份代码，在两端运行？","tokens":[{"type":"text","raw":"同一份代码，在两端运行？","text":"同一份代码，在两端运行？"}],"id":"#%E5%90%8C%E4%B8%80%E4%BB%BD%E4%BB%A3%E7%A0%81%EF%BC%8C%E5%9C%A8%E4%B8%A4%E7%AB%AF%E8%BF%90%E8%A1%8C%EF%BC%9F"},{"type":"heading","raw":"### 同构的模块\n\n","depth":3,"text":"同构的模块","tokens":[{"type":"text","raw":"同构的模块","text":"同构的模块"}],"id":"#%E5%90%8C%E6%9E%84%E7%9A%84%E6%A8%A1%E5%9D%97"},{"type":"heading","raw":"### 自动编译到目标环境\n\n","depth":3,"text":"自动编译到目标环境","tokens":[{"type":"text","raw":"自动编译到目标环境","text":"自动编译到目标环境"}],"id":"#%E8%87%AA%E5%8A%A8%E7%BC%96%E8%AF%91%E5%88%B0%E7%9B%AE%E6%A0%87%E7%8E%AF%E5%A2%83"},{"type":"heading","raw":"### `componentPrepare` 生命周期\n\n","depth":3,"text":"`componentPrepare` 生命周期","tokens":[{"type":"codespan","raw":"`componentPrepare`","text":"componentPrepare"},{"type":"text","raw":" 生命周期","text":" 生命周期"}],"id":"#%60componentprepare%60-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"}]},{"type":"heading","raw":"## 跨域问题\n\n","depth":2,"text":"跨域问题","tokens":[{"type":"text","raw":"跨域问题","text":"跨域问题"}],"id":"#%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98"},{"type":"heading","raw":"## 打包静态版本\n\n","depth":2,"text":"打包静态版本","tokens":[{"type":"text","raw":"打包静态版本","text":"打包静态版本"}],"id":"#%E6%89%93%E5%8C%85%E9%9D%99%E6%80%81%E7%89%88%E6%9C%AC"}]},{"title":"主要版本升级日志","path":"/v1/change-log","file":"docs\\v1\\07-change-log.md","hasMenu":false,"mdContent":"# 主要版本升级日志\r\n\r\n## 1.2.3\r\n\r\n- 重构 api 代理模式，支持特定路径代理转发，支持 websocket 转发。\r\n- fetch 文件优化，自动代理模式优化。\r\n- bug 修复。\r\n\r\n## 1.2.0\r\n\r\n- 支持 react hook。提供 hook 和 model 链接\r\n- 升级了各主要依赖库\r\n- fix: react-hot-loader 热更新时 componentPrepare 被重复调用\r\n- fix: n 个常规问题\r\n\r\n## 0.5.0\r\n\r\n- 优化 webpack 配置，使其更适合单页渐进式应用，减少首屏 js 加载大小。将`_app.js` `_error.js` `runtime/webapck.[hash].js`合并到`main.js`中\r\n- 优化@symph/joy-css 和@symph/joy-less 插件，优化后：`styles.css`添加 hash 标识，有效利用缓存；自动注入到 document 中，不再需要自定义`_document.js`\r\n- 去掉react-router-redux@5.0.0-alpha.9, 该插件已停止更新，并会导致生产包运行错误，替换为的 connected-react-router\r\n- 去掉从 next.js 继承过来的 pages 目录，将`pages/_document.js`移动到`src/_document.js`，简化项目目录结构\r\n- fix: 服务端渲染时，所有在 chunks 在首页就被全部加载\r\n- fix: build 时出现`id not found``错误，升级 webpack 到 4.18.0\r\n- example: 添加集成 antd 的例子\r\n","htmlContent":"\n                \u003ch1 id=\"%E4%B8%BB%E8%A6%81%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7%E6%97%A5%E5%BF%97\"\u003e\n                  主要版本升级日志\n                \u003c/h1\u003e\n                \u003ch2 id=\"12.3\"\u003e\n                  1.2.3\n                \u003c/h2\u003e\u003cul\u003e\n\u003cli\u003e重构 api 代理模式，支持特定路径代理转发，支持 websocket 转发。\u003c/li\u003e\n\u003cli\u003efetch 文件优化，自动代理模式优化。\u003c/li\u003e\n\u003cli\u003ebug 修复。\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch2 id=\"12.0\"\u003e\n                  1.2.0\n                \u003c/h2\u003e\u003cul\u003e\n\u003cli\u003e支持 react hook。提供 hook 和 model 链接\u003c/li\u003e\n\u003cli\u003e升级了各主要依赖库\u003c/li\u003e\n\u003cli\u003efix: react-hot-loader 热更新时 componentPrepare 被重复调用\u003c/li\u003e\n\u003cli\u003efix: n 个常规问题\u003c/li\u003e\n\u003c/ul\u003e\n\n                \u003ch2 id=\"05.0\"\u003e\n                  0.5.0\n                \u003c/h2\u003e\u003cul\u003e\n\u003cli\u003e优化 webpack 配置，使其更适合单页渐进式应用，减少首屏 js 加载大小。将\u003ccode\u003e_app.js\u003c/code\u003e \u003ccode\u003e_error.js\u003c/code\u003e \u003ccode\u003eruntime/webapck.[hash].js\u003c/code\u003e合并到\u003ccode\u003emain.js\u003c/code\u003e中\u003c/li\u003e\n\u003cli\u003e优化@symph/joy-css 和@symph/joy-less 插件，优化后：\u003ccode\u003estyles.css\u003c/code\u003e添加 hash 标识，有效利用缓存；自动注入到 document 中，不再需要自定义\u003ccode\u003e_document.js\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e去掉\u003ca href=\"mailto:\u0026#x72;\u0026#101;\u0026#97;\u0026#x63;\u0026#x74;\u0026#x2d;\u0026#x72;\u0026#x6f;\u0026#117;\u0026#x74;\u0026#101;\u0026#x72;\u0026#45;\u0026#x72;\u0026#101;\u0026#x64;\u0026#x75;\u0026#120;\u0026#x40;\u0026#x35;\u0026#46;\u0026#48;\u0026#x2e;\u0026#48;\u0026#45;\u0026#97;\u0026#x6c;\u0026#112;\u0026#104;\u0026#97;\u0026#46;\u0026#57;\"\u003e\u0026#x72;\u0026#101;\u0026#97;\u0026#x63;\u0026#x74;\u0026#x2d;\u0026#x72;\u0026#x6f;\u0026#117;\u0026#x74;\u0026#101;\u0026#x72;\u0026#45;\u0026#x72;\u0026#101;\u0026#x64;\u0026#x75;\u0026#120;\u0026#x40;\u0026#x35;\u0026#46;\u0026#48;\u0026#x2e;\u0026#48;\u0026#45;\u0026#97;\u0026#x6c;\u0026#112;\u0026#104;\u0026#97;\u0026#46;\u0026#57;\u003c/a\u003e, 该插件已停止更新，并会导致生产包运行错误，替换为的 connected-react-router\u003c/li\u003e\n\u003cli\u003e去掉从 next.js 继承过来的 pages 目录，将\u003ccode\u003epages/_document.js\u003c/code\u003e移动到\u003ccode\u003esrc/_document.js\u003c/code\u003e，简化项目目录结构\u003c/li\u003e\n\u003cli\u003efix: 服务端渲染时，所有在 chunks 在首页就被全部加载\u003c/li\u003e\n\u003cli\u003efix: build 时出现`id not found``错误，升级 webpack 到 4.18.0\u003c/li\u003e\n\u003cli\u003eexample: 添加集成 antd 的例子\u003c/li\u003e\n\u003c/ul\u003e\n","anchor":[{"type":"heading","raw":"## 1.2.3\n\n","depth":2,"text":"1.2.3","tokens":[{"type":"text","raw":"1.2.3","text":"1.2.3"}],"id":"#12.3"},{"type":"heading","raw":"## 1.2.0\n\n","depth":2,"text":"1.2.0","tokens":[{"type":"text","raw":"1.2.0","text":"1.2.0"}],"id":"#12.0"},{"type":"heading","raw":"## 0.5.0\n\n","depth":2,"text":"0.5.0","tokens":[{"type":"text","raw":"0.5.0","text":"0.5.0"}],"id":"#05.0"}]}],"defaultOpenKeys":[]}},{"type":"reactAppInitManager/__SET_STATE","state":{"/v1":{"pathname":"/v1","index":false,"initStatic":2}}}]},{"pathname":"/v1/examples","ssgData":[{"type":"docsModel/__SET_STATE","state":{"loadingCurrentDoc":true}},{"type":"docsModel/__SET_STATE","state":{"loadingCurrentDoc":true}},{"type":"docsModel/__SET_STATE","state":{"loadCurrentDocErr":null,"currentDoc":{"title":"示例","path":"/v1/examples","file":"docs\\v1\\05-examples.md","hasMenu":false,"mdContent":"# 示例\r\n\r\n- [hello-world](https://github.com/lnlfps/symph-joy/tree/master/examples/hello-world) 最简单的例子\r\n- [basic](https://github.com/lnlfps/symph-joy/tree/master/examples/basic) 展示主要特性的使用方法\r\n- [with-element-react](https://github.com/lnlfps/symph-joy/tree/master/examples/with-element-react) 集成 element-react UI 框架\r\n- [with-antd](https://github.com/lnlfps/symph-joy/tree/master/examples/with-antd) 集成 antd UI 框架\r\n- [with-antd](https://github.com/lnlfps/symph-joy/tree/master/examples/with-antd-mobile) 集成 antd-mobile UI 框架\r\n","htmlContent":"\n                \u003ch1 id=\"%E7%A4%BA%E4%BE%8B\"\u003e\n                  示例\n                \u003c/h1\u003e\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/lnlfps/symph-joy/tree/master/examples/hello-world\"\u003ehello-world\u003c/a\u003e 最简单的例子\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/lnlfps/symph-joy/tree/master/examples/basic\"\u003ebasic\u003c/a\u003e 展示主要特性的使用方法\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/lnlfps/symph-joy/tree/master/examples/with-element-react\"\u003ewith-element-react\u003c/a\u003e 集成 element-react UI 框架\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/lnlfps/symph-joy/tree/master/examples/with-antd\"\u003ewith-antd\u003c/a\u003e 集成 antd UI 框架\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/lnlfps/symph-joy/tree/master/examples/with-antd-mobile\"\u003ewith-antd\u003c/a\u003e 集成 antd-mobile UI 框架\u003c/li\u003e\n\u003c/ul\u003e\n","anchor":[]},"titleTrees":[],"loadingCurrentDoc":false}},{"type":"reactAppInitManager/__SET_STATE","state":{"/v1/examples":{"pathname":"/v1/examples","index":false,"initStatic":2}}}]}],"props":{},"page":"/v1/examples","query":{},"buildId":"wlOsApI5V3lmjJftaMJj9","joyExport":true,"isFallback":false,"ssr":true,"gip":true}</script><script nomodule="" src="/_joy/static/chunks/polyfills-661efe1e66c152d86266.js"></script><script src="/_joy/static/chunks/main-afae04c633ecb7831b2d.js" async=""></script><script src="/_joy/static/chunks/webpack-373fdeea3ec48be3183e.js" async=""></script><script src="/_joy/static/chunks/framework-c68016514741a3bee8af.js" async=""></script><script src="/_joy/static/chunks/commons-661a67bd51344448fa8d.js" async=""></script><script src="/_joy/static/chunks/pages/_app-7b903e89152bab22741a.js" async=""></script><script src="/_joy/static/wlOsApI5V3lmjJftaMJj9/_buildManifest.js" async=""></script><script src="/_joy/static/wlOsApI5V3lmjJftaMJj9/_ssgManifest.js" async=""></script></body></html>